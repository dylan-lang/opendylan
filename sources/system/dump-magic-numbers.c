#include <limits.h>
#include <stddef.h>
#include <stdio.h>

/* TARGET HEADERS */
#include <errno.h>
#include <dirent.h>
#include <pwd.h>
#include <grp.h>
#include <time.h>
#include <sys/stat.h>

#define PRINT_CONSTANT(value, name) \
    printf("define constant %s :: <integer> = %d;\n", name, value);
#define PRINT_SIZEOF(type, name) \
    printf("define constant %s :: <integer> = %zu;\n", name, sizeof(type))
#define PRINT_OFFSETOF(type, member, name) \
    printf("define constant %s :: <integer> = %zu;\n", name, offsetof(type, member))

int
main(void) {

    printf("Module: system-internals\n");
    printf("License: Public Domain\n");

    printf("\n// WARNING! This file is generated by running dump-magic-numbers.c!\n");

    printf("\n");
    PRINT_CONSTANT(ENOENT,  "$ENOENT");
    PRINT_CONSTANT(EINTR,   "$EINTR");
    PRINT_CONSTANT(EACCES,  "$EACCES");
    PRINT_CONSTANT(ETXTBSY, "$ETXTBSY");
    PRINT_CONSTANT(EROFS,   "$EROFS");

    printf("\n");
    PRINT_CONSTANT(PATH_MAX, "$path-max");

    printf("\n");
    PRINT_SIZEOF(struct stat, "$stat-size");
    PRINT_OFFSETOF(struct stat, st_mode, "$st-mode-offset");
    PRINT_OFFSETOF(struct stat, st_uid,  "$st-uid-offset");
    PRINT_OFFSETOF(struct stat, st_gid,  "$st-gid-offset");
    PRINT_OFFSETOF(struct stat, st_size, "$st-size-offset");
    PRINT_OFFSETOF(struct stat, st_atime, "$st-atime-offset");
    PRINT_OFFSETOF(struct stat, st_mtime, "$st-mtime-offset");
    PRINT_OFFSETOF(struct stat, st_ctime, "$st-ctime-offset");

    printf("\n");
    PRINT_OFFSETOF(struct group, gr_name, "$gr-name-offset");

    printf("\n");
    PRINT_OFFSETOF(struct tm, tm_sec,    "$tm-sec-offset");
    PRINT_OFFSETOF(struct tm, tm_min,    "$tm-min-offset");
    PRINT_OFFSETOF(struct tm, tm_hour,   "$tm-hour-offset");
    PRINT_OFFSETOF(struct tm, tm_mday,   "$tm-mday-offset");
    PRINT_OFFSETOF(struct tm, tm_mon,    "$tm-mon-offset");
    PRINT_OFFSETOF(struct tm, tm_year,   "$tm-year-offset");
    PRINT_OFFSETOF(struct tm, tm_isdst,  "$tm-isdst-offset");
    PRINT_OFFSETOF(struct tm, tm_gmtoff, "$tm-gmtoff-offset");
    PRINT_OFFSETOF(struct tm, tm_zone,   "$tm-zone-offset");

    return 0;
}
