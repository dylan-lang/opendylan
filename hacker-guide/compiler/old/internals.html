<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="The Runtime" href="../../runtime/index.html" /><link rel="prev" title="Compiler Design (Old)" href="design.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>Compiler Internals (Old) - Open Dylan</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Open Dylan</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/images/opendylan-light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/images/opendylan-dark.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../community/index.html">Get Involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../download/index.html">Download</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Hacker Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Hacker Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../../documentation/index.html">Writing Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Writing Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/guidelines.html">Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/generating.html">Generating Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/doctower.html">Doctower</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/example.html">Example documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../build-system.html">Jam-based Build System</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">DFMC, The Dylan Flow Machine Compiler</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of DFMC, The Dylan Flow Machine Compiler</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../notes-warnings-errors.html">Notes, Warnings and Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="design.html">Compiler Design (Old)</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Compiler Internals (Old)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../runtime/index.html">The Runtime</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of The Runtime</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../runtime/object-representation.html">Object Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../runtime/calling-convention.html">Calling Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../runtime/special-features.html">Special Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../runtime/mangling.html">Name Mangling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../runtime/threads.html">Compiler Support for Threads</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../runtime/startup.html">Startup</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../runtime-manager/index.html">Runtime Manager</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Runtime Manager</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../runtime-manager/access-path.html">The ACCESS-PATH library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../runtime-manager/debugger-manager.html">The DEBUGGER-MANAGER library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../duim/index.html">DUIM - Dylan User Interface Manager</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../topics/index.html">Topics</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Topics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/method-dispatch.html">Method Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/debugging.html">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/porting.html">Porting to a New Target Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/ppml.html">The PPML library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/making-a-release.html">Release Check-list</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../proposals/index.html">Enhancement Proposals</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Enhancement Proposals</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0001-dep-process.html">DEP Purpose and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0002-define-function.html">Define Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0003-c3-linearization.html">C3 superclass linearization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0004-strings-library.html">New strings Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0005-subclass-function.html">Subclass</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0006-single-file-library.html">Single File Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0007-collection-type-safety.html">Type-Safe Limited Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0008-multi-line-strings.html">Multi-line Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0010-element-otherwise.html">Defaulted Element Reference Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0011-numeric-literal-syntax.html">Numeric Literal Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proposals/dep-0012-string-literals.html">String Literal Syntax</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../about/index.html">Tour of Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Tour of Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/hello_world.html">Hello, World!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/everything_value.html">Everything is a value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/classes.html">Classes &amp; Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/generic_functions.html">Generic Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/getters_setters_functions.html">Getters &amp; Setters are functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/keyword_arguments.html">Keyword Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/limited_types.html">Limited Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../about/examples/multiple_return_values.html">Multiple Return Values</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../getting-started-cli/index.html">Getting Started Guide</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Getting Started Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/hello-world.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/source-registries.html">Using Source Registries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/managing-dependencies.html">Managing Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/quick-tips.html">A Few More Quick Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/dylan-compiler.html">Using dylan-compiler interactively</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/dylan-environment.html">An example of dylan-environment interactive functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/editor-support.html">Editor Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/dylan-mode-for-emacs.html">Dylan Interactor Mode for Emacs (DIME)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/debugging-with-gdb-lldb.html">Debugging with GDB or LLDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/windows.html">Notes for Windows Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/environment-variables.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/cross-compilation.html">Cross Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/platform-specific.html">Platform Specific Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started-cli/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://opendylan.org/books/dpg/">Dylan Programming Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://play.opendylan.org">Dylan Playground</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://opendylan.org/books/drm/">Dylan Reference Manual</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../library-reference/index.html">Open Dylan Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Open Dylan Libraries</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../library-reference/language-extensions/index.html">Dylan Language Extensions</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Dylan Language Extensions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/language-differences.html">Language Differences</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/define-function.html">Function Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/for-iteration.html">Extensions to the FOR iteration construct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/weak-tables.html">Weak tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/inlining.html">Inlining adjectives for methods, constants, functions, and slots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/numbers.html">Integers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/object-with-elements.html">object-with-elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/macro-system-extensions.html">Macro System Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/parser-expansions.html">Parser Expansions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/alternative-curry-syntax.html">Alternative Curry Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/numeric-literals.html">Numeric Literal Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/language-extensions/string-literals.html">String Literal Syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/lid.html">LID File Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/c-ffi/index.html">The c-ffi Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../library-reference/collections/index.html">The collections Library</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of The collections Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/collections/bit-set.html">The bit-set Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/collections/bit-vector.html">The bit-vector Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/collections/collectors.html">The collectors Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/collections/plists.html">The plists Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/collections/set.html">The set Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/collections/table-extensions.html">The table-extensions Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/coloring-stream/index.html">The coloring-stream Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../library-reference/common-dylan/index.html">The common-dylan Library</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of The common-dylan Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/common-dylan/byte-vector.html">The byte-vector Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/common-dylan/common-extensions.html">The common-extensions Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/common-dylan/machine-words.html">The machine-words Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/common-dylan/simple-format.html">The simple-format Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/common-dylan/simple-profiling.html">The simple-profiling Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/common-dylan/simple-random.html">The simple-random Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/common-dylan/simple-timers.html">The simple-timers Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/common-dylan/transcendentals.html">The transcendentals Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/dood/index.html">The DOOD library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../library-reference/dylan/index.html">The dylan Library</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of The dylan Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/dylan/finalization.html">The finalization Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/dylan/primitives.html">The dylan-primitives Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/dylan/threads.html">The threads Module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../library-reference/io/index.html">The io Library</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of The io Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/io/format.html">The format Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/io/format-out.html">The format-out Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/io/print.html">The print and pprint Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/io/streams.html">The streams Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/io/standard-io.html">The standard-io Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/network/index.html">The network Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/progress-stream/index.html">The progress-stream Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/sql/index.html">The sql Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../library-reference/system/index.html">The system Library</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of The system Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/system/date.html">The date Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/system/locators.html">The locators Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/system/file-system.html">The file-system Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../library-reference/system/operating-system.html">The operating-system Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/t-lists/index.html">The t-lists Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/win32/index.html">The Win32 API Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../library-reference/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../documentation/index.html">All Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of All Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../news/index.html">News</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../documentation/cheatsheets/index.html">Cheat Sheets</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Cheat Sheets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../documentation/cheatsheets/syntax.html">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../documentation/cheatsheets/conditionals.html">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../documentation/cheatsheets/collections.html">Collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../documentation/cheatsheets/iteration.html">Iteration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../documentation/cheatsheets/scheme.html">For Schemers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation/publications.html">Publications</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../intro-dylan/index.html">Intro to Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of Intro to Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../intro-dylan/why-dylan.html">Why Dylan?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro-dylan/expressions-variables.html">Expressions &amp; Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro-dylan/methods-generic-functions.html">Methods &amp; Generic Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro-dylan/objects.html">Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro-dylan/multiple-dispatch.html">Multiple Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro-dylan/modules-libraries.html">Modules &amp; Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro-dylan/conditions.html">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro-dylan/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../corba-guide/index.html">CORBA Guide</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of CORBA Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/intro.html">About Open Dylan CORBA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/getstart.html">Quick Start Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/bank-setup.html">Setting up the Bank Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/bank-idl.html">Writing and Compiling IDL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/bank-client.html">The Bank Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/bank-server.html">The Bank Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/projects.html">Creating CORBA Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/rundebug.html">Running and Debugging CORBA Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/scepter.html">Using the Dylan IDL Compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../corba-guide/idl-app.html">An IDL Binding for Dylan</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../building-with-duim/index.html">DUIM Guide</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of DUIM Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/design.html">Designing A Simple DUIM Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/improve.html">Improving The Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/menus.html">Adding Menus To The Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/callbacks.html">Adding Callbacks to the Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/commands.html">Using Command Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/tour.html">A Tour of the DUIM Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/source.html">Source Code For The Task List Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../building-with-duim/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../duim-reference/index.html">DUIM Reference</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of DUIM Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/conventions.html">Conventions in this Manual</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/geom.html">DUIM-Geometry Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/ext-geom.html">DUIM-Extended-Geometry Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/dcs.html">DUIM-DCs Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/sheets.html">DUIM-Sheets Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/graphics.html">DUIM-Graphics Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/layouts.html">DUIM-Layouts Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/gadgets.html">DUIM-Gadgets Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/frames.html">DUIM-Frames Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../duim-reference/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../getting-started-ide/index.html">Getting Started / IDE</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of Getting Started / IDE</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/quick-start.html">Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/expanding.html">Fixing Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/model.html">Programming in Open Dylan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/projects.html">Creating and Using Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/browsing.html">Learning More About an Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/debug.html">Debugging and Interactive Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/remotedbg.html">Remote Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/coloring.html">Dispatch Optimization Coloring in the Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/delivery.html">Delivering Dylan Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/editopt.html">The Interactive Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/com-projects.html">Creating COM Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started-ide/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../release-notes/index.html">Release Notes</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of Release Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2024.1.html">Open Dylan 2024.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2023.1.html">Open Dylan 2023.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2022.1.html">Open Dylan 2022.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2020.1.html">Open Dylan 2020.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2019.1.html">Open Dylan 2019.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2014.1.html">Open Dylan 2014.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2013.2.html">Open Dylan 2013.2 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2013.1.html">Open Dylan 2013.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2012.1.html">Open Dylan 2012.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../release-notes/2011.1.html">Open Dylan 2011.1 Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../style-guide/index.html">Style Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../genindex.html">Full Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/dylan-lang/website/edit/master/source/hacker-guide/compiler/old/internals.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="compiler-internals-old">
<h1>Compiler Internals (Old)<a class="headerlink" href="#compiler-internals-old" title="Permalink to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>This chapter is an overview of the libraries involved during
compilation, information was gathered while hacking on the compiler.
It focuses only on DFMC, the Dylan Flow Machine Compiler, located in
<code class="docutils literal notranslate"><span class="pre">sources/dfmc</span></code> of the opendylan repository.</p>
<p>But first look how to get there: let’s consider the command-line
compiler, invoked with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dylan</span><span class="o">-</span><span class="n">compiler</span> <span class="o">-</span><span class="n">build</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
<p>There is a fairly long call chain to perform the compilation, starting
with command-line parsing in
sources/environment/console/command-line.dylan, which looks like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>do-execute-command(..., &lt;build-project-command&gt;)
  (defined in sources/environment/commands/build.dylan)
build-project
  (defined in sources/environment/dfmc/projects/projects.dylan)
compile-library
parse-and-compile
  (defined in sources/project-manager/projects/compilation.dylan)
parse-project-sources
  (defined in sources/dfmc/management/definitions-driver.dylan)
compile-project-definitions
  (defined in sources/dfmc/browser-support/glue-routines.dylan)
compile-library-from-definitions
  (defined in sources/dfmc/management/world.dylan called here
  under the name ``dfmc-compile-library-from-definitions`` due
  to a prefixed import.).
</pre></div>
</div>
<p>To explain these long call chains, we need some more understanding of
the different libraries of the compiler:</p>
<ul class="simple">
<li><p><strong>environment</strong> is the public API</p></li>
<li><p><strong>project-manager</strong> is a bunch of hacks for</p>
<ul>
<li><p>finding the project source (via the registry)</p></li>
<li><p>calling the compiler and linker (to create a dll/so and executable) afterwards.</p></li>
</ul>
</li>
<li><p><strong>dfmc/browser-support</strong> and <strong>environment/dfmc</strong> are the glue from
environment to DFMC.</p></li>
</ul>
<p>The big picture is pretty simple: <strong>management</strong> drives the different
libraries, some are the front-end (<strong>reader</strong>, <strong>macro-expander</strong>)
translating into definitions; some intermediate language
(<strong>conversion</strong>, <strong>optimization</strong>, <strong>typist</strong>) which work on the
flow-graph; others are back-end, including <strong>linker</strong>. There is some
support needed for the actual runtime, which is sketched in
<strong>modeling</strong> (parts of which are put into the dylan runtime library),
<strong>namespace</strong> (which handles namespaces and defines the dylan library
and its modules).</p>
<p>First we need to introduce some terminology and recapitulate some
conventions:</p>
<ul class="simple">
<li><p>the unit of compilation is a single dylan library</p></li>
<li><p>the metadata of a library is stored in DOOD, the dylan object-oriented
database</p></li>
<li><p>loose (development) vs tight (production): loose mode allows runtime
updates of definitions, like adding generic function into a sealed
domain, subclassing sealed classes - production mode has stricter
checks</p></li>
<li><p>batch compilation: when invoked from command line, or building a
complete library</p></li>
<li><p>interactive compilation: IDE feature to play around, adding a single
definition to a library</p></li>
</ul>
<p>DFMC is well structured, but sadly some libraries use each other,
which they shouldn’t (typist, conversion, optimization).</p>
<p>In the remainder of this guide, we will focus on a simple example,
which prints <code class="docutils literal notranslate"><span class="pre">Hello</span></code> x times:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">hello-world</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">()</span>
<span class="w">  </span><span class="nb">do</span><span class="p">(</span><span class="nb">curry</span><span class="p">(</span><span class="n">format-out</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="k">to:</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="dfmc-management">
<h2>dfmc-management<a class="headerlink" href="#dfmc-management" title="Permalink to this heading">#</a></h2>
<p>The library dfmc-management drives the compilation process, prints
general information about what is happening at the moment (progress,
warnings) and takes care of some global settings like opening and
closing source records, etc.</p>
<p>The main external entry point is <code class="docutils literal notranslate"><span class="pre">compile-library-from-definitions</span></code> in
world.dylan. This requires that the source has already been parsed
(really? but it calls compute-library-definitions itself!).</p>
<p>It then calls in sequence <code class="docutils literal notranslate"><span class="pre">compute-library-definitions</span></code>,
<code class="docutils literal notranslate"><span class="pre">ensure-library-compiled</span></code>, <code class="docutils literal notranslate"><span class="pre">ensure-library-glue-linked</span></code>,
<code class="docutils literal notranslate"><span class="pre">ensure-library-stripped</span></code> and <code class="docutils literal notranslate"><span class="pre">ensure-database-saved</span></code>, apart from
console output (warnings, stats).</p>
<p>The very first method, <code class="docutils literal notranslate"><span class="pre">compute-library-definitions</span></code>, calls
<code class="docutils literal notranslate"><span class="pre">ensure-library-definitions-installed</span></code>, which calls
<code class="docutils literal notranslate"><span class="pre">update-compilation-record-definitions</span></code>, which mainly calls
<code class="docutils literal notranslate"><span class="pre">compute-source-record-top-level-forms</span></code>. This passes the compilation
record to <code class="docutils literal notranslate"><span class="pre">read-top-level-fragment</span></code> to get a fragment and then calls
<code class="docutils literal notranslate"><span class="pre">top-level-convert-forms</span></code>.</p>
<p>The reader library defines the <code class="docutils literal notranslate"><span class="pre">read-top-level-fragment</span></code>, the
definitions library the <code class="docutils literal notranslate"><span class="pre">top-level-convert-forms</span></code>. Thus, a fragment
is read and converted into definitions.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">ensure-library-compiled</span></code> computes, finishes and checks
the data models. Afterwards the code models are generated (the control
flow graph), then type inference is done and the optimizer is run.
Finally the heaps are generated. These are methods defined in
<code class="docutils literal notranslate"><span class="pre">compilation-driver.dylan</span></code>, calling out to the modeling, conversion,
flow-graph, typist and optimizer libraries.</p>
<p>Finally the glue is emitted (in <code class="docutils literal notranslate"><span class="pre">back-end-driver.dylan</span></code>) and the
database is saved, which contains metadata of each library (like type
information, code models, etc.).</p>
<p>Some global warnings for libraries are defined and checked for in the
management library.</p>
<p>The unused file <code class="docutils literal notranslate"><span class="pre">interface.dylan</span></code> compares module and binding
definitions, in order to judge whether the public API of a
library/module has changed between two versions. Usage of this would
allow lazy recompilation: only recompile if the API has changed of a
linked library.</p>
</section>
<section id="dfmc-reader">
<h2>dfmc-reader<a class="headerlink" href="#dfmc-reader" title="Permalink to this heading">#</a></h2>
<p>This library reads the Dylan source, tokenizes it, annotates source
locations, and builds a parse tree. The parser is in
<code class="docutils literal notranslate"><span class="pre">parser.dylgram</span></code>, which uses <code class="docutils literal notranslate"><span class="pre">app/parser-compiler</span></code> to generate
<code class="docutils literal notranslate"><span class="pre">infix-parser.dylan</span></code>. The API used is <code class="docutils literal notranslate"><span class="pre">read-top-level-fragment</span></code>
and <code class="docutils literal notranslate"><span class="pre">re-read-fragments</span></code>.</p>
<p>Error handling is on the token level, thus a mismatched <code class="docutils literal notranslate"><span class="pre">end</span></code> is
noticed. Other sorts of errors are invalid token, integer too large,
character too large, ratios not being supported, end of input (while
more tokens were required).</p>
<p>Every <code class="docutils literal notranslate"><span class="pre">&lt;fragment&gt;</span></code>, the base class of the abstract syntax tree, has
a compilation-record and a source-position.</p>
<p>So, for the above hello-world method, <code class="docutils literal notranslate"><span class="pre">read-top-level-fragment</span></code>
returns the following parse tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">body</span><span class="o">-</span><span class="n">definition</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
  <span class="n">fragment</span><span class="o">-</span><span class="n">macro</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
  <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;method-definer&quot;</span>
  <span class="n">fragment</span><span class="o">-</span><span class="n">modifiers</span><span class="p">:</span> <span class="c1">#()</span>
  <span class="n">fragment</span><span class="o">-</span><span class="n">body</span><span class="o">-</span><span class="n">fragment</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;hello-world&quot;</span>
    <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">left</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">fragments</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;x&quot;</span>
        <span class="o">&lt;</span><span class="n">colon</span><span class="o">-</span><span class="n">colon</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;&lt;integer&gt;&quot;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">right</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;do&quot;</span>
    <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">left</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">fragments</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;curry&quot;</span>
        <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">left</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">fragments</span><span class="p">:</span>
            <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;format-out&quot;</span>
            <span class="o">&lt;</span><span class="n">comma</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">string</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="s2">&quot;Hello </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">right</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">comma</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;range&quot;</span>
        <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">left</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">fragments</span><span class="p">:</span>
            <span class="o">&lt;</span><span class="n">keyword</span><span class="o">-</span><span class="n">syntax</span><span class="o">-</span><span class="n">symbol</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="c1">#&quot;to&quot;</span>
            <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;x&quot;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">right</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">right</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">semicolon</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>NB: the type hierarchy for &lt;body-definition-fragment&gt; is:
&lt;definition-fragment&gt;, &lt;macro-call-fragment&gt;, &lt;compound-fragment&gt;,
&lt;fragment&gt;, &lt;object&gt;</p>
</section>
<section id="dfmc-definitions">
<h2>dfmc-definitions<a class="headerlink" href="#dfmc-definitions" title="Permalink to this heading">#</a></h2>
<p>Once the abstract syntax tree is generated (by the reader), it’s time
to convert this into definitions, which are the names in dylan. There
are several top-level definitions in dylan, namely: binding, class,
constant, (copy-down), domain, function, generic, macro, method,
module, namespace (library) and variable. Every definition has its
own class, inheriting from <code class="docutils literal notranslate"><span class="pre">&lt;top-level-form&gt;</span></code> (defined in
common/top-level-forms.dylan). A top level form at least contains
information about its compilation record, source location, parent
form, sequence number and dependencies and referenced variables.
Additional information available are adjectives, the word defined, its
library, original library, top level methods.</p>
<p>As a side note, dependency tracking is also defined in
<code class="docutils literal notranslate"><span class="pre">common/top-level-forms.dylan</span></code>.</p>
<p>The main entry point for the definition library is
<code class="docutils literal notranslate"><span class="pre">top-level-convert(parent,</span> <span class="pre">fragment)</span></code>, defined in
<code class="docutils literal notranslate"><span class="pre">top-level-convert.dylan</span></code>.</p>
<p>The building of definition objects relies heavily on the
macro-expander, especially on procedural macros described in
<a class="reference external" href="http://people.csail.mit.edu/jrb/Projects/dexprs.pdf">D-Expressions: Lisp Power, Dylan Style</a>. Open Dylan
extends the definitions with compiler, optimizer, primitive and
shared-symbols, mainly used internally in the compiler.</p>
<p>Looking into <code class="docutils literal notranslate"><span class="pre">define-method.dylan</span></code>, we can see a class
<code class="docutils literal notranslate"><span class="pre">&lt;method-definition&gt;</span></code>. This is built by the parser, more
specifically there is a <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">&amp;definition</span> <span class="pre">method-definer</span></code>, which
has two rules to match fragments, whereas the second rule is the error
case. The first matches any <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">method</span></code> syntax and calls
<code class="docutils literal notranslate"><span class="pre">do-define-method</span></code> with the arguments. The method
<code class="docutils literal notranslate"><span class="pre">do-define-method</span></code> defers the work to helper methods
<code class="docutils literal notranslate"><span class="pre">parse-method-adjectives</span></code> and <code class="docutils literal notranslate"><span class="pre">parse-method-signature</span></code>, and
instantiates a <code class="docutils literal notranslate"><span class="pre">&lt;method-definition&gt;</span></code> object.</p>
<p>For our hello-world example, <code class="docutils literal notranslate"><span class="pre">do-define-method</span></code> creates a single object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">method</span><span class="o">-</span><span class="n">definition</span><span class="o">&gt;</span>
  <span class="n">private</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">body</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">body</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="n">fragment</span><span class="o">-</span><span class="n">constituents</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">prefix</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">arguments</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">prefix</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">arguments</span><span class="p">:</span>
            <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;format-out&quot;</span>
            <span class="o">&lt;</span><span class="n">string</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="s2">&quot;Hello </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">function</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
            <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;curry&quot;</span>
        <span class="o">&lt;</span><span class="n">prefix</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">arguments</span><span class="p">:</span>
            <span class="o">&lt;</span><span class="n">keyword</span><span class="o">-</span><span class="n">syntax</span><span class="o">-</span><span class="n">symbol</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="c1">#&quot;to&quot;</span>
            <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;x&quot;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">function</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
            <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;range&quot;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">function</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;do&quot;</span>
  <span class="n">private</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">signature</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">method</span><span class="o">-</span><span class="n">requires</span><span class="o">-</span><span class="n">signature</span><span class="o">-</span><span class="n">spec</span><span class="o">&gt;</span>
    <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">argument</span><span class="o">-</span><span class="nb">next</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">specs</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">next</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">spec</span><span class="o">&gt;</span>
      <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;next-method&quot;</span>
    <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">argument</span><span class="o">-</span><span class="n">required</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">specs</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">typed</span><span class="o">-</span><span class="n">required</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">spec</span><span class="o">&gt;</span>
      <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="nb">type</span><span class="o">-</span><span class="n">expression</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;&lt;integer&gt;&quot;</span>
      <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;x&quot;</span>
  <span class="n">private</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">signature</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">body</span><span class="o">-</span><span class="n">fragment</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sequence</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">semicolon</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
  <span class="n">private</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">names</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;hello-world&quot;</span>
</pre></div>
</div>
<p>It is noteworthy that still no intra-library information is present,
this is top-level Dylan code without any context. All macros are
expanded.</p>
</section>
<section id="excursion-into-run-time-and-compile-time">
<h2>Excursion into run-time and compile-time<a class="headerlink" href="#excursion-into-run-time-and-compile-time" title="Permalink to this heading">#</a></h2>
<p>Some objects are defined in the compiler, but are injected into the
Dylan world. How does this happen?</p>
<p>In the Dylan library you see <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">BOOTED:</span></code> comments here and
there. The source location of well-known basic types and functions is
<code class="docutils literal notranslate"><span class="pre">dylan:dylan-user:boot-dylan-definitions</span></code>.</p>
<p>There is no definition of this specific method.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">boot-definitions-form?</span></code> (in dfmc-definitions) checks
exactly for this name. The method <code class="docutils literal notranslate"><span class="pre">top-level-convert-forms</span></code> behaves
differently if <code class="docutils literal notranslate"><span class="pre">boot-definitions-form?</span></code> returns true, namely it
calls <code class="docutils literal notranslate"><span class="pre">booted-source-sequence</span></code> (in boot-definitions.dylan) which
grabs the boot-record and returns it sorted as a vector.</p>
<p>But what is a boot-record after all? Well, its definition is all in
boot-definitions.dylan, with the explanation “records the set of
things that must be inserted into a Dylan world at the very
start. Some things are core definitions, such as converters and
macros, and these are booted at the definition level. The rest are
expressed as source to be fed to the compiler.”</p>
<p>The constant <code class="docutils literal notranslate"><span class="pre">*boot-record*</span></code> is filled by do-define-core-*. These
are called by <strong>dfmc-modeling</strong>. Namely, primitives (which names and
signatures are installed), macros, modules, libraries, classes.</p>
<p>Be aware that the actual implementation of the primitives is in the
runtime (either <code class="docutils literal notranslate"><span class="pre">sources/lib/run-time/run-time.c</span></code> or the
runtime-generator generates a runtime.o containing those definitions),
but some crucial bits, like the adjectives (<code class="docutils literal notranslate"><span class="pre">side-effect-free</span></code>,
<code class="docutils literal notranslate"><span class="pre">dynamic-extent</span></code>, <code class="docutils literal notranslate"><span class="pre">stateless</span></code> and <code class="docutils literal notranslate"><span class="pre">opposited</span></code>) are in
<strong>dfmc-modeling</strong> and are used in the optimization!</p>
<p>The core classes are emitted from modeling with actual constructors.
Be aware that the runtime layout is also recorded in run-time.h.</p>
<p>The dylan library and module definitions are in
modeling/namespaces.dylan.</p>
<p>A noteworthy comment is that a compiler (comp-0, generation 0) loads
the Dylan library (dylan-0), which contains the definitions
(defs-0). When compiling itself (comp-1), first a fresh Dylan library
(dylan-1) is built, which contains still the old booted definitions
(defs-0). It emits new definitions (defs-1) and a new boot-record when
dumping dfmc-definitions. Now the next generation compiler (comp-1)
will use these new definitions in the next Dylan (dylan-2)
library. Beware of dragons.</p>
</section>
<section id="dfmc-macro-expander">
<h2>dfmc-macro-expander<a class="headerlink" href="#dfmc-macro-expander" title="Permalink to this heading">#</a></h2>
<p>The deep magic happens here.</p>
</section>
<section id="dfmc-convert">
<h2>dfmc-convert<a class="headerlink" href="#dfmc-convert" title="Permalink to this heading">#</a></h2>
<p>Converts definition objects to model objects. In order to fulfill
this task, it looks up bindings to objects from other
libraries. Also converts the bodies of definitions to a flow
graph. Does some initial evaluation, for example <code class="docutils literal notranslate"><span class="pre">limited(&lt;vector&gt;,</span>
<span class="pre">of:</span> <span class="pre">&lt;string&gt;)</span></code> gets converted to a <code class="docutils literal notranslate"><span class="pre">&lt;&amp;limited-vector-type&gt;</span></code>
instance. Thus, it contains a poor-mans eval.</p>
<p>Also, creates init-expressions, which may be needed for the
runtime. Since everything can be dynamic, each top-level form may need
initializing.  This happens when the library is loaded.</p>
<p>Also sets up a lexical environment for the definitions, and checks
bindings.</p>
<p>Here, type variables are now recorded into the lexical environment,
the type variables are passed around while the signature is
checked.</p>
<p>After Dylan code is converted, it is in a representation which can
be passed to a back-end to generate code. Modeling objects have
corresponding compile and run time objects, and are prefixed with
an ampersand, e.g., <code class="docutils literal notranslate"><span class="pre">&lt;&amp;object&gt;</span></code>.</p>
</section>
<section id="dfmc-modeling">
<h2>dfmc-modeling<a class="headerlink" href="#dfmc-modeling" title="Permalink to this heading">#</a></h2>
<p>Contains modeling of runtime and compile time objects. Since some
calls are attempted at compile time rather than at runtime,
it provides these compile time methods with a mechanism to override
the runtime methods (<code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">&amp;override-function</span></code>). An example for
this is <code class="docutils literal notranslate"><span class="pre">^instance?</span></code>, compile time methods are prefixed with a <code class="docutils literal notranslate"><span class="pre">^</span></code>,
while compile and runtime class definitions are prefixed with <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>,
like <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">&amp;class</span> <span class="pre">&lt;type&gt;</span></code>.</p>
<p>Also, DOOD (a persistent object store) models and proxies for
compile time definitions are available in this library, in order to
load definitions of dependent libraries.</p>
</section>
<section id="dfmc-flow-graph">
<h2>dfmc-flow-graph<a class="headerlink" href="#dfmc-flow-graph" title="Permalink to this heading">#</a></h2>
<p>The flow graph consists of instances of the <code class="docutils literal notranslate"><span class="pre">&lt;computation&gt;</span></code> class,
like <code class="docutils literal notranslate"><span class="pre">&lt;if&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;loop-call&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;assignment&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;merge&gt;</span></code>. The flow
graph is in a (pseudo) static single assignment (SSA) form. Every time any
algorithm alters the flow graph, it disconnects the deprecated
computation and inserts new computations. New temporaries are
introduced if a binding is assigned to a new value. Subclasses of
<code class="docutils literal notranslate"><span class="pre">&lt;computation&gt;</span></code> model control flow, <code class="docutils literal notranslate"><span class="pre">&lt;temporary&gt;</span></code> (as well as
<code class="docutils literal notranslate"><span class="pre">&lt;referenced-object&gt;</span></code>) model data flow.</p>
<p>Computations are a doubly-linked list, with special cases for merge
nodes, loops, if, bind-exit and unwind-protect. Every computation
may have a computation-type field, which is bound to a
<code class="docutils literal notranslate"><span class="pre">&lt;type-variable&gt;</span></code>. It also may have a temporary slot, which is its
return value. Several cases, single and multiple return values, are
supported. The temporary has a link to its generator, a list of
users and a reference to its value.</p>
<p>Additional (data flow) information is kept in special slots, test
in <code class="docutils literal notranslate"><span class="pre">&lt;if&gt;</span></code>, arguments of a <code class="docutils literal notranslate"><span class="pre">&lt;call&gt;</span></code>, etc. These are all
<code class="docutils literal notranslate"><span class="pre">&lt;referenced-object&gt;</span></code>, or more specially <code class="docutils literal notranslate"><span class="pre">&lt;value-reference&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;object-reference&gt;</span></code>, etc. <code class="docutils literal notranslate"><span class="pre">&lt;object-reference&gt;</span></code> contains a binding
to its actual value.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;temporary&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;environment&gt;</span></code> classes are defined in this
library.</p>
<p><code class="docutils literal notranslate"><span class="pre">join-2x1</span></code> etc. are the operations on the flow graph.</p>
</section>
<section id="dfmc-typist">
<h2>dfmc-typist<a class="headerlink" href="#dfmc-typist" title="Permalink to this heading">#</a></h2>
<p>This library contains runtime type algebra as well as a type
inference algorithm.</p>
<p>Main entry point is <code class="docutils literal notranslate"><span class="pre">type-estimate</span></code>, which calls
<code class="docutils literal notranslate"><span class="pre">type-estimate-in-cache</span></code>. Each library contains a type-cache, mapping
from method definitions, etc. to type-variables.</p>
<p>Type variables contain an actual type estimate as well as
justifications (supporters and supportees), used for propagation of
types.</p>
<p>converts types to <code class="docutils literal notranslate"><span class="pre">&lt;type-estimate&gt;</span></code> objects</p>
<p><code class="docutils literal notranslate"><span class="pre">type-estimate-function-from-signature</span></code> calls <code class="docutils literal notranslate"><span class="pre">type-estimate-body</span></code>
if available (instead of using types of the signature), call chain is
<code class="docutils literal notranslate"><span class="pre">type-estimate-call-from-site</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">type-estimate-call-stupidly-from-fn</span></code>
-&gt; <code class="docutils literal notranslate"><span class="pre">function-valtype</span></code></p>
<p>contains hard-coded hacks for <code class="docutils literal notranslate"><span class="pre">make</span></code>, <code class="docutils literal notranslate"><span class="pre">element</span></code>, <code class="docutils literal notranslate"><span class="pre">element-setter</span></code>
(in <code class="docutils literal notranslate"><span class="pre">type-estimate-call-from-site</span></code>)</p>
<p>typist/typist-inference.dylan:poor-mans-check-type-intersection
if #f (the temp), optimizer has determined that type check is superfluous</p>
<p>dfmc/typist-protocol.dylan:151 - does not look sane!</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">function</span><span class="w"> </span><span class="n">type-estimate=?</span><span class="p">(</span><span class="n">te1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;type-estimate&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">te2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;type-estimate&gt;</span><span class="p">)</span>
<span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">e?</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">known?</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// Dylan Torah, p. 48: te1 = te2 iff te1 &lt;= te2 &amp; te2 &lt;= te1</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="p">(</span><span class="n">sub?-1</span><span class="p">,</span><span class="w"> </span><span class="n">known?-1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type-estimate-subtype?</span><span class="p">(</span><span class="n">te1</span><span class="p">,</span><span class="w"> </span><span class="n">te2</span><span class="p">);</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="p">(</span><span class="n">sub?-2</span><span class="p">,</span><span class="w"> </span><span class="n">known?-2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type-estimate-subtype?</span><span class="p">(</span><span class="n">te1</span><span class="p">,</span><span class="w"> </span><span class="n">te2</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="dfmc-optimization">
<h2>dfmc-optimization<a class="headerlink" href="#dfmc-optimization" title="Permalink to this heading">#</a></h2>
<p>This library contains several optimizations: dead code removal,
constant folding, common subexpression elimination, inlining,
dispatch upgrading and tail call analysis.</p>
<p>Main entry point from management is <code class="docutils literal notranslate"><span class="pre">really-run-compilation-passes</span></code>.
This loops over all lambdas in the given code fragment, converts
assigned variables to a <code class="docutils literal notranslate"><span class="pre">&lt;cell&gt;</span></code> representation, renames temporaries
in conditionals, then runs the “optimizer”. This builds an
optimization queue, initially containing all computations. It calls
do-optimize on each element of the optimization-queue, as long as
it returns <code class="docutils literal notranslate"><span class="pre">#f</span></code>. (The protocol is that if an optimization was successful,
it returns <code class="docutils literal notranslate"><span class="pre">#t</span></code>, if it was not successful, <code class="docutils literal notranslate"><span class="pre">#f</span></code>). For different types
of computations different optimizations are run. Default
optimizations are deletion of useless computations and constant
folding. <code class="docutils literal notranslate"><span class="pre">&lt;bind&gt;</span></code> is skipped, for <code class="docutils literal notranslate"><span class="pre">&lt;function-call&gt;</span></code> additionally
upgrade (analyzes the call, tries to get rid of gf dispatch) and
inlining is done. <code class="docutils literal notranslate"><span class="pre">&lt;primitive-call&gt;</span></code> are optimized by <code class="docutils literal notranslate"><span class="pre">analyze-calls</span></code>.</p>
<p>constant folds (constant-folding.dylan):</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="w">   </span><span class="c1">// The following is because we seem to have a bogus class hierarchy</span>
<span class="w">   </span><span class="c1">// here 8(</span>
<span class="w">   </span><span class="c1">// We mustn&#39;t propagate a constraint type above its station, since</span>
<span class="w">   </span><span class="c1">// the constraint is typically local (true within a particular</span>
<span class="w">   </span><span class="c1">// branch, say).</span>
<span class="w">   </span><span class="o">&amp;</span><span class="w"> </span><span class="n">~instance?</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;constrain-type&gt;</span><span class="p">)</span>

<span class="n">optimization/dispatch</span><span class="p">.</span><span class="k">dylan:</span><span class="w"> </span><span class="n">gf</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="n">optimization</span>
</pre></div>
</div>
<p>optimization/assignment: here happens the “occurrence typing”
(type inference for instance?)…
<code class="docutils literal notranslate"><span class="pre">&lt;constrain-type&gt;</span></code> is only for the instance? and conditionals hack</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../runtime/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">The Runtime</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="design.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Compiler Design (Old)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2011-2023, Dylan Hackers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Compiler Internals (Old)</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#dfmc-management">dfmc-management</a></li>
<li><a class="reference internal" href="#dfmc-reader">dfmc-reader</a></li>
<li><a class="reference internal" href="#dfmc-definitions">dfmc-definitions</a></li>
<li><a class="reference internal" href="#excursion-into-run-time-and-compile-time">Excursion into run-time and compile-time</a></li>
<li><a class="reference internal" href="#dfmc-macro-expander">dfmc-macro-expander</a></li>
<li><a class="reference internal" href="#dfmc-convert">dfmc-convert</a></li>
<li><a class="reference internal" href="#dfmc-modeling">dfmc-modeling</a></li>
<li><a class="reference internal" href="#dfmc-flow-graph">dfmc-flow-graph</a></li>
<li><a class="reference internal" href="#dfmc-typist">dfmc-typist</a></li>
<li><a class="reference internal" href="#dfmc-optimization">dfmc-optimization</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=2df60dd4"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>