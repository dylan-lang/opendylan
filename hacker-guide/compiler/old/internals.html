
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compiler Internals (Old) &mdash; Open Dylan Hacker&#39;s Guide</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/opendylan.org/css/opendylan-docs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="The Runtime" href="../../runtime/index.html" />
    <link rel="prev" title="Compiler Design (Old)" href="design.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Open Dylan Hacker's Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../documentation/index.html">Writing Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build-system.html">Jam-based Build System</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">DFMC, The Dylan Flow Machine Compiler</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../notes-warnings-errors.html">Notes, Warnings and Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="design.html">Compiler Design (Old)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Compiler Internals (Old)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../runtime/index.html">The Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../runtime-manager/index.html">Runtime Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../duim/index.html">DUIM - Dylan User Interface Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/index.html">Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Open Dylan Hacker's Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">DFMC, The Dylan Flow Machine Compiler</a></li>
      <li class="breadcrumb-item active">Compiler Internals (Old)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/compiler/old/internals.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="compiler-internals-old">
<h1>Compiler Internals (Old)<a class="headerlink" href="#compiler-internals-old" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This chapter is an overview of the libraries involved during
compilation, information was gathered while hacking on the compiler.
It focuses only on DFMC, the Dylan Flow Machine Compiler, located in
<code class="docutils literal notranslate"><span class="pre">sources/dfmc</span></code> of the opendylan repository.</p>
<p>But first look how to get there: let’s consider the command-line
compiler, invoked with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dylan</span><span class="o">-</span><span class="n">compiler</span> <span class="o">-</span><span class="n">build</span> <span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
<p>There is a fairly long call chain to perform the compilation, starting
with command-line parsing in
sources/environment/console/command-line.dylan, which looks like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>do-execute-command(..., &lt;build-project-command&gt;)
  (defined in sources/environment/commands/build.dylan)
build-project
  (defined in sources/environment/dfmc/projects/projects.dylan)
compile-library
parse-and-compile
  (defined in sources/project-manager/projects/compilation.dylan)
parse-project-sources
  (defined in sources/dfmc/management/definitions-driver.dylan)
compile-project-definitions
  (defined in sources/dfmc/browser-support/glue-routines.dylan)
compile-library-from-definitions
  (defined in sources/dfmc/management/world.dylan called here
  under the name ``dfmc-compile-library-from-definitions`` due
  to a prefixed import.).
</pre></div>
</div>
<p>To explain these long call chains, we need some more understanding of
the different libraries of the compiler:</p>
<ul class="simple">
<li><p><strong>environment</strong> is the public API</p></li>
<li><p><strong>project-manager</strong> is a bunch of hacks for</p>
<ul>
<li><p>finding the project source (via the registry)</p></li>
<li><p>calling the compiler and linker (to create a dll/so and executable) afterwards.</p></li>
</ul>
</li>
<li><p><strong>dfmc/browser-support</strong> and <strong>environment/dfmc</strong> are the glue from
environment to DFMC.</p></li>
</ul>
<p>The big picture is pretty simple: <strong>management</strong> drives the different
libraries, some are the front-end (<strong>reader</strong>, <strong>macro-expander</strong>)
translating into definitions; some intermediate language
(<strong>conversion</strong>, <strong>optimization</strong>, <strong>typist</strong>) which work on the
flow-graph; others are back-end, including <strong>linker</strong>. There is some
support needed for the actual runtime, which is sketched in
<strong>modeling</strong> (parts of which are put into the dylan runtime library),
<strong>namespace</strong> (which handles namespaces and defines the dylan library
and its modules).</p>
<p>First we need to introduce some terminology and recapitulate some
conventions:</p>
<ul class="simple">
<li><p>the unit of compilation is a single dylan library</p></li>
<li><p>the metadata of a library is stored in DOOD, the dylan object-oriented
database</p></li>
<li><p>loose (development) vs tight (production): loose mode allows runtime
updates of definitions, like adding generic function into a sealed
domain, subclassing sealed classes - production mode has stricter
checks</p></li>
<li><p>batch compilation: when invoked from command line, or building a
complete library</p></li>
<li><p>interactive compilation: IDE feature to play around, adding a single
definition to a library</p></li>
</ul>
<p>DFMC is well structured, but sadly some libraries use each other,
which they shouldn’t (typist, conversion, optimization).</p>
<p>In the remainder of this guide, we will focus on a simple example,
which prints <code class="docutils literal notranslate"><span class="pre">Hello</span></code> x times:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">hello-world</span> <span class="p">(</span><span class="n">x</span> <span class="p">::</span> <span class="nc">&lt;integer&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="nb">do</span><span class="p">(</span><span class="nb">curry</span><span class="p">(</span><span class="n">format-out</span><span class="p">,</span> <span class="s">&quot;Hello %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="k">to:</span> <span class="n">x</span><span class="p">))</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="dfmc-management">
<h2>dfmc-management<a class="headerlink" href="#dfmc-management" title="Permalink to this headline">¶</a></h2>
<p>The library dfmc-management drives the compilation process, prints
general information about what is happening at the moment (progress,
warnings) and takes care of some global settings like opening and
closing source records, etc.</p>
<p>The main external entry point is <code class="docutils literal notranslate"><span class="pre">compile-library-from-definitions</span></code> in
world.dylan. This requires that the source has already been parsed
(really? but it calls compute-library-definitions itself!).</p>
<p>It then calls in sequence <code class="docutils literal notranslate"><span class="pre">compute-library-definitions</span></code>,
<code class="docutils literal notranslate"><span class="pre">ensure-library-compiled</span></code>, <code class="docutils literal notranslate"><span class="pre">ensure-library-glue-linked</span></code>,
<code class="docutils literal notranslate"><span class="pre">ensure-library-stripped</span></code> and <code class="docutils literal notranslate"><span class="pre">ensure-database-saved</span></code>, apart from
console output (warnings, stats).</p>
<p>The very first method, <code class="docutils literal notranslate"><span class="pre">compute-library-definitions</span></code>, calls
<code class="docutils literal notranslate"><span class="pre">ensure-library-definitions-installed</span></code>, which calls
<code class="docutils literal notranslate"><span class="pre">update-compilation-record-definitions</span></code>, which mainly calls
<code class="docutils literal notranslate"><span class="pre">compute-source-record-top-level-forms</span></code>. This passes the compilation
record to <code class="docutils literal notranslate"><span class="pre">read-top-level-fragment</span></code> to get a fragment and then calls
<code class="docutils literal notranslate"><span class="pre">top-level-convert-forms</span></code>.</p>
<p>The reader library defines the <code class="docutils literal notranslate"><span class="pre">read-top-level-fragment</span></code>, the
definitions library the <code class="docutils literal notranslate"><span class="pre">top-level-convert-forms</span></code>. Thus, a fragment
is read and converted into definitions.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">ensure-library-compiled</span></code> computes, finishes and checks
the data models. Afterwards the code models are generated (the control
flow graph), then type inference is done and the optimizer is run.
Finally the heaps are generated. These are methods defined in
<code class="docutils literal notranslate"><span class="pre">compilation-driver.dylan</span></code>, calling out to the modeling, conversion,
flow-graph, typist and optimizer libraries.</p>
<p>Finally the glue is emitted (in <code class="docutils literal notranslate"><span class="pre">back-end-driver.dylan</span></code>) and the
database is saved, which contains metadata of each library (like type
information, code models, etc.).</p>
<p>Some global warnings for libraries are defined and checked for in the
management library.</p>
<p>The unused file <code class="docutils literal notranslate"><span class="pre">interface.dylan</span></code> compares module and binding
definitions, in order to judge whether the public API of a
library/module has changed between two versions. Usage of this would
allow lazy recompilation: only recompile if the API has changed of a
linked library.</p>
</div>
<div class="section" id="dfmc-reader">
<h2>dfmc-reader<a class="headerlink" href="#dfmc-reader" title="Permalink to this headline">¶</a></h2>
<p>This library reads the Dylan source, tokenizes it, annotates source
locations, and builds a parse tree. The parser is in
<code class="docutils literal notranslate"><span class="pre">parser.dylgram</span></code>, which uses <code class="docutils literal notranslate"><span class="pre">app/parser-compiler</span></code> to generate
<code class="docutils literal notranslate"><span class="pre">infix-parser.dylan</span></code>. The API used is <code class="docutils literal notranslate"><span class="pre">read-top-level-fragment</span></code>
and <code class="docutils literal notranslate"><span class="pre">re-read-fragments</span></code>.</p>
<p>Error handling is on the token level, thus a mismatched <code class="docutils literal notranslate"><span class="pre">end</span></code> is
noticed. Other sorts of errors are invalid token, integer too large,
character too large, ratios not being supported, end of input (while
more tokens were required).</p>
<p>Every <code class="docutils literal notranslate"><span class="pre">&lt;fragment&gt;</span></code>, the base class of the abstract syntax tree, has
a compilation-record and a source-position.</p>
<p>So, for the above hello-world method, <code class="docutils literal notranslate"><span class="pre">read-top-level-fragment</span></code>
returns the following parse tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">body</span><span class="o">-</span><span class="n">definition</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
  <span class="n">fragment</span><span class="o">-</span><span class="n">macro</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
  <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;method-definer&quot;</span>
  <span class="n">fragment</span><span class="o">-</span><span class="n">modifiers</span><span class="p">:</span> <span class="c1">#()</span>
  <span class="n">fragment</span><span class="o">-</span><span class="n">body</span><span class="o">-</span><span class="n">fragment</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;hello-world&quot;</span>
    <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">left</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">fragments</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;x&quot;</span>
        <span class="o">&lt;</span><span class="n">colon</span><span class="o">-</span><span class="n">colon</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;&lt;integer&gt;&quot;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">right</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;do&quot;</span>
    <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">left</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">fragments</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;curry&quot;</span>
        <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">left</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">fragments</span><span class="p">:</span>
            <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;format-out&quot;</span>
            <span class="o">&lt;</span><span class="n">comma</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">string</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="s2">&quot;Hello </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">right</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">comma</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;range&quot;</span>
        <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">left</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">lparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">nested</span><span class="o">-</span><span class="n">fragments</span><span class="p">:</span>
            <span class="o">&lt;</span><span class="n">keyword</span><span class="o">-</span><span class="n">syntax</span><span class="o">-</span><span class="n">symbol</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="c1">#&quot;to&quot;</span>
            <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">:</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;x&quot;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">right</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">right</span><span class="o">-</span><span class="n">delimiter</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rparen</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">semicolon</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>NB: the type hierarchy for &lt;body-definition-fragment&gt; is:
&lt;definition-fragment&gt;, &lt;macro-call-fragment&gt;, &lt;compound-fragment&gt;,
&lt;fragment&gt;, &lt;object&gt;</p>
</div>
<div class="section" id="dfmc-definitions">
<h2>dfmc-definitions<a class="headerlink" href="#dfmc-definitions" title="Permalink to this headline">¶</a></h2>
<p>Once the abstract syntax tree is generated (by the reader), it’s time
to convert this into definitions, which are the names in dylan. There
are several top-level definitions in dylan, namely: binding, class,
constant, (copy-down), domain, function, generic, macro, method,
module, namespace (library) and variable. Every definition has its
own class, inheriting from <code class="docutils literal notranslate"><span class="pre">&lt;top-level-form&gt;</span></code> (defined in
common/top-level-forms.dylan). A top level form at least contains
information about its compilation record, source location, parent
form, sequence number and dependencies and referenced variables.
Additional information available are adjectives, the word defined, its
library, original library, top level methods.</p>
<p>As a side note, dependency tracking is also defined in
<code class="docutils literal notranslate"><span class="pre">common/top-level-forms.dylan</span></code>.</p>
<p>The main entry point for the definition library is
<code class="docutils literal notranslate"><span class="pre">top-level-convert(parent,</span> <span class="pre">fragment)</span></code>, defined in
<code class="docutils literal notranslate"><span class="pre">top-level-convert.dylan</span></code>.</p>
<p>The building of definition objects relies heavily on the
macro-expander, especially on procedural macros described in
<a class="reference external" href="http://people.csail.mit.edu/jrb/Projects/dexprs.pdf">D-Expressions: Lisp Power, Dylan Style</a>. Open Dylan
extends the definitions with compiler, optimizer, primitive and
shared-symbols, mainly used internally in the compiler.</p>
<p>Looking into <code class="docutils literal notranslate"><span class="pre">define-method.dylan</span></code>, we can see a class
<code class="docutils literal notranslate"><span class="pre">&lt;method-definition&gt;</span></code>. This is built by the parser, more
specifically there is a <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">&amp;definition</span> <span class="pre">method-definer</span></code>, which
has two rules to match fragments, whereas the second rule is the error
case. The first matches any <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">method</span></code> syntax and calls
<code class="docutils literal notranslate"><span class="pre">do-define-method</span></code> with the arguments. The method
<code class="docutils literal notranslate"><span class="pre">do-define-method</span></code> defers the work to helper methods
<code class="docutils literal notranslate"><span class="pre">parse-method-adjectives</span></code> and <code class="docutils literal notranslate"><span class="pre">parse-method-signature</span></code>, and
instantiates a <code class="docutils literal notranslate"><span class="pre">&lt;method-definition&gt;</span></code> object.</p>
<p>For our hello-world example, <code class="docutils literal notranslate"><span class="pre">do-define-method</span></code> creates a single object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">method</span><span class="o">-</span><span class="n">definition</span><span class="o">&gt;</span>
  <span class="n">private</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">body</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">body</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="n">fragment</span><span class="o">-</span><span class="n">constituents</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">prefix</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">arguments</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">prefix</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">arguments</span><span class="p">:</span>
            <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;format-out&quot;</span>
            <span class="o">&lt;</span><span class="n">string</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="s2">&quot;Hello </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">function</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
            <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;curry&quot;</span>
        <span class="o">&lt;</span><span class="n">prefix</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">arguments</span><span class="p">:</span>
            <span class="o">&lt;</span><span class="n">keyword</span><span class="o">-</span><span class="n">syntax</span><span class="o">-</span><span class="n">symbol</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">value</span><span class="p">:</span> <span class="c1">#&quot;to&quot;</span>
            <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
              <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;x&quot;</span>
          <span class="n">fragment</span><span class="o">-</span><span class="n">function</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
            <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;range&quot;</span>
      <span class="n">fragment</span><span class="o">-</span><span class="n">function</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;do&quot;</span>
  <span class="n">private</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">signature</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">method</span><span class="o">-</span><span class="n">requires</span><span class="o">-</span><span class="n">signature</span><span class="o">-</span><span class="n">spec</span><span class="o">&gt;</span>
    <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">argument</span><span class="o">-</span><span class="nb">next</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">specs</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">next</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">spec</span><span class="o">&gt;</span>
      <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;next-method&quot;</span>
    <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">argument</span><span class="o">-</span><span class="n">required</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">specs</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">typed</span><span class="o">-</span><span class="n">required</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">spec</span><span class="o">&gt;</span>
      <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="nb">type</span><span class="o">-</span><span class="n">expression</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;&lt;integer&gt;&quot;</span>
      <span class="n">private</span><span class="o">-</span><span class="n">spec</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
        <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;x&quot;</span>
  <span class="n">private</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">signature</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">body</span><span class="o">-</span><span class="n">fragment</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">sequence</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">parens</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">semicolon</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
  <span class="n">private</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">names</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">simple</span><span class="o">-</span><span class="n">variable</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">fragment</span><span class="o">&gt;</span>
    <span class="n">fragment</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="c1">#&quot;hello-world&quot;</span>
</pre></div>
</div>
<p>It is noteworthy that still no intra-library information is present,
this is top-level Dylan code without any context. All macros are
expanded.</p>
</div>
<div class="section" id="excursion-into-run-time-and-compile-time">
<h2>Excursion into run-time and compile-time<a class="headerlink" href="#excursion-into-run-time-and-compile-time" title="Permalink to this headline">¶</a></h2>
<p>Some objects are defined in the compiler, but are injected into the
Dylan world. How does this happen?</p>
<p>In the Dylan library you see <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">BOOTED:</span></code> comments here and
there. The source location of well-known basic types and functions is
<code class="docutils literal notranslate"><span class="pre">dylan:dylan-user:boot-dylan-definitions</span></code>.</p>
<p>There is no definition of this specific method.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">boot-definitions-form?</span></code> (in dfmc-definitions) checks
exactly for this name. The method <code class="docutils literal notranslate"><span class="pre">top-level-convert-forms</span></code> behaves
differently if <code class="docutils literal notranslate"><span class="pre">boot-definitions-form?</span></code> returns true, namely it
calls <code class="docutils literal notranslate"><span class="pre">booted-source-sequence</span></code> (in boot-definitions.dylan) which
grabs the boot-record and returns it sorted as a vector.</p>
<p>But what is a boot-record after all? Well, its definition is all in
boot-definitions.dylan, with the explanation “records the set of
things that must be inserted into a Dylan world at the very
start. Some things are core definitions, such as converters and
macros, and these are booted at the definition level. The rest are
expressed as source to be fed to the compiler.”</p>
<p>The constant <code class="docutils literal notranslate"><span class="pre">*boot-record*</span></code> is filled by do-define-core-*. These
are called by <strong>dfmc-modeling</strong>. Namely, primitives (which names and
signatures are installed), macros, modules, libraries, classes.</p>
<p>Be aware that the actual implementation of the primitives is in the
runtime (either <code class="docutils literal notranslate"><span class="pre">sources/lib/run-time/run-time.c</span></code> or the
runtime-generator generates a runtime.o containing those definitions),
but some crucial bits, like the adjectives (<code class="docutils literal notranslate"><span class="pre">side-effect-free</span></code>,
<code class="docutils literal notranslate"><span class="pre">dynamic-extent</span></code>, <code class="docutils literal notranslate"><span class="pre">stateless</span></code> and <code class="docutils literal notranslate"><span class="pre">opposited</span></code>) are in
<strong>dfmc-modeling</strong> and are used in the optimization!</p>
<p>The core classes are emitted from modeling with actual constructors.
Be aware that the runtime layout is also recorded in run-time.h.</p>
<p>The dylan library and module definitions are in
modeling/namespaces.dylan.</p>
<p>A noteworthy comment is that a compiler (comp-0, generation 0) loads
the Dylan library (dylan-0), which contains the definitions
(defs-0). When compiling itself (comp-1), first a fresh Dylan library
(dylan-1) is built, which contains still the old booted definitions
(defs-0). It emits new definitions (defs-1) and a new boot-record when
dumping dfmc-definitions. Now the next generation compiler (comp-1)
will use these new definitions in the next Dylan (dylan-2)
library. Beware of dragons.</p>
</div>
<div class="section" id="dfmc-macro-expander">
<h2>dfmc-macro-expander<a class="headerlink" href="#dfmc-macro-expander" title="Permalink to this headline">¶</a></h2>
<p>The deep magic happens here.</p>
</div>
<div class="section" id="dfmc-convert">
<h2>dfmc-convert<a class="headerlink" href="#dfmc-convert" title="Permalink to this headline">¶</a></h2>
<p>Converts definition objects to model objects. In order to fulfill
this task, it looks up bindings to objects from other
libraries. Also converts the bodies of definitions to a flow
graph. Does some initial evaluation, for example <code class="docutils literal notranslate"><span class="pre">limited(&lt;vector&gt;,</span>
<span class="pre">of:</span> <span class="pre">&lt;string&gt;)</span></code> gets converted to a <code class="docutils literal notranslate"><span class="pre">&lt;&amp;limited-vector-type&gt;</span></code>
instance. Thus, it contains a poor-mans eval.</p>
<p>Also, creates init-expressions, which may be needed for the
runtime. Since everything can be dynamic, each top-level form may need
initializing.  This happens when the library is loaded.</p>
<p>Also sets up a lexical environment for the definitions, and checks
bindings.</p>
<p>Here, type variables are now recorded into the lexical environment,
the type variables are passed around while the signature is
checked.</p>
<p>After Dylan code is converted, it is in a representation which can
be passed to a back-end to generate code. Modeling objects have
corresponding compile and run time objects, and are prefixed with
an ampersand, e.g., <code class="docutils literal notranslate"><span class="pre">&lt;&amp;object&gt;</span></code>.</p>
</div>
<div class="section" id="dfmc-modeling">
<h2>dfmc-modeling<a class="headerlink" href="#dfmc-modeling" title="Permalink to this headline">¶</a></h2>
<p>Contains modeling of runtime and compile time objects. Since some
calls are attempted at compile time rather than at runtime,
it provides these compile time methods with a mechanism to override
the runtime methods (<code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">&amp;override-function</span></code>). An example for
this is <code class="docutils literal notranslate"><span class="pre">^instance?</span></code>, compile time methods are prefixed with a <code class="docutils literal notranslate"><span class="pre">^</span></code>,
while compile and runtime class definitions are prefixed with <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>,
like <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">&amp;class</span> <span class="pre">&lt;type&gt;</span></code>.</p>
<p>Also, DOOD (a persistent object store) models and proxies for
compile time definitions are available in this library, in order to
load definitions of dependent libraries.</p>
</div>
<div class="section" id="dfmc-flow-graph">
<h2>dfmc-flow-graph<a class="headerlink" href="#dfmc-flow-graph" title="Permalink to this headline">¶</a></h2>
<p>The flow graph consists of instances of the <code class="docutils literal notranslate"><span class="pre">&lt;computation&gt;</span></code> class,
like <code class="docutils literal notranslate"><span class="pre">&lt;if&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;loop-call&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;assignment&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;merge&gt;</span></code>. The flow
graph is in a (pseudo) static single assignment (SSA) form. Every time any
algorithm alters the flow graph, it disconnects the deprecated
computation and inserts new computations. New temporaries are
introduced if a binding is assigned to a new value. Subclasses of
<code class="docutils literal notranslate"><span class="pre">&lt;computation&gt;</span></code> model control flow, <code class="docutils literal notranslate"><span class="pre">&lt;temporary&gt;</span></code> (as well as
<code class="docutils literal notranslate"><span class="pre">&lt;referenced-object&gt;</span></code>) model data flow.</p>
<p>Computations are a doubly-linked list, with special cases for merge
nodes, loops, if, bind-exit and unwind-protect. Every computation
may have a computation-type field, which is bound to a
<code class="docutils literal notranslate"><span class="pre">&lt;type-variable&gt;</span></code>. It also may have a temporary slot, which is its
return value. Several cases, single and multiple return values, are
supported. The temporary has a link to its generator, a list of
users and a reference to its value.</p>
<p>Additional (data flow) information is kept in special slots, test
in <code class="docutils literal notranslate"><span class="pre">&lt;if&gt;</span></code>, arguments of a <code class="docutils literal notranslate"><span class="pre">&lt;call&gt;</span></code>, etc. These are all
<code class="docutils literal notranslate"><span class="pre">&lt;referenced-object&gt;</span></code>, or more specially <code class="docutils literal notranslate"><span class="pre">&lt;value-reference&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;object-reference&gt;</span></code>, etc. <code class="docutils literal notranslate"><span class="pre">&lt;object-reference&gt;</span></code> contains a binding
to its actual value.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;temporary&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;environment&gt;</span></code> classes are defined in this
library.</p>
<p><code class="docutils literal notranslate"><span class="pre">join-2x1</span></code> etc. are the operations on the flow graph.</p>
</div>
<div class="section" id="dfmc-typist">
<h2>dfmc-typist<a class="headerlink" href="#dfmc-typist" title="Permalink to this headline">¶</a></h2>
<p>This library contains runtime type algebra as well as a type
inference algorithm.</p>
<p>Main entry point is <code class="docutils literal notranslate"><span class="pre">type-estimate</span></code>, which calls
<code class="docutils literal notranslate"><span class="pre">type-estimate-in-cache</span></code>. Each library contains a type-cache, mapping
from method definitions, etc. to type-variables.</p>
<p>Type variables contain an actual type estimate as well as
justifications (supporters and supportees), used for propagation of
types.</p>
<p>converts types to <code class="docutils literal notranslate"><span class="pre">&lt;type-estimate&gt;</span></code> objects</p>
<p><code class="docutils literal notranslate"><span class="pre">type-estimate-function-from-signature</span></code> calls <code class="docutils literal notranslate"><span class="pre">type-estimate-body</span></code>
if available (instead of using types of the signature), call chain is
<code class="docutils literal notranslate"><span class="pre">type-estimate-call-from-site</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">type-estimate-call-stupidly-from-fn</span></code>
-&gt; <code class="docutils literal notranslate"><span class="pre">function-valtype</span></code></p>
<p>contains hard-coded hacks for <code class="docutils literal notranslate"><span class="pre">make</span></code>, <code class="docutils literal notranslate"><span class="pre">element</span></code>, <code class="docutils literal notranslate"><span class="pre">element-setter</span></code>
(in <code class="docutils literal notranslate"><span class="pre">type-estimate-call-from-site</span></code>)</p>
<p>typist/typist-inference.dylan:poor-mans-check-type-intersection
if #f (the temp), optimizer has determined that type check is superfluous</p>
<p>dfmc/typist-protocol.dylan:151 - does not look sane!</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">function</span> <span class="n">type-estimate=?</span><span class="p">(</span><span class="n">te1</span> <span class="p">::</span> <span class="nc">&lt;type-estimate&gt;</span><span class="p">,</span> <span class="n">te2</span> <span class="p">::</span> <span class="nc">&lt;type-estimate&gt;</span><span class="p">)</span>
 <span class="p">=&gt;</span> <span class="p">(</span><span class="n">e?</span> <span class="p">::</span> <span class="nc">&lt;boolean&gt;</span><span class="p">,</span> <span class="n">known?</span> <span class="p">::</span> <span class="nc">&lt;boolean&gt;</span><span class="p">)</span>
  <span class="c1">// Dylan Torah, p. 48: te1 = te2 iff te1 &lt;= te2 &amp; te2 &lt;= te1</span>
  <span class="k">let</span> <span class="p">(</span><span class="n">sub?-1</span><span class="p">,</span> <span class="n">known?-1</span><span class="p">)</span> <span class="o">=</span> <span class="n">type-estimate-subtype?</span><span class="p">(</span><span class="n">te1</span><span class="p">,</span> <span class="n">te2</span><span class="p">);</span>
  <span class="k">let</span> <span class="p">(</span><span class="n">sub?-2</span><span class="p">,</span> <span class="n">known?-2</span><span class="p">)</span> <span class="o">=</span> <span class="n">type-estimate-subtype?</span><span class="p">(</span><span class="n">te1</span><span class="p">,</span> <span class="n">te2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="dfmc-optimization">
<h2>dfmc-optimization<a class="headerlink" href="#dfmc-optimization" title="Permalink to this headline">¶</a></h2>
<p>This library contains several optimizations: dead code removal,
constant folding, common subexpression elimination, inlining,
dispatch upgrading and tail call analysis.</p>
<p>Main entry point from management is <code class="docutils literal notranslate"><span class="pre">really-run-compilation-passes</span></code>.
This loops over all lambdas in the given code fragment, converts
assigned variables to a <code class="docutils literal notranslate"><span class="pre">&lt;cell&gt;</span></code> representation, renames temporaries
in conditionals, then runs the “optimizer”. This builds an
optimization queue, initially containing all computations. It calls
do-optimize on each element of the optimization-queue, as long as
it returns <code class="docutils literal notranslate"><span class="pre">#f</span></code>. (The protocol is that if an optimization was successful,
it returns <code class="docutils literal notranslate"><span class="pre">#t</span></code>, if it was not successful, <code class="docutils literal notranslate"><span class="pre">#f</span></code>). For different types
of computations different optimizations are run. Default
optimizations are deletion of useless computations and constant
folding. <code class="docutils literal notranslate"><span class="pre">&lt;bind&gt;</span></code> is skipped, for <code class="docutils literal notranslate"><span class="pre">&lt;function-call&gt;</span></code> additionally
upgrade (analyzes the call, tries to get rid of gf dispatch) and
inlining is done. <code class="docutils literal notranslate"><span class="pre">&lt;primitive-call&gt;</span></code> are optimized by <code class="docutils literal notranslate"><span class="pre">analyze-calls</span></code>.</p>
<p>constant folds (constant-folding.dylan):</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span>   <span class="c1">// The following is because we seem to have a bogus class hierarchy</span>
   <span class="c1">// here 8(</span>
   <span class="c1">// We mustn&#39;t propagate a constraint type above its station, since</span>
   <span class="c1">// the constraint is typically local (true within a particular</span>
   <span class="c1">// branch, say).</span>
   <span class="o">&amp;</span> <span class="n">~instance?</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nc">&lt;constrain-type&gt;</span><span class="p">)</span>

<span class="n">optimization/dispatch</span><span class="p">.</span><span class="k">dylan:</span> <span class="n">gf</span> <span class="n">dispatch</span> <span class="n">optimization</span>
</pre></div>
</div>
<p>optimization/assignment: here happens the “occurrence typing”
(type inference for instance?)…
<code class="docutils literal notranslate"><span class="pre">&lt;constrain-type&gt;</span></code> is only for the instance? and conditionals hack</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="design.html" class="btn btn-neutral float-left" title="Compiler Design (Old)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../runtime/index.html" class="btn btn-neutral float-right" title="The Runtime" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html">Copyright</a> 2011-2023, Dylan Hackers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>