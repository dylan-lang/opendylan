<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Startup" href="startup.html" /><link rel="prev" title="Name Mangling" href="mangling.html" />

    <link rel="shortcut icon" href="../../_static/favicon.ico"/><!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>Compiler Support for Threads - Open Dylan</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Open Dylan</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/images/opendylan-light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/images/opendylan-dark.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Get Involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../download/index.html">Download</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Hacker Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Hacker Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../documentation/index.html">Writing Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Writing Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/guidelines.html">Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/generating.html">Generating Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/doctower.html">Doctower</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/example.html">Example documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../build-system.html">Jam-based Build System</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../compiler/index.html">DFMC, The Dylan Flow Machine Compiler</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of DFMC, The Dylan Flow Machine Compiler</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../compiler/notes-warnings-errors.html">Notes, Warnings and Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../compiler/old/design.html">Compiler Design (Old)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../compiler/old/internals.html">Compiler Internals (Old)</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">The Runtime</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of The Runtime</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="object-representation.html">Object Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="calling-convention.html">Calling Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="special-features.html">Special Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="mangling.html">Name Mangling</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Compiler Support for Threads</a></li>
<li class="toctree-l3"><a class="reference internal" href="startup.html">Startup</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../runtime-manager/index.html">Runtime Manager</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Runtime Manager</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../runtime-manager/access-path.html">The ACCESS-PATH library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../runtime-manager/debugger-manager.html">The DEBUGGER-MANAGER library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../duim/index.html">DUIM - Dylan User Interface Manager</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../topics/index.html">Topics</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Topics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../topics/method-dispatch.html">Method Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/debugging.html">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/porting.html">Porting to a New Target Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/ppml.html">The PPML library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../topics/making-a-release.html">Release Check-list</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../proposals/index.html">Enhancement Proposals</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Enhancement Proposals</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0001-dep-process.html">DEP Purpose and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0002-define-function.html">Define Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0003-c3-linearization.html">C3 superclass linearization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0004-strings-library.html">New strings Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0005-subclass-function.html">Subclass</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0006-single-file-library.html">Single File Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0007-collection-type-safety.html">Type-Safe Limited Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0008-multi-line-strings.html">Multi-line Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0010-element-otherwise.html">Defaulted Element Reference Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0011-numeric-literal-syntax.html">Numeric Literal Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0012-string-literals.html">String Literal Syntax</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../about/index.html">Tour of Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Tour of Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/hello_world.html">Hello, World!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/everything_value.html">Everything is a value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/classes.html">Classes &amp; Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/generic_functions.html">Generic Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/getters_setters_functions.html">Getters &amp; Setters are functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/keyword_arguments.html">Keyword Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/limited_types.html">Limited Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/multiple_return_values.html">Multiple Return Values</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../getting-started-cli/index.html">Getting Started Guide</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Getting Started Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/hello-world.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/source-registries.html">Using Source Registries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/managing-dependencies.html">Managing Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/quick-tips.html">A Few More Quick Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/dylan-compiler.html">Using dylan-compiler interactively</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/dylan-environment.html">An example of dylan-environment interactive functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/editor-support.html">Editor Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/dylan-mode-for-emacs.html">Dylan Interactor Mode for Emacs (DIME)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/debugging-with-gdb-lldb.html">Debugging with GDB or LLDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/windows.html">Notes for Windows Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/environment-variables.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/cross-compilation.html">Cross Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/platform-specific.html">Platform Specific Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://opendylan.org/books/dpg/">Dylan Programming Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://play.opendylan.org">Dylan Playground</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://opendylan.org/books/drm/">Dylan Reference Manual</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../library-reference/index.html">Open Dylan Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Open Dylan Libraries</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../library-reference/language-extensions/index.html">Dylan Language Extensions</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Dylan Language Extensions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/language-differences.html">Language Differences</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/define-function.html">Function Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/for-iteration.html">Extensions to the FOR iteration construct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/weak-tables.html">Weak tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/inlining.html">Inlining adjectives for methods, constants, functions, and slots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/numbers.html">Integers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/object-with-elements.html">object-with-elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/macro-system-extensions.html">Macro System Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/parser-expansions.html">Parser Expansions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/alternative-curry-syntax.html">Alternative Curry Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/numeric-literals.html">Numeric Literal Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/language-extensions/string-literals.html">String Literal Syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/lid.html">LID File Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/c-ffi/index.html">The c-ffi Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../library-reference/collections/index.html">The collections Library</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of The collections Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/collections/bit-set.html">The bit-set Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/collections/bit-vector.html">The bit-vector Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/collections/collectors.html">The collectors Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/collections/plists.html">The plists Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/collections/set.html">The set Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/collections/table-extensions.html">The table-extensions Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/coloring-stream/index.html">The coloring-stream Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../library-reference/common-dylan/index.html">The common-dylan Library</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of The common-dylan Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/common-dylan/byte-vector.html">The byte-vector Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/common-dylan/common-extensions.html">The common-extensions Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/common-dylan/machine-words.html">The machine-words Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/common-dylan/simple-format.html">The simple-format Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/common-dylan/simple-profiling.html">The simple-profiling Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/common-dylan/simple-random.html">The simple-random Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/common-dylan/simple-timers.html">The simple-timers Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/common-dylan/transcendentals.html">The transcendentals Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/dood/index.html">The DOOD library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../library-reference/dylan/index.html">The dylan Library</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of The dylan Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/dylan/finalization.html">The finalization Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/dylan/primitives.html">The dylan-primitives Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/dylan/threads.html">The threads Module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../library-reference/io/index.html">The io Library</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of The io Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/io/format.html">The format Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/io/format-out.html">The format-out Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/io/print.html">The print and pprint Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/io/streams.html">The streams Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/io/standard-io.html">The standard-io Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/network/index.html">The network Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/progress-stream/index.html">The progress-stream Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/sql/index.html">The sql Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../library-reference/system/index.html">The system Library</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of The system Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/system/date.html">The date Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/system/locators.html">The locators Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/system/file-system.html">The file-system Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library-reference/system/operating-system.html">The operating-system Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/t-lists/index.html">The t-lists Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/win32/index.html">The Win32 API Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../library-reference/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/index.html">All Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of All Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../news/index.html">News</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../documentation/cheatsheets/index.html">Cheat Sheets</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Cheat Sheets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/cheatsheets/syntax.html">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/cheatsheets/conditionals.html">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/cheatsheets/collections.html">Collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/cheatsheets/iteration.html">Iteration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation/cheatsheets/scheme.html">For Schemers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/publications.html">Publications</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../intro-dylan/index.html">Intro to Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of Intro to Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/why-dylan.html">Why Dylan?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/expressions-variables.html">Expressions &amp; Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/methods-generic-functions.html">Methods &amp; Generic Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/objects.html">Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/multiple-dispatch.html">Multiple Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/modules-libraries.html">Modules &amp; Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/conditions.html">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../corba-guide/index.html">CORBA Guide</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of CORBA Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/intro.html">About Open Dylan CORBA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/getstart.html">Quick Start Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/bank-setup.html">Setting up the Bank Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/bank-idl.html">Writing and Compiling IDL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/bank-client.html">The Bank Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/bank-server.html">The Bank Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/projects.html">Creating CORBA Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/rundebug.html">Running and Debugging CORBA Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/scepter.html">Using the Dylan IDL Compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/idl-app.html">An IDL Binding for Dylan</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../building-with-duim/index.html">DUIM Guide</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of DUIM Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/design.html">Designing A Simple DUIM Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/improve.html">Improving The Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/menus.html">Adding Menus To The Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/callbacks.html">Adding Callbacks to the Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/commands.html">Using Command Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/tour.html">A Tour of the DUIM Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/source.html">Source Code For The Task List Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../duim-reference/index.html">DUIM Reference</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of DUIM Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/conventions.html">Conventions in this Manual</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/geom.html">DUIM-Geometry Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/ext-geom.html">DUIM-Extended-Geometry Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/dcs.html">DUIM-DCs Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/sheets.html">DUIM-Sheets Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/graphics.html">DUIM-Graphics Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/layouts.html">DUIM-Layouts Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/gadgets.html">DUIM-Gadgets Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/frames.html">DUIM-Frames Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../getting-started-ide/index.html">Getting Started / IDE</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of Getting Started / IDE</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/quick-start.html">Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/expanding.html">Fixing Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/model.html">Programming in Open Dylan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/projects.html">Creating and Using Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/browsing.html">Learning More About an Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/debug.html">Debugging and Interactive Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/remotedbg.html">Remote Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/coloring.html">Dispatch Optimization Coloring in the Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/delivery.html">Delivering Dylan Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/editopt.html">The Interactive Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/com-projects.html">Creating COM Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../release-notes/index.html">Release Notes</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of Release Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2024.1.html">Open Dylan 2024.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2023.1.html">Open Dylan 2023.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2022.1.html">Open Dylan 2022.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2020.1.html">Open Dylan 2020.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2019.1.html">Open Dylan 2019.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2014.1.html">Open Dylan 2014.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2013.2.html">Open Dylan 2013.2 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2013.1.html">Open Dylan 2013.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2012.1.html">Open Dylan 2012.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2011.1.html">Open Dylan 2011.1 Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../style-guide/index.html">Style Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Full Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/dylan-lang/website/edit/master/source/hacker-guide/runtime/threads.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="compiler-support-for-threads">
<h1>Compiler Support for Threads<a class="headerlink" href="#compiler-support-for-threads" title="Permalink to this heading">#</a></h1>
<section id="dylan-portability-interface">
<h2>Dylan Portability Interface<a class="headerlink" href="#dylan-portability-interface" title="Permalink to this heading">#</a></h2>
<p>The Threads Library is designed for implementation using
different threads APIs from common operating systems, including Unix
and Windows. Harlequin’s implementation of the library is designed
to be directly portable onto these operating systems. This portability
is achieved by using primitive operations defined within our runtime
system. Each primitive operation must be implemented specially for each
operating system.</p>
<p>The set of portable primitive operations is collectively called the
<em>portability layer</em>. The Dylan compiler has special knowledge of the
portability layer via primitive function definitions and some
specialized emit methods for flow-graph node types which are specific to
threads.</p>
<section id="portability-and-runtime-layers">
<h3>Portability and Runtime Layers<a class="headerlink" href="#portability-and-runtime-layers" title="Permalink to this heading">#</a></h3>
<p>The design assumes that each of the concrete classes of the
Threads Library (<code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;simple-lock&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;recursive-lock&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;semaphore&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;notification&gt;</span></code>) corresponds with an equivalent
lower-level feature provided directly by either the operating system or
the runtime system. The Dylan objects which are instances of these
classes are implemented as <em>containers</em> for handles corresponding to
low-level (non-Dylan) objects. The Dylan objects contain normal Dylan
slots too, and these are directly manipulated by the Dylan library.
However, the slots containing the low-level handles may only be
manipulated via primitive function calls. For each of the classes,
primitive functions are defined to both create and destroy the low-level
handles, as well as to perform the basic functions of the class, such as
<em>wait-for</em> and <em>release</em>. The platform-specific implementation of these
primitive functions is free to choose any representation for these
handles, provided that it is the same shape as a Dylan slot (which is
equivalent to C’s <em>void *</em>).</p>
<p>As with all Dylan objects, the container objects defined by the threads
library are subject to automatic memory management, and possible
relocation by the garbage collector. The contents of the container slots
will be copied during such a relocation — but the values they contain
will not be subject to garbage collection or relocation themselves.</p>
<p>The portability layer provides no direct support for the <em>dynamic-bind</em>
operation. The library implements a <em>dynamic variable</em> as a thread-local
variable via the high-level Dylan constructs <em>define thread variable</em> and
<em>block … cleanup</em> to manage the creation and deletion of new bindings.</p>
<p>The portability layer includes support for conditional update of atomic
variables, as well as assignment. The implementation mechanism for these
is not defined, but it is hoped that many platforms will provide direct
hardware support for this operation. Where hardware support is not
available, the low-level implementation may choose to use a lock to
protect conditional updates and assignments, as a fall back option. It
is assumed that atomic variables may always be read as normal variables.</p>
<p><a class="reference internal" href="#implementations-of-dylan-thread-interfaces">Implementations of Dylan Thread Interfaces</a>
shows the expected mapping between the concrete Dylan classes and
low-level operating system features, for three of the most popular
general-purpose operating systems.</p>
</section>
<section id="implementations-of-dylan-thread-interfaces">
<h3>Implementations of Dylan Thread Interfaces<a class="headerlink" href="#implementations-of-dylan-thread-interfaces" title="Permalink to this heading">#</a></h3>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Dylan Interface</p></th>
<th class="head"><p>Unix Implementation</p></th>
<th class="head"><p>Win32 Implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code></p></td>
<td><p>thread</p></td>
<td><p>thread</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;simple-lock&gt;</span></code></p></td>
<td><p>mutex</p></td>
<td><p>critical region</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;recursive-lock&gt;</span></code></p></td>
<td><p>mutex</p></td>
<td><p>critical region</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;semaphore&gt;</span></code></p></td>
<td><p>semaphore</p></td>
<td><p>semaphore</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;notification&gt;</span></code></p></td>
<td><p>condition variable</p></td>
<td><p>event</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dynamic</span> <span class="pre">variable</span></code></p></td>
<td><p>thread-local variable</p></td>
<td><p>thread-local variable</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">conditional-update!</span></code></p></td>
<td><p>mutex</p></td>
<td><p>exchange instruction
(using a guard value
as a lock);</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="dylan-types-for-threads-portability">
<h3>Dylan Types for Threads Portability<a class="headerlink" href="#dylan-types-for-threads-portability" title="Permalink to this heading">#</a></h3>
<p>Three Dylan types merit discussion for their use with portability
primitives: <code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;portable-container&gt;</span></code>.  Objects that are
instances of the <code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;portable-container&gt;</span></code> classes have
slots which contain lower-level objects that are specific to the Dylan
runtime or operating system.</p>
<p>&lt;thread&gt;</p>
<p>[Class]</p>
<p>A Dylan object of class <code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code> contains two OS handles. One of these
represents the underlying OS thread, and the other may be used by
implementations to contain the current status of the thread, as an aid
to the implementation of the join state.</p>
<p>&lt;portable-container&gt;</p>
<p>[Class]</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;portable-container&gt;</span></code> class is used by the implementation as a
superclass for all the concrete synchronization classes (<code class="docutils literal notranslate"><span class="pre">&lt;simple-lock&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;recursive-lock&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;semaphore&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;notification&gt;</span></code>). Each
<code class="docutils literal notranslate"><span class="pre">&lt;portable-container&gt;</span></code> object contains an OS handle, which is available
to the runtime for storing any OS-specific data. Subclasses may provide
additional slots.</p>
<p>Various classes of Dylan objects are passed through the portability
interface, and hence require description in terms of lower level
languages. <a class="reference internal" href="#correspondence-between-dylan-types-and-c-types">Correspondence Between Dylan Types and C
Types</a> maps the layout of these Dylan objects onto
their C equivalents, which are used by runtime-specific implementations
of the portability layer.</p>
<p>In general, all Dylan types can be thought of as equivalent to the C
type <code class="docutils literal notranslate"><span class="pre">D</span></code>, which is in turn equivalent to the C type <code class="docutils literal notranslate"><span class="pre">void*</span></code>. Of
course, runtime-specific implementations of the portability layer must
have access to relevant fields of the Dylan objects on which they
operate. The type definitions in <a class="reference internal" href="#correspondence-between-dylan-types-and-c-types">Correspondence Between Dylan Types
and C Types</a> give implementations access to fields
needed for specific types. These definitions are not necessarily
complete descriptions of the Dylan objects, however. The objects may
contain additional fields that are not of interest to the portability
layer, and subclasses may add additional fields of their own.</p>
</section>
<section id="correspondence-between-dylan-types-and-c-types">
<h3>Correspondence Between Dylan Types and C Types<a class="headerlink" href="#correspondence-between-dylan-types-and-c-types" title="Permalink to this heading">#</a></h3>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Dylan Type</p></th>
<th class="head"><p>C Type</p></th>
<th class="head"><p>C Type Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a></p></td>
<td><p><em>D</em></p></td>
<td><p><em>typedef void* D;</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
<td><p><em>DINT</em></p></td>
<td><p><em>platform specific (size of void*)</em></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://opendylan.org/books/drm/Function_Classes#function"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;function&gt;</span></code></a></p></td>
<td><p><em>DFN</em></p></td>
<td><p><em>typedef D(*DFN)(D, int, …);</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#simple-object-vector"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;simple-object-vector&gt;</span></code></a></p></td>
<td><p><em>SOV*</em></p></td>
<td><p><em>typedef struct _sov {
* *D class;
* *DINT size;</em>
<em>D data[ ];</em>
<em>} SOV;</em></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a></p></td>
<td><p><em>B_STRING*</em></p></td>
<td><p><em>typedef struct _bst {
* *D class;
* *DINT size;</em>
<em>char data[ ];</em>
<em>} B_STRING;</em></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">false-or(&lt;byte-string&gt;)</span></code></p></td>
<td><p><em>D_NAME</em></p></td>
<td><p><em>typedef void* D_NAME;</em></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;portable-container&gt;</span></code></p></td>
<td><p><em>CONTAINER*</em></p></td>
<td><p><em>typedef struct _ctr {
* *D class;
* *void* handle;</em>
<em>} CONTAINER;</em></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code></p></td>
<td><p><em>D_THREAD*</em></p></td>
<td><p><em>typedef struct _dth {
* *D class;
* *void* handle1;</em>
<em>void* handle2;</em>
<em>} D_THREAD;</em></p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="compiler-support-for-the-portability-interface">
<h2>Compiler Support for the Portability Interface<a class="headerlink" href="#compiler-support-for-the-portability-interface" title="Permalink to this heading">#</a></h2>
<section id="the-compiler-flow-graph">
<h3>The Compiler Flow Graph<a class="headerlink" href="#the-compiler-flow-graph" title="Permalink to this heading">#</a></h3>
<p>The front end of the compiler parses Dylan source code and produces an
intermediate representation, the Implicit Continuation Representation
(ICR). The ICR is a directed acyclic graph (DAG) of Dylan objects. A
<em>leaf</em> in the ICR represents a basic computational object, such as a
variable (of class <code class="docutils literal notranslate"><span class="pre">&lt;variable-leaf&gt;</span></code>) or a function (of class
<code class="docutils literal notranslate"><span class="pre">&lt;function-leaf&gt;</span></code>). A <em>node</em> in the ICR represents an operation such as
assignment (class <code class="docutils literal notranslate"><span class="pre">&lt;assignment&gt;</span></code>), conditional execution (class <code class="docutils literal notranslate"><span class="pre">&lt;if&gt;</span></code>),
or a reference to a leaf (class <code class="docutils literal notranslate"><span class="pre">&lt;reference&gt;</span></code>).</p>
<p>In mapping Dylan code to the ICR, the compiler uses a set of
<em>converters</em>, which perform syntactic pattern matching against
fragments of Dylan code and generate the ICR corresponding to the
matched code. For example, when the compiler encounters a top-level
variable definition (introduced by the Dylan <em>define variable</em>
construct), the converter for <em>define variable</em> creates a new instance
of <code class="docutils literal notranslate"><span class="pre">&lt;global-variable-leaf&gt;</span></code> in the ICR to represent this variable and to
record data such as its name, initial value, and typing information.</p>
<p>The back end of the compiler traverses the flow graph and emits code in
the target language for compiler output. Methods in the back end
specialize on node and leaf classes to enable them to produce the
appropriate output.</p>
</section>
<section id="compiler-support-for-atomic-and-fluid-variables">
<h3>Compiler Support for Atomic and Fluid Variables<a class="headerlink" href="#compiler-support-for-atomic-and-fluid-variables" title="Permalink to this heading">#</a></h3>
<p>The portability layer provides support for atomic variable access and
for Dylan fluid variables (implemented as thread-local variables).
Atomic variables and thread variables are directly represented in the
flow graph, where they are subject to dataflow analysis. The variables
themselves appear as leaves in the graph.</p>
<p>Because both atomic and fluid variables need special treatment when they
are accessed, the back end must emit output that is different from that
for accessing other kinds of variables. The compiler defines two
specialized classes of leaf for the ICR, <code class="docutils literal notranslate"><span class="pre">&lt;atomic-global-variable-leaf&gt;</span></code>
(corresponding to atomic variables) and <code class="docutils literal notranslate"><span class="pre">&lt;fluid-global-variable-leaf&gt;</span></code>
(corresponding to fluid variables). These are subclasses of
<code class="docutils literal notranslate"><span class="pre">&lt;global-variable-leaf&gt;</span></code> and therefore inherit general characteristics
of leaves that represent variables.</p>
<p>ICR leaves representing both atomic and fluid variables are created by
the converter for <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">variable</span></code>. When the compiler encounters a
definition of an atomic variable (introduced by the <code class="docutils literal notranslate"><span class="pre">define</span>
<span class="pre">atomic-variable</span></code> construct), the converter for <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">variable</span></code> creates
an instance of <code class="docutils literal notranslate"><span class="pre">&lt;atomic-global-variable-leaf&gt;</span></code> in the ICR. When the
compiler encounters a definition of a fluid variable (introduced by the
<code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">fluid-variable</span></code> construct), the converter creates an instance of
<code class="docutils literal notranslate"><span class="pre">&lt;fluid-global-variable-leaf&gt;</span></code>.</p>
<p>The operations of reading, writing, and conditionally updating atomic
variables and of reading and writing fluid variables are not represented
by primitive functions. Instead, they are represented directly in the
flow graph. They are implemented by specializing methods on the leaf
classes that represent atomic and fluid variables.</p>
</section>
<section id="compiler-support-for-primitives">
<h3>Compiler Support for Primitives<a class="headerlink" href="#compiler-support-for-primitives" title="Permalink to this heading">#</a></h3>
<p>When the compiler constructs the flow graph, it represents a function
call as a node in the ICR. Just as the compiler distinguishes atomic and
fluid variables by means of specialized leaf classes, so it
distinguishes calls to primitive functions of the portability interface
by means of a specialized node class.</p>
<p>A function call is an operation on several components: the function
object, the arguments, and the destination for returned values. When the
compiler encounters a regular Dylan call, which typically appears as a
call to a generic function, it represents the call in the ICR as a node
of class <code class="docutils literal notranslate"><span class="pre">&lt;combination&gt;</span></code>.</p>
<p>However, the compiler contains a table of the primitive functions in the
portability interface. Before creating an ICR node to represent a
function call, the compiler looks up the function being called in the
table of primitives. If the function appears in the table, the compiler
creates an ICR node of class <code class="docutils literal notranslate"><span class="pre">&lt;primitive-combination&gt;</span></code>.</p>
<p>When the back end traverses the flow graph, methods specialized on the
node class <code class="docutils literal notranslate"><span class="pre">&lt;primitive-combination&gt;</span></code> emit calls to primitive functions.</p>
</section>
</section>
<section id="support-for-dylan-language-features">
<h2>Support for Dylan Language Features<a class="headerlink" href="#support-for-dylan-language-features" title="Permalink to this heading">#</a></h2>
<section id="interfacing-to-foreign-code">
<h3>Interfacing to Foreign Code<a class="headerlink" href="#interfacing-to-foreign-code" title="Permalink to this heading">#</a></h3>
<p>It is intended that threads created by the Dylan library may
inter-operate with code written in other languages with no special
constraints. Dylan is interfaced with other languages via a Foreign
Language Interface (<em>FLI</em>), which acts as a barrier between Dylan
conventions and the <em>neutral</em> conventions of the platform. The FLI is
responsible for:</p>
<ol class="arabic simple">
<li><p>mapping between Dylan and foreign data types,</p></li>
<li><p>converting between Dylan and foreign calling conventions</p></li>
<li><p>maintaining the Dylan dynamic environment</p></li>
<li><p>maintaining any support necessary for garbage collection (such as
ensuring that all Dylan values can be traced).</p></li>
</ol>
<p>The first and second of these require no significant extensions to
support multiple threads, since these are inherently computations which
have no effect on any thread other than the one performing the
computation.</p>
<p>There is a requirement that the dynamic environment for each thread is
stored in a thread-local variable. Since the environment is stored in
this way, its value is preserved across calls into foreign code, and it
will still be valid if the foreign code calls back into Dylan. The
techniques described in [MG95] for maintaining the dynamic environment
across foreign calls are therefore directly appropriate to a
multi-threaded implementation too.</p>
<p>If an object is passed to foreign code with dynamic extent, then it is
sufficient to ensure that the object is referenced from the current
stack, which the garbage collector will scan conservatively. In a
multi-threaded implementation, the garbage collector will scan all the
stacks conservatively, so there is no requirement to maintain a
thread-global data structure.</p>
<p>If an object is passed with indefinite extent, then it must be recorded
in a table. The table may be maintained by the runtime system, by means
of suitable primitive functions to add and remove references. There are
potentially synchronization problems associated with multiple threads
manipulating a global data structure — but the runtime system
implementation is free to choose whether to have separate tables for
each thread, or whether to have a global table with an associated lock
to guard accesses. Either technique is possible — but Harlequin have not
yet implemented this feature.</p>
<p>One further consideration is the interaction of the Dylan threads
library itself with foreign components:</p>
<p>If foreign code is not designed for multiple threads (for instance,
because it uses global data structures, and doesn’t synchronize
updates), then the code may fail if it is invoked from multiple Dylan
threads. However, this problem is not related to the Dylan
implementation, since it would fail if called from multiple threads
created by any means. The solution is to modify the foreign component to
make it thread safe.</p>
<p>If foreign code is designed for use with multiple threads, then it is
valid for it to use the synchronization facilities of the Dylan library
(by calling back into Dylan, to invoke the Threads Library
synchronization functions). Alternatively, it may use its own methods
for synchronization, provided that these are not incompatible with the
methods provided by the operating system. This is valid whenever it has
been possible to implement the runtime system support for threads
directly in terms of operating system features, and it is anticipated
that this will always be true if the operating system supports threads.
Typically, foreign code is expected to make direct use of operating
system threads facilities.</p>
<p>However, a problem may arise if a thread is created in foreign code, and
the new thread then calls back into Dylan. In this case, the Dylan
thread library itself will not be able to find an existing <code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code>
object corresponding to the current thread, and the fluid variables for
the current thread will not have been correctly initialized. Worse
still, the garbage collector may not have enough information to locate
the roots of the thread. Harlequin have not yet allowed for this in
their implementation, but they have an anticipated solution.</p>
<p>It is possible to detect that a thread has never been executing on the
Dylan side of the FLI before because it will have an uninitialized
(zero) value for its thread-local dynamic environment variable. This can
be checked at a call-in in the stub function which implements the FLI.
Once such a thread has been detected, appropriate initialization steps
can be taken. A function in the runtime system can be called to register
the stack of the thread for root tracing; the dynamic environment can be
set to point to a suitable value on the stack; finally a new Dylan
<code class="docutils literal notranslate"><span class="pre">&lt;thread&gt;</span></code> object can be allocated and initialized with
<code class="docutils literal notranslate"><span class="pre">primitive-initialize-current-thread</span></code> (as for the first thread).</p>
</section>
<section id="finalization">
<h3>Finalization<a class="headerlink" href="#finalization" title="Permalink to this heading">#</a></h3>
<p>As has been discussed, the Dylan synchronization objects are implemented
as wrappers around lower-level operating system structures. The Dylan
objects are subject to garbage collection, and their memory will be
automatically freed by the garbage collector at an undefined point in
the program. But the low-level structures are not Dylan objects and must
be explicitly freed when the Dylan container is collected (primitive
functions are provided for this purpose). However, the core language of
Dylan provides no <em>finalization</em> mechanism to invoke cleanup code when
objects are reclaimed. Harlequin’s implementation of the Threads
Library strictly requires this, but it is not yet implemented. It is
intended to provide finalization support for Dylan with a new garbage
collector which is currently under development.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="startup.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Startup</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="mangling.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Name Mangling</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2011-2023, Dylan Hackers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Compiler Support for Threads</a><ul>
<li><a class="reference internal" href="#dylan-portability-interface">Dylan Portability Interface</a><ul>
<li><a class="reference internal" href="#portability-and-runtime-layers">Portability and Runtime Layers</a></li>
<li><a class="reference internal" href="#implementations-of-dylan-thread-interfaces">Implementations of Dylan Thread Interfaces</a></li>
<li><a class="reference internal" href="#dylan-types-for-threads-portability">Dylan Types for Threads Portability</a></li>
<li><a class="reference internal" href="#correspondence-between-dylan-types-and-c-types">Correspondence Between Dylan Types and C Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compiler-support-for-the-portability-interface">Compiler Support for the Portability Interface</a><ul>
<li><a class="reference internal" href="#the-compiler-flow-graph">The Compiler Flow Graph</a></li>
<li><a class="reference internal" href="#compiler-support-for-atomic-and-fluid-variables">Compiler Support for Atomic and Fluid Variables</a></li>
<li><a class="reference internal" href="#compiler-support-for-primitives">Compiler Support for Primitives</a></li>
</ul>
</li>
<li><a class="reference internal" href="#support-for-dylan-language-features">Support for Dylan Language Features</a><ul>
<li><a class="reference internal" href="#interfacing-to-foreign-code">Interfacing to Foreign Code</a></li>
<li><a class="reference internal" href="#finalization">Finalization</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=2df60dd4"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>