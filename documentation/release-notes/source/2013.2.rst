*******************************
Open Dylan 2013.2 Release Notes
*******************************

Introduction
============

This document describes the 2013.2 release of Open Dylan, released
XXX XX, 2013.

* `Download the release <http://opendylan.org/download/index.html>`_
* `Report bugs <https://github.com/dylan-lang/opendylan/issues>`_
* `Source code <https://github.com/dylan-lang/opendylan/tree/v2013.2>`_

Improvements
============

Documentation
-------------

The `logging <http://opendylan.org/documentation/library-reference/logging/>`_ library has been documented.

The `regular-expressions <http://opendylan.org/documentation/library-reference/regular-expressions/index.html>`_ library documentation has been greatly improved.

The `date <http://opendylan.org/documentation/library-reference/system/date.html>`_ module documentation has been improved and now covers date formatting and parsing.

The `C-FFI <http://opendylan.org/documentation/library-reference/c-ffi/>`_ library now discusses `linking against a library <http://opendylan.org/documentation/library-reference/c-ffi/#notes-on-linking>`_ rather than assuming that people will find the LID file documentation. `Tracing FFI calls <http://opendylan.org/documentation/library-reference/c-ffi/#tracing-ffi-calls>`_ has also been documented.

Build Tools
-----------

Architectures
^^^^^^^^^^^^^

Our configure script now supports the multiarch layout used on recent Debian systems.

``OPEN_DYLAN_PLATFORM_NAME`` is now ``OPEN_DYLAN_TARGET_PLATFORM`` to make
the intent more clear. Additionally, this value is available to Jam as
``TARGET_NAME``.

Cross-compilation by setting ``OPEN_DYLAN_TARGET_PLATFORM`` in the environment
is also improved, so long as the proper run-time libraries have been built.

Error Reporting
^^^^^^^^^^^^^^^

``dylan-compiler`` now reports more information about circular references.
Before, it reported::

  .../opendylan/sources/dylan/multidimensional-array.dylan:19: Warning - The definition of $empty-dimensions is circular.
        ---------------------------------------------------------------
        define constant $empty-dimensions = make(<dimensions>, size: 0);
        ---------------------------------------------------------------

Now, it reports::

  .../opendylan/sources/dylan/multidimensional-array.dylan:19: Warning - The definition of $empty-dimensions is circular among the following:
  #({ define method size (object :: {<simple-single-float-array> in dylan-extensions}, #next next-method) => (size :: <integer>) ... end }, { define constant $empty-dimensions }, { define method size (object :: {<simple-object-array> in internal}, #next next-method) => (size :: <integer>) ... end }, { define method <implementation-class> constructor (class :: <class>, #next next-method, #rest init-args, #key ..., #all-keys) => (object :: {<implementation-class> in dylan-extensions}) ... end }, { (implicit) define generic <implementation-class> constructor (class, #key ...) => (#rest results) })
        ---------------------------------------------------------------
        define constant $empty-dimensions = make(<dimensions>, size: 0);
        ---------------------------------------------------------------


Libraries
---------

command-line-parser
^^^^^^^^^^^^^^^^^^^

Two new init keywords have been added to the :class:`<command-line-parser>`
class: ``min-positional-options:`` and ``max-positional-options:``.

dylan-extensions
^^^^^^^^^^^^^^^^

The ``debug-name`` method now has a specialization for ``<slot-descriptor>``.

The ``debug-message`` method is now a function and doesn't perform any
generic dispatch, making it safe to use it almost anywhere, including
within the dispatch code.

common-dylan
^^^^^^^^^^^^

A new module ``simple-timers`` has been added. This replaces the old
primitives ``primitive-start-timer`` and ``primitive-start-timer``
which have been removed.

I/O
^^^

A function ``stream-console?`` has been added to the ``<file-stream>`` class,
this can be used to determine whether console output has been directed to a
file.

A new method ``force-out`` has been added to the ``format-out`` module.
This method allows avoiding to import the ``streams`` and ``standard-io`` modules when all you want is to flush the stream corresponding to ``format-out``.

logging
^^^^^^^

The logging library is now part of Open Dylan.  This means it is no
longer necessary to add it as a git submodule in your project's
sources and set up a registry entry in order to use it.

network
^^^^^^^

The bindings ``$local-host`` and ``$loopback-address`` have been removed. The function ``local-host-name`` is now provided which returns the host name.
The main reason for this change was ongoing confusion by the way the network library initialized itself (calling ``gethostname`` and passing its result to ``gethostbyname``, which does not work on all computers).

System
^^^^^^

Two new functions have been added: ``current-process-id`` and
``parent-process-id``.  On Unix these are equivalent to ``getpid`` and
``getppid`` respectively.  On Windows they are equivalent to
``GetCurrentProcessId`` and ``method () 0 end`` respectively.

Testworks
^^^^^^^^^

* New assert-\* macros replace the check-\* macros, which are now
  deprecated.  The assert-\* macros make the assertion description
  optional and if it isn't provided they use a description based on
  the printed representation of the argument expressions.

* ``assert-equal`` shows some additional details about why collections
  failed to match.  (There are still improvements to be made here.)

* There are three new command-line options:

  + A ``--report-file`` option to output the report to a file.
  + A ``--list-suites`` option to list suite names.
  + A ``--list-tests`` option to list test names.

* Benchmarks have been removed.  Instead, timing and allocation stats
  are automatically recorded for all tests.  Relatedly, the
  ``--profile`` option has been removed.

* The Testworks code has been simplified and overhauled in general.

* There is a new report format, "surefire", which outputs Surefire
  XML, for use with Jenkins.  (This was in 2013.1 but there was no
  release note.)

Bug Fixes
=========

Common Dylan
------------

``application-arguments()`` will now work on ``x86_64-darwin``.

The ``debug-message()`` function will now work around a possible clang compiler
issue that causes a crash when printing integers.

I/O
---

Several cases of missing locking were fixed in the ``io`` library.
The added locking may cause changes in performance.
If you encounter this you can mitigate it by disabling locking on affected streams.
We are considering a switch to an opt-in locking scheme to improve performance.

