<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>The Dylan Macro System - Open Dylan</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Open Dylan</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/images/opendylan-light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/images/opendylan-dark.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Get Involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download/index.html">Download</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hacker-guide/index.html">Hacker Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Hacker Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../hacker-guide/documentation/index.html">Writing Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Writing Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/documentation/guidelines.html">Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/documentation/generating.html">Generating Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/documentation/doctower.html">Doctower</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/documentation/example.html">Example documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../hacker-guide/build-system.html">Jam-based Build System</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../hacker-guide/compiler/index.html">DFMC, The Dylan Flow Machine Compiler</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of DFMC, The Dylan Flow Machine Compiler</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/compiler/notes-warnings-errors.html">Notes, Warnings and Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/compiler/old/design.html">Compiler Design (Old)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/compiler/old/internals.html">Compiler Internals (Old)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../hacker-guide/runtime/index.html">The Runtime</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of The Runtime</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/runtime/object-representation.html">Object Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/runtime/calling-convention.html">Calling Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/runtime/special-features.html">Special Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/runtime/mangling.html">Name Mangling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/runtime/threads.html">Compiler Support for Threads</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/runtime/startup.html">Startup</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../hacker-guide/runtime-manager/index.html">Runtime Manager</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Runtime Manager</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/runtime-manager/access-path.html">The ACCESS-PATH library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/runtime-manager/debugger-manager.html">The DEBUGGER-MANAGER library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../hacker-guide/duim/index.html">DUIM - Dylan User Interface Manager</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../hacker-guide/topics/index.html">Topics</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Topics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/topics/method-dispatch.html">Method Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/topics/debugging.html">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/topics/porting.html">Porting to a New Target Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/topics/ppml.html">The PPML library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hacker-guide/topics/making-a-release.html">Release Check-list</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../hacker-guide/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hacker-guide/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../proposals/index.html">Enhancement Proposals</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Enhancement Proposals</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0001-dep-process.html">DEP Purpose and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0002-define-function.html">Define Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0003-c3-linearization.html">C3 superclass linearization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0004-strings-library.html">New strings Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0005-subclass-function.html">Subclass</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0006-single-file-library.html">Single File Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0007-collection-type-safety.html">Type-Safe Limited Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0008-multi-line-strings.html">Multi-line Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0010-element-otherwise.html">Defaulted Element Reference Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0011-numeric-literal-syntax.html">Numeric Literal Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proposals/dep-0012-string-literals.html">String Literal Syntax</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../about/index.html">Tour of Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Tour of Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/hello_world.html">Hello, World!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/everything_value.html">Everything is a value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/classes.html">Classes &amp; Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/generic_functions.html">Generic Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/getters_setters_functions.html">Getters &amp; Setters are functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/keyword_arguments.html">Keyword Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/limited_types.html">Limited Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/examples/multiple_return_values.html">Multiple Return Values</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting-started-cli/index.html">Getting Started Guide</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Getting Started Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/hello-world.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/source-registries.html">Using Source Registries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/managing-dependencies.html">Managing Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/quick-tips.html">A Few More Quick Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/dylan-compiler.html">Using dylan-compiler interactively</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/dylan-environment.html">An example of dylan-environment interactive functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/editor-support.html">Editor Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/dylan-mode-for-emacs.html">Dylan Interactor Mode for Emacs (DIME)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/debugging-with-gdb-lldb.html">Debugging with GDB or LLDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/windows.html">Notes for Windows Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/environment-variables.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/cross-compilation.html">Cross Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/platform-specific.html">Platform Specific Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-cli/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://opendylan.org/books/dpg/">Dylan Programming Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://play.opendylan.org">Dylan Playground</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://opendylan.org/books/drm/">Dylan Reference Manual</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../library-reference/index.html">Open Dylan Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Open Dylan Libraries</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library-reference/language-extensions/index.html">Dylan Language Extensions</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Dylan Language Extensions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/language-differences.html">Language Differences</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/define-function.html">Function Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/for-iteration.html">Extensions to the FOR iteration construct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/weak-tables.html">Weak tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/inlining.html">Inlining adjectives for methods, constants, functions, and slots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/numbers.html">Integers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/object-with-elements.html">object-with-elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/macro-system-extensions.html">Macro System Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/parser-expansions.html">Parser Expansions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/alternative-curry-syntax.html">Alternative Curry Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/numeric-literals.html">Numeric Literal Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/language-extensions/string-literals.html">String Literal Syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/lid.html">LID File Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/c-ffi/index.html">The c-ffi Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library-reference/collections/index.html">The collections Library</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of The collections Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/collections/bit-set.html">The bit-set Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/collections/bit-vector.html">The bit-vector Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/collections/collectors.html">The collectors Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/collections/plists.html">The plists Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/collections/set.html">The set Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/collections/table-extensions.html">The table-extensions Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/coloring-stream/index.html">The coloring-stream Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library-reference/common-dylan/index.html">The common-dylan Library</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of The common-dylan Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/common-dylan/byte-vector.html">The byte-vector Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/common-dylan/common-extensions.html">The common-extensions Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/common-dylan/machine-words.html">The machine-words Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/common-dylan/simple-format.html">The simple-format Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/common-dylan/simple-profiling.html">The simple-profiling Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/common-dylan/simple-random.html">The simple-random Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/common-dylan/simple-timers.html">The simple-timers Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/common-dylan/transcendentals.html">The transcendentals Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/dood/index.html">The DOOD library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library-reference/dylan/index.html">The dylan Library</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of The dylan Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/dylan/finalization.html">The finalization Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/dylan/primitives.html">The dylan-primitives Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/dylan/threads.html">The threads Module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library-reference/io/index.html">The io Library</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of The io Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/io/format.html">The format Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/io/format-out.html">The format-out Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/io/print.html">The print and pprint Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/io/streams.html">The streams Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/io/standard-io.html">The standard-io Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/network/index.html">The network Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/progress-stream/index.html">The progress-stream Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/sql/index.html">The sql Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library-reference/system/index.html">The system Library</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of The system Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/system/date.html">The date Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/system/locators.html">The locators Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/system/file-system.html">The file-system Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library-reference/system/operating-system.html">The operating-system Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/t-lists/index.html">The t-lists Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/win32/index.html">The Win32 API Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../library-reference/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../documentation/index.html">All Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of All Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../documentation/cheatsheets/index.html">Cheat Sheets</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Cheat Sheets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation/cheatsheets/syntax.html">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/cheatsheets/conditionals.html">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/cheatsheets/collections.html">Collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/cheatsheets/iteration.html">Iteration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation/cheatsheets/scheme.html">For Schemers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/publications.html">Publications</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../intro-dylan/index.html">Intro to Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of Intro to Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../intro-dylan/why-dylan.html">Why Dylan?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro-dylan/expressions-variables.html">Expressions &amp; Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro-dylan/methods-generic-functions.html">Methods &amp; Generic Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro-dylan/objects.html">Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro-dylan/multiple-dispatch.html">Multiple Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro-dylan/modules-libraries.html">Modules &amp; Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro-dylan/conditions.html">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../intro-dylan/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../corba-guide/index.html">CORBA Guide</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of CORBA Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/intro.html">About Open Dylan CORBA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/getstart.html">Quick Start Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/bank-setup.html">Setting up the Bank Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/bank-idl.html">Writing and Compiling IDL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/bank-client.html">The Bank Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/bank-server.html">The Bank Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/projects.html">Creating CORBA Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/rundebug.html">Running and Debugging CORBA Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/scepter.html">Using the Dylan IDL Compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../corba-guide/idl-app.html">An IDL Binding for Dylan</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../building-with-duim/index.html">DUIM Guide</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of DUIM Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/design.html">Designing A Simple DUIM Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/improve.html">Improving The Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/menus.html">Adding Menus To The Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/callbacks.html">Adding Callbacks to the Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/commands.html">Using Command Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/tour.html">A Tour of the DUIM Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/source.html">Source Code For The Task List Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-with-duim/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../duim-reference/index.html">DUIM Reference</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of DUIM Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/conventions.html">Conventions in this Manual</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/geom.html">DUIM-Geometry Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/ext-geom.html">DUIM-Extended-Geometry Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/dcs.html">DUIM-DCs Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/sheets.html">DUIM-Sheets Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/graphics.html">DUIM-Graphics Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/layouts.html">DUIM-Layouts Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/gadgets.html">DUIM-Gadgets Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/frames.html">DUIM-Frames Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../duim-reference/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../getting-started-ide/index.html">Getting Started / IDE</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of Getting Started / IDE</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/quick-start.html">Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/expanding.html">Fixing Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/model.html">Programming in Open Dylan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/projects.html">Creating and Using Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/browsing.html">Learning More About an Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/debug.html">Debugging and Interactive Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/remotedbg.html">Remote Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/coloring.html">Dispatch Optimization Coloring in the Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/delivery.html">Delivering Dylan Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/editopt.html">The Interactive Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/com-projects.html">Creating COM Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started-ide/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../release-notes/index.html">Release Notes</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of Release Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2024.1.html">Open Dylan 2024.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2023.1.html">Open Dylan 2023.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2022.1.html">Open Dylan 2022.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2020.1.html">Open Dylan 2020.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2019.1.html">Open Dylan 2019.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2014.1.html">Open Dylan 2014.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2013.2.html">Open Dylan 2013.2 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2013.1.html">Open Dylan 2013.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2012.1.html">Open Dylan 2012.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/2011.1.html">Open Dylan 2011.1 Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../style-guide/index.html">Style Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Full Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/dylan-lang/website/edit/master/source/articles/macro-system.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <p><em>Section author: Dustin Voss &lt;<a class="reference external" href="mailto:d_j_v&#37;&#52;&#48;me&#46;com">d_j_v<span>&#64;</span>me<span>&#46;</span>com</a>&gt;</em></p>
<section id="the-dylan-macro-system">
<h1>The Dylan Macro System<a class="headerlink" href="#the-dylan-macro-system" title="Permalink to this heading">#</a></h1>
<p>Dylan macros simplify boilerplate code and provide syntactic shorthand. They are
useful in small jobs within a particular file (e.g. making a series of
repetitive declarations) and for larger jobs (e.g. constructing a GUI through
creating and associating objects). Easy jobs are easy to do with macros, but the
complicated jobs get hard fast.</p>
<p>This document describes how the Dylan macro system works and some techniques you
can use when writing your own macros. I gloss over some of the implementation
details and present this information more informally than the <cite>Dylan
Reference Manual</cite> does.</p>
<section id="background-and-overview">
<h2>Background and Overview<a class="headerlink" href="#background-and-overview" title="Permalink to this heading">#</a></h2>
<p>Macros work on the basis of code fragments. The macro system
does not understand code fragments; it just substitutes some fragments for other
fragments. Once the macro system has substituted and arranged all the code
fragments, they are compiled into executable code.</p>
<p>Because the macro system parses and generates code fragments, it can recognize
the difference between a string containing a macro name and an actual invocation
of a macro. Macros are not affected by such syntactical issues; strings and
other expressions are treated as opaque units.</p>
<p>The following are all examples of elementary code fragments, or <code class="samp docutils literal notranslate"><span class="pre">parsed</span>
<span class="pre">fragments</span></code>. These combine to form the larger code fragments upon which macros
operate.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;a&#39;
&quot;end times&quot;
35.552
3/4
(3 + 7)
#t
#&quot;red&quot;
red:
cinnamon
==
#[1, 2, 3]
as(...)
list.size
</pre></div>
</div>
<section id="anatomy-and-terms">
<h3>Anatomy and terms<a class="headerlink" href="#anatomy-and-terms" title="Permalink to this heading">#</a></h3>
<p>Macros have <code class="samp docutils literal notranslate"><span class="pre">main</span> <span class="pre">rules</span></code> and <code class="samp docutils literal notranslate"><span class="pre">auxiliary</span> <span class="pre">rules</span></code>. Each of the main or auxiliary
rules has a <code class="samp docutils literal notranslate"><span class="pre">pattern</span></code> and a <code class="samp docutils literal notranslate"><span class="pre">template</span></code>. Patterns are matched against the code
fragments of your source code. A main rule is matched against the code fragment
that comprises the entire macro call. An auxiliary rule is matched against parts
of that code fragment. The matched code is then replaced by the template.</p>
<p>A pattern can contain code fragments and <code class="samp docutils literal notranslate"><span class="pre">pattern</span> <span class="pre">variables</span></code>. If a code
fragment in the source code matches what is in the pattern, parts of that code
fragment may be pulled out into pattern variables. The rest is discarded.</p>
<p>A template can contain other code fragments and <code class="samp docutils literal notranslate"><span class="pre">substitutions</span></code>. Substitutions
are placeholders; the contents of a pattern variable are processed and inserted
into the template in place of every corresponding substitution. The template’s
combined fragments and substitutions form the macro’s <code class="samp docutils literal notranslate"><span class="pre">expansion</span></code>, which
replaces the original code fragment.</p>
<p>This happens recursively: after a macro is expanded, its expansion is scanned
for additional macro call code fragments, and those are expanded in turn. The
parser recognizes a macro call code fragment by way of a <code class="samp docutils literal notranslate"><span class="pre">distinguishing</span> <span class="pre">word</span></code>
and the type of syntax associated with the macro (discussed further in
<a class="reference internal" href="#macro-types">Macro Types</a>).</p>
<p>Let us examine this function macro:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">table</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="nt">?table-class</span><span class="o">:</span><span class="nb">expression</span><span class="p">,</span><span class="w"> </span><span class="nt">?table-contents</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 3</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="n">ht</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="nt">?table-class</span><span class="p">);</span><span class="w"> </span><span class="nt">?table-contents</span><span class="p">;</span><span class="w"> </span><span class="n">ht</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="nt">?rest</span><span class="o">:</span><span class="nb">*</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 6</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="nc">&lt;table&gt;</span><span class="p">,</span><span class="w"> </span><span class="nt">?rest</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w"> </span><span class="k">table-contents:</span>
<span class="linenos"> 9</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="nt">?key</span><span class="o">:</span><span class="nb">expression</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nt">?value</span><span class="o">:</span><span class="nb">expression</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">10</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ht</span><span class="p">[</span><span class="nt">?key</span><span class="p">]</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nt">?value</span><span class="p">;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">13</span><span class="w">  </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">14</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">table</span>
</pre></div>
</div>
</div></blockquote>
<p>Here are the parts of the macro:</p>
<ul class="simple">
<li><p>The distinguishing word is <code class="samp docutils literal notranslate"><span class="pre">table</span></code>. Whenever the compiler sees <code class="samp docutils literal notranslate"><span class="pre">table(...)</span></code>,
it will expand this macro rather than creating a call to a function named
“table”.</p></li>
<li><p>The main rules are in lines 2–6.</p></li>
<li><p>The macro has one set of auxiliary rules in lines 8-13. A set of auxiliary
rules has a title written as a symbol. This set of auxiliary rules is titled
<code class="samp docutils literal notranslate"><span class="pre">table-contents:</span></code>.</p></li>
<li><p>The pattern of the first main rule is in line 2.</p></li>
<li><p>The template of the first main rule is in line 3.</p></li>
<li><p>The patterns in this macro include the pattern variables <code class="samp docutils literal notranslate"><span class="pre">?table-class</span></code>,
<code class="samp docutils literal notranslate"><span class="pre">?table-contents</span></code>, <code class="samp docutils literal notranslate"><span class="pre">?rest</span></code>, <code class="samp docutils literal notranslate"><span class="pre">?key</span></code>, and <code class="samp docutils literal notranslate"><span class="pre">?value</span></code>.</p></li>
<li><p>The substitutions in this macro include those same names.</p></li>
</ul>
<p>This macro might be called as follows:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span><span class="w"> </span><span class="n">lights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="nc">&lt;string-table&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;stop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;go&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>But this actual call fragment is what the parser will attempt to match:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="p">(</span><span class="nc">&lt;string-table&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;stop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;go&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>The macro’s expansion will be</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span><span class="w"> </span><span class="n">ht</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="nc">&lt;string-table&gt;</span><span class="p">);</span>
<span class="n">ht</span><span class="p">[</span><span class="s">&quot;red&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;stop&quot;</span><span class="p">;</span>
<span class="n">ht</span><span class="p">[</span><span class="s">&quot;green&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;go&quot;</span><span class="p">;</span>
<span class="n">ht</span>
</pre></div>
</div>
</div></blockquote>
<p>and the replacement code will then become</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span><span class="w"> </span><span class="n">lights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">begin</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">ht</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="nc">&lt;string-table&gt;</span><span class="p">);</span>
<span class="w">  </span><span class="n">ht</span><span class="p">[</span><span class="s">&quot;red&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;stop&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">ht</span><span class="p">[</span><span class="s">&quot;green&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;go&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">ht</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>Note that the expansion is surrounded by <code class="samp docutils literal notranslate"><span class="pre">begin</span></code> and <code class="samp docutils literal notranslate"><span class="pre">end</span></code>. Macro expansions
are always surrounded by a begin…end block. This helps with macro hygiene (i.e.
preventing bindings outside of a macro call from being affected by bindings used
in a macro’s expansion). See <a class="reference internal" href="#hygiene">Hygiene</a>.</p>
</section>
</section>
<section id="macro-types">
<h2>Macro Types<a class="headerlink" href="#macro-types" title="Permalink to this heading">#</a></h2>
<p>There are four types of macro.</p>
<dl class="simple">
<dt><em class="dfn">Body-style definition macro</em></dt><dd><p>This kind of macro lets you create <code class="samp docutils literal notranslate"><span class="pre">define</span> <span class="pre">x</span> <span class="pre">...</span> <span class="pre">end</span></code> syntax. This is the
most popular kind of macro. Example: <code class="samp docutils literal notranslate"><span class="pre">define</span> <span class="pre">function</span></code>
(see <a class="reference external" href="https://opendylan.org/proposals/dep-0002-define-function.html">DEP-002</a>).</p>
</dd>
<dt><em class="dfn">List-style definition macro</em></dt><dd><p>This kind of macro lets you create <code class="samp docutils literal notranslate"><span class="pre">define</span> <span class="pre">x</span> <span class="pre">...</span></code> syntax, such as <code class="samp docutils literal notranslate"><span class="pre">define</span>
<span class="pre">variable</span> <span class="pre">$pi</span></code>.</p>
</dd>
<dt><em class="dfn">Statement macro</em></dt><dd><p>This kind of macro lets you create <code class="samp docutils literal notranslate"><span class="pre">do-something</span> <span class="pre">...</span> <span class="pre">end</span></code> syntax. Use this
kind of syntax to simplify blocks or to create new kinds of loops. It is
most commonly used to simplify resource management. Examples include
<a class="reference external" href="https://opendylan.org/books/drm/Statement_Macros#block"><code class="xref drm docutils literal notranslate"><span class="pre">block</span></code></a>, <a class="reference external" href="https://opendylan.org/books/drm/Statement_Macros#for"><code class="xref drm docutils literal notranslate"><span class="pre">for</span></code></a>, and <code class="samp docutils literal notranslate"><span class="pre">with-open-file</span></code>.</p>
</dd>
<dt><em class="dfn">Function macro</em></dt><dd><p>This kind of macro lets you create <code class="samp docutils literal notranslate"><span class="pre">x(...)</span></code> syntax. Use this instead of a
function call if the syntax you want in the parentheses is more
complicated than a normal function call, or if there is additional setup
needed around a normal function call.</p>
</dd>
</dl>
<section id="macro-definitions">
<h3>Macro definitions<a class="headerlink" href="#macro-definitions" title="Permalink to this heading">#</a></h3>
<p>All macros are defined by the <a class="reference external" href="https://opendylan.org/books/drm/Definition_Macros#define_macro"><code class="xref drm docutils literal notranslate"><span class="pre">define</span> <span class="pre">macro</span></code></a> macro, which follows this general
syntax, with optional parts in brackets:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">MACRO-NAME</span>
<span class="w">   </span><span class="n">MAIN-RULE-SET</span>
<span class="w">   </span><span class="p">[</span><span class="n">AUXILIARY-RULE-SETS</span><span class="p">]</span>
<span class="k">end</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">MACRO-NAME</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><em><span class="pre">MACRO-NAME</span></em></code></dt><dd><p>For statement and function macros, this is the macro’s distinguishing
word. For body-style and list-style definition macros, though, it is the
distinguishing word plus <code class="samp docutils literal notranslate"><span class="pre">-definer</span></code>.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">MAIN-RULE-SET</span></em></code></dt><dd><p>One or more pattern/template pairs. The syntax that the patterns all
follow determine the type of the macro, and are described <a class="reference internal" href="#main-rules"><span class="std std-ref">below</span></a>. The patterns are matched in order; see <a class="reference internal" href="#patterns">Patterns</a>.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">AUXILIARY-RULE-SETS</span></em></code></dt><dd><p>One or more auxiliary rule sets, described in more detail in
<a class="reference internal" href="#auxiliary-rules">Auxiliary Rules</a>. Each rule set has a name (which is syntactically a
symbol) and one or more pattern/template pairs. The name may be written as
<code class="samp docutils literal notranslate"><span class="pre">my-aux-ruleset:</span></code> or <code class="samp docutils literal notranslate"><span class="pre">#&quot;my-aux-ruleset&quot;</span></code>; both are the same.</p>
</dd>
</dl>
</section>
<section id="main-rules">
<span id="id1"></span><h3>Main Rules<a class="headerlink" href="#main-rules" title="Permalink to this heading">#</a></h3>
<p>The pattern of each main rule of a macro (and thus the way the macro is called)
must follow a specific syntactic style depending on the type of macro.</p>
<p>When the Dylan compiler sees a macro call, it first finds the end of the call,
and only afterwards attempts to expand the macro. While looking for the end of
the call, the compiler recognizes inner macro calls along the way and
recursively looks for the end of them first. If a code fragment <em>looks</em> like
the end of a macro call, the parser will assume that that code fragment <em>is</em>
the end of the macro call. Below, I describe what the end of each type of macro
call <em>looks</em> like.</p>
<section id="body-style-definition-macro">
<h4>Body-style definition macro<a class="headerlink" href="#body-style-definition-macro" title="Permalink to this heading">#</a></h4>
<p>The main rules’ patterns must follow this syntax, with optional parts in
brackets:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="p">[</span><span class="n">MODIFIERS</span><span class="p">]</span><span class="w"> </span><span class="n">DISTINGUISHING-WORD</span><span class="w"> </span><span class="p">[</span><span class="n">NAME</span><span class="p">]</span>
<span class="w">    </span><span class="p">[</span><span class="n">BODY-PATTERNS</span><span class="p">]</span><span class="w"> </span><span class="p">[;]</span>
<span class="w">  </span><span class="k">end</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><em><span class="pre">MODIFIERS</span></em></code></dt><dd><p>One or more words or pattern variables.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">NAME</span></em></code></dt><dd><p>A name or a pattern variable with a name constraint.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">BODY-PATTERNS</span></em></code></dt><dd><p>One or more sets of code fragments and pattern variables separated by
semicolons and/or commas.</p>
</dd>
</dl>
<p>The parser will end the macro call at the first matching <code class="samp docutils literal notranslate"><span class="pre">end</span></code>. The final <code class="samp docutils literal notranslate"><span class="pre">end</span></code>
in each main rule is the only <code class="samp docutils literal notranslate"><span class="pre">end</span></code> that the macro’s patterns can have.</p>
<p>As a special case, the final <code class="samp docutils literal notranslate"><span class="pre">end</span></code> matches these code fragments:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">end</span>
<span class="k">end</span><span class="w"> </span><span class="n">DISTINGUISHING-WORD</span>
<span class="k">end</span><span class="w"> </span><span class="n">DISTINGUISHING-WORD</span><span class="w"> </span><span class="n">NAME</span>
</pre></div>
</div>
</section>
<section id="list-style-definition-macro">
<h4>List-style definition macro<a class="headerlink" href="#list-style-definition-macro" title="Permalink to this heading">#</a></h4>
<p>The main rules’ patterns must follow this syntax, with optional parts in
brackets:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="p">[</span><span class="n">MODIFIERS</span><span class="p">]</span><span class="w"> </span><span class="n">DISTINGUISHING-WORD</span><span class="w"> </span><span class="p">[</span><span class="n">LIST-PATTERNS</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><em><span class="pre">MODIFIERS</span></em></code></dt><dd><p>One or more words or pattern variables.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">LIST-PATTERNS</span></em></code></dt><dd><p>One or more sets of code fragments and pattern variables separated by
commas.</p>
</dd>
</dl>
<p>The parser will end the macro call at the first matching <code class="samp docutils literal notranslate"><span class="pre">;</span></code> or the end of the
enclosing source code. None of the macro’s patterns can have a semicolon, and it
is probably better to avoid <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> or <code class="samp docutils literal notranslate"><span class="pre">?:case-body</span></code> pattern variables.</p>
</section>
<section id="statement-macro">
<h4>Statement macro<a class="headerlink" href="#statement-macro" title="Permalink to this heading">#</a></h4>
<p>The main rules’ patterns must follow this syntax, with optional parts in
brackets:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="n">DISTINGUISHING-WORD</span><span class="w"> </span><span class="p">[</span><span class="n">BODY-PATTERNS</span><span class="p">]</span><span class="w"> </span><span class="p">[;]</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><em><span class="pre">BODY-PATTERNS</span></em></code></dt><dd><p>One or more sets of code fragments and pattern variables separated by
semicolons and/or commas.</p>
</dd>
</dl>
<p>The parser will end the macro call at the first matching <code class="samp docutils literal notranslate"><span class="pre">end</span></code>. The final <code class="samp docutils literal notranslate"><span class="pre">end</span></code>
in each main rule is the only <code class="samp docutils literal notranslate"><span class="pre">end</span></code> that the macro’s patterns can have.</p>
<p>As a special case, the final <code class="samp docutils literal notranslate"><span class="pre">end</span></code> matches these code fragments:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">end</span>
<span class="k">end</span><span class="w"> </span><span class="n">DISTINGUISHING-WORD</span>
</pre></div>
</div>
</section>
<section id="function-macro">
<h4>Function macro<a class="headerlink" href="#function-macro" title="Permalink to this heading">#</a></h4>
<p>The main rules’ patterns must follow this syntax, with optional parts in
brackets:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="n">DISTINGUISHING-WORD</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">[</span><span class="n">BODY-PATTERNS</span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><em><span class="pre">BODY-PATTERNS</span></em></code></dt><dd><p>One or more sets of code fragments and pattern variables separated by
semicolons and/or commas.</p>
</dd>
</dl>
<p>The parser will end the macro call when it sees the closing parenthesis. Other
patterns in the macro can also include parentheses, so long as they are matched;
the parser understands nested parentheses.</p>
<p>As a special case, function macros can be called using operator, slot access, or
element access syntax. The function macro has to accept expressions for its
<code class="samp docutils literal notranslate"><em><span class="pre">BODY-PATTERN</span></em></code> arguments like a normal function call in order to be used with
these syntaxes.</p>
</section>
</section>
</section>
<section id="patterns">
<h2>Patterns<a class="headerlink" href="#patterns" title="Permalink to this heading">#</a></h2>
<p>Pattern matching follows these basic rules:</p>
<ul class="simple">
<li><p>Pattern-matching starts and ends with the main rule set.</p></li>
<li><p>Patterns in a rule set are tried in order. If a pattern does not match the
code fragment, the next pattern is tried, and so on. If none of the patterns
in a rule set match, macro expansion fails.</p></li>
<li><p>When determining whether a pattern matches a code fragment, the compiler will
not consider auxiliary rules. Any pattern variable corresponding to an
auxiliary rule matches like any other pattern variable with the same
constraint.</p></li>
<li><p>If no patterns in an auxiliary rule set match, macro expansion fails. The
compiler does not backtrack and try a different earlier rule.</p></li>
</ul>
<section id="subdivisions">
<h3>Subdivisions<a class="headerlink" href="#subdivisions" title="Permalink to this heading">#</a></h3>
<p>A main rule pattern has elements like <code class="samp docutils literal notranslate"><span class="pre">define</span></code> and <code class="samp docutils literal notranslate"><span class="pre">end</span></code> as described in
<a class="reference internal" href="#macro-types">Macro Types</a>, but in general, a pattern is a list of fragments or
pattern variables separated at the highest level by semicolons, then by commas.
That is, a pattern has this syntax:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">FRAGMENTS</span><span class="p">,</span><span class="w"> </span><span class="n">FRAGMENTS</span><span class="p">,</span><span class="w"> </span><span class="p">...;</span><span class="w"> </span><span class="n">FRAGMENTS</span><span class="p">,</span><span class="w"> </span><span class="n">FRAGMENTS</span><span class="p">,</span><span class="w"> </span><span class="p">...;</span><span class="w"> </span><span class="p">...</span>
</pre></div>
</div>
<p>The parser matches each semicolon-separated sub-pattern individually, and only
then matches the comma-separated sub-patterns within. This can have surprising
side effects in combination with recursive auxiliary rules.</p>
<p>A pattern can include a trailing comma or semicolon, but this is strictly
decorative. The pattern will match a trailing separator in the code fragment
whether or not the pattern contains a trailing separator. Keep this in mind. The
following patterns are equivalent:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">name</span><span class="p">,</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Any of them will match any of these code fragments:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span>
<span class="n">alpha</span><span class="p">,</span>
<span class="n">alpha</span><span class="p">;</span>
<span class="n">alpha</span><span class="p">,;</span>
</pre></div>
</div>
<p>You can use parentheses, curly brackets (“{…}”), and square brackets to nest
comma- or semicolon-separated patterns inside of other patterns, as in this
example:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">?name</span><span class="o">:</span><span class="nb">name</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">?true-expr</span><span class="o">:</span><span class="nb">expression</span><span class="p">;</span><span class="w"> </span><span class="nt">?false-expr</span><span class="o">:</span><span class="nb">expression</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nt">?final</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Such a pattern will only match a code fragment with matching bracket characters.
The above pattern will match the first line of the following, but not the
second:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="l">#t</span><span class="p">;</span><span class="w"> </span><span class="l">#f</span><span class="p">;},</span><span class="w"> </span><span class="n">beta</span>
<span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="l">#t</span><span class="p">;</span><span class="w"> </span><span class="l">#f</span><span class="p">;),</span><span class="w"> </span><span class="n">beta</span>
</pre></div>
</div>
</section>
<section id="final-items">
<span id="id2"></span><h3>Final items<a class="headerlink" href="#final-items" title="Permalink to this heading">#</a></h3>
<p>A pattern with at least two list items treats the last item specially. For example, the
pattern <code class="samp docutils literal notranslate"><em> <span class="pre">?item-1:*,</span> <span class="pre">?item-2:*,</span> <span class="pre">?item-3:*</span> </em></code> will match any of these code fragments,</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>alpha, beta, gamma
<span class="linenos">2</span>alpha, beta
<span class="linenos">3</span>alpha, beta, gamma, delta, epsilon
</pre></div>
</div>
</div></blockquote>
<p>and will set the pattern variables as follows:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Code Fragments</p></th>
<th class="head"><p>?item-1</p></th>
<th class="head"><p>?item-2</p></th>
<th class="head"><p>?item-3</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Line 1</p></td>
<td><p><code class="samp docutils literal notranslate"><span class="pre">alpha</span></code></p></td>
<td><p><code class="samp docutils literal notranslate"><span class="pre">beta</span></code></p></td>
<td><p><code class="samp docutils literal notranslate"><span class="pre">gamma</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Line 2</p></td>
<td><p><code class="samp docutils literal notranslate"><span class="pre">alpha</span></code></p></td>
<td><p><code class="samp docutils literal notranslate"><span class="pre">beta</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Line 3</p></td>
<td><p><code class="samp docutils literal notranslate"><span class="pre">alpha</span></code></p></td>
<td><p><code class="samp docutils literal notranslate"><span class="pre">beta</span></code></p></td>
<td><p><code class="samp docutils literal notranslate"><span class="pre">gamma,</span> <span class="pre">delta,</span> <span class="pre">epsilon</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>This special behavior is usually only relevant when the last item in the list is a
wildcard pattern variable (see <a class="reference internal" href="#wildcard-variables"><span class="std std-ref">Wildcard pattern variables</span></a>). If the pattern were <code class="samp docutils literal notranslate"><em>
<span class="pre">?item-1:*,</span> <span class="pre">?item-2:*,</span> <span class="pre">?item-3:name</span> </em></code> instead, the only matching code fragment would be
line 1, because neither an empty fragment (from line 2) nor <code class="samp docutils literal notranslate"><span class="pre">gamma,</span> <span class="pre">delta,</span> <span class="pre">epsilon</span></code> (from
line
3) match the <code class="samp docutils literal notranslate"><span class="pre">name</span></code> constraint of <code class="samp docutils literal notranslate"><span class="pre">?item-3</span></code>.</p>
</section>
<section id="property-lists">
<h3>Property lists<a class="headerlink" href="#property-lists" title="Permalink to this heading">#</a></h3>
<p>The end of a comma-separated list of pattern fragments can include <code class="samp docutils literal notranslate"><span class="pre">#rest</span></code>,
<code class="samp docutils literal notranslate"><span class="pre">#key</span></code>, and <code class="samp docutils literal notranslate"><span class="pre">#all-keys</span></code>, as in this example:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="k">#rest</span><span class="w"> </span><span class="nt">?keys</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?alpha</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="nt">?beta</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="k">#all-keys</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>This syntax is <em>not</em> used to match a code fragment that contains literal
<code class="samp docutils literal notranslate"><span class="pre">#rest</span></code>, <code class="samp docutils literal notranslate"><span class="pre">#key</span></code>, and <code class="samp docutils literal notranslate"><span class="pre">#all-keys</span></code> fragments. Instead, this syntax matches a code
fragment consisting of keyword/value pairs, called a <em class="dfn">property list</em>. An
example of a property list is:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">alpha</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;a&quot;, beta: &quot;b&quot;</span>
</pre></div>
</div>
<p>In this code fragment, <code class="samp docutils literal notranslate"><span class="pre">alpha:</span></code> and <code class="samp docutils literal notranslate"><span class="pre">beta:</span></code> are the keyword or <em class="dfn">symbol
parts</em> of the property list and <code class="samp docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> and <code class="samp docutils literal notranslate"><span class="pre">&quot;b&quot;</span></code> are the <em class="dfn">value parts</em>.</p>
<p>If you want to match literal <code class="samp docutils literal notranslate"><span class="pre">#rest</span></code>, <code class="samp docutils literal notranslate"><span class="pre">#key</span></code>, or <code class="samp docutils literal notranslate"><span class="pre">#all-keys</span></code> fragments, escape
them in the pattern like <code class="samp docutils literal notranslate"><span class="pre">\#rest</span></code>, <code class="samp docutils literal notranslate"><span class="pre">\#key</span></code>, or <code class="samp docutils literal notranslate"><span class="pre">\#all-keys</span></code>.</p>
<p>If you write a pattern that contains <code class="samp docutils literal notranslate"><span class="pre">#all-keys</span></code>, you must also include <code class="samp docutils literal notranslate"><span class="pre">#key</span></code>.
There are several variations on this syntax; they are described in
<a class="reference internal" href="#proplist-variables"><span class="std std-ref">Property list pattern variables</span></a>.</p>
<p><code class="samp docutils literal notranslate"><span class="pre">#rest</span></code>, <code class="samp docutils literal notranslate"><span class="pre">#key</span></code>, and <code class="samp docutils literal notranslate"><span class="pre">#all-keys</span></code> must be the only pattern fragments in their
comma-separated sub-pattern, and that sub-pattern must be the last of several
comma-separated sub-patterns. Here are some examples of when it <strong>is</strong> or <strong>is
not</strong> valid to use this syntax in a pattern:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="cm">/* valid */</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?alpha</span><span class="o">:</span><span class="nb">token</span><span class="w"> </span><span class="p">}</span>
<span class="cm">/* not valid */</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">?alpha</span><span class="o">:</span><span class="nb">token</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?beta</span><span class="o">:</span><span class="nb">token</span><span class="w"> </span><span class="p">}</span>
<span class="cm">/* valid */</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="nt">?anything</span><span class="o">:</span><span class="nb">*</span><span class="p">,</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?alpha</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="k">#all-keys</span><span class="w"> </span><span class="p">}</span>
<span class="cm">/* not valid */</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?alpha</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="k">#all-keys</span><span class="p">,</span><span class="w"> </span><span class="nt">?anything</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span>
<span class="cm">/* valid */</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?alpha</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="k">#all-keys</span><span class="p">;</span><span class="w"> </span><span class="nt">?anything</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span>
<span class="cm">/* not valid */</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?alpha</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?beta-token</span><span class="w"> </span><span class="p">}</span>
<span class="cm">/* valid */</span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?alpha</span><span class="o">:</span><span class="nb">token</span><span class="p">;</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?beta-token</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="pattern-variables">
<h2>Pattern Variables<a class="headerlink" href="#pattern-variables" title="Permalink to this heading">#</a></h2>
<p>A macro pattern variable pulls out and transforms part of a code fragment. This
partial code fragment is then substituted into the macro’s expansion. The
substitution can be altered in some ways, or intercepted and more extensively
transformed using auxiliary rules.</p>
<p>Every pattern variable has a name and a <em class="dfn">constraint</em>. The constraint forces
the pattern variable to only match certain code fragments. If the pattern
variable cannot match, the pattern containing the variable will not match.
Unless the pattern variable has the wildcard (or <code class="samp docutils literal notranslate"><span class="pre">*</span></code>) constraint, it can only
match a code fragment that is part of the core language or a macro call; a
pattern variable cannot match a code fragment that is only legal with respect to
a given inner macro. An example of this is given in the discussion of the
<code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> constraint below.</p>
<p>The scope of a pattern variable is the rule that uses it. Other rules or
auxiliary rule sets cannot use the pattern variable.</p>
<section id="simple-pattern-variables">
<h3>Simple pattern variables<a class="headerlink" href="#simple-pattern-variables" title="Permalink to this heading">#</a></h3>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em></code></dt><dd><p>This is the basic pattern variable.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?:</span><em><span class="pre">constraint</span></em></code></dt><dd><p>This is a pattern variable where its constraint is also its name. For
example, <code class="samp docutils literal notranslate"><span class="pre">?:expression</span></code> is equivalent to <code class="samp docutils literal notranslate"><span class="pre">?expression:expression</span></code>,
that is, a pattern variable named <code class="samp docutils literal notranslate"><span class="pre">expression</span></code> with a constraint of
<code class="samp docutils literal notranslate"><span class="pre">expression</span></code>.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:name</span></code></dt><dd><p>This matches a name.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:token</span></code></dt><dd><p>This matches a name, operator, or simple literal such as a string,
character constant, or number. It does not match vector literals or
function calls.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:expression</span></code></dt><dd><p>This matches any expression, including vector literals, function calls,
and begin…end blocks.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:variable</span></code></dt><dd><p>This matches a variable name and optional specialization, for example,
<code class="samp docutils literal notranslate"><span class="pre">color</span></code> or <code class="samp docutils literal notranslate"><span class="pre">color</span> <span class="pre">::</span> <span class="pre">&lt;color&gt;</span></code>.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:name</span> <span class="pre">::</span> <span class="pre">?</span><em><span class="pre">specialization</span></em><span class="pre">:expression</span></code></dt><dd><p>This matches a variable name and optional specialization, like
<code class="samp docutils literal notranslate"><span class="pre">?:variable</span></code>, but lets you extract each part separately. If the code
fragment just has the name part, the substitution for
<code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">specialization</span></em></code> will be <code class="samp docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code>. Note that <code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">specialization</span></em></code>
will not match every expression; it will only match an expression that
happens to also be a valid type specialization.</p>
</dd>
</dl>
</section>
<section id="property-list-pattern-variables">
<span id="proplist-variables"></span><h3>Property list pattern variables<a class="headerlink" href="#property-list-pattern-variables" title="Permalink to this heading">#</a></h3>
<dl>
<dt><code class="samp docutils literal notranslate"><span class="pre">#rest</span> <span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em></code></dt><dd><p>This matches a property list where every value part meets the
constraint. If the constraint is <code class="samp docutils literal notranslate"><span class="pre">*</span></code>, any value part will match. The
substitution for <code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em></code> is the entire property list code fragment,
including both the symbol and value parts of each property.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">#key</span> <span class="pre">?</span><em><span class="pre">prop-1</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em><span class="pre">,</span> <span class="pre">?</span><em><span class="pre">prop-2</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em></code></dt><dd><p>This matches a property list that only includes the <code class="samp docutils literal notranslate"><em><span class="pre">prop-1</span></em><span class="pre">:</span></code> and
<code class="samp docutils literal notranslate"><em><span class="pre">prop-2</span></em><span class="pre">:</span></code> properties. If the property list includes any other property
such as <code class="samp docutils literal notranslate"><span class="pre">alpha:</span></code> or if either <code class="samp docutils literal notranslate"><em><span class="pre">prop-1</span></em><span class="pre">:</span></code> or <code class="samp docutils literal notranslate"><em><span class="pre">prop-2</span></em><span class="pre">:</span></code> are missing,
this pattern variable will not match. Additionally, the properties’
value parts have to meet the constraints given. If the constraint is
<code class="samp docutils literal notranslate"><span class="pre">*</span></code>, any value part will match.</p>
<p>The substitution for <code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">prop-1</span></em></code> is the value part of the <code class="samp docutils literal notranslate"><em><span class="pre">prop-1</span></em><span class="pre">:</span></code>
property.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">#key</span> <span class="pre">??</span><em><span class="pre">prop-1</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em><span class="pre">,</span> <span class="pre">??</span><em><span class="pre">prop-2</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em></code></dt><dd><p>This matches a property list that has several properties with a symbol
part of <code class="samp docutils literal notranslate"><em><span class="pre">prop-1</span></em><span class="pre">:</span></code> or <code class="samp docutils literal notranslate"><em><span class="pre">prop-2</span></em><span class="pre">:</span></code>. The substitution for <code class="samp docutils literal notranslate"><span class="pre">??</span><em><span class="pre">prop-1</span></em></code> is
several code fragments, each being the value part of a <code class="samp docutils literal notranslate"><em><span class="pre">prop-1</span></em><span class="pre">:</span></code>
property. The substitution may use one of the separators listed in
<a class="reference internal" href="#finalitems-subst"><span class="std std-ref">Final items</span></a> between each code fragment.</p>
<p>For example, consider this pattern:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">??my-key</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>It will match the following code fragment:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">my-key</span><span class="o">:</span><span class="w"> </span><span class="s">alpha, my-key: beta</span>
</pre></div>
</div>
<p>The substitution will be the following code fragment:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="w"> </span><span class="n">beta</span>
</pre></div>
</div>
<p>If the property list did not include a <code class="samp docutils literal notranslate"><span class="pre">my-key:</span></code> property, the
substitution for <code class="samp docutils literal notranslate"><span class="pre">??my-key</span></code> would have been empty.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">#key</span> <span class="pre">?</span><em><span class="pre">prop</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em><span class="pre">,</span> <span class="pre">#all-keys</span></code></dt><dd><p>This matches a property list that contains <code class="samp docutils literal notranslate"><em><span class="pre">prop</span></em><span class="pre">:</span></code>, but also matches
if the property list contains other properties in addition to
<code class="samp docutils literal notranslate"><em><span class="pre">prop</span></em><span class="pre">:</span></code>.</p>
<p>For example, consider this code fragment:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">my-key</span><span class="o">:</span><span class="w"> </span><span class="s">alpha, another-key: beta</span>
</pre></div>
</div>
<p>This pattern would not match:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?my-key</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>However, this pattern would:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?my-key</span><span class="o">:</span><span class="nb">name</span><span class="p">,</span><span class="w"> </span><span class="k">#all-keys</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">#key</span> <span class="pre">?</span><em><span class="pre">prop</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em> <span class="pre">=</span> <em><span class="pre">default-value</span></em></code></dt><dd><p>This matches a property list that contains <code class="samp docutils literal notranslate"><em><span class="pre">prop</span></em><span class="pre">:</span></code>, but also matches
a property list that is missing that property. If the property is
missing, the substitution will be the default value given.</p>
<p>The default value is not evaluated during macro expansion. Instead, it
is simply treated as a code fragment and substituted for <code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">prop</span></em></code> in
the template. The default value code fragment does not have to abide by
the pattern variable’s constraint. For example, the following pattern is
valid even though <code class="samp docutils literal notranslate"><span class="pre">#f</span></code> is not a name:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">#key</span><span class="w"> </span><span class="nt">?name</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="l">#f</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">#key</span> <span class="pre">??</span><em><span class="pre">prop</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em> <span class="pre">=</span> <em><span class="pre">default-value</span></em></code></dt><dd><p>This matches a property list containing zero or more <code class="samp docutils literal notranslate"><em><span class="pre">prop</span></em><span class="pre">:</span></code>
properties. If <code class="samp docutils literal notranslate"><em><span class="pre">prop</span></em><span class="pre">:</span></code> properties are present, the substitution for
<code class="samp docutils literal notranslate"><span class="pre">??</span><em><span class="pre">prop</span></em></code> will be a sequence of value parts as it is for the <code class="samp docutils literal notranslate"><span class="pre">#key</span>
<span class="pre">??</span><em><span class="pre">prop</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em></code> pattern. However, if the property list does not
have any <code class="samp docutils literal notranslate"><em><span class="pre">prop</span></em><span class="pre">:</span></code> properties, the substitution will be a sequence of
only one code fragment — the default value code fragment.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">#rest</span> <em><span class="pre">...</span></em><span class="pre">,</span> <span class="pre">#key</span> <em><span class="pre">...</span></em></code></dt><dd><p>With these two syntaxes are combined, both match separately against the
same property list.</p>
</dd>
</dl>
</section>
<section id="body-and-macro-pattern-variables">
<h3>Body and macro pattern variables<a class="headerlink" href="#body-and-macro-pattern-variables" title="Permalink to this heading">#</a></h3>
<dl>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:body</span></code></dt><dd><p>This matches a series of semicolon-separated statements and expressions.
If the code fragment does not have any statements or expressions, the
substitution will be <code class="samp docutils literal notranslate"><span class="pre">#f</span></code>. The substitution will wrap the code
fragment in <code class="samp docutils literal notranslate"><span class="pre">begin</span></code> and <code class="samp docutils literal notranslate"><span class="pre">end</span></code> to make an expression.</p>
<p>A <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> pattern variable matches statements and expressions in a code
fragment until it reaches some word, called an <em class="dfn">intermediate word</em>.
You must ensure that all your <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> pattern variables are either
followed by a word, or followed by a pattern variable referring to an
auxiliary rule set whose rules all start with a word. Those word will
become the intermediate words that tells the parser to stop matching the
pattern variable.</p>
<p>In this example, the <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> variable matches all code fragments up to
<code class="samp docutils literal notranslate"><span class="pre">endif</span></code>:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nt">?</span><span class="o">:</span><span class="nb">expression</span><span class="p">)</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">body</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>In this example with auxiliary rules, the <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> variable matches
all code fragments up to <code class="samp docutils literal notranslate"><span class="pre">endif</span></code> or <code class="samp docutils literal notranslate"><span class="pre">else</span></code>:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nt">?</span><span class="o">:</span><span class="nb">expression</span><span class="p">)</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">body</span><span class="w"> </span><span class="nt">?else-or-end</span><span class="w"> </span><span class="p">}</span>
<span class="k">else-or-end:</span>
<span class="p">{</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">body</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>In this example, the macro will not work because the pattern does not
include an intermediate word following the <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> variable:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="nt">?</span><span class="o">:</span><span class="nb">expression</span><span class="p">)</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">body</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>A <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> pattern variable matches semicolons. It cannot be used in a
series of comma- or semicolon-separated sub-patterns, and cannot itself
be followed by a comma or semicolon in the pattern. The following will
not work:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nt">?</span><span class="o">:</span><span class="nb">expression</span><span class="p">)</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">body</span><span class="p">;</span><span class="w"> </span><span class="nt">?else-or-end</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>A <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> pattern variable does not match things that are not
statements or expressions. For example, the following pattern is
designed to be used with the above <code class="samp docutils literal notranslate"><span class="pre">if</span></code> macro:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="n">if-into</span><span class="w"> </span><span class="p">(</span><span class="nt">?</span><span class="o">:</span><span class="nb">expression</span><span class="p">)</span><span class="w"> </span><span class="nt">?rest</span><span class="o">:</span><span class="nb">body</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="nt">?name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nt">?expression</span><span class="p">)</span><span class="w"> </span><span class="nt">?rest</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>You might expect that you can use this macro on the following code:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">if-into</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="l">#f</span><span class="p">)</span><span class="w"> </span><span class="n">format-out</span><span class="p">(</span><span class="s">&quot;false&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">x</span>
</pre></div>
</div>
<p>However, the <code class="samp docutils literal notranslate"><span class="pre">?rest:body</span></code> variable will not match the words <code class="samp docutils literal notranslate"><span class="pre">else</span></code> or
<code class="samp docutils literal notranslate"><span class="pre">endif</span></code> because they are not part of the core Dylan language. They are
not statements or expressions. Those words are actually an extension to
the language allowed by the <code class="samp docutils literal notranslate"><span class="pre">if</span></code> macro, but the <code class="samp docutils literal notranslate"><span class="pre">if</span></code> macro will never
see them because the <code class="samp docutils literal notranslate"><span class="pre">?rest:body</span></code> variable does not match or pass them
on to the <code class="samp docutils literal notranslate"><span class="pre">if</span></code> macro. To match arbitrary fragments for the <code class="samp docutils literal notranslate"><span class="pre">if</span></code> macro,
the <code class="samp docutils literal notranslate"><span class="pre">if-into</span></code> macro must use the wildcard constraint on the variable
instead, like <code class="samp docutils literal notranslate"><span class="pre">?rest:*</span></code>.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:case-body</span></code></dt><dd><p>This matches a list of cases separated by semicolons, where each case
consists of: a list of expressions, an arrow, and a body. For example,
this pattern variable would match the following:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;red&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;stop&quot;</span><span class="p">;</span>
<span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;go&quot;</span><span class="p">;</span>
<span class="k">otherwise</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">error</span><span class="p">(</span><span class="s">&quot;I don&#39;t know what this means.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Since a case includes a body, a <code class="samp docutils literal notranslate"><span class="pre">?:case-body</span></code> pattern variable must be
followed with an intermediate word just like a <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> pattern
variable and cannot be followed by a comma or semicolon.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:macro</span></code></dt><dd><p>This matches any macro call. The substitution will be the expanded
macro, without the begin…end block that normally surrounds macro
expansions.</p>
<p>While you can use <code class="samp docutils literal notranslate"><span class="pre">?:expression</span></code> and <code class="samp docutils literal notranslate"><span class="pre">?:body</span></code> pattern variables to match
macro calls, their substitutions will include a called macro’s begin…end
wrapper, and <code class="samp docutils literal notranslate"><span class="pre">?:expression</span></code> can only match function macro calls.</p>
</dd>
</dl>
</section>
<section id="wildcard-pattern-variables">
<span id="wildcard-variables"></span><h3>Wildcard pattern variables<a class="headerlink" href="#wildcard-pattern-variables" title="Permalink to this heading">#</a></h3>
<dl>
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em><span class="pre">:*</span></code></dt><dd><p>Wildcard pattern variables match as many code fragments as can be
matched before the next comma, semicolon, or other pattern fragment in
the pattern. For example, consider the following pattern:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">?many-things</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p><code class="samp docutils literal notranslate"><span class="pre">?many-things</span></code> will match everything up to but not including a name. The
substitution for <code class="samp docutils literal notranslate"><span class="pre">?many-things</span></code> will be everything except that name. If
the code fragment only has a name, the substitution for <code class="samp docutils literal notranslate"><span class="pre">?many-things</span></code>
will be empty.</p>
<p>There can only be one wildcard pattern variable in a comma- or
semicolon-separated sub-pattern. Each must be separated from other
wildcards by a semicolon or comma. For example, this is not a legal
pattern:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">?first</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="nt">?second</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>However, this is:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">?first</span><span class="o">:</span><span class="nb">*</span><span class="p">,</span><span class="w"> </span><span class="nt">?second</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>As a special case, main rules of definition macros can have wildcards in
both the <code class="samp docutils literal notranslate"><em><span class="pre">MODIFIERS</span></em></code> part and the <code class="samp docutils literal notranslate"><em><span class="pre">LIST-PATTERN</span></em></code> or <code class="samp docutils literal notranslate"><em><span class="pre">BODY-PATTERN</span></em></code>
part without an intervening comma or semicolon. This allows patterns
like the following that would normally not be allowed:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="nt">?modifiers</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="nt">?contents</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Finally, consider this pattern:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">?first</span><span class="o">:</span><span class="nb">*</span><span class="p">,</span><span class="w"> </span><span class="nt">?second</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>As described in <a class="reference internal" href="#patterns">Patterns</a>, it will match any of the following:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span>
<span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">gamma</span>
<span class="n">alpha</span><span class="p">,</span>
<span class="n">alpha</span>
</pre></div>
</div>
<p>In all cases, the wildcard constraint on <code class="samp docutils literal notranslate"><span class="pre">?first</span></code> will match up to the
first comma in the code fragment. <code class="samp docutils literal notranslate"><span class="pre">?first</span></code> will contain <code class="samp docutils literal notranslate"><span class="pre">alpha</span></code>.
<code class="samp docutils literal notranslate"><span class="pre">?second</span></code> will contain nothing, <code class="samp docutils literal notranslate"><span class="pre">beta</span></code>, or <code class="samp docutils literal notranslate"><span class="pre">beta,</span> <span class="pre">gamma</span></code>.</p>
</dd>
</dl>
</section>
<section id="auxiliary-rule-set-pattern-variables">
<h3>Auxiliary rule set pattern variables<a class="headerlink" href="#auxiliary-rule-set-pattern-variables" title="Permalink to this heading">#</a></h3>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">aux-rules</span></em></code></dt><dd><p>This syntax can only be used when there is an auxiliary rule set named
the same as the pattern variable. It is equivalent to <code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">aux-rules</span></em><span class="pre">:*</span></code>.
See <a class="reference internal" href="#auxiliary-rules">Auxiliary Rules</a>.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">...</span></code></dt><dd><p>This syntax can only be used within an auxiliary rule set. If the rule
set is named <code class="samp docutils literal notranslate"><span class="pre">my-aux-rules</span></code>, <code class="samp docutils literal notranslate"><span class="pre">...</span></code> is equivalent to <code class="samp docutils literal notranslate"><span class="pre">?my-aux-rules:*</span></code>.</p>
</dd>
</dl>
</section>
</section>
<section id="substitutions">
<h2>Substitutions<a class="headerlink" href="#substitutions" title="Permalink to this heading">#</a></h2>
<p>Pattern variables contain code fragments, which can be inserted into the macro
expansion via a substitution. A substitution looks much like a pattern variable,
but it is on the template side of the rule and has different syntax forms.</p>
<p>A template can only use pattern variables from its corresponding pattern. It
cannot use pattern variables from other rules’ patterns.</p>
<section id="finalitems-subst">
<span id="id3"></span><h3>Final items<a class="headerlink" href="#finalitems-subst" title="Permalink to this heading">#</a></h3>
<p>As a special case, if the template has a separator followed by any of the
substitution forms below, and the substituted code fragment is empty, the
preceding separator is removed. For example, consider this template:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">?alpha</span><span class="p">,</span><span class="w"> </span><span class="nt">?beta</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>If <code class="samp docutils literal notranslate"><span class="pre">?alpha</span></code> contains <code class="samp docutils literal notranslate"><span class="pre">a</span></code> and <code class="samp docutils literal notranslate"><span class="pre">?beta</span></code> is empty, the expansion will not be <code class="samp docutils literal notranslate"><span class="pre">a,</span></code>, but will
instead be <code class="samp docutils literal notranslate"><span class="pre">a</span></code>. This special case applies with any of the following separators in place
of the comma: <code class="samp docutils literal notranslate"><span class="pre">,</span> <span class="pre">;</span> <span class="pre">+</span> <span class="pre">-</span> <span class="pre">*</span> <span class="pre">/</span> <span class="pre">^</span> <span class="pre">=</span> <span class="pre">==</span> <span class="pre">~=</span> <span class="pre">~==</span> <span class="pre">&lt;</span> <span class="pre">&lt;=</span> <span class="pre">&gt;</span> <span class="pre">&gt;=</span> <span class="pre">&amp;</span> <span class="pre">|</span> <span class="pre">:=</span></code></p>
</section>
<section id="simple-substitutions">
<h3>Simple substitutions<a class="headerlink" href="#simple-substitutions" title="Permalink to this heading">#</a></h3>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">name</span></em></code></dt><dd><p>This is the basic substitution. The pattern variable’s code fragment is
inserted into the expansion according to the syntax used in the pattern,
as described in <a class="reference internal" href="#pattern-variables">Pattern Variables</a>.</p>
</dd>
</dl>
</section>
<section id="conversion-substitutions">
<h3>Conversion substitutions<a class="headerlink" href="#conversion-substitutions" title="Permalink to this heading">#</a></h3>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><span class="pre">?#&quot;</span><em><span class="pre">name</span></em><span class="pre">&quot;</span></code></dt><dd><p>The code fragment of the pattern variable <code class="samp docutils literal notranslate"><em><span class="pre">name</span></em></code>, which must be a
simple name, is turned into a symbol and inserted into the expansion.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">?&quot;</span><em><span class="pre">name</span></em><span class="pre">&quot;</span></code></dt><dd><p>The code fragment of the pattern variable <code class="samp docutils literal notranslate"><em><span class="pre">name</span></em></code>, which must be a
simple name, is turned into a string and inserted into the expansion.</p>
</dd>
</dl>
</section>
<section id="concatenation-substitutions">
<h3>Concatenation substitutions<a class="headerlink" href="#concatenation-substitutions" title="Permalink to this heading">#</a></h3>
<dl>
<dt><code class="samp docutils literal notranslate"><span class="pre">&quot;</span><em><span class="pre">prefix</span></em><span class="pre">&quot;</span> <span class="pre">##</span> <span class="pre">?</span><em><span class="pre">name</span></em> <span class="pre">##</span> <span class="pre">&quot;</span><em><span class="pre">suffix</span></em><span class="pre">&quot;</span></code></dt><dd><p>The prefix and suffix are added to the pattern variable’s code fragment,
which must be a simple name. The result is inserted into the expansion.
Either the prefix or the suffix may be omitted.</p>
<p>For example, consider a pattern variable, <code class="samp docutils literal notranslate"><span class="pre">?name-part</span></code>, that contains
the following code fragment:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span>
</pre></div>
</div>
<p>The pattern variable is used by the following template:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">?name-part</span><span class="w"> </span><span class="p">##</span><span class="w"> </span><span class="s">&quot;-function&quot;</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>The expansion will be the following code fragment:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha-function</span>
</pre></div>
</div>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">&quot;</span><em><span class="pre">prefix</span></em><span class="pre">&quot;</span> <span class="pre">##</span> <span class="pre">?&quot;</span><em><span class="pre">name</span></em><span class="pre">&quot;</span> <span class="pre">##</span> <span class="pre">&quot;</span><em><span class="pre">suffix</span></em><span class="pre">&quot;</span></code></dt><dd><p>As above, but results in a string. In the above example, the resulting
code fragment would be the following:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;alpha-function&quot;</span>
</pre></div>
</div>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">&quot;</span><em><span class="pre">prefix</span></em><span class="pre">&quot;</span> <span class="pre">##</span> <span class="pre">?#&quot;</span><em><span class="pre">name</span></em><span class="pre">&quot;</span> <span class="pre">##</span> <span class="pre">&quot;</span><em><span class="pre">suffix</span></em><span class="pre">&quot;</span></code></dt><dd><p>As above, but results in a symbol:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="ss">#&quot;alpha-function&quot;</span>
</pre></div>
</div>
<p>Or, equivalently:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">alpha-function</span><span class="o">:</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="list-substitutions">
<h3>List substitutions<a class="headerlink" href="#list-substitutions" title="Permalink to this heading">#</a></h3>
<dl>
<dt><code class="samp docutils literal notranslate"><span class="pre">??</span><em><span class="pre">name</span></em> <span class="pre">...</span></code></dt><dd><p>Used with a <code class="samp docutils literal notranslate"><span class="pre">??</span></code>-style pattern variable to make a list. Consider a
pattern variable, <code class="samp docutils literal notranslate"><span class="pre">??name-parts</span></code>, that contains the following code
fragments:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="n">gamma</span>
</pre></div>
</div>
<p>The pattern variable is referenced by the following template and
substitution:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">??name-parts</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>The expansion will be the following code fragment:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="n">gamma</span>
</pre></div>
</div>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">??</span><em><span class="pre">name</span></em><span class="pre">,</span> <span class="pre">...</span></code></dt><dd><p>As above, but the expansion would be the following:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span>
</pre></div>
</div>
<p>Consider if <code class="samp docutils literal notranslate"><span class="pre">??name-parts</span></code> contained the following code fragment:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span>
</pre></div>
</div>
<p>The expansion would be the following, without any commas:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span>
</pre></div>
</div>
<p>Any of the following separators may be used in place of a comma in
the template: <code class="samp docutils literal notranslate"><span class="pre">,</span> <span class="pre">;</span> <span class="pre">+</span> <span class="pre">-</span> <span class="pre">*</span> <span class="pre">/</span> <span class="pre">^</span> <span class="pre">=</span> <span class="pre">==</span> <span class="pre">~=</span> <span class="pre">~==</span> <span class="pre">&lt;</span> <span class="pre">&lt;=</span> <span class="pre">&gt;</span> <span class="pre">&gt;=</span> <span class="pre">&amp;</span> <span class="pre">|</span> <span class="pre">:=</span></code></p>
</dd>
</dl>
</section>
<section id="auxiliary-rule-set-substitution">
<h3>Auxiliary rule set substitution<a class="headerlink" href="#auxiliary-rule-set-substitution" title="Permalink to this heading">#</a></h3>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><span class="pre">...</span></code></dt><dd><p>This syntax can only be used within an auxiliary rule set. If the rule
set is named <code class="samp docutils literal notranslate"><span class="pre">my-aux-rules</span></code>, this syntax is equivalent to
<code class="samp docutils literal notranslate"><span class="pre">?my-aux-rules</span></code>.</p>
</dd>
</dl>
</section>
<section id="unhygienic-reference">
<h3>Unhygienic reference<a class="headerlink" href="#unhygienic-reference" title="Permalink to this heading">#</a></h3>
<dl class="simple">
<dt><code class="samp docutils literal notranslate"><span class="pre">?=</span><em><span class="pre">binding</span></em></code></dt><dd><p>This is not a substitution, but a way to refer to a binding in the
macro’s caller. See <a class="reference internal" href="#hygiene">Hygiene</a>.</p>
</dd>
</dl>
</section>
</section>
<section id="auxiliary-rules-and-expansions">
<h2>Auxiliary Rules and Expansions<a class="headerlink" href="#auxiliary-rules-and-expansions" title="Permalink to this heading">#</a></h2>
<section id="auxiliary-rules">
<h3>Auxiliary Rules<a class="headerlink" href="#auxiliary-rules" title="Permalink to this heading">#</a></h3>
<p>Auxiliary rules transform the code fragment contained in a pattern variable
before it is substituted into a template.</p>
<p>Auxiliary rule sets follow the syntax described in <a class="reference internal" href="#patterns">Patterns</a> and have the
behaviors described in that section. They do not have the special elements like
<code class="samp docutils literal notranslate"><span class="pre">define</span></code> or <code class="samp docutils literal notranslate"><em><span class="pre">modifiers</span></em></code> shown in <a class="reference internal" href="#id1">Main Rules</a>, but the macro type does
place certain <em>de facto</em> restrictions on what can appear in auxiliary rule
patterns:</p>
<ul class="simple">
<li><p><code class="samp docutils literal notranslate"><span class="pre">end</span></code> cannot usefully appear in an auxiliary rule pattern of a body-style
definition macro or a statement macro unless it is enclosed in bracketing
characters.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">;</span></code> cannot usefully appear in an auxiliary rule pattern of a list-style
definition macro unless enclosed in bracketing characters.</p></li>
</ul>
<p>An auxiliary rule set comes into play when a pattern variable matches a code
fragment and that pattern variable is named the same as the auxiliary rule set.
Usually, the pattern variable is a wildcard variable written without a
constraint, but the pattern variable can use any of the forms described in
<a class="reference internal" href="#patterns">Patterns</a>, including the <code class="samp docutils literal notranslate"><span class="pre">#key</span></code> and <code class="samp docutils literal notranslate"><span class="pre">??</span><em><span class="pre">name</span></em><span class="pre">:</span><em><span class="pre">constraint</span></em></code> forms.</p>
<p>After the pattern variable matches and is set to a code fragment, that code
fragment is matched against the rules of the auxiliary rule set. If a rule’s
pattern matches the code fragment, that rule’s template is expanded and replaces
the code fragment contained by the pattern variable. If no rules match the code
fragment, macro expansion fails.</p>
<p>If the pattern variable being examined is a <code class="samp docutils literal notranslate"><span class="pre">??</span></code>-style pattern variable, the
process is similar, except each code fragment in the pattern variable is
individually matched and transformed by the auxiliary rules.</p>
</section>
<section id="expansions">
<h3>Expansions<a class="headerlink" href="#expansions" title="Permalink to this heading">#</a></h3>
<p>This section discusses expansions through a series of examples. The examples are
all variations of a function macro named <code class="samp docutils literal notranslate"><span class="pre">version</span></code> that builds a version number
in a specific format and sets it by calling a function <code class="samp docutils literal notranslate"><span class="pre">set-version</span></code>. The
<code class="samp docutils literal notranslate"><span class="pre">set-version</span></code> function is declared like this:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">function</span><span class="w"> </span><span class="n">set-version</span><span class="w"> </span><span class="p">(</span><span class="n">version-string</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;string&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">()</span>
</pre></div>
</div>
<section id="simple-expansion">
<h4>Simple expansion<a class="headerlink" href="#simple-expansion" title="Permalink to this heading">#</a></h4>
<p>First, let us consider the <code class="samp docutils literal notranslate"><span class="pre">version</span></code> macro below.</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">version</span>
<span class="linenos">2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="p">(</span><span class="nt">?number</span><span class="o">:</span><span class="nb">expression</span><span class="p">,</span><span class="w"> </span><span class="nt">?type</span><span class="o">:</span><span class="nb">name</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">3</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">set-version</span><span class="p">(</span><span class="nt">?number</span><span class="w"> </span><span class="nt">?type</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">4</span><span class="k">type:</span>
<span class="linenos">5</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">6</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">7</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">8</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
</div></blockquote>
<p>The macro is called like this</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s">&quot;1.2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>and the generated code looks like this:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">set-version</span><span class="p">(</span><span class="s">&quot;1.2&quot;</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Dylan compilers concatenate consecutive literal strings such as <code class="samp docutils literal notranslate"><span class="pre">&quot;1.2&quot;</span> <span class="pre">&quot;a&quot;</span></code>,
giving <code class="samp docutils literal notranslate"><span class="pre">&quot;1.2a&quot;</span></code>.</p>
</div>
</div></blockquote>
<p>The <code class="samp docutils literal notranslate"><span class="pre">?type</span></code> pattern variable in line 1 of the macro definition matches <code class="samp docutils literal notranslate"><span class="pre">alpha</span></code>
in the call. After the variable matches, the <code class="samp docutils literal notranslate"><span class="pre">type:</span></code> auxiliary rule set in lines
4–7 rewrites the contents of the pattern variable according to the matching rule
in line 5. The matching rule expands to the string <code class="samp docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code>, which replaces the
<code class="samp docutils literal notranslate"><span class="pre">alpha</span></code> code fragment in the pattern variable. In the main rule’s template (line
3), the pattern variable (now containing <code class="samp docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code>) is substituted into the
expansion.</p>
<section id="effect-of-constraints">
<h5>Effect of constraints<a class="headerlink" href="#effect-of-constraints" title="Permalink to this heading">#</a></h5>
<p>Now consider if the auxiliary rules were rewritten this way:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">version</span>
<span class="linenos">2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="p">(</span><span class="nt">?number</span><span class="o">:</span><span class="nb">expression</span><span class="p">,</span><span class="w"> </span><span class="nt">?type</span><span class="o">:</span><span class="nb">name</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">3</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">set-version</span><span class="p">(</span><span class="nt">?number</span><span class="w"> </span><span class="nt">?type</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">4</span><span class="k">type:</span>
<span class="hll"><span class="linenos">5</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="nt">?n</span><span class="o">:</span><span class="nb">expression</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="nt">?n</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">6</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="nt">?n</span><span class="o">:</span><span class="nb">expression</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="nt">?n</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">7</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">release</span><span class="p">,</span><span class="w"> </span><span class="nt">?n</span><span class="o">:</span><span class="nb">expression</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span class="linenos">8</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
</div></blockquote>
<p>This macro is intended to be called like this</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>to create a version number like <code class="samp docutils literal notranslate"><span class="pre">&quot;1.0a1&quot;</span></code>. However, the macro will never succeed. <code class="samp docutils literal notranslate"><span class="pre">?type</span></code>
in line 2 has the <code class="samp docutils literal notranslate"><span class="pre">name</span></code> constraint, so it cannot match the call, which includes a comma
and an additional clause. The <code class="samp docutils literal notranslate"><span class="pre">type:</span></code> auxiliary rule set will not even be consulted and
macro expansion will fail.</p>
</section>
<section id="empty-and-missing-code-fragments">
<h5>Empty and missing code fragments<a class="headerlink" href="#empty-and-missing-code-fragments" title="Permalink to this heading">#</a></h5>
<p>An auxiliary rule set can match against a missing code fragment. Consider the
following macro call in relation to the <code class="samp docutils literal notranslate"><span class="pre">version</span></code> macros above.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With this macro call, the <code class="samp docutils literal notranslate"><span class="pre">?number</span></code> pattern variable would contain <code class="samp docutils literal notranslate"><span class="pre">&quot;1.0&quot;</span></code> and
<code class="samp docutils literal notranslate"><span class="pre">?type</span></code> would be empty, as described in <a class="reference internal" href="#final-items"><span class="std std-ref">Final items</span></a>. The macro would fail
to match this code fragment, since the <code class="samp docutils literal notranslate"><span class="pre">name</span></code> constraint of the <code class="samp docutils literal notranslate"><span class="pre">?type</span></code>
variable does not match a missing code fragment.</p>
<p>If we changed the macro definition to include a wildcard constraint, like this,</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">version</span>
<span class="hll"><span class="linenos">2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="p">(</span><span class="nt">?number</span><span class="o">:</span><span class="nb">expression</span><span class="p">,</span><span class="w"> </span><span class="nt">?type</span><span class="o">:</span><span class="nb">*</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span class="linenos">3</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">set-version</span><span class="p">(</span><span class="nt">?number</span><span class="w"> </span><span class="nt">?type</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">4</span><span class="k">type:</span>
<span class="linenos">5</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">6</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">7</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">8</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
</div></blockquote>
<p>the macro would still fail to match the code fragment because,
while the <code class="samp docutils literal notranslate"><span class="pre">?type</span></code> pattern variable itself will match, the <code class="samp docutils literal notranslate"><span class="pre">type:</span></code> auxiliary rule
set does not have a pattern that matches a missing code fragment. We would also
have to add the rule highlighted below:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">version</span>
<span class="linenos">2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="p">(</span><span class="nt">?number</span><span class="o">:</span><span class="nb">expression</span><span class="p">,</span><span class="w"> </span><span class="nt">?type</span><span class="o">:</span><span class="nb">*</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">3</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">set-version</span><span class="p">(</span><span class="nt">?number</span><span class="w"> </span><span class="nt">?type</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">4</span><span class="k">type:</span>
<span class="linenos">5</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">6</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">7</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="hll"><span class="linenos">8</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span class="linenos">9</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="complex-expansion">
<h4>Complex expansion<a class="headerlink" href="#complex-expansion" title="Permalink to this heading">#</a></h4>
<p>Now suppose we wanted to support this syntax:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">version</span><span class="p">(</span><span class="k">major:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">rev:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">rev:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="k">rev:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">type:</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>This macro should expand to</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">set-version</span><span class="p">(</span><span class="nb">concatenate</span><span class="p">(</span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">                        </span><span class="s">&quot;.&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">                        </span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span>
<span class="w">                        </span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
<span class="w">                        </span><span class="s">&quot;a&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
<p>to generate a version number like <code class="samp docutils literal notranslate"><span class="pre">&quot;1.042a&quot;</span></code>. The macro could be defined like this:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">version</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">version</span><span class="p">(</span><span class="k">#key</span><span class="w"> </span><span class="nt">?major</span><span class="o">:</span><span class="nb">expression</span><span class="p">,</span><span class="w"> </span><span class="nt">??rev</span><span class="o">:</span><span class="nb">expression</span><span class="p">,</span><span class="w"> </span><span class="nt">?type</span><span class="o">:</span><span class="nb">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">none</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">set-version</span><span class="p">(</span><span class="nb">concatenate</span><span class="p">(</span><span class="nt">?major</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">??rev</span><span class="p">,</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="nt">?type</span><span class="p">))</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 4</span><span class="k">major:</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">?rev</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">?rev</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 6</span><span class="k">rev:</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">expression</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">?expression</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 8</span><span class="k">type:</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">10</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">11</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">12</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">none</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">13</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
</div></blockquote>
<section id="property-lists-and-optional-properties">
<h5>Property lists and optional properties<a class="headerlink" href="#property-lists-and-optional-properties" title="Permalink to this heading">#</a></h5>
<p>The macro call must include the <code class="samp docutils literal notranslate"><span class="pre">major:</span></code> property, but the <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> and <code class="samp docutils literal notranslate"><span class="pre">type:</span></code>
properties are optional.</p>
<p><code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> is optional because it is a <code class="samp docutils literal notranslate"><span class="pre">??</span></code>-type pattern variable and, as described
in <a class="reference internal" href="#proplist-variables"><span class="std std-ref">Property list pattern variables</span></a>, that type of pattern variable can handle a missing
property. If the macro call did not include any <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> properties, the
substitution for <code class="samp docutils literal notranslate"><span class="pre">??rev,</span> <span class="pre">...</span></code> would be empty. This would also cause the comma
after <code class="samp docutils literal notranslate"><span class="pre">&quot;.&quot;</span></code> in line 3 to vanish, as described in <a class="reference internal" href="#finalitems-subst"><span class="std std-ref">Final items</span></a>.</p>
<p><code class="samp docutils literal notranslate"><span class="pre">type:</span></code> is optional because the pattern variable includes a default value. If
the macro call did not include <code class="samp docutils literal notranslate"><span class="pre">type:</span></code>, the substitution for <code class="samp docutils literal notranslate"><span class="pre">?type</span></code> in line 3
would be empty. It would initially be <code class="samp docutils literal notranslate"><span class="pre">none</span></code>, but then the pattern variable
would be processed by the <code class="samp docutils literal notranslate"><span class="pre">type:</span></code> auxiliary rule set and matched by the rule in
line 12, and its contents replaced by the empty template for that rule. Because
<code class="samp docutils literal notranslate"><span class="pre">?type</span></code> in line 3 would be empty, the comma after <code class="samp docutils literal notranslate"><span class="pre">??rev,</span> <span class="pre">...</span></code> would vanish.</p>
<p>You may have noted that the <code class="samp docutils literal notranslate"><span class="pre">major:</span></code>, <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code>, and <code class="samp docutils literal notranslate"><span class="pre">type:</span></code> auxiliary rule sets do
not include the actual <code class="samp docutils literal notranslate"><span class="pre">major:</span></code>, <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code>, or <code class="samp docutils literal notranslate"><span class="pre">type:</span></code> symbols found in the macro
call. This is because <code class="samp docutils literal notranslate"><span class="pre">#key</span></code>-type pattern variables contain only the value parts
of properties, not the symbol parts.</p>
</section>
<section id="auxiliary-rule-sets-in-auxiliary-rules">
<h5>Auxiliary rule sets in auxiliary rules<a class="headerlink" href="#auxiliary-rule-sets-in-auxiliary-rules" title="Permalink to this heading">#</a></h5>
<p>In line 5, <code class="samp docutils literal notranslate"><span class="pre">?rev</span></code> is equivalent to <code class="samp docutils literal notranslate"><span class="pre">?rev:*</span></code>. The code fragment matched by that
pattern variable is the code fragment initially contained by the <code class="samp docutils literal notranslate"><span class="pre">?major</span></code>
pattern variable matched in line 2. This code fragment will be an expression.
Because <code class="samp docutils literal notranslate"><span class="pre">rev</span></code> is also the name of an auxiliary rule set, that code fragment will
be matched and transformed by the <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> rule set. That transformed code
fragment will be inserted in place of the <code class="samp docutils literal notranslate"><span class="pre">?rev</span></code> substitution in line 5 and then
subsequently inserted in place of the <code class="samp docutils literal notranslate"><span class="pre">?major</span></code> substitution in line 3.</p>
</section>
<section id="and-pattern-variables">
<h5><code class="samp docutils literal notranslate"><span class="pre">??</span></code> and <code class="samp docutils literal notranslate"><span class="pre">?</span></code> pattern variables<a class="headerlink" href="#and-pattern-variables" title="Permalink to this heading">#</a></h5>
<p>The main rule and the <code class="samp docutils literal notranslate"><span class="pre">major:</span></code> auxiliary rule set both contain a pattern
variable named <code class="samp docutils literal notranslate"><span class="pre">rev</span></code>, though it is <code class="samp docutils literal notranslate"><span class="pre">??rev:expression</span></code> in the main rule (line 2)
and <code class="samp docutils literal notranslate"><span class="pre">?rev</span></code> in the auxiliary rule (line 5). Both pattern variables are
transformed by the <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> auxiliary rule in line 7 because both pattern
variables have the name <code class="samp docutils literal notranslate"><span class="pre">rev</span></code>, but they are transformed differently because of
the different natures of the two pattern variables.</p>
<p>Because the <code class="samp docutils literal notranslate"><span class="pre">?major</span></code> pattern variable in line 2 is a simple pattern variable
that contains only one code fragment, the <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> rule in line 7 that acts on it
(for reasons described above) transforms that fragment as you would expect:
<code class="samp docutils literal notranslate"><span class="pre">?major</span></code> will become a call to <code class="samp docutils literal notranslate"><span class="pre">format-to-string</span></code>.</p>
<p>However, the <code class="samp docutils literal notranslate"><span class="pre">??rev</span></code> pattern variable in line 2 is a <code class="samp docutils literal notranslate"><span class="pre">??</span></code>-type pattern variable
containing zero or more code fragments, so when acting on <em>it</em>, the <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code>
rule transforms each code fragment individually. The <code class="samp docutils literal notranslate"><span class="pre">??rev,</span> <span class="pre">...</span></code> substitution
in line 3 then joins each of the transformed code fragments with a comma and
includes the entire collection in the main rule expansion, transforming the list
of revision numbers to a list of calls to <code class="samp docutils literal notranslate"><span class="pre">format-to-string</span></code>.</p>
</section>
<section id="empty-pattern-variables">
<h5>Empty <code class="samp docutils literal notranslate"><span class="pre">??</span></code> pattern variables<a class="headerlink" href="#empty-pattern-variables" title="Permalink to this heading">#</a></h5>
<p>In line 2, the <code class="samp docutils literal notranslate"><span class="pre">?type</span></code> variable has a default. If the macro call does not
contain a <code class="samp docutils literal notranslate"><span class="pre">type:</span></code> property, the default provides a code fragment to match
against the <code class="samp docutils literal notranslate"><span class="pre">type:</span></code> auxiliary rule set.</p>
<p>In contrast, the <code class="samp docutils literal notranslate"><span class="pre">??rev</span></code> variable does not have a default. If the call does not
include any <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> properties then the pattern variable will not contain a code
fragment. Since the <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> rule does not include an empty pattern, you might
expect the macro to fail.</p>
<p>But the macro still works. The <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> rule will be applied to each code fragment
in <code class="samp docutils literal notranslate"><span class="pre">??rev</span></code> individually because it is a <code class="samp docutils literal notranslate"><span class="pre">??</span></code>-type pattern variable. Since there
are no code fragments in <code class="samp docutils literal notranslate"><span class="pre">??rev</span></code>, the <code class="samp docutils literal notranslate"><span class="pre">rev:</span></code> rule set is not applied even once,
so its lack of an empty pattern is irrelevant.</p>
</section>
</section>
<section id="recursive-expansion">
<h4>Recursive expansion<a class="headerlink" href="#recursive-expansion" title="Permalink to this heading">#</a></h4>
<p>Any pattern variable named the same as an auxiliary rule is processed by that
rule. That includes pattern variables in the auxiliary rule referring to the
auxiliary rule set itself. This recursive behavior is useful for processing
lists of items.</p>
<p>The <code class="samp docutils literal notranslate"><span class="pre">...</span></code> pattern variable and substitution syntaxes draw attention to a recursive rule
and make the author’s intention explicit. Using that syntax, these two <code class="samp docutils literal notranslate"><span class="pre">path</span></code> macros are
equivalent:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">path</span>
<span class="linenos">2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="p">(</span><span class="nt">?steps</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nt">?steps</span><span class="p">;</span><span class="w"> </span><span class="nb">values</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">3</span><span class="k">steps:</span>
<span class="hll"><span class="linenos">4</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">north</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="nt">?steps</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nt">?token</span><span class="p">;</span><span class="w"> </span><span class="nt">?steps</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">5</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">south</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="nt">?steps</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">?token</span><span class="p">;</span><span class="w"> </span><span class="nt">?steps</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">6</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">west</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="nt">?steps</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nt">?token</span><span class="p">;</span><span class="w"> </span><span class="nt">?steps</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">7</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">east</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="nt">?steps</span><span class="o">:</span><span class="nb">*</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">?token</span><span class="p">;</span><span class="w"> </span><span class="nt">?steps</span><span class="w"> </span><span class="p">}</span>
</span><span class="linenos">8</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">9</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">path</span>
<span class="linenos">2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="p">(</span><span class="nt">?steps</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nt">?steps</span><span class="p">;</span><span class="w"> </span><span class="nb">values</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">3</span><span class="k">steps:</span>
<span class="hll"><span class="linenos">4</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">north</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nt">?token</span><span class="p">;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">5</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">south</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">?token</span><span class="p">;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">6</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">west</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nt">?token</span><span class="p">;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">7</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">east</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">token</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">?token</span><span class="p">;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span class="linenos">8</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">9</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
</div></blockquote>
<p>But if I may editorialize, I feel there is a good argument for avoiding that syntax for
the sake of consistency.</p>
<p>Let us trace the following macro call to show how macro recursion works:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">(</span><span class="n">north</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">east</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">south</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">east</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>The patterns and templates will be evaluated as follows:</p>
<ol class="arabic simple">
<li><p>The main rule pattern matches. <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> is set to
<code class="samp docutils literal notranslate"><span class="pre">north</span> <span class="pre">5,</span> <span class="pre">east</span> <span class="pre">3,</span> <span class="pre">south</span> <span class="pre">1,</span> <span class="pre">east</span> <span class="pre">2</span></code>.</p></li>
<li><p>The contents of <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> is rewritten by the <code class="samp docutils literal notranslate"><span class="pre">steps:</span></code> auxiliary rule set.</p>
<ol class="loweralpha simple">
<li><p>The “north” rule is matched against <code class="samp docutils literal notranslate"><span class="pre">north</span> <span class="pre">5,</span> <span class="pre">east</span> <span class="pre">3,</span> <span class="pre">south</span> <span class="pre">1,</span> <span class="pre">east</span> <span class="pre">2</span></code>.
The pattern is a comma-separated pattern, which matches the code fragment.
The word <code class="samp docutils literal notranslate"><span class="pre">north</span></code> and the token <code class="samp docutils literal notranslate"><span class="pre">5</span></code> match. As described in
<a class="reference internal" href="#final-items"><span class="std std-ref">Final items</span></a>, the <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> pattern variable belonging to this
pattern-match operation is set to <code class="samp docutils literal notranslate"><span class="pre">east</span> <span class="pre">3,</span> <span class="pre">south</span> <span class="pre">1,</span> <span class="pre">east</span> <span class="pre">2</span></code>.</p></li>
<li><p>The contents of this rule’s <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> variable is rewritten by the <code class="samp docutils literal notranslate"><span class="pre">steps:</span></code>
auxiliary rule set.</p>
<ol class="lowerroman simple">
<li><p>The “north,” “south,” and “west” rules fail to match against
<code class="samp docutils literal notranslate"><span class="pre">east</span> <span class="pre">3,</span> <span class="pre">south</span> <span class="pre">1,</span> <span class="pre">east</span> <span class="pre">2</span></code>.</p></li>
<li><p>The “east” rule matches and the <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> pattern variable of this
pattern-match operation (different from any other <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> variable
being dealt with) is set to <code class="samp docutils literal notranslate"><span class="pre">south</span> <span class="pre">1,</span> <span class="pre">east</span> <span class="pre">2</span></code>.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> is rewritten by another pass through the <code class="samp docutils literal notranslate"><span class="pre">steps:</span></code> rule set.</p>
<ol class="arabic simple">
<li><p>The “south” rule matches and its <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> is set to <code class="samp docutils literal notranslate"><span class="pre">east</span> <span class="pre">2</span></code>.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> is again rewritten.</p>
<ol class="loweralpha simple">
<li><p>The “north,” “south,” and “west” rules fail to match.</p></li>
<li><p>The “east” rule is matched against <code class="samp docutils literal notranslate"><span class="pre">east</span> <span class="pre">2</span></code>. The word <code class="samp docutils literal notranslate"><span class="pre">east</span></code> and
the token <code class="samp docutils literal notranslate"><span class="pre">2</span></code> match. The code fragment does not contain a comma,
but the pattern matches the code fragment without the comma per
<a class="reference internal" href="#final-items"><span class="std std-ref">Final items</span></a>. The <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> pattern variable will contain an
empty code fragment.</p></li>
<li><p>Even though <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> contains an empty code fragment, it is still
rewritten by the <code class="samp docutils literal notranslate"><span class="pre">steps:</span></code> auxiliary rule set.</p>
<ol class="lowerroman simple">
<li><p>The “north,” “south,” “west,” and “east” rules fail to match
against an empty code fragment.</p></li>
<li><p>The empty pattern matches. Its expansion is an empty fragment.</p></li>
</ol>
</li>
<li><p>The <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> pattern variable of the “east” rule is set to the
expansion of the auxiliary rule set, i.e., an empty fragment.</p></li>
<li><p>The rule’s expansion is therefore <code class="samp docutils literal notranslate"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">2</span></code>.</p></li>
</ol>
</li>
<li><p>The <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> pattern variable of the “south” rule is set to
<code class="samp docutils literal notranslate"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">2</span></code>.</p></li>
<li><p>The rule’s expansion is therefore <code class="samp docutils literal notranslate"><span class="pre">y</span> <span class="pre">:=</span> <span class="pre">y</span> <span class="pre">+</span> <span class="pre">1;</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">2</span></code>.</p></li>
</ol>
</li>
<li><p>The <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code> pattern variable of the “east” rule is set to
<code class="samp docutils literal notranslate"><span class="pre">y</span> <span class="pre">:=</span> <span class="pre">y</span> <span class="pre">+</span> <span class="pre">1;</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">2</span></code>.</p></li>
<li><p>The rule’s expansion is therefore <code class="samp docutils literal notranslate"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">3;</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">y</span> <span class="pre">+</span> <span class="pre">1;</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">2</span></code></p></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>...and so on. The key ideas to note are:</p>
<ul class="simple">
<li><p>The rule set has to have a non-recursing rule (in this case, <code class="samp docutils literal notranslate"><em> </em> <span class="pre">=&gt;</span> <em> </em></code>)</p></li>
<li><p>Each rule’s matching and expansion has its own <code class="samp docutils literal notranslate"><span class="pre">?token</span></code> and <code class="samp docutils literal notranslate"><span class="pre">?steps</span></code>
pattern variable.</p></li>
</ul>
</section>
</section>
</section>
<section id="hygiene">
<h2>Hygiene<a class="headerlink" href="#hygiene" title="Permalink to this heading">#</a></h2>
<p>Macro expansions are hygienic, meaning there can be no name conflict between
a local binding in scope that calls the macro and a local binding in the macro
expansion.</p>
<p>Let us say we have two macros A and B. The expansion of A calls B. The following
diagram shows the lexical scopes of bindings used in A and B. The table after
describes the scopes in more detail.</p>
<pre style="line-height: 1em; font-family: Andale Mono, Courier New">
╒═════════════════════════════════════╕
│ [1] Module or lexical scope of a    │
│     call to macro A                 │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ [2] Expansion of A            │  │
│  │                               │  │
│  │  ┌─────────────────────────┐  │  │
│  │  │ [3] Expansion of B      │  │  │
│  │  │                         │  │  │
│  │  └─────────────────────────┘  │  │
│  │                               │  │
│  └───────────────────────────────┘  │
│                                     │
╘═════════════════════════════════════╛

╒═════════════════════════════════════╕
│ [4] Module containing definition of │
│     macro A                         │
│                                     │
╘═════════════════════════════════════╛

╒═════════════════════════════════════╕
│ [5] Module containing definition of │
│     macro B                         │
│                                     │
╘═════════════════════════════════════╛
</pre><p>In this table, each lexical scope is identified by its number as “Box 1”
through “Box 5”. The table describe which bindings defined in each column’s
lexical scope are visible in the lexical scope of each row. For example, the
table shows that the only bindings from Box 1 visible in Box 2 are those that
are captured by one of Macro A’s pattern variables and included in the
expansion.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Definition
Visibility</p></th>
<th class="head" colspan="5"><p>Definition Location</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Box 1</p></th>
<th class="head"><p>Box 2</p></th>
<th class="head"><p>Box 3</p></th>
<th class="head"><p>Box 4</p></th>
<th class="head"><p>Box 5</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Box 1</p></td>
<td><p>All</p></td>
<td><p>Only if defined
with unhygienic
reference to name
from 1, captured by
pattern variable of
A</p></td>
<td><p>Only if defined
with unhygienic
reference to name
from 1, captured by
pattern variable of
A and recaptured by
pattern variable of
B</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Box 2</p></td>
<td><p>Only if captured by
pattern variable of
A</p></td>
<td><p>All</p></td>
<td><p>Only if defined
with unhygienic
reference to name
from 2, captured by
pattern variable of
B</p></td>
<td><p>All</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Box 3</p></td>
<td><p>Only if captured by
pattern variable of
A and recaptured by
pattern variable of
B</p></td>
<td><p>Only if captured by
pattern variable of
B</p></td>
<td><p>All</p></td>
<td></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>Box 4</p></td>
<td></td>
<td></td>
<td></td>
<td><p>All</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Box 5</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>All</p></td>
</tr>
</tbody>
</table>
</div>
<section id="breaking-hygiene">
<h3>Breaking hygiene<a class="headerlink" href="#breaking-hygiene" title="Permalink to this heading">#</a></h3>
<p>A template can prefix a binding with <code class="samp docutils literal notranslate"><span class="pre">?=</span></code>. This makes the binding come from
and be visible in the macro’s caller. This can be illustrated by an example from
<cite>Dylan Programming</cite>.</p>
<p>Say this is the Macro A defined in Box 4,</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">repeat</span>
<span class="linenos">2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">repeat</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">body</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="p">}</span>
<span class="hll"><span class="linenos">3</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">block</span><span class="w"> </span><span class="p">(</span><span class="nt">?=stop!</span><span class="p">)</span>
</span><span class="linenos">4</span><span class="w">           </span><span class="k">local</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">again</span><span class="p">()</span><span class="w"> </span><span class="nt">?body</span><span class="p">;</span><span class="w"> </span><span class="n">again</span><span class="p">();</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">5</span><span class="w">           </span><span class="n">again</span><span class="p">();</span>
<span class="linenos">6</span><span class="w">         </span><span class="k">end</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">7</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
<p>and it is called in Box 1 like so:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">repeat</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="n">stop!</span><span class="p">()</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
<span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The <code class="samp docutils literal notranslate"><span class="pre">?=stop!</span></code> substitution in line 3 of the macro becomes a reference to a
binding visible in Boxes 1 and 2. In Box 1, the binding is visible as <code class="samp docutils literal notranslate"><span class="pre">stop!</span></code>.
In Box 2 (the expansion itself), the binding is visible as <code class="samp docutils literal notranslate"><span class="pre">?=stop!</span></code> and can be
used like any binding (e.g., <code class="samp docutils literal notranslate"><span class="pre">format-out(&quot;%=&quot;,</span> <span class="pre">?=stop!)</span></code>).</p>
<p>Note that that a macro expansion cannot create a new name visible outside of the
macro call itself. In other words, Box 2 cannot create a binding for use
elsewhere in Box 1 unless Box 1 supplies the name to be defined.</p>
<p>For example, given this macro,</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">do-then-foo</span>
<span class="linenos">2</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">do-then-foo</span><span class="p">(</span><span class="nt">?</span><span class="o">:</span><span class="nb">expression</span><span class="p">)</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">body</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">3</span><span class="w">    </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="nt">?=foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">?expression</span><span class="p">;</span><span class="w"> </span><span class="nt">?body</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">4</span><span class="k">end</span><span class="w"> </span><span class="nb">macro</span>
</pre></div>
</div>
</div></blockquote>
<p>one might expect the macro call</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">do-then-foo</span><span class="p">(</span><span class="s">&quot;Hello</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">format-out</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
<span class="n">format-out</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>would print “Hello” twice, but the code does not compile. Because every macro expansion
is implicitly surrounded by <code class="samp docutils literal notranslate"><span class="pre">begin...end</span></code> as described in <a class="reference internal" href="#background-and-overview">Background and Overview</a>,
the example expands into:</p>
<blockquote>
<div><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">begin</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="n">format-out</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="k">end</span><span class="p">;</span>
<span class="n">format-out</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>After the macro call, <code class="samp docutils literal notranslate"><span class="pre">foo</span></code> is no longer in scope.</p>
</section>
</section>
<section id="faq-and-tips">
<h2>FAQ and Tips<a class="headerlink" href="#faq-and-tips" title="Permalink to this heading">#</a></h2>
<section id="general-advice-and-troubleshooting">
<h3>General advice and troubleshooting<a class="headerlink" href="#general-advice-and-troubleshooting" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>The best way to design a macro is:</dt><dd><ol class="arabic simple">
<li><p>Come up with the best non-macro interface you can.</p></li>
<li><p>Design the syntax of the macro call up front.</p></li>
<li><p>Implement that design.</p></li>
</ol>
</dd>
</dl>
</li>
<li><p>Gwydion Dylan sometimes has issues with trailing semi-colons or commas. In
general, don’t include a separator at the end of a template.</p></li>
<li><p>In both Gwydion Dylan and Open Dylan, the variable declaration for a variable
used in the lexical scope of a macro needs to be in that macro. The variable
cannot be declared in an auxiliary macro and exposed to the macro through the
<code class="samp docutils literal notranslate"><span class="pre">?=</span></code> mechanism. However, the variable can be declared in an auxiliary rule of
the macro.</p></li>
<li><p>Ensure you haven’t accidently given a pattern variable the same name as an
auxiliary rule set.</p></li>
<li><p>In Open Dylan, use <code class="samp docutils literal notranslate"><span class="pre">define</span> <span class="pre">traced</span> <span class="pre">macro</span></code> to get additional debug output while
developing macros.</p></li>
</ul>
</section>
<section id="how-can-i-combine-multiple-names-into-one">
<h3>How can I combine multiple names into one?<a class="headerlink" href="#how-can-i-combine-multiple-names-into-one" title="Permalink to this heading">#</a></h3>
<p>There is no real way to do this for names or symbols. The concatenating
substitution forms do not scale, so this template will not work:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="nt">?name-1</span><span class="w"> </span><span class="p">##</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="p">##</span><span class="w"> </span><span class="nt">?name-2</span><span class="w"> </span><span class="p">##</span><span class="w"> </span><span class="s">&quot;-function&quot;</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>However, you can easily combine multiple names into a string by taking advantage
of adjacent string concatenation:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="n">format-out</span><span class="p">(?</span><span class="s">&quot;name-1&quot;</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="p">?</span><span class="s">&quot;name-2&quot;</span><span class="w"> </span><span class="s">&quot;-function&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Your best bet may be to do some sort of string-based introspection, or create
anonymous definitions stored in a table keyed by a string.</p>
</section>
<section id="how-can-i-write-macros-that-follow-a-bnf-like-syntax">
<h3>How can I write macros that follow a BNF-like syntax?<a class="headerlink" href="#how-can-i-write-macros-that-follow-a-bnf-like-syntax" title="Permalink to this heading">#</a></h3>
<p>Macros are designed to follow Dylan language conventions, so you may not be able
to support arbitrary BNF-based syntax. But here are some tricks to help with
common BNF forms.</p>
<dl>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">x</span></em><span class="pre">?</span></code></dt><dd><p>An optional item can be handled by a wildcard pattern variable using an
auxiliary rule with two patterns:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">x-opt</span><span class="o">:</span>
<span class="s">  { x }</span>
<span class="s">  { }</span>
</pre></div>
</div>
</dd>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">x</span></em><span class="pre">?</span> <em><span class="pre">y</span></em><span class="pre">?</span> <em><span class="pre">z</span></em><span class="pre">?</span></code></dt><dd><p>If there are several space-separated optional items, put them all in the
same auxiliary rule, since the upper rule can’t have adjacent wildcard
pattern variables that call out to an individual auxiliary rule for each
item:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">x-y-z-opts</span><span class="o">:</span>
<span class="s">  { x ... }</span>
<span class="s">  { y ... }</span>
<span class="s">  { z ... }</span>
<span class="s">  { }</span>
</pre></div>
</div>
</dd>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">x</span></em><span class="pre">?</span> <span class="pre">|</span> <em><span class="pre">x</span></em> <span class="pre">(,</span> <em><span class="pre">x</span></em><span class="pre">)*</span></code></dt><dd><p>This is a list that may have 0–<em>n</em> items. Handle this by calling out to an
auxiliary rule that calls itself recursively like so:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">x-list</span><span class="o">:</span>
<span class="s">  { ?x:*, ?x-list:* }</span>
<span class="s">  { }</span>
</pre></div>
</div>
<p>Note that the calling rule needs to use a wildcard pattern variable to
collect the comma’d items for the <code class="samp docutils literal notranslate"><span class="pre">x-list:</span></code> rule set; this pattern
variable needs to be well-separated from the syntax that follows it by a
semicolon or intermediate word.</p>
</dd>
<dt><code class="samp docutils literal notranslate"><em><span class="pre">x</span></em> <span class="pre">(,</span> <em><span class="pre">x</span></em><span class="pre">)*</span></code></dt><dd><p>This is a list that may have 1–<em>n</em> items. You simply cannot do this in the
general case; your best bet is design your macro to handle 0 items
gracefully and then use a 0-<em>n</em> list.</p>
<p>The following does not work because <code class="samp docutils literal notranslate"><span class="pre">?</span><em><span class="pre">x</span></em><span class="pre">:*</span></code> allows an empty code
fragment, which allows 0 items:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">x-list</span><span class="o">:</span>
<span class="s">  // Doesn&#39;t work</span>
<span class="s">  { ?x:*, ?x-list:* }</span>
<span class="s">  { ?x:* }</span>
</pre></div>
</div>
<p>Of course, if you can put a constraint on <code class="samp docutils literal notranslate"><span class="pre">?x</span></code>, it will work fine, but
remember that a secondary rule can’t be used to provide a constraint in a
primary rule.</p>
</dd>
</dl>
</section>
<section id="i-can-t-make-a-bare-list">
<h3>I can’t make a bare list!<a class="headerlink" href="#i-can-t-make-a-bare-list" title="Permalink to this heading">#</a></h3>
<p>A macro that makes a bare list (by which I mean a simple list of comma-separated
names) cannot do anything useful with it. Macros build cohesive code fragments,
and a bare list is not such a code fragment.</p>
<p>For example, this will not compile:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">setter-names</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">setter-names</span><span class="p">(</span><span class="nt">?names</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">?names</span><span class="w"> </span><span class="p">}</span>
<span class="k">names:</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">name</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">?name</span><span class="w"> </span><span class="p">##</span><span class="w"> </span><span class="s">&quot;-setter&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="k">end</span><span class="w"> </span><span class="nb">macro</span><span class="p">;</span>

<span class="nb">vector</span><span class="p">(</span><span class="n">setter-names</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">gamma</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="p">))</span>
</pre></div>
</div>
<p>It does not compile because the expansion of <code class="samp docutils literal notranslate"><span class="pre">setter-names</span></code> is wrapped in a
begin…end, resulting in this invalid syntax:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="nb">vector</span><span class="p">(</span><span class="k">begin</span><span class="w"> </span><span class="n">alpha-setter</span><span class="p">,</span><span class="w"> </span><span class="n">beta-setter</span><span class="p">,</span><span class="w"> </span><span class="n">gamma-setter</span><span class="p">,</span><span class="w"> </span><span class="n">delta-setter</span><span class="w"> </span><span class="k">end</span><span class="p">)</span>
</pre></div>
</div>
<p>Instead, do something with the list in the macro itself:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">macro</span><span class="w"> </span><span class="n">setter-vector</span>
<span class="hll"><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">setter-vector</span><span class="p">(</span><span class="nt">?names</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">vector</span><span class="p">(</span><span class="nt">?names</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span class="k">names:</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">?</span><span class="o">:</span><span class="nb">name</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">?name</span><span class="w"> </span><span class="p">##</span><span class="w"> </span><span class="s">&quot;-setter&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="k">end</span><span class="w"> </span><span class="nb">macro</span><span class="p">;</span>

<span class="hll"><span class="n">setter-vector</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">gamma</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2011-2023, Dylan Hackers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">The Dylan Macro System</a><ul>
<li><a class="reference internal" href="#background-and-overview">Background and Overview</a><ul>
<li><a class="reference internal" href="#anatomy-and-terms">Anatomy and terms</a></li>
</ul>
</li>
<li><a class="reference internal" href="#macro-types">Macro Types</a><ul>
<li><a class="reference internal" href="#macro-definitions">Macro definitions</a></li>
<li><a class="reference internal" href="#main-rules">Main Rules</a><ul>
<li><a class="reference internal" href="#body-style-definition-macro">Body-style definition macro</a></li>
<li><a class="reference internal" href="#list-style-definition-macro">List-style definition macro</a></li>
<li><a class="reference internal" href="#statement-macro">Statement macro</a></li>
<li><a class="reference internal" href="#function-macro">Function macro</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#patterns">Patterns</a><ul>
<li><a class="reference internal" href="#subdivisions">Subdivisions</a></li>
<li><a class="reference internal" href="#final-items">Final items</a></li>
<li><a class="reference internal" href="#property-lists">Property lists</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pattern-variables">Pattern Variables</a><ul>
<li><a class="reference internal" href="#simple-pattern-variables">Simple pattern variables</a></li>
<li><a class="reference internal" href="#property-list-pattern-variables">Property list pattern variables</a></li>
<li><a class="reference internal" href="#body-and-macro-pattern-variables">Body and macro pattern variables</a></li>
<li><a class="reference internal" href="#wildcard-pattern-variables">Wildcard pattern variables</a></li>
<li><a class="reference internal" href="#auxiliary-rule-set-pattern-variables">Auxiliary rule set pattern variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#substitutions">Substitutions</a><ul>
<li><a class="reference internal" href="#finalitems-subst">Final items</a></li>
<li><a class="reference internal" href="#simple-substitutions">Simple substitutions</a></li>
<li><a class="reference internal" href="#conversion-substitutions">Conversion substitutions</a></li>
<li><a class="reference internal" href="#concatenation-substitutions">Concatenation substitutions</a></li>
<li><a class="reference internal" href="#list-substitutions">List substitutions</a></li>
<li><a class="reference internal" href="#auxiliary-rule-set-substitution">Auxiliary rule set substitution</a></li>
<li><a class="reference internal" href="#unhygienic-reference">Unhygienic reference</a></li>
</ul>
</li>
<li><a class="reference internal" href="#auxiliary-rules-and-expansions">Auxiliary Rules and Expansions</a><ul>
<li><a class="reference internal" href="#auxiliary-rules">Auxiliary Rules</a></li>
<li><a class="reference internal" href="#expansions">Expansions</a><ul>
<li><a class="reference internal" href="#simple-expansion">Simple expansion</a><ul>
<li><a class="reference internal" href="#effect-of-constraints">Effect of constraints</a></li>
<li><a class="reference internal" href="#empty-and-missing-code-fragments">Empty and missing code fragments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complex-expansion">Complex expansion</a><ul>
<li><a class="reference internal" href="#property-lists-and-optional-properties">Property lists and optional properties</a></li>
<li><a class="reference internal" href="#auxiliary-rule-sets-in-auxiliary-rules">Auxiliary rule sets in auxiliary rules</a></li>
<li><a class="reference internal" href="#and-pattern-variables"><code class="samp docutils literal notranslate"><span class="pre">??</span></code> and <code class="samp docutils literal notranslate"><span class="pre">?</span></code> pattern variables</a></li>
<li><a class="reference internal" href="#empty-pattern-variables">Empty <code class="samp docutils literal notranslate"><span class="pre">??</span></code> pattern variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recursive-expansion">Recursive expansion</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#hygiene">Hygiene</a><ul>
<li><a class="reference internal" href="#breaking-hygiene">Breaking hygiene</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq-and-tips">FAQ and Tips</a><ul>
<li><a class="reference internal" href="#general-advice-and-troubleshooting">General advice and troubleshooting</a></li>
<li><a class="reference internal" href="#how-can-i-combine-multiple-names-into-one">How can I combine multiple names into one?</a></li>
<li><a class="reference internal" href="#how-can-i-write-macros-that-follow-a-bnf-like-syntax">How can I write macros that follow a BNF-like syntax?</a></li>
<li><a class="reference internal" href="#i-can-t-make-a-bare-list">I can’t make a bare list!</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=2df60dd4"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>