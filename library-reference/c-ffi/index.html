<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="The collections Library" href="../collections/index.html" /><link rel="prev" title="LID File Format" href="../lid.html" />

    <link rel="shortcut icon" href="../../_static/favicon.ico"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>The c-ffi Library - Open Dylan</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Open Dylan</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/images/opendylan-light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/images/opendylan-dark.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Get Involved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../download/index.html">Download</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../hacker-guide/index.html">Hacker Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Hacker Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hacker-guide/documentation/index.html">Writing Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Writing Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/documentation/guidelines.html">Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/documentation/generating.html">Generating Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/documentation/doctower.html">Doctower</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/documentation/example.html">Example documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../hacker-guide/build-system.html">Jam-based Build System</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hacker-guide/compiler/index.html">DFMC, The Dylan Flow Machine Compiler</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of DFMC, The Dylan Flow Machine Compiler</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/compiler/notes-warnings-errors.html">Notes, Warnings and Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/compiler/old/design.html">Compiler Design (Old)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/compiler/old/internals.html">Compiler Internals (Old)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hacker-guide/runtime/index.html">The Runtime</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of The Runtime</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/runtime/object-representation.html">Object Representation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/runtime/calling-convention.html">Calling Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/runtime/special-features.html">Special Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/runtime/mangling.html">Name Mangling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/runtime/threads.html">Compiler Support for Threads</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/runtime/startup.html">Startup</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hacker-guide/runtime-manager/index.html">Runtime Manager</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Runtime Manager</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/runtime-manager/access-path.html">The ACCESS-PATH library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/runtime-manager/debugger-manager.html">The DEBUGGER-MANAGER library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../hacker-guide/duim/index.html">DUIM - Dylan User Interface Manager</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../hacker-guide/topics/index.html">Topics</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Topics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/topics/method-dispatch.html">Method Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/topics/debugging.html">Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/topics/porting.html">Porting to a New Target Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/topics/ppml.html">The PPML library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/topics/making-a-release.html">Release Check-list</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hacker-guide/topics/opendylan.org.html">Maintaining opendylan.org</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../hacker-guide/glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hacker-guide/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../proposals/index.html">Enhancement Proposals</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Enhancement Proposals</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0001-dep-process.html">DEP Purpose and Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0002-define-function.html">Define Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0003-c3-linearization.html">C3 superclass linearization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0004-strings-library.html">New strings Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0005-subclass-function.html">Subclass</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0006-single-file-library.html">Single File Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0007-collection-type-safety.html">Type-Safe Limited Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0008-multi-line-strings.html">Multi-line Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0010-element-otherwise.html">Defaulted Element Reference Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0011-numeric-literal-syntax.html">Numeric Literal Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0012-string-literals.html">String Literal Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../proposals/dep-0013-multi-assignment.html">Multiple Value Assignment</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../about/index.html">Tour of Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Tour of Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/hello_world.html">Hello, World!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/everything_value.html">Everything is a value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/classes.html">Classes &amp; Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/generic_functions.html">Generic Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/getters_setters_functions.html">Getters &amp; Setters are functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/keyword_arguments.html">Keyword Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/limited_types.html">Limited Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/examples/multiple_return_values.html">Multiple Return Values</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../getting-started-cli/index.html">Getting Started Guide</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Getting Started Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/hello-world.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/source-registries.html">Using Source Registries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/managing-dependencies.html">Managing Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/quick-tips.html">A Few More Quick Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/dylan-compiler.html">Using dylan-compiler interactively</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/dylan-environment.html">An example of dylan-environment interactive functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/editor-support.html">Editor Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/dylan-mode-for-emacs.html">Dylan Interactor Mode for Emacs (DIME)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/debugging-with-gdb-lldb.html">Debugging with GDB or LLDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/windows.html">Notes for Windows Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/environment-variables.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/cross-compilation.html">Cross Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/platform-specific.html">Platform Specific Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started-cli/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://package.opendylan.org/dylan-programming-book/">Dylan Programming Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://play.opendylan.org">Dylan Playground</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/cheatsheets/index.html">Cheat Sheets</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Cheat Sheets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/cheatsheets/syntax.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/cheatsheets/conditionals.html">Conditionals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/cheatsheets/collections.html">Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/cheatsheets/iteration.html">Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/cheatsheets/scheme.html">For Schemers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/cheatsheets/python.html">For Pythonistas</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://opendylan.org/books/drm/">Dylan Reference Manual</a></li>
<li class="toctree-l1"><a class="reference external" href="https://package.opendylan.org/">Package Docs</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Bundled Libraries</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Bundled Libraries</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../language-extensions/index.html">Dylan Language Extensions</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Dylan Language Extensions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/language-differences.html">Language Differences</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/define-function.html">Function Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/for-iteration.html">Extensions to the FOR iteration macro</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/weak-tables.html">Weak tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/inlining.html">Inlining adjectives for methods, constants, functions, and slots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/numbers.html">Integers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/object-with-elements.html">object-with-elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/macro-system-extensions.html">Macro System Extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/parser-expansions.html">Parser Expansions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/alternative-curry-syntax.html">Alternative Curry Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/numeric-literals.html">Numeric Literal Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../language-extensions/string-literals.html">String Literal Syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../lid.html">LID File Format</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">The c-ffi Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../collections/index.html">The collections Library</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of The collections Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../collections/bit-set.html">The bit-set Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collections/bit-vector.html">The bit-vector Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collections/collectors.html">The collectors Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collections/plists.html">The plists Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collections/set.html">The set Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../collections/table-extensions.html">The table-extensions Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../coloring-stream/index.html">The coloring-stream Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../common-dylan/index.html">The common-dylan Library</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of The common-dylan Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../common-dylan/byte-vector.html">The byte-vector Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common-dylan/common-extensions.html">The common-extensions Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common-dylan/machine-words.html">The machine-words Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common-dylan/simple-format.html">The simple-format Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common-dylan/simple-profiling.html">The simple-profiling Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common-dylan/simple-random.html">The simple-random Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common-dylan/simple-timers.html">The simple-timers Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../common-dylan/transcendentals.html">The transcendentals Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dispatch-profiler/index.html">The DISPATCH-PROFILER library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dood/index.html">The DOOD library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../dylan/index.html">The dylan Library</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of The dylan Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../dylan/finalization.html">The finalization Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dylan/primitives.html">The dylan-primitives Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dylan/threads.html">The threads Module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../io/index.html">The io Library</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of The io Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../io/format.html">The format Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../io/format-out.html">The format-out Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../io/print.html">The print and pprint Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../io/streams.html">The streams Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../io/standard-io.html">The standard-io Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">The network Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../progress-stream/index.html">The progress-stream Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sql/index.html">The sql Library</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../system/index.html">The system Library</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of The system Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../system/date.html">The date Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../system/locators.html">The locators Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../system/file-system.html">The file-system Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../system/operating-system.html">The operating-system Module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../t-lists/index.html">The t-lists Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../win32/index.html">The Win32 API Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../documentation/index.html">Other Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Other Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../news/index.html">News</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/publications.html">Publications</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../intro-dylan/index.html">Intro to Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of Intro to Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/why-dylan.html">Why Dylan?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/expressions-variables.html">Expressions &amp; Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/methods-generic-functions.html">Methods &amp; Generic Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/objects.html">Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/multiple-dispatch.html">Multiple Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/modules-libraries.html">Modules &amp; Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/conditions.html">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../intro-dylan/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../corba-guide/index.html">CORBA Guide</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of CORBA Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/intro.html">About Open Dylan CORBA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/getstart.html">Quick Start Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/bank-setup.html">Setting up the Bank Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/bank-idl.html">Writing and Compiling IDL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/bank-client.html">The Bank Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/bank-server.html">The Bank Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/projects.html">Creating CORBA Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/rundebug.html">Running and Debugging CORBA Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/scepter.html">Using the Dylan IDL Compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../corba-guide/idl-app.html">An IDL Binding for Dylan</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../building-with-duim/index.html">DUIM Guide</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of DUIM Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/design.html">Designing A Simple DUIM Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/improve.html">Improving The Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/menus.html">Adding Menus To The Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/callbacks.html">Adding Callbacks to the Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/commands.html">Using Command Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/tour.html">A Tour of the DUIM Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/source.html">Source Code For The Task List Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-with-duim/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../duim-reference/index.html">DUIM Reference</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of DUIM Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/conventions.html">Conventions in this Manual</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/geom.html">DUIM-Geometry Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/ext-geom.html">DUIM-Extended-Geometry Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/dcs.html">DUIM-DCs Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/sheets.html">DUIM-Sheets Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/graphics.html">DUIM-Graphics Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/layouts.html">DUIM-Layouts Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/gadgets.html">DUIM-Gadgets Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/frames.html">DUIM-Frames Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../duim-reference/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../getting-started-ide/index.html">Getting Started / IDE</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of Getting Started / IDE</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/preface.html">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/quick-start.html">Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/expanding.html">Fixing Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/model.html">Programming in Open Dylan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/projects.html">Creating and Using Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/browsing.html">Learning More About an Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/debug.html">Debugging and Interactive Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/remotedbg.html">Remote Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/coloring.html">Dispatch Optimization Coloring in the Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/delivery.html">Delivering Dylan Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/editopt.html">The Interactive Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/com-projects.html">Creating COM Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started-ide/copyright.html">Copyright</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../release-notes/index.html">Release Notes</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of Release Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2026.1.html">Open Dylan 2026.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2025.1.html">Open Dylan 2025.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2024.1.html">Open Dylan 2024.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2023.1.html">Open Dylan 2023.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2022.1.html">Open Dylan 2022.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2020.1.html">Open Dylan 2020.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2019.1.html">Open Dylan 2019.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2014.1.html">Open Dylan 2014.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2013.2.html">Open Dylan 2013.2 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2013.1.html">Open Dylan 2013.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2012.1.html">Open Dylan 2012.1 Release Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release-notes/2011.1.html">Open Dylan 2011.1 Release Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../style-guide/index.html">Style Guide</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../history/index.html">Dylan History</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of Dylan History</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../history/apple-dylan/index.html">Apple Dylan</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of Apple Dylan</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../history/apple-dylan/apple-cambridge.html">Apple Cambridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../history/apple-dylan/eulogy.html">Apple Dylan Eulogy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../history/apple-dylan/technology-release.html">Apple Dylan Technology Release</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../history/apple-dylan/today.html">Apple Dylan Today</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../history/apple-dylan/screenshots/browsers.html">Apple Dylan Screenshots - Browsers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../history/apple-dylan/screenshots/dynamic.html">Apple Dylan Screenshots - Dynamic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../history/apple-dylan/screenshots/index.html">Apple Dylan Screenshots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../history/apple-dylan/screenshots/misc.html">Apple Dylan Screenshots - Misc</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Full Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/dylan-lang/opendylan/blob/master/documentation/source/library-reference/c-ffi/index.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/dylan-lang/opendylan/edit/master/documentation/source/library-reference/c-ffi/index.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="the-c-ffi-library">
<span id="index-0"></span><h1>The c-ffi Library<a class="headerlink" href="#the-c-ffi-library" title="Link to this heading">Â¶</a></h1>
<p id="index-1">The C-FFI (<em>C foreign function interface</em>) library provides a means of
interfacing a Dylan application with code written in the C language. The
C-FFI library is available to applications as the module C-FFI in the
library C-FFI.</p>
<p>The C-FFI library consists of macros, classes, and functions that you
can use to write a complete description of the Dylan interface to a C
library. Compiling this description generates a set of Dylan classes and
functions through which Dylan code can manipulate the C libraryâs data
and call its functions. Interface descriptions can also allow C code to
call into Dylan; compiling such a description generates entry points
compatible with Câs calling conventions.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">Â¶</a></h2>
<p>This section is an overview of the C-FFI library, introducing the most
commonly used constructs as the basis for examples.</p>
<p>The C-FFI library provides a set of macros that can be used to describe
a C interface in a form that the Open Dylan compiler can
understand; we call these macros the <em>C interface definition language</em>.</p>
<p>The C interface definition language provides macros that correspond to
each of Câs type, function, variable, and constant defining forms. These
macros define Dylan classes that designate and encapsulate instances of
C types, Dylan methods through which to manipulate C variables and call
out to C functions, and functions with C-compatible entry points through
which to call in to Dylan from C.</p>
<p>In addition to the interface definition language, the C-FFI library
provides run-time methods and functions for allocating, manipulating and
destroying instances of C data structures. For example, using these
facilities you can allocate C structs and arrays, and access and set
their elements.</p>
<section id="c-types-in-dylan">
<span id="index-2"></span><h3>C types in Dylan<a class="headerlink" href="#c-types-in-dylan" title="Link to this heading">Â¶</a></h3>
<p>When you use the interface definition language to describe a C type to
the Dylan compiler, the compiler generates a new Dylan class. This class
is said to <em>designate</em> the C type, which means that it carries with it
the essential properties of the C type such as its size and alignment.</p>
<p id="index-3">You can use this <em>designator class</em> in subsequent interface definition
forms to specify which elements involve the designated C type. A
designator class also carries with it the information on how to
interpret the untyped C data as a tagged Dylan object.</p>
<p id="index-4">The C-FFI library contains predefined designator classes for Câs
fundamental types like <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">double</span></code>. The names of these
predefined Dylan classes are formed from the C name of the fundamental
type being designated. The designator class name for a particular C type
formed using Dylanâs standard class-naming convention; it is prefixed
with âC-â, hyphenated if it contains more than one word, and enclosed in
angle brackets. For example, the C-FFI library provides the class
<code class="docutils literal notranslate"><span class="pre">&lt;C-int&gt;</span></code> to designate the C type <code class="docutils literal notranslate"><span class="pre">int</span></code> ; it designates <code class="docutils literal notranslate"><span class="pre">double</span></code>
by the class <code class="docutils literal notranslate"><span class="pre">&lt;C-double&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span></code> by the class
<code class="docutils literal notranslate"><span class="pre">&lt;C-unsigned-long&gt;</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since Dylan variable names are compared without sensitivity to
case, the capitalization of the âCâ in the names above, and in other
Dylan names appearing in this document, is not binding and can safely be
ignored.</p>
</div>
<p id="index-5">The C-FFI library also provides predefined classes designating pointers
to Câs fundamental numeric types. To do so, it adds a <code class="docutils literal notranslate"><span class="pre">*</span></code> to the
fundamental C type designator. For example <code class="docutils literal notranslate"><span class="pre">&lt;C-double*&gt;</span></code> designates the
C type <code class="docutils literal notranslate"><span class="pre">double*</span></code>.</p>
<p>The following is an example of defining and using designator classes.
Suppose we have the following C struct:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">x_coord</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">y_coord</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span>
</pre></div>
</div>
<p id="index-6">We describe C structs to Dylan using the macro <a class="reference internal" href="#c-ffi:c-ffi:definec-struct"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-struct</span></code></a>:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-struct</span><span class="w"> </span><span class="nc">&lt;Point&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">x-coord</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-unsigned-short&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">y-coord</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-unsigned-short&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-struct</span><span class="p">;</span>
</pre></div>
</div>
<p id="index-7">This form defines a new designator class <code class="docutils literal notranslate"><span class="pre">&lt;Point&gt;</span></code> for a structure type
corresponding to the C type <code class="docutils literal notranslate"><span class="pre">Point</span></code>. We designate the types of the
slots of <code class="docutils literal notranslate"><span class="pre">&lt;Point&gt;</span></code> using the Dylan classes designating the C types used
in the definition of <code class="docutils literal notranslate"><span class="pre">Point</span></code>. In this case, both slots are of the C
type <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">short</span></code> which is designated by the predefined class
<code class="docutils literal notranslate"><span class="pre">&lt;C-unsigned-short&gt;</span></code>. The information about the C type <code class="docutils literal notranslate"><span class="pre">unsigned</span>
<span class="pre">short</span></code> carried by this designator class allows the compiler to compute
the size, alignment, and layout of the struct. The compiler records the
structâs size and alignment and associates them with <code class="docutils literal notranslate"><span class="pre">&lt;Point&gt;</span></code>. The
designator class <code class="docutils literal notranslate"><span class="pre">&lt;Point&gt;</span></code> can then be used in the definition of other
types, functions, and variables. For example, we could describe</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Point</span><span class="w"> </span><span class="n">start</span><span class="p">;</span>
<span class="w">  </span><span class="n">Point</span><span class="w"> </span><span class="n">end</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">LineSegment</span><span class="p">;</span>
</pre></div>
</div>
<p>like this:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-struct</span><span class="w"> </span><span class="nc">&lt;LineSegment&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Point&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Point&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-struct</span><span class="p">;</span>
</pre></div>
</div>
<p>As well as acting as a static information carrier for use in other FFI
definitions, a designator class can also be instantiable, in which case
Dylan uses an instance of the designator class to represent an object of
the C type it designates when that object is passed from the âC worldâ
to the âDylan worldâ.</p>
<div class="admonition note" id="index-8">
<p class="admonition-title">Note</p>
<p>Only classes that designate C pointer types can be
instantiated in this way. Instances of Câs fundamental numeric
value types like <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">char</span></code>, and <code class="docutils literal notranslate"><span class="pre">double</span></code> are just
converted to an equivalent Dylan object with the same value. The
<code class="docutils literal notranslate"><span class="pre">&lt;Point&gt;</span></code> class is not an instantiable class in Dylan because
there is nothing in Dylan that corresponds to a C struct.  However,
the C-FFI does provide a Dylan representation of a pointer to a C
struct.</p>
</div>
<p>To illustrate, here is an example interaction involving a C struct
containing some pointer-typed slots and some slots whose types are
fundamental numeric types:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-struct</span><span class="w"> </span><span class="nc">&lt;Example&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">statistic</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-double&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-char*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Example*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">pointer-type-name:</span><span class="w"> </span><span class="nc">&lt;Example*&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-struct</span><span class="p">;</span>
</pre></div>
</div>
<p>This example defines the two designator types <code class="docutils literal notranslate"><span class="pre">&lt;Example&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;Example*&gt;</span></code> ; the slots <em>count</em> and <em>statistic</em> have fundamental
numeric types while <em>data</em> and <em>next</em> have pointer types. The getter and
setter methods for the slots are defined for instances of <code class="docutils literal notranslate"><span class="pre">&lt;Example*&gt;</span></code>.</p>
<p>Suppose there is a function <em>current-example</em> that returns an
initialized <code class="docutils literal notranslate"><span class="pre">&lt;Example*&gt;</span></code> struct. The following transactions illustrate
what you get when you read the slots of the structure it returns:</p>
<div class="highlight-dylan-repl notranslate"><div class="highlight"><pre><span></span><span class="gp">?</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="nb">variable</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current-example</span><span class="p">();</span>
<span class="go">// Defined example</span>
<span class="gp">?</span><span class="w"> </span><span class="n">example</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
<span class="go">4</span>
<span class="gp">?</span><span class="w"> </span><span class="nb">instance?</span><span class="p">(</span><span class="n">example</span><span class="p">.</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">);</span>
<span class="go">#t</span>
<span class="gp">?</span><span class="w"> </span><span class="n">example</span><span class="p">.</span><span class="n">statistic</span><span class="p">;</span>
<span class="go">10.5</span>
<span class="gp">?</span><span class="w"> </span><span class="nb">instance?</span><span class="p">(</span><span class="n">example</span><span class="p">.</span><span class="n">statistic</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;float&gt;</span><span class="p">);</span>
<span class="go">#t</span>
</pre></div>
</div>
<p>The interactions above show that if we access structure slots that were
defined as being of one of Câs fundamental numeric types, we get a Dylan
number of the equivalent value. The same thing happens if an imported C
function returns a fundamental numeric type: a Dylan number with the
same value appears in Dylan. Similarly, when setting slots in structs
expecting numbers or passing objects out to C functions expecting
numeric arguments, you should provide a Dylan number, and the C-FFI will
convert it automatically to its C equivalent.</p>
<div class="highlight-dylan-repl notranslate"><div class="highlight"><pre><span></span><span class="gp">?</span><span class="w"> </span><span class="n">example</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
<span class="go">{&lt;C-char&gt; pointer #xff5e00}</span>
<span class="gp">?</span><span class="w"> </span><span class="nb">instance?</span><span class="p">(</span><span class="n">example</span><span class="p">.</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;C-char*&gt;</span><span class="p">);</span>
<span class="go">#t</span>
<span class="gp">?</span><span class="w"> </span><span class="n">example</span><span class="p">.</span><span class="n">next</span><span class="p">;</span>
<span class="go">{&lt;Example&gt; pointer #xff5f00}</span>
<span class="gp">?</span><span class="w"> </span><span class="nb">instance?</span><span class="p">(</span><span class="n">example</span><span class="p">.</span><span class="n">next</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;Example*&gt;</span><span class="p">);</span>
<span class="go">#t</span>
</pre></div>
</div>
<p>The interactions above show that accessing structure slots with a
pointer type results in an instance of the Dylan class that designates
that type. Again, the same thing happens if an imported C function
returns a pointer type: an instance of the corresponding designator
class is created. Similarly, when setting slots in structs expecting
pointers or passing objects out to C functions expecting pointer
arguments, you should provide an instance of the Dylan designator class
for that pointer type, and the C-FFI will convert it automatically to
the raw C pointer value.</p>
<p>Later sections describe all the macros available for defining C types
and the functions available for manipulating them.</p>
</section>
<section id="c-functions-in-dylan">
<span id="index-9"></span><h3>C functions in Dylan<a class="headerlink" href="#c-functions-in-dylan" title="Link to this heading">Â¶</a></h3>
<p>When you use the interface definition language to describe a C function
to the Dylan compiler, the compiler generates a new Dylan function. This
<em>wrapper function</em> accepts Dylan arguments and returns Dylan results. It
converts each of its arguments from a Dylan object to a corresponding C
value before calling the C function it wraps. The C-FFI converts any
results that the C function returns into Dylan objects before returning
them to the caller.</p>
<p id="index-10">In order for Dylan to be able to call into C correctly, C functions must
be described to Dylan in the same detail a C header file would provide a
calling C program. Specifically, for every function we must provide the
C name and the type of its arguments and results. As with struct
definitions, these types are indicated by naming the designator classes
corresponding to the C types involved in the C-FFI description of the C
function.</p>
<p>The following is an example of defining and using wrapper functions.
Suppose we have the following <code class="docutils literal notranslate"><span class="pre">extern</span></code> C function declaration:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">cos</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">angle</span><span class="p">);</span>
</pre></div>
</div>
<p id="index-11">We describe C functions to Dylan using the C-FFI macro <a class="reference internal" href="#c-ffi:c-ffi:definec-function"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span>
<span class="pre">C-function</span></code></a>:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">C-cos</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-double&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">cos</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-double&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;cos&quot;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>
</pre></div>
</div>
<p id="index-12">The name appearing immediately after the <a class="reference internal" href="#c-ffi:c-ffi:definec-function"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-function</span></code></a> is
the name we want to give to the Dylan variable to which our wrapper
function will be bound. We call it <em>C-cos</em>. We also give the actual C
name of the function we want to wrap as the value of the keyword
<em>c-name:</em>.</p>
<p>Once we have compiled the definition â and assuming the compiled version
of the C library implementing <em>cos</em> has been linked in with the Dylan
application â we can call the wrapper function just like any other Dylan
function:</p>
<div class="highlight-default notranslate" id="index-13"><div class="highlight"><pre><span></span>? C-cos(0.0);
1.0
</pre></div>
</div>
<p id="index-14">As we noted above, when values are passed back and forth between Dylan
and C, the C-FFI performs automatic conversions. In this case, the type
of the parameter and the result are both fundamental numeric types which
means that the C-FFI will accept and return Dylan floats, converting to
and from raw C floats as necessary.</p>
<p>As well as making C functions available to Dylan code, the C-FFI allows
us to make Dylan functions available to call from C code. We do this by
defining a <em>C-callable</em> wrapper function. A C-callable wrapper is a
Dylan function that a C program can call. The C-callable wrapper has a C
calling convention. When a C program calls a C-callable wrapper, the
C-FFI performs the necessary data conversions and then invokes a Dylan
function.</p>
<p>You can pass C-callable wrappers into C code for use as callbacks. You
can also give them names visible in C, so that C clients of Dylan code
can call into Dylan directly by invoking a named function.</p>
<p>The argument and result conversions performed by C-callable wrappers are
just like those done within Dylan wrapper functions. The macro that
defines C-callable wrappers is called <a class="reference internal" href="#c-ffi:c-ffi:definec-callable-wrapper"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-callable-wrapper</span></code></a>
and we describe it in detail later. For now, consider the following
simple example. Suppose we have a C <code class="docutils literal notranslate"><span class="pre">extern</span></code> function declaration
<em>AddDouble</em>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">AddDouble</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
<p>This function is intended to return the sum of two <code class="docutils literal notranslate"><span class="pre">double</span></code> values.
Instead of implementing the function in C, we can implement it in Dylan
using Dylanâs generic function <a class="reference external" href="https://opendylan.org/books/drm/Arithmetic_Operations#addition"><code class="xref drm docutils literal notranslate"><span class="pre">+</span></code></a>. All we need to do is define a
C-callable wrapper for <a class="reference external" href="https://opendylan.org/books/drm/Arithmetic_Operations#addition"><code class="xref drm docutils literal notranslate"><span class="pre">+</span></code></a>, as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-callable-wrapper</span><span class="w"> </span><span class="n">AddDoubleObject</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">\+</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-double&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-double&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;AddDouble&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-callable-wrapper</span><span class="p">;</span>
</pre></div>
</div>
<p>We can now call <code class="docutils literal notranslate"><span class="pre">AddDouble</span></code> in C. Our wrapper will be invoked, the C
arguments will be converted and passed to Dylanâs + generic function,
and then the result of the computation will be converted and passed back
to C:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="k">extern</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">AddDouble</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>

<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AddDouble</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The C-FFI binds the Dylan variable <em>AddDoubleObject</em> to a Dylan object
representing the function pointer of the C-callable wrapper. This
reference allows the C-callable wrapper to be passed to a C function
expecting a callback argument.</p>
</section>
<section id="c-variables-in-dylan">
<span id="index-15"></span><h3>C variables in Dylan<a class="headerlink" href="#c-variables-in-dylan" title="Link to this heading">Â¶</a></h3>
<p>When you use the interface definition language to describe a C variable
to the Dylan compiler, the compiler generates new Dylan getter and
setter functions for reading and setting the variableâs value from
Dylan. If the variable is constant, it defines a getter function only.</p>
<p>The getter function converts the C value to a Dylan value before
returning it according to the variableâs declared type. Similarly, the
setter function converts its argument, as Dylan value, into a C value
before setting the C variable. These conversions happen according to the
same rules that apply to other C-Dylan world transition points, such as
argument passing or structure slot access.</p>
<p id="index-16">In order for Dylan to be able to access a C variable correctly, we must
describe the variable to Dylan in the same detail that a C header file
would give to a C program that uses it. Specifically, we must provide
the C name and the type of the variable. As with struct and function
definitions, we indicate C types by naming the appropriate Dylan
designator classes.</p>
<p>Here is an example of defining and using C variables. Suppose we have
the following <code class="docutils literal notranslate"><span class="pre">extern</span></code> C variable declaration:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mean</span><span class="p">;</span>
</pre></div>
</div>
<p id="index-17">We describe C variables to Dylan using the C-FFI macro <a class="reference internal" href="#c-ffi:c-ffi:definec-variable"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span>
<span class="pre">C-variable</span></code></a>:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-variable</span><span class="w"> </span><span class="n">C-mean</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-double&gt;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-variable</span><span class="p">;</span>
</pre></div>
</div>
<p>The name immediately after the <a class="reference internal" href="#c-ffi:c-ffi:definec-variable"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-variable</span></code></a> is the name of
the Dylan variable to which the getter for our C variable will be bound.
In this case it is <em>C-mean</em>.</p>
<p>We give the C name of the variable as the value of the keyword <em>c-name:</em>.
Once we have compiled the definition â and assuming the compiled
version of the C library defining <em>mean</em> has been linked in with the
Dylan application â we can call the getter function just like any other
Dylan function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>? C-mean();
1.5
</pre></div>
</div>
<p>By default, the C-FFI also defines a setter function for the variable.
The setter name uses Dylanâs convention of appending â-setterâ to the
getter name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>? C-mean() := 0.0;
0.0
? C-mean();
0.0
</pre></div>
</div>
<p>As described above, when values are passed back and forth between Dylan
and C, the C-FFI performs automatic conversions. In this case, the type
of the variable is a fundamental numeric type which means that the C-FFI
accepts and returns Dylan floats, converting to and from raw C floats as
necessary.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We could achieve the same result by using the <a class="reference internal" href="#c-ffi:c-ffi:definec-address"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span>
<span class="pre">C-address</span></code></a> macro, which defines a constant that is a pointer to the
storage allocated for the C variable.</p>
</div>
</section>
</section>
<section id="notes-on-linking">
<h2>Notes on Linking<a class="headerlink" href="#notes-on-linking" title="Link to this heading">Â¶</a></h2>
<p>When using C-FFI, you will typically need to link in an existing library
or framework.</p>
<p><a class="reference internal" href="../lid.html"><span class="doc">LID files</span></a> provide many options for controlling
the compilation and linking of the project depending on what exactly
is required.</p>
<section id="linking-against-a-library">
<h3>Linking against a Library<a class="headerlink" href="#linking-against-a-library" title="Link to this heading">Â¶</a></h3>
<p>This can be done in a <a class="reference internal" href="../lid.html"><span class="doc">LID file</span></a> using the <a class="reference internal" href="../lid.html#lid-c-libraries"><span class="std std-ref">C-Libraries</span></a>
keyword.  This supports both static and shared libraries. It also supports
specifying a search path.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">-</span><span class="n">Libraries</span><span class="p">:</span> <span class="o">-</span><span class="n">lGL</span>
</pre></div>
</div>
</section>
<section id="linking-against-a-macos-framework">
<h3>Linking against a macOS Framework<a class="headerlink" href="#linking-against-a-macos-framework" title="Link to this heading">Â¶</a></h3>
<p>Just as with a regular shared library, the <a class="reference internal" href="../lid.html#lid-c-libraries"><span class="std std-ref">C-Libraries</span></a>
keyword in a <a class="reference internal" href="../lid.html"><span class="doc">LID file</span></a>.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">-</span><span class="n">Libraries</span><span class="p">:</span> <span class="o">-</span><span class="n">framework</span> <span class="n">OpenGL</span>
</pre></div>
</div>
</section>
<section id="using-pkg-config">
<h3>Using pkg-config<a class="headerlink" href="#using-pkg-config" title="Link to this heading">Â¶</a></h3>
<p>Libraries that use âpkg-configâ are slightly more complicated to work with in
that they require using the <a class="reference internal" href="../lid.html#lid-jam-includes"><span class="std std-ref">Jam-Includes</span></a> keyword and
an additional file within the project.  The GTK+ bindings provide multiple
examples of this.</p>
<p>In the LID file, you would include the additional Jam file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Jam</span><span class="o">-</span><span class="n">Includes</span><span class="p">:</span> <span class="n">gtk</span><span class="o">-</span><span class="n">dylan</span><span class="o">.</span><span class="n">jam</span>
</pre></div>
</div>
<p>And you would provide the additional Jam file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{
  local _dll = [ FDLLName $(image) ] ;
  LINKLIBS on $(_dll) += `pkg-config --libs gtk+-3.0` ;
  CCFLAGS += `pkg-config --cflags gtk+-3.0` ;
}
</pre></div>
</div>
</section>
</section>
<section id="tracing-ffi-calls">
<h2>Tracing FFI Calls<a class="headerlink" href="#tracing-ffi-calls" title="Link to this heading">Â¶</a></h2>
<p>When working with the C-FFI, it is very useful to be able to trace what
is happening, what is getting called, what the arguments are, and what
the return value is. To aid in this, C-FFI enables the programmer to
enable tracing.</p>
<p>To do this, you will need to exclude the default implementation of
tracing when importing the <code class="docutils literal notranslate"><span class="pre">c-ffi</span></code> module and define your own
implementation.</p>
<p>In your <code class="docutils literal notranslate"><span class="pre">library.dylan</span></code>, you would change your module declaration:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">c-ffi</span><span class="p">;</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">c-ffi</span><span class="p">,</span><span class="w"> </span><span class="k">exclude:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="no">$trace-ffi-calls</span><span class="p">,</span>
<span class="w">  </span><span class="n">log-entry</span><span class="p">,</span>
<span class="w">  </span><span class="n">log-exit</span><span class="w"> </span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">format-out</span><span class="p">;</span>
</pre></div>
</div>
<p>Note that weâve used the <code class="docutils literal notranslate"><span class="pre">format-out</span></code> module from the <code class="docutils literal notranslate"><span class="pre">io</span></code>
library in addition to the exclusion.</p>
<p>After doing that, you can define your own implementation of
tracing such that your implementation is in the same lexical
scope as the <code class="docutils literal notranslate"><span class="pre">C-function</span></code> definitions that you want to trace:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">constant</span><span class="w"> </span><span class="no">$trace-ffi-calls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="l">#t</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="nb">inline-only</span><span class="w"> </span><span class="nb">function</span><span class="w"> </span><span class="n">log-entry</span><span class="p">(</span><span class="n">c-function-name</span><span class="p">,</span><span class="w"> </span><span class="k">#rest</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="n">format-out</span><span class="p">(</span><span class="s">&quot;entering %s %=&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c-function-name</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
<span class="k">define</span><span class="w"> </span><span class="nb">inline-only</span><span class="w"> </span><span class="nb">function</span><span class="w"> </span><span class="n">log-exit</span><span class="p">(</span><span class="n">c-function-name</span><span class="p">,</span><span class="w"> </span><span class="k">#rest</span><span class="w"> </span><span class="n">results</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">();</span>
<span class="w">  </span><span class="n">format-out</span><span class="p">(</span><span class="s">&quot; =&gt; %=</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="p">...</span>
</pre></div>
</div>
<p>When this is run, you will see output like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entering</span> <span class="n">nn_socket</span> <span class="c1">#[1, 16] =&gt; #[0]</span>
<span class="n">entering</span> <span class="n">nn_socket</span> <span class="c1">#[1, 16] =&gt; #[1]</span>
<span class="n">entering</span> <span class="n">nn_bind</span> <span class="c1">#[0, &quot;inproc://a&quot;] =&gt; #[1]</span>
<span class="n">entering</span> <span class="n">nn_connect</span> <span class="c1">#[1, &quot;inproc://a&quot;] =&gt; #[1]</span>
<span class="n">entering</span> <span class="n">nn_send</span> <span class="c1">#[1, #x007D0AAC, 3, 0] =&gt; #[3]</span>
<span class="n">entering</span> <span class="n">nn_recv</span> <span class="c1">#[0, #x007D0AE4, 3, 0] =&gt; #[3]</span>
<span class="n">entering</span> <span class="n">nn_close</span> <span class="c1">#[0] =&gt; #[0]</span>
<span class="n">entering</span> <span class="n">nn_close</span> <span class="c1">#[1] =&gt; #[0]</span>
</pre></div>
</div>
</section>
<section id="terminology">
<span id="index-18"></span><h2>Terminology<a class="headerlink" href="#terminology" title="Link to this heading">Â¶</a></h2>
<p>For the rest of this chapter, we adopt the following terminology,
hopefully not too inconsistent with common C terminology:</p>
<ul class="simple">
<li><p><em>Base type</em> Basic units of data storage (Câs variously sized
integers, characters, and floating point numbers) and aggregate
records (structs and unions).</p></li>
<li><p><em>Derived type</em>. A type based on some other type (Câs pointer, array,
and function types).</p></li>
<li><p><em>Fundamental numeric type</em>. One of Câs integer or floating point types.
This does not include pointer types, structure types, or union types.</p></li>
</ul>
</section>
<section id="basic-options-in-c-ffi-macros">
<span id="index-19"></span><h2>Basic options in C-FFI macros<a class="headerlink" href="#basic-options-in-c-ffi-macros" title="Link to this heading">Â¶</a></h2>
<p>The defining macros of the C-FFI share a consistent core set of options
which are worth describing here:</p>
<ul>
<li><p>A <em>c-name</em> argument. Every defining form allows you to specify the
corresponding C entity through the keyword <em>c-name:</em>. It is optional
in some forms but required in others. You can define types that have
no named opposite number in C, and the c-name option is always
optional in type definitions. On the other hand, you must always name
an imported C function or variable so that Dylan knows the correct
name from the compiled C library to link with.</p>
<p>In general, any C entity you can declare in C using <code class="docutils literal notranslate"><span class="pre">extern</span></code> can only be
found by the C-FFI if you pass a <em>c-name</em> argument to the corresponding
C-FFI definition.</p>
<p>The sole exception to this is the <a class="reference internal" href="#c-ffi:c-ffi:defineobjc-selector"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">objc-selector</span></code></a> form which
instead takes a <code class="docutils literal notranslate"><span class="pre">selector:</span></code> keyword.</p>
</li>
<li><p>A <em>pointer-type-name</em> argument. All the type-defining forms (except for <a class="reference internal" href="#c-ffi:c-ffi:definec-pointer-type"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span>
<span class="pre">c-pointer-type</span></code></a>) allow you to name the type for a pointer to the type being defined.
This is specified with the <code class="docutils literal notranslate"><span class="pre">pointer-type-name:</span></code> keyword option.</p></li>
</ul>
</section>
<section id="designator-classes">
<span id="index-20"></span><h2>Designator classes<a class="headerlink" href="#designator-classes" title="Link to this heading">Â¶</a></h2>
<p>As <a class="reference internal" href="#overview">Overview</a> explained, the C-FFI defines some Dylan classes to designate
C types and to describe how they are passed to and from Dylan. These
<em>designator classes</em> carry with them static information about the C type
they designate.</p>
<p>The C-FFI library provides an initial set of designator classes
corresponding to Câs fundamental types, as well as macros for generating
designator classes corresponding to Câs pointer types and for extending
the translation between C data and Dylan objects.</p>
<p>Designator classes that correspond to fundamental numeric types are not
instantiable. When you pass a numeric value to Dylan from C, the C-FFI
simply generates a Dylan number with the same value. Similarly, a Dylan
number passed to C is converted to a C number of the appropriate type
and value.</p>
<p>Each of the fundamental designator classes indicate a conversion to or
from a unique Dylan class. The conversions that take place are described
in detail in the documentation for each designator class.</p>
<p>The main reasons for this design are increased efficiency, simplified
implementation, and added convenience when working with numeric values.
The designator classes for the numeric types could have been made
instantiable and placed beneath the appropriate number protocol classes
in Dylan, but these extra representations in such a fundamental area
could cause problems for Dylan compilers. In addition, to make these
instantiable designator classes convenient to work with, the C-FFI would
also have to define methods on the standard arithmetic and comparison
operators. It is simpler to represent these fundamental types with
existing Dylan objects.</p>
<p id="index-21">However, the designator classes that correspond to pointer types <em>are</em>
instantiable. When you pass a pointer from C to Dylan, the C-FFI
constructs an instance of the appropriate designator class that contains
the raw address. A wrapped pointer like this can be passed out to some C
code that is expecting a compatible pointer â the C-FFI extracts the raw
address before handing it to C code. The documentation for the abstract
class <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> describes the compatibility rules for pointer
types.</p>
<p>This feature of pointer designator classes allows Dylan code to be typed
to a specific kind of pointer. For example, you can define methods that
specialize on different kinds of pointer on the same generic function.</p>
<section id="designator-type-properties">
<span id="index-22"></span><h3>Designator type properties<a class="headerlink" href="#designator-type-properties" title="Link to this heading">Â¶</a></h3>
<p>To understand how designator classes work, it is useful to know about
their properties. A few of these properties are accessible
programmatically, but others are implicit and only really exist in the
compiler. Some of the properties may be empty.</p>
<p>A <em>referenced type</em> is the designator type to which a pointer refers. A
designatorâs <em>referenced type</em> only has a value for subtypes of
<a class="reference internal" href="#c-ffi:c-ffi:[c-statically-typed-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></code></a>. Programs can access the
referenced type through the function <a class="reference internal" href="#c-ffi:c-ffi:referenced-type"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">referenced-type</span></code></a>.</p>
<p id="index-23">A designator classâs <em>pointer-type</em> only has a value for each of
those types that has a pointer designator type that refers to it. Most
of the constructs that define a new designator type also define a
pointer-type for that designator. Many of the macros that define
designators accept a <em>pointer-type-name:</em> keyword to bind the
<em>pointer-type</em> of the defined designator to a given variable. The
pointer-type is not programmatically available because it may not have
been defined. You can assure that there is a pointer-type for a
particular designator by using the macro <a class="reference internal" href="#c-ffi:c-ffi:definec-pointer-type"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">c-pointer-type</span></code></a>.</p>
<p>A designator classâs <em>import type</em> and <em>export type</em> are instantiable
Dylan types that describe the Dylan instantiation of a designator class
when it is used in a position that <em>imports</em> values from C, or <em>exports</em>
values to C.</p>
<p>Nearly all of the C-FFIâs designators have import and export types that
are equivalent. Some, such as <a class="reference internal" href="#c-ffi:c-ffi:[c-string]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code></a>, have different import
and export types because it is possible to pass a pointer to a Dylan
object to C directly without creating a C pointer object, or copying the
underlying data, but when importing a string from C it is not practical
to copy the contents and create a Dylan string. By default, the import
and export types for any subtype of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> are the class
itself. You can override this by defining a new subclass with the macro
<a class="reference internal" href="#c-ffi:c-ffi:definec-mapped-subtype"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-mapped-subtype</span></code></a>.</p>
<p>You can define a designatorâs <em>import-function</em> and <em>export-function</em> by
using the macro <a class="reference internal" href="#c-ffi:c-ffi:definec-mapped-subtype"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-mapped-subtype</span></code></a>. These functions are
merely the procedural specifications for translating the C data to Dylan
and back. The <em>import</em> and <em>export</em> functions are inherited when you
define a subclass for a designator.</p>
</section>
<section id="designator-class-basics">
<span id="index-24"></span><h3>Designator class basics<a class="headerlink" href="#designator-class-basics" title="Link to this heading">Â¶</a></h3>
<dl class="dylan class" id="index-25">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-value]">
<span class="sig-name descname"><span class="pre">&lt;C-value&gt;</span></span> <em class="property"><span class="pre">Abstract</span> <span class="pre">Sealed</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-value]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>The abstract superclass of all designator classes. It is a subclass
of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>. It has neither an <em>export-type</em> nor an
<em>import-type</em>, so you cannot use it when designating a transition
between C and Dylan.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan class" id="index-26">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-void]">
<span class="sig-name descname"><span class="pre">&lt;C-void&gt;</span></span> <em class="property"><span class="pre">Abstract</span> <span class="pre">Sealed</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-void]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>The abstract superclass of all designator classes. It is a subclass
of <a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a>. It has neither an <em>export-type</em> nor an
<em>import-type</em>, so you cannot use it when designating a transition
between C and Dylan.</p>
<p>This class is only useful in that it is the <em>referenced type</em> for
<a class="reference internal" href="#c-ffi:c-ffi:[c-void*]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-void*&gt;</span></code></a>.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-27">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:size-of">
<span class="sig-name descname"><span class="pre">size-of</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:size-of" title="Link to this definition">Â¶</a></dt>
<dd><p>Takes a designator class and returns the size of the C type that the
class designates.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>size-of <em>designator-class</em> =&gt; <em>size</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>designator-class</strong> â A subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>size</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Takes a designator class and returns the size of the C type that
the class designates.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">size-of</span></code> function can be applied to any designator class.
However, if it is applied to <a class="reference internal" href="#c-ffi:c-ffi:[c-void]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-void&gt;</span></code></a>, <a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a>,
or <a class="reference internal" href="#c-ffi:c-ffi:[c-struct]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-struct&gt;</span></code></a>, it returns zero. It corresponds to Câs
<code class="docutils literal notranslate"><span class="pre">sizeof</span></code> operator and returns an integer, <em>size</em>, in the same
units as <code class="docutils literal notranslate"><span class="pre">sizeof</span></code> does on the target platform. It can be useful
when allocating a C object whose declared size is not accurate and
has to be adjusted manually.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-28">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:alignment-of">
<span class="sig-name descname"><span class="pre">alignment-of</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:alignment-of" title="Link to this definition">Â¶</a></dt>
<dd><p>Takes a designator class and returns the alignment of the C type that
the class designates.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>alignment-of <em>designator-class</em> =&gt; <em>alignment</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>designator-class</strong> â A subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alignment</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Takes a designator class and returns the alignment of the C type
that the class designates. The <code class="docutils literal notranslate"><span class="pre">alignment-of</span></code> function can be
applied to any designator class. It returns the alignment as an
integer, in the same units as <a class="reference internal" href="#c-ffi:c-ffi:size-of"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">size-of</span></code></a> does.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="fundamental-numeric-type-designator-classes">
<span id="index-29"></span><h3>Fundamental numeric type designator classes<a class="headerlink" href="#fundamental-numeric-type-designator-classes" title="Link to this heading">Â¶</a></h3>
<p>This section describes the pre-defined designator classes for
fundamental C numeric types. On page <a class="reference internal" href="#designator-classes">Designator
classes</a> we saw that none of these designator types
are instantiable: a number on one side of the interface is converted to
a number on the other side with the same value.</p>
<p>There are some additional details to note about integer representations.
Because Dylanâs integer representations do not match Câs exactly, for
each of the C integer types there are three designator classes that can
be used to translate Dylan representations to that C integer. The
categories are <em>plain</em>, <em>unsafe</em>, and <em>raw</em> integers.</p>
<p id="index-30"><em>Plain</em> integer designators â of which the class <code class="docutils literal notranslate"><span class="pre">&lt;C-unsigned-short&gt;</span></code> is
an example â translate C integer values to instances of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>. If
the integer being translated is too big for the destination, the C-FFI
signals an error. There are two ways this can happen.</p>
<ul class="simple">
<li><p>On export, the C-FFI signals an error if the Dylan value has more
significant bits than the C integer.</p></li>
</ul>
<p id="index-31">This can happen if, for example, the designator is <code class="docutils literal notranslate"><span class="pre">&lt;C-unsigned-short&gt;</span></code>,
and the Dylan value is negative, or if <em>unsigned</em> <em>short</em> on that
platform is 16 bits wide, but the Dylan integer has more than 16
significant bits. The check will be omitted if the compiler can
determine that no Dylan value outside the safe range can reach there.
This can be done using a limited integer type.</p>
<ul class="simple">
<li><p>On import into Dylan, the C-FFI signals an error if it cannot
represent the C value using a Dylan <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
<p>This can happen with any C integer type that is more than 30 bits wide.
The size of a Dylan <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> depends on the particular platform, but
it is guaranteed to be at least 30 bits in length.</p>
<p id="index-32">The C-FFI never signals an error for the <em>unsafe</em> designator classes â
of which the class <code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-unsigned-short&gt;</span></code> is an example â but if
the destination is too small for the value, the most significant bits of
the value are chopped off to fit into the destination. Because there is
no checking, using the unsafe designator classes brings a very small
performance improvement, but nonetheless you should not use them unless
you are certain you will not lose any bits.</p>
<p id="index-33"><em>Raw</em> designator classes â of which the class <code class="docutils literal notranslate"><span class="pre">&lt;C-raw-unsigned-int&gt;</span></code> is
an example â represent the integer on the Dylan side as a
<a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>. An instance of <code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code> is guaranteed to have
enough bits to represent any C <code class="docutils literal notranslate"><span class="pre">long</span></code> value, or any C <code class="docutils literal notranslate"><span class="pre">void*</span></code> value.
Note that a <code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code> value may still have more significant bits
than some C integer types, and so the C-FFI may still signal an overflow
error if the <code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code> value, interpreted as indicated by the
designator, has more significant bits than may be held in the indicated
C type.</p>
<p><a class="reference internal" href="#the-integer-designator-classes-and-their-mappings">The integer designator classes and their mappings.</a> shows all raw, plain,
and unsafe integer designator types exported from the C-FFI module.</p>
<div class="table-wrapper docutils container" id="the-integer-designator-classes-and-their-mappings">
<span id="index-34"></span><span id="index-34"></span><table class="docutils align-default" id="the-integer-designator-classes-and-their-mappings">
<caption><span class="caption-text">The integer designator classes and their mappings.</span><a class="headerlink" href="#the-integer-designator-classes-and-their-mappings" title="Link to this table">Â¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Designator name</p></th>
<th class="head"><p>C type</p></th>
<th class="head"><p>Dylan type(s)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-signed-int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-signed</span> <span class="pre">int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">int</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-signed-int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">int</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-unsigned-int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-unsigned-int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsigned-int&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsigned-long&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-signed-long&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">long</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-unsigned-long&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-signed-long&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">long</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-unsigned-long&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-signed-long&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">long</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsigned-short&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">short</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-signed-short&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">short</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-unsigned-short&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">short</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-signed-short&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">short</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-unsigned-short&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">short</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-signed-short&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">short</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsigned-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-signed-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">char</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-unsigned-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-signed-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">char</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-unsigned-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-signed-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signed</span> <span class="pre">char</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">char</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">char</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-char&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">char</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-size-t&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">size_t</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-size-t&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">size_t</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-size-t&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">size_t</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-ssize-t&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ssize_t</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-unsafe-ssize-t&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ssize_t</span></code></p></td>
<td><p><a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;C-raw-ssize-t&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ssize_t</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>For each of the fundamental integer designator types, <code class="docutils literal notranslate"><span class="pre">&lt;C-foo&gt;</span></code>,
there is also a type designating pointers to that type called <code class="docutils literal notranslate"><span class="pre">&lt;C-foo*&gt;</span></code>
In addition, the C-FFI defines methods for
<a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> and <a class="reference internal" href="#c-ffi:c-ffi:pointer-value-setter"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value-setter</span></code></a>, with appropriate
translation behavior for each of the types designating pointers to the
fundamental integer designator types.</p>
<dl class="dylan class" id="index-35">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-number]">
<span class="sig-name descname"><span class="pre">&lt;C-number&gt;</span></span> <em class="property"><span class="pre">Abstract</span> <span class="pre">Sealed</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-number]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Superclasses<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a></p>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>The abstract superclass of all classes that designate a fundamental
numeric C type.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan class" id="index-36">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-float]">
<span class="sig-name descname"><span class="pre">&lt;C-float&gt;</span></span> <em class="property"><span class="pre">Abstract</span> <span class="pre">Sealed</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-float]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>The class of C floating point values.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan class" id="index-37">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-double]">
<span class="sig-name descname"><span class="pre">&lt;C-double&gt;</span></span> <em class="property"><span class="pre">Abstract</span> <span class="pre">Sealed</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-double]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>The class of C double-precision values.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="pointer-designator-classes-and-related-functions">
<span id="index-38"></span><h3>Pointer designator classes and related functions<a class="headerlink" href="#pointer-designator-classes-and-related-functions" title="Link to this heading">Â¶</a></h3>
<p>This section describes the pre-defined classes that designate C pointer
types. Subclasses of the abstract classes documented here are
instantiable, and C pointers are represented in Dylan by instances of
these classes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pointer designator classes are defined for all the designator
classes in <a class="reference internal" href="#the-integer-designator-classes-and-their-mappings">The integer designator classes and their
mappings.</a>, but are not listed here. To form the name
of the pointer designator class for a particular designator class,
append a <code class="docutils literal notranslate"><span class="pre">*</span></code> to the part of the name enclosed in angle brackets. Thus
for <code class="docutils literal notranslate"><span class="pre">&lt;C-int&gt;</span></code> the pointer designator class is <code class="docutils literal notranslate"><span class="pre">&lt;C-int*&gt;</span></code>.</p>
</div>
<dl class="dylan class" id="index-39">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-pointer]">
<span class="sig-name descname"><span class="pre">&lt;C-pointer&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Primary</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-pointer]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Superclasses<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a></p>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>The abstract superclass of all classes that designate a C pointer
type. Instances of concrete subclasses of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>
encapsulate a raw C address. The make methods on subclasses of
<a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> accept the keyword argument <code class="docutils literal notranslate"><span class="pre">address:</span></code>,
which must be a Dylan <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> or <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>
representation of the C address.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-40">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:pointer-address">
<span class="sig-name descname"><span class="pre">pointer-address</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:pointer-address" title="Link to this definition">Â¶</a></dt>
<dd><p>Recovers the address from an instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> and returns it as
a Dylan <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>pointer-address <em>C-pointer</em> =&gt; <em>address</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> â An instance of <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Recovers the address from an instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> and
returns it as a Dylan <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:pointer-cast">
<span class="sig-name descname"><span class="pre">pointer-cast</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:pointer-cast" title="Link to this definition">Â¶</a></dt>
<dd><p>Converts a pointer from one pointer type to another.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>pointer-cast <em>pointer-designator-class</em> <em>C-pointer</em> =&gt; <em>new-C-pointer</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>pointer-designator-class</strong> â A subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>c-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>new-c-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Converts a pointer from one pointer type to another. The new
pointer will have the same address as the old pointer.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-41">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:null-pointer">
<span class="sig-name descname"><span class="pre">null-pointer</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:null-pointer" title="Link to this definition">Â¶</a></dt>
<dd><p>Returns a null pointer whose type is given by the
pointer-designator-class.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>null-pointer <em>pointer-designator-class</em> =&gt; <em>null-pointer</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>pointer-designator-class</strong> â A subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>c-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>new-c-pointer</strong> â </p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Returns a null pointer whose type is given by
<em>pointer-designator-class</em>. Note that different calls to
<code class="docutils literal notranslate"><span class="pre">null-pointer</span></code> may return the same object.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-42">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:null-pointer?">
<span class="sig-name descname"><span class="pre">null-pointer?</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:null-pointer?" title="Link to this definition">Â¶</a></dt>
<dd><p>Returns true if a pointer is null</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>null-pointer? <em>C-pointer</em> =&gt; <em>boolean</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>boolean</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Returns <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> if a pointer is null and <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan class" id="index-43">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-void*]">
<span class="sig-name descname"><span class="pre">&lt;C-void*&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Concrete</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-void*]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Superclasses<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a></p>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>The class designating Câs <code class="docutils literal notranslate"><span class="pre">void*</span></code> pointer type. No
<a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> methods are defined on this class.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan class" id="index-44">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-statically-typed-pointer]">
<span class="sig-name descname"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-statically-typed-pointer]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Superclasses<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>, <a class="reference internal" href="../language-extensions/object-with-elements.html#dylan:dylan-extensions:[mutable-object-with-elements]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;mutable-object-with-elements&gt;</span></code></a></p>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>The abstract superclass of all classes designating a C pointer type
for a non-<em>void</em> base.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan macro" id="index-45">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-pointer-type">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-pointer-type</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-pointer-type" title="Link to this definition">Â¶</a></dt>
<dd><p>Defines a constant bound to a pointer class designating pointers to a
designator class name.</p>
<dl class="field-list simple">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define C-pointer-type <cite>pointer-class-name</cite> =&gt; <cite>designator-class-name</cite></pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>pointer-class-name</strong> â A Dylan variable name.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>designator-class</strong> â A Dylan name.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Defines a constant bound to a pointer class designating pointers to
<em>designator-class-name</em>. Note that the pointer type may already
exist. The class defined will be open, abstract and instantiable.
Objects returned by <code class="docutils literal notranslate"><span class="pre">make(pointer-class-name)</span></code> will be
instances of a sealed concrete subclass of <em>pointer-class-name</em>.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-46">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:referenced-type">
<span class="sig-name descname"><span class="pre">referenced-type</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:referenced-type" title="Link to this definition">Â¶</a></dt>
<dd><p>Returns the class designating the contents type of the designated C
pointer type.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>referenced-type <em>pointer-designator-class</em> =&gt; <em>designator-class</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>pointer-designator-class</strong> â A subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>designator-class</strong> â A subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Returns the class designating the contents type of the C pointer
type designated by <em>pointer-designator-class</em>. The same designator
class is returned whenever <em>referenced-type</em> is called with the
same argument.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-47">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-type-cast">
<span class="sig-name descname"><span class="pre">c-type-cast</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-type-cast" title="Link to this definition">Â¶</a></dt>
<dd><p>Converts a value to a value of a specified type, according to the
semantics of a C type cast.</p>
<dl class="field-list">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>c-type-cast <em>type</em> <em>value</em> =&gt; <em>value</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>type</strong> â See Description.</p></li>
<li><p><strong>value</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="target" id="index-48"></span><p>Returns the value of the second argument, converted to the type
specified by the first argument, in accordance with the semantics of a C
type cast. This is convenient to use when translating C code to Dylan.
It may also be helpful for converting a value to the form required by a
C-function wrapper argument.</p>
<p>The first argument can be either a C type designator or one of the Dylan
classes <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a>, <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#character"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;character&gt;</span></code></a>, <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>, or any subclass
of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#number"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;number&gt;</span></code></a>. For a C type designator, the value is converted to the
Dylan class which it maps to. <em>&lt;C-</em> [<em>un</em> ]*signed-short&gt;* and <em>&lt;C-</em>
[<em>un</em> ]*signed-char&gt;* truncate the value as well as ensuring that it is
an <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p>
</p>
</dd>
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p>For example, with a function declared in C as</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Foo</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</pre></div>
</div>
<p>and called as</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Foo</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
</pre></div>
</div>
<p>if the Dylan declaration is</p>
<div class="highlight-dylan notranslate" id="index-49"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">Foo</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-both-long&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;Foo&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<p>then the equivalent call will be:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">Foo</span><span class="p">(</span><span class="n">c-type-cast</span><span class="p">(</span><span class="nc">&lt;C-both-long&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">));</span>
</pre></div>
</div>
<p>which will ensure that the C semantics are preserved without needing to
analyze exactly what the type cast is doing.</p>
<p>The functions <a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> and <a class="reference internal" href="#c-ffi:c-ffi:pointer-value-setter"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value-setter</span></code></a>
perform the primitive Dylan-to-C and C-to-Dylan conversions as
documented with the designator class of the pointerâs contents type
(see <a class="reference internal" href="#the-integer-designator-classes-and-their-mappings">The integer designator classes and their mappings.</a>). The
C-FFI signals an error if it cannot convert the object you attempt
to store in the pointer to a compatible type.</p>
<p>These two functions are part of a protocol for extending the C type
conversions. You can define new methods for <a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> and
<a class="reference internal" href="#c-ffi:c-ffi:pointer-value-setter"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value-setter</span></code></a> for types defined by <a class="reference internal" href="#c-ffi:c-ffi:definec-subtype"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span>
<span class="pre">C-subtype</span></code></a> that are subtypes of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan generic-function" id="index-50">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:pointer-value">
<span class="sig-name descname"><span class="pre">pointer-value</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Generic</span> <span class="pre">function</span></em><a class="headerlink" href="#c-ffi:c-ffi:pointer-value" title="Link to this definition">Â¶</a></dt>
<dd><p>Dereferences a c-typed pointer using its encapsulated raw C address.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>pointer-value <em>C-typed-pointer</em> #key <em>index</em> =&gt; <em>object</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-typed-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-statically-typed-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Dereferences <em>c-typed-pointer</em> using its encapsulated raw C
address, and returns a Dylan object representing the object at that
address. If you supply index, the pointer is treated as a pointer
to an array, and the function returns the appropriate element
indexed by the correct unit size.</p>
<p>It is an error if <em>C-typed-pointer</em> does not point to a valid
address or is a null pointer.</p>
</p>
</dd>
<dt class="field-odd">See also<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><a class="reference internal" href="#c-ffi:c-ffi:pointer-value-setter"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value-setter</span></code></a>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan generic-function" id="index-51">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:pointer-value-setter">
<span class="sig-name descname"><span class="pre">pointer-value-setter</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Generic</span> <span class="pre">function</span></em><a class="headerlink" href="#c-ffi:c-ffi:pointer-value-setter" title="Link to this definition">Â¶</a></dt>
<dd><p>Allows you to set pointer values.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>pointer-value-setter <em>new-value</em> <em>C-typed-pointer</em> #key <em>index</em> =&gt; <em>new-value</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>new-value</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
<li><p><strong>c-typed-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-statically-typed-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>index</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>new-value</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Allows you to set pointer values. If you supply index, the pointer is
treated as a pointer to an array, and the function returns the
appropriate element indexed by the correct unit size.</p>
<p>It is an error if <em>C-typed-pointer</em> does not point to a valid address or
is a null pointer.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan generic-function" id="index-52">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:pointer-value-address">
<span class="sig-name descname"><span class="pre">pointer-value-address</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Generic</span> <span class="pre">function</span></em><a class="headerlink" href="#c-ffi:c-ffi:pointer-value-address" title="Link to this definition">Â¶</a></dt>
<dd><p>Returns a pointer of the same type as a C-typed pointer that points
to the object offset into the C-typed pointer.</p>
<dl class="field-list">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>pointer-value-address <em>C-typed-pointer</em> #key <em>index</em> =&gt; <em>object</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-typed-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-statically-typed-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>index</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Returns a pointer of the same type as <em>C-typed-pointer</em> that points
to the <em>index</em> <em>th</em> object offset into <em>C-typed-pointer</em>. The
following expression is guaranteed to be true:</p>
</dd>
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">pointer-value</span><span class="p">(</span><span class="vg">*C-typed-pointer*</span><span class="p">,</span><span class="w"> </span><span class="k">index:</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pointer-value</span><span class="w"> </span><span class="p">(</span><span class="n">pointer-value-address</span><span class="p">(</span><span class="vg">*C-typed-pointer*</span><span class="p">,</span><span class="w"> </span><span class="k">index:</span><span class="w"> </span><span class="n">i</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="dylan method" id="index-53">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:element([c-statically-typed-pointer])">
<span class="sig-name descname"><span class="pre">element(&lt;C-statically-typed-pointer&gt;)</span></span> <em class="property"><span class="pre">Method</span></em><a class="headerlink" href="#c-ffi:c-ffi:element([c-statically-typed-pointer])" title="Link to this definition">Â¶</a></dt>
<dd><p>Dereferences a c-typed pointer using its encapsulated raw C address.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>element <em>C-typed-pointer</em> <em>index</em> =&gt; <em>object</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-typed-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-statically-typed-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Dereferences a c-typed pointer using its encapsulated raw C
address. Synonymous with a call to <a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> that
includes the optional index. Thus it does the same thing as:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">pointer-value</span><span class="p">(</span><span class="vg">*C-statically-typed-pointer*</span><span class="p">,</span><span class="w"> </span><span class="k">index:</span><span class="w"> </span><span class="vg">*index*</span><span class="p">)</span>
</pre></div>
</div>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan method" id="index-54">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:element-setter([c-statically-typed-pointer])">
<span class="sig-name descname"><span class="pre">element-setter(&lt;C-statically-typed-pointer&gt;)</span></span> <em class="property"><span class="pre">Method</span></em><a class="headerlink" href="#c-ffi:c-ffi:element-setter([c-statically-typed-pointer])" title="Link to this definition">Â¶</a></dt>
<dd><p>Allows you to set pointer values.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>element-setter <em>new</em> <em>C-typed-pointer</em> <em>index</em> =&gt; <em>object</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-typed-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-statically-typed-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>index</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Synonymous with a call to <a class="reference internal" href="#c-ffi:c-ffi:pointer-value-setter"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value-setter</span></code></a> that includes
the optional index. Thus it does the same thing as:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">pointer-value-setter</span><span class="p">(</span><span class="vg">*new*</span><span class="p">,</span><span class="w"> </span><span class="vg">*C-statically-typed-pointer*</span><span class="p">,</span><span class="w"> </span><span class="k">index:</span>
<span class="w">                     </span><span class="vg">*index*</span><span class="p">)</span>
</pre></div>
</div>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan method" id="index-55">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:=([c-pointer])">
<span class="sig-name descname"><span class="pre">=(&lt;C-pointer&gt;)</span></span> <em class="property"><span class="pre">Method</span></em><a class="headerlink" href="#c-ffi:c-ffi:=([c-pointer])" title="Link to this definition">Â¶</a></dt>
<dd><p>Returns <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> if two pointers are equal.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>= <em>C-pointer-1</em> <em>C-pointer-2</em> =&gt; <em>boolean</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-pointer-1</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>c-pointer-2</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>boolean</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple" id="index-56">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Returns <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> if two pointers are equal. This is equivalent to:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pointer-address</span><span class="p">(</span><span class="vg">*C-pointer-1*</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pointer-address</span><span class="p">(</span><span class="vg">*C-pointer-2*</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that operations corresponding to C pointer arithmetic are not
defined on <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>. If pointer arithmetic operations are
required, use <a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> with an <code class="docutils literal notranslate"><span class="pre">index:</span></code> argument.</p>
</p>
</dd>
<dt class="field-even">See also<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan method" id="index-57">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[([c-pointer])">
<span class="sig-name descname"><span class="pre">&lt;(&lt;C-pointer&gt;)</span></span> <em class="property"><span class="pre">Method</span></em><a class="headerlink" href="#c-ffi:c-ffi:[([c-pointer])" title="Link to this definition">Â¶</a></dt>
<dd><p>Returns <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> if the second argument is less than the first.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>&lt; <em>C-pointer-1</em> <em>C-pointer-2</em> =&gt; <em>boolean</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-pointer-1</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>c-pointer-2</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>boolean</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Returns <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> if the second argument is less than the first. This
allows pointer comparison operations to be performed on instances
of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p>
<p>Note that operations corresponding to C pointer arithmetic are not
defined on <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>. If pointer arithmetic operations
are required, use <a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> with an <code class="docutils literal notranslate"><span class="pre">index:</span></code> argument.</p>
</p>
</dd>
<dt class="field-odd">See also<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<p>The following functions comprise the conceptual foundation on which the
pointer accessing protocol is based. In the signatures of these
functions, <em>byte-index</em> is in terms of address units (typically bytes)
and <em>scaled-index</em> is scaled by the size of the units involved. In the
setters, <em>new</em> is the new value to which the value in the pointed-at
location will be set. These functions can be used to deference any
general instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p>
<dl class="dylan function" id="index-58">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-char-at">
<span class="sig-name descname"><span class="pre">C-char-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-char-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-char-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-59">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-char-at-setter">
<span class="sig-name descname"><span class="pre">C-char-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-char-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-char-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-60">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-signed-char-at">
<span class="sig-name descname"><span class="pre">C-signed-char-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-signed-char-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-signed-char-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;
<em>machine-word</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-61">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-signed-char-at-setter">
<span class="sig-name descname"><span class="pre">C-signed-char-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-signed-char-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-char-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-62">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-unsigned-char-at">
<span class="sig-name descname"><span class="pre">C-unsigned-char-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-unsigned-char-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-unsigned-char-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-63">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-unsigned-char-at-setter">
<span class="sig-name descname"><span class="pre">C-unsigned-char-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-unsigned-char-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-unsigned-char-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-64">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-unsigned-short-at">
<span class="sig-name descname"><span class="pre">C-unsigned-short-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-unsigned-short-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-unsigned-short-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em></dt><dd><p>=&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-65">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-unsigned-short-at-setter">
<span class="sig-name descname"><span class="pre">C-unsigned-short-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-unsigned-short-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-unsigned-short-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-66">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-signed-short-at">
<span class="sig-name descname"><span class="pre">C-signed-short-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-signed-short-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-short-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-67">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-signed-short-at-setter">
<span class="sig-name descname"><span class="pre">C-signed-short-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-signed-short-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-short-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-68">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-short-at">
<span class="sig-name descname"><span class="pre">C-short-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-short-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-short-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-69">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-short-at-setter">
<span class="sig-name descname"><span class="pre">C-short-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-short-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-short-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-70">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-unsigned-long-at">
<span class="sig-name descname"><span class="pre">C-unsigned-long-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-unsigned-long-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-unsigned-long-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-71">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-unsigned-long-at-setter">
<span class="sig-name descname"><span class="pre">C-unsigned-long-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-unsigned-long-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-unsigned-long-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-72">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-signed-int-at">
<span class="sig-name descname"><span class="pre">C-signed-int-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-signed-int-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-int-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-73">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-signed-int-at-setter">
<span class="sig-name descname"><span class="pre">C-signed-int-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-signed-int-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-int-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-74">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-int-at">
<span class="sig-name descname"><span class="pre">C-int-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-int-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-int-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-75">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-int-at-setter">
<span class="sig-name descname"><span class="pre">C-int-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-int-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-int-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-76">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-signed-long-at">
<span class="sig-name descname"><span class="pre">C-signed-long-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-signed-long-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-long-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-77">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-signed-long-at-setter">
<span class="sig-name descname"><span class="pre">C-signed-long-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-signed-long-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-long-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-78">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-long-at">
<span class="sig-name descname"><span class="pre">C-long-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-long-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-long-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-79">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-long-at-setter">
<span class="sig-name descname"><span class="pre">C-long-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-long-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-long-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-80">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-unsigned-int-at">
<span class="sig-name descname"><span class="pre">C-unsigned-int-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-unsigned-int-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-unsigned-int-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-81">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-unsigned-int-at-setter">
<span class="sig-name descname"><span class="pre">C-unsigned-int-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-unsigned-int-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-unsigned-int-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-82">
<dt class="sig sig-object dylan-api dylan">
<span class="sig-name descname"><span class="pre">C-signed-int-at</span></span> <em class="property"><span class="pre">Function</span></em></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-int-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-83">
<dt class="sig sig-object dylan-api dylan">
<span class="sig-name descname"><span class="pre">C-signed-int-at-setter</span></span> <em class="property"><span class="pre">Function</span></em></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-signed-int-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-84">
<dt class="sig sig-object dylan-api dylan">
<span class="sig-name descname"><span class="pre">C-int-at</span></span> <em class="property"><span class="pre">Function</span></em></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-int-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt; <em>machine-word</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-85">
<dt class="sig sig-object dylan-api dylan">
<span class="sig-name descname"><span class="pre">C-int-at-setter</span></span> <em class="property"><span class="pre">Function</span></em></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-int-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-86">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-double-at">
<span class="sig-name descname"><span class="pre">C-double-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-double-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-double-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt; <em>float</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-87">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-double-at-setter">
<span class="sig-name descname"><span class="pre">C-double-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-double-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-double-at-setter <em>new-double-float</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>float</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-88">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-float-at">
<span class="sig-name descname"><span class="pre">C-float-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-float-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-float-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt; <em>float</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-89">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-float-at-setter">
<span class="sig-name descname"><span class="pre">C-float-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-float-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-float-at-setter <em>new-single-float</em> <em>C-pointer</em> #key <em>byte-index</em></dt><dd><p><em>scaled-index</em> =&gt; <em>float</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-90">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-pointer-at">
<span class="sig-name descname"><span class="pre">C-pointer-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-pointer-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>C-pointer-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt; <em>C-pointer</em></p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-91">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-pointer-at-setter">
<span class="sig-name descname"><span class="pre">C-pointer-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-pointer-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-pointer-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>C-pointer</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-size-t-at">
<span class="sig-name descname"><span class="pre">C-size-t-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-size-t-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-size-t-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-size-t-at-setter">
<span class="sig-name descname"><span class="pre">C-size-t-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-size-t-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-size-t-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-ssize-t-at">
<span class="sig-name descname"><span class="pre">C-ssize-t-at</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-ssize-t-at" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-ssize-t-at <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:c-ssize-t-at-setter">
<span class="sig-name descname"><span class="pre">C-ssize-t-at-setter</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:c-ssize-t-at-setter" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>C-ssize-t-at-setter <em>new</em> <em>C-pointer</em> #key <em>byte-index</em> <em>scaled-index</em> =&gt;</dt><dd><p><em>machine-word</em></p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="structure-types">
<span id="index-92"></span><h3>Structure types<a class="headerlink" href="#structure-types" title="Link to this heading">Â¶</a></h3>
<dl class="dylan class" id="index-93">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-struct]">
<span class="sig-name descname"><span class="pre">&lt;C-struct&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-struct]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>The abstract superclass of all classes designating a C struct type.  It is a
subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a>.  You can describe new struct types using the
<a class="reference internal" href="#c-ffi:c-ffi:definec-struct"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-struct</span></code></a> macro.</p>
<p>Classes designating C structs are not instantiable. Where a slot,
array element, function parameter or function result is typed as a
struct value, pointers to that struct type are accepted and
returned.</p>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="union-types">
<span id="index-94"></span><h3>Union types<a class="headerlink" href="#union-types" title="Link to this heading">Â¶</a></h3>
<dl class="dylan class" id="index-95">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-union]">
<span class="sig-name descname"><span class="pre">&lt;C-union&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-union]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>The abstract superclass of all classes designating a C union type.
It is a subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a>. You can describe new union
types with the macro <a class="reference internal" href="#c-ffi:c-ffi:definec-union"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-union</span></code></a>. Classes designating C
unions are not instantiable. Where a slot, array element, function
parameter or function result is typed as a union value, pointers to
that union type are accepted and returned.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="notes-on-c-type-macros">
<span id="index-96"></span><h3>Notes on C type macros<a class="headerlink" href="#notes-on-c-type-macros" title="Link to this heading">Â¶</a></h3>
<p>The C-FFIâs C interface description language does not model all of the
ways of defining new types in C, but all C types should be expressible
in it. As a simplification, we do not support anonymous base types in
the C interface description language. If a structure or union field has
an in-line type definition in C, that definition must be extracted and
given a name in order for it to be used. For example, the following C
struct</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">something</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
<span class="w">  </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">int_val</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">string_val</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>can be described with these definitions:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-union</span><span class="w"> </span><span class="nc">&lt;anonymous-union-1&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">int-val</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-long&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">string-val</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-string&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-union</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-struct</span><span class="w"> </span><span class="nc">&lt;something&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-string&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-long&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;anonymous-union-1&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-struct</span><span class="p">;</span>
</pre></div>
</div>
<p>The slots of these ex-inline types must be accessed through a chain of
accesses, for example <code class="docutils literal notranslate"><span class="pre">o.val.string-val</span></code>.</p>
</section>
</section>
<section id="defining-types">
<span id="index-97"></span><h2>Defining types<a class="headerlink" href="#defining-types" title="Link to this heading">Â¶</a></h2>
<p>This section covers the definition macros that create Dylan designators
for C types, structs and unions.</p>
<section id="defining-specialized-versions-of-designator-classes">
<span id="index-98"></span><h3>Defining specialized versions of designator classes<a class="headerlink" href="#defining-specialized-versions-of-designator-classes" title="Link to this heading">Â¶</a></h3>
<dl class="dylan macro" id="index-99">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-subtype">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-subtype</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-subtype" title="Link to this definition">Â¶</a></dt>
<dd><p>Defines a specialized designator class for a C type based on an
existing designator class for that type.</p>
<dl class="field-list">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define [<cite>modifiers</cite>] C-subtype <cite>name</cite> (<cite>superclasses</cite>)
  [<cite>slot-spec</cite> ; ...] [;]
  [<cite>type-options</cite>] [;]
end [C-subtype] [<cite>name</cite>]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>modifiers</strong> â The same as the modifiers allowed in <a class="reference external" href="https://opendylan.org/books/drm/Definition_Macros#define_class"><code class="xref drm docutils literal notranslate"><span class="pre">define</span> <span class="pre">class</span></code></a>.</p></li>
<li><p><strong>name</strong> â A Dylan variable name.</p></li>
<li><p><strong>superclasses</strong> â A list of Dylan names.</p></li>
<li><p><strong>slot-spec</strong> â Same syntax as a slot definition in <a class="reference external" href="https://opendylan.org/books/drm/Definition_Macros#define_class"><code class="xref drm docutils literal notranslate"><span class="pre">define</span> <span class="pre">class</span></code></a>.</p></li>
<li><p><strong>type-options</strong> â A property list.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Defines a specialized designator class for a C type based on an
existing designator class for that type. It does this by defining a
subclass of the original designator class, and is a simple wrapper
around <a class="reference external" href="https://opendylan.org/books/drm/Definition_Macros#define_class"><code class="xref drm docutils literal notranslate"><span class="pre">define</span> <span class="pre">class</span></code></a> from which it takes its syntax. The
superclasses, slot-specs, and <em>modifiers</em> are passed on to <a class="reference external" href="https://opendylan.org/books/drm/Definition_Macros#define_class"><code class="xref drm docutils literal notranslate"><span class="pre">define</span>
<span class="pre">class</span></code></a> unchanged. In effect, it expands to:</p>
<pre class="literal-block">define class <cite>name</cite> ( <cite>superclasses</cite> )
  <cite>slot-spec</cite> ; ...
end class;</pre>
<span class="target" id="index-100"></span><p>In terms of C, <a class="reference internal" href="#c-ffi:c-ffi:definec-subtype"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-subtype</span></code></a> can be thought of as
implementing a strongly typed version of <code class="docutils literal notranslate"><span class="pre">typedef</span></code> because a new
designator class is generated that Dylanâs type system can
distinguish from the designator class on which it was based. As
well as inheriting from an existing designator class, other Dylan
classes can be mixed in too.</p>
<p>The optional <em>type-options</em> must be a property list. The <em>c-name:</em>
keyword is recognized, allowing the original C name of the type
designated by the class to be documented. The <em>pointer-type-name:</em>
keyword option can be used to name the designator for pointers to
<em>name</em>.</p>
</p>
</dd>
<dt class="field-even">Example<span class="colon">:</span></dt>
<dd class="field-even"><p>Some example C declarations:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">Handle</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="n">Handle</span><span class="w"> </span><span class="n">WindowHandle</span><span class="p">;</span>
<span class="k">typedef</span><span class="w"> </span><span class="n">Handle</span><span class="w"> </span><span class="n">StreamHandle</span><span class="p">;</span>

<span class="k">extern</span><span class="w"> </span><span class="n">WindowHandle</span><span class="w"> </span><span class="nf">CurrentWindow</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">extern</span><span class="w"> </span><span class="n">StreamHandle</span><span class="w"> </span><span class="nf">CurrentStream</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>Example FFI definitions:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-subtype</span><span class="w"> </span><span class="nc">&lt;Handle&gt;</span><span class="w"> </span><span class="p">(</span><span class="nc">&lt;C-void*&gt;</span><span class="p">)</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-subtype</span><span class="w"> </span><span class="nc">&lt;WindowHandle&gt;</span><span class="w"> </span><span class="p">(</span><span class="nc">&lt;Handle&gt;</span><span class="p">)</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
<span class="k">define</span><span class="w"> </span><span class="n">C-subtype</span><span class="w"> </span><span class="nc">&lt;StreamHandle&gt;</span><span class="w"> </span><span class="p">(</span><span class="nc">&lt;Handle&gt;</span><span class="p">)</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">CurrentWindow</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;WindowHandle&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;CurrentWindow&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">CurrentStream</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;StreamHandle&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;CurrentStream&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>
</pre></div>
</div>
<p id="index-101">Example transactions:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="p">?</span><span class="w"> </span><span class="nc">&lt;C-void*&gt;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">&lt;WindowHandle&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">&lt;WindowHandle&gt;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">&lt;StreamHandle&gt;</span><span class="p">;</span>
<span class="l">#f</span>

<span class="p">?</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="nb">variable</span><span class="w"> </span><span class="vg">*cw*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CurrentWindow</span><span class="p">();</span>
<span class="c1">// Defined *cw*</span>

<span class="p">?</span><span class="w"> </span><span class="vg">*cw*</span>
<span class="p">{</span><span class="nc">&lt;WindowHandle&gt;</span><span class="w"> </span><span class="mh">#xff5400</span><span class="p">}</span>

<span class="p">?</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="nb">variable</span><span class="w"> </span><span class="vg">*cs*</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CurrentStream</span><span class="p">();</span>
<span class="c1">// Defined *cs*</span>

<span class="p">?</span><span class="w"> </span><span class="vg">*cs*</span>
<span class="p">{</span><span class="nc">&lt;StreamHandle&gt;</span><span class="w"> </span><span class="mh">#xff6400</span><span class="p">}</span>

<span class="p">?</span><span class="w"> </span><span class="nb">instance?</span><span class="p">(</span><span class="vg">*cs*</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;WindowHandle&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">instance?</span><span class="p">(</span><span class="vg">*cw*</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;StreamHandle&gt;</span><span class="p">);</span>
<span class="l">#f</span>
</pre></div>
</div>
<p>The following example uses the ability to specify extra superclasses to
place a type beneath an abstract class.</p>
<p>Example C declarations:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">_Matrix</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">rank</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">dimensions</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">values</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_Matrix</span><span class="w"> </span><span class="o">*</span><span class="n">Matrix</span><span class="p">;</span>

<span class="k">extern</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="nf">MatrixAdd</span><span class="w"> </span><span class="p">(</span><span class="n">Matrix</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
</pre></div>
</div>
<p>Example FFI definitions:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-struct</span><span class="w"> </span><span class="nc">&lt;_Matrix-struct&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="nb">rank</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="nb">dimensions</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="nb">values</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">pointer-type-name:</span><span class="w"> </span><span class="nc">&lt;_Matrix-struct*&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-struct</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-subtype</span><span class="w"> </span><span class="nc">&lt;Matrix&gt;</span><span class="w"> </span><span class="p">(</span><span class="nc">&lt;_Matrix-struct*&gt;</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;number&gt;</span><span class="p">)</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">MatrixAdd</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Matrix&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Matrix&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Matrix&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;MatrixAdd&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">\+</span><span class="w"> </span><span class="p">(</span><span class="n">m1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Matrix&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Matrix&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">    </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Matrix&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="n">MatrixAdd</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">)</span>
<span class="k">end</span><span class="w"> </span><span class="nb">method</span><span class="p">;</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
<section id="defining-specialized-designator-classes">
<span id="index-102"></span><h3>Defining specialized designator classes<a class="headerlink" href="#defining-specialized-designator-classes" title="Link to this heading">Â¶</a></h3>
<dl class="dylan macro" id="index-103">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-mapped-subtype">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-mapped-subtype</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-mapped-subtype" title="Link to this definition">Â¶</a></dt>
<dd><p>Allows you to define a name to which to bind a pointer designator.</p>
<dl class="field-list simple">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define [<cite>modifier</cite> ...] C-mapped-subtype <cite>type-name</cite> (<cite>superclass</cite> )
  [map <cite>high-level-type</cite>
    [, import-function: <cite>import-fun</cite> ]
    [, export-function: <cite>export-fun</cite> ];]
  [import-map <cite>high-level-type</cite>,
    import-function: <cite>import-fun</cite> ;]
  [export-map <cite>high-level-type</cite>,
    export-function: <cite>export-fun</cite> ;]
  [<cite>type-options</cite>]
end</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>modifiers</strong> â The same as the modifiers allowed in <a class="reference external" href="https://opendylan.org/books/drm/Definition_Macros#define_class"><code class="xref drm docutils literal notranslate"><span class="pre">define</span> <span class="pre">class</span></code></a>.</p></li>
<li><p><strong>type-name</strong> â A Dylan variable name.</p></li>
<li><p><strong>superclasses</strong> â A list of Dylan names.</p></li>
<li><p><strong>high-level-type</strong> â An instance of a Dylan <a class="reference external" href="https://opendylan.org/books/drm/Type_Classes#type"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code></a>.</p></li>
<li><p><strong>import-fun</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Function_Classes#function"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;function&gt;</span></code></a>.</p></li>
<li><p><strong>export-fun</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Function_Classes#function"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;function&gt;</span></code></a>.</p></li>
<li><p><strong>type-options</strong> â A property list.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Allows you to define a name to which to bind a pointer designator.</p>
<p>The <em>modifiers</em> may be <code class="docutils literal notranslate"><span class="pre">sealed</span></code> or <code class="docutils literal notranslate"><span class="pre">open</span></code>. (The default is
<code class="docutils literal notranslate"><span class="pre">sealed</span></code>.) Their effect on the class defined is the same as the
similar modifiers on an ordinary class.</p>
<p>The possible combinations are, a map clause, an import-map clause,
an export-map clause, or both an import-map and an export-map
clause. Any other combinations are illegal.</p>
<p>The <em>import-map</em> clause specifies that a type conversion takes
place when <em>type-name</em> is used as a designator for values imported
from C into Dylan. The conversion is accomplished by calling the
<em>import-function</em> on the imported value. This call is automatically
inserted into function wrappers, structure member getters,
pointer-value dereference functions and so on by the C-FFI. The
<em>high-level-type</em> is used as the Dylan type specifier for the
appropriate parameter or result in any wrapper function or
<em>c-struct</em> accessor which uses the defined class. The <em>export-map</em>
clause specifies a similar type conversion for exported values. The
<em>high-level-type</em> must in either case name an instantiable Dylan
type.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="w"> </span><span class="nc">&lt;type-c&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">import-map</span><span class="w"> </span><span class="nc">&lt;type-c&gt;</span><span class="p">;</span>
<span class="n">export-map</span><span class="w"> </span><span class="nc">&lt;type-c&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>The import and export functions are monadic functions whose single
argument is the appropriate low-level value for export functions and the
appropriate Dylan type for import functions. Any mapped subtype which
specifies an import-map must specify an <em>import-function</em>. Any mapped
subtype which specifies an export-map must specify an <em>export-function</em>.</p>
<p>Map boolean example:</p>
<p>bool-header.h:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="kt">bool</span><span class="p">;</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">bool_function</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">bool_pointer_function</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>

<span class="c1">//eof</span>
</pre></div>
</div>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">Module</span><span class="o">:</span><span class="w"> </span><span class="s">my-module</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-mapped-subtype</span><span class="w"> </span><span class="nc">&lt;bool&gt;</span><span class="w"> </span><span class="p">(</span><span class="nc">&lt;C-int&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="nb">map</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">export-function:</span>
<span class="w">      </span><span class="nb">method</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">as</span><span class="p">(</span><span class="nc">&lt;integer&gt;</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">)</span>
<span class="w">      </span><span class="k">end</span><span class="p">,</span>
<span class="w">    </span><span class="k">import-function:</span>
<span class="w">      </span><span class="nb">method</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="n">~zero?</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="w">      </span><span class="k">end</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>

<span class="c1">//end module</span>
</pre></div>
</div>
<span class="target" id="index-104"></span><p>Mapped string example: an alternate version of C string which
automatically converts instances of <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a> to instances
of <code class="docutils literal notranslate"><span class="pre">&lt;C-example-string&gt;</span></code> on export.</p>
<p>string-header.h</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>

<span class="n">string</span><span class="w"> </span><span class="n">string</span><span class="o">-</span><span class="n">filter</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="n">string</span><span class="o">-</span><span class="n">modifier</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>

<span class="c1">//eof</span>
</pre></div>
</div>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">module</span><span class="o">:</span><span class="w"> </span><span class="s">my-module</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-mapped-subtype</span><span class="w"> </span><span class="nc">&lt;C-example-string&gt;</span><span class="w"> </span><span class="p">(</span><span class="nc">&lt;C-char*&gt;</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;string&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="n">export-map</span><span class="w"> </span><span class="nb">type-union</span><span class="p">(</span><span class="nc">&lt;byte-string&gt;</span><span class="p">,</span><span class="w"> </span><span class="nc">&lt;C-example-string&gt;</span><span class="p">),</span>
<span class="w">    </span><span class="k">export-function:</span><span class="w"> </span><span class="n">c-string-exporter</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">c-string-exporter</span>
<span class="w">    </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;byte-string&gt;</span><span class="p">)</span>
<span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-char*&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="nb">as</span><span class="p">(</span><span class="nc">&lt;C-example-string&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">c-string-exporter</span>
<span class="w">    </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-example-string&gt;</span><span class="p">)</span>
<span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-example-string&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="n">s</span>
<span class="k">end</span><span class="p">;</span>

<span class="c1">//end module</span>
</pre></div>
</div>
<span class="target" id="index-105"></span><p>It is possible to define an ordinary subtype of a mapped supertype.
The mapping characteristic of the subtype is inherited from the
supertype. It is also possible to define a mapped subtype of a
mapped supertype. When the subtype and supertype both specify an
export function, the export functions of the subtype and the
supertype are composed with the subtypeâs export function applied
to the result of the supertypeâs export function. Import functions
of a mapped subtype and supertype are similarly composed. Mapping
characteristics are inherited from the supertype where the subtype
does not define them. (You can think of this as composition with
identity when either the supertype or subtype fails to specify an
import or export function.) This shadowing is only useful when
import and export maps are defined separately. Here is an example
of a mapped subtypes which adds an import map to the mapped version
of <code class="docutils literal notranslate"><span class="pre">&lt;C-example-string&gt;</span></code> defined above.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-mapped-subtype</span><span class="w"> </span><span class="nc">&lt;other-string&gt;</span>
<span class="w">    </span><span class="p">(</span><span class="nc">&lt;C-example-string&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="n">import-map</span><span class="w"> </span><span class="nc">&lt;byte-string&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">import-function:</span>
<span class="w">      </span><span class="nb">method</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;byte-string&gt;</span><span class="p">)</span>
<span class="w">       </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-example-string&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">as</span><span class="p">(</span><span class="nc">&lt;C-example-string&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="nb">method</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<p>The import signature is <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a>. The export signature is
inherited from <code class="docutils literal notranslate"><span class="pre">&lt;C-example-string&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">type-union(&lt;byte-string&gt;,</span>
<span class="pre">&lt;C-example-string&gt;)</span></code>. For a example involving composition of
mapped types consider the following (hypothetical) definitions of
<code class="docutils literal notranslate"><span class="pre">&lt;C-raw-int&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;C-mapped-int&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;bool&gt;</span></code>. The
<code class="docutils literal notranslate"><span class="pre">&lt;C-raw-int&gt;</span></code> class is a primitive which returns and accepts
instances of <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>. The <code class="docutils literal notranslate"><span class="pre">&lt;C-mapped-int&gt;</span></code> class is a
mapped subtype which converts the instances of <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>
to instances of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>. The <code class="docutils literal notranslate"><span class="pre">&lt;bool&gt;</span></code> class is a mapped
subtype of <code class="docutils literal notranslate"><span class="pre">&lt;C-mapped-int&gt;</span></code> which converts to and from
<a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a>.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-mapped-subtype</span><span class="w"> </span><span class="nc">&lt;C-mapped-int&gt;</span><span class="w"> </span><span class="p">(</span><span class="nc">&lt;C-raw-int&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="nb">map</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">export-function:</span>
<span class="w">      </span><span class="nb">method</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;machine-word&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">as</span><span class="p">(</span><span class="nc">&lt;machine-word&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="w">      </span><span class="k">end</span><span class="p">,</span>
<span class="w">    </span><span class="k">import-function:</span>
<span class="w">      </span><span class="nb">method</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;machine-word&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">as</span><span class="p">(</span><span class="nc">&lt;integer&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="w">      </span><span class="k">end</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-mapped-subtype</span><span class="w"> </span><span class="nc">&lt;bool&gt;</span><span class="w"> </span><span class="p">(</span><span class="nc">&lt;C-mapped-int&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="nb">map</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">export-function:</span>
<span class="w">      </span><span class="nb">method</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">if</span>
<span class="w">      </span><span class="k">end</span><span class="p">,</span>
<span class="w">    </span><span class="k">import-function:</span>
<span class="w">      </span><span class="nb">method</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;boolean&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="n">~zero?</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="w">      </span><span class="k">end</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="describing-structure-types">
<span id="index-106"></span><h3>Describing structure types<a class="headerlink" href="#describing-structure-types" title="Link to this heading">Â¶</a></h3>
<dl class="dylan macro" id="index-107">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-struct">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-struct</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-struct" title="Link to this definition">Â¶</a></dt>
<dd><p>Describes Câs aggregate structures.</p>
<dl class="field-list">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define C-struct <cite>name</cite>
  [<cite>slot-spec</cite> ; ...] [;]
  [<cite>type-options</cite>] [;]
end [C-struct] [<cite>name</cite>]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> â A Dylan variable name.</p></li>
<li><p><strong>slot-spec</strong></p></li>
<li><p><strong>type-options</strong> â A property list.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="index-108"></span><p>Describes Câs aggregate structures. The name is defined to be a
designator class encapsulating the value of a structure, not a
pointer to the structure. This is significant because many of the
protocols associated with structures work only on pointers to
structures â pointers to structures being the most common form and
the form closest to Dylanâs object model. The new designator class
is defined to be a subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-struct]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-struct&gt;</span></code></a>.</p>
<span class="target" id="index-109"></span><p>Once defined, a structure-designating class is most likely to be
used as the basis for a pointer type definition in terms of which
most further transactions will take place. Structure-designating
classes are abstract and cannot have direct instances. Accessor
methods defined for the slots of the structure are specialized on
the structure designatorâs pointer-type. However, the class itself
may be needed to specify an in-line structure in another structure,
union, or array, or a value-passed structure argument or result in
a C function.</p>
<p>A slot-spec has the following syntax:</p>
<pre class="literal-block">[ <cite>slot-adjective</cite> ] slot <cite>getter-name</cite> :: <cite>c-type</cite> #key <cite>setter</cite>
  <cite>address-getter</cite>, <cite>c-name</cite>, <cite>length</cite>, <cite>width</cite></pre>
<p>The <em>slot-adjective</em> can be <em>constant</em>,  <em>array</em> or <em>bitfield</em>. The
<em>array</em> slot adjective indicates that the slot is repeated and the
<em>length</em> option indicates how many repetitions are
defined. The <em>bitfield</em> slot adjective
indicates that the slot is really a bitfield. If <em>bitfield</em> is
given then the <em>width</em> option must also be given. The <em>c-type</em>
given for a <em>bitfield</em> slot must be an integer designator. The
<em>c-type</em> for a <em>bitfield</em> slot indicates how the value is
interpreted in Dylan by the slot accessor. A slot may not be
specified as both an <em>array</em> and a <em>bitfield</em>. If <em>constant</em>
is specified, then no setter is generated. The <em>constant</em>
adjective can be supplied for <em>array</em> and <em>bitfield</em> slots.</p>
<p>The getter-name keyword specifies the name of the Dylan function to
which the getter method for the structure slot will be added. The
specializer of the getter methodâs single argument will be a
designator indicating a pointer to the structâs name.</p>
<p>The c-type specifies the fieldâs C type, and must be a designator
class. Unlike Dylan slot specifications, the type declaration here
is not optional.</p>
<p>The optional setter keyword specifies the generic function to which
the setter method for the structure slot will be added. It defaults
to <em>getter-name</em>-setter. No setter method is defined if the
<em>setter</em> option is <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>. If the <em>constant</em> keyword is supplied, no
<em>setter</em> option should be supplied.</p>
<span class="target" id="index-110"></span><p>The optional <em>address-getter</em> specifies the name of a function that
can be used to return a pointer to the data in the member. It
returns a <code class="docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code> object that points to a C type. No
<em>address-getter</em> is defined by default.</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">length:</span></code> keyword only if you used the <code class="docutils literal notranslate"><span class="pre">array</span></code> slot
adjective. The accessor for an array slot is defined to take an extra integer
parameter indicating an index into the array.</p>
<p>You can use the <em>width</em> keyword option only if you used the
<em>bitfield</em> adjective.</p>
<p>The optional c-name keyword allows you to document the original C
name of the slot.</p>
<p>The type-options clause is a property list allowing you to specify
properties of the type as a whole. It accepts the optional keyword
c-name:, allowing you to document the original C name of the struct
to be documented. The optional keyword <em>pointer-type-name:</em> is also
accepted. When given, the name is bound to the struct pointer type
on which the accessors are defined.</p>
<p>The type option <em>pack:</em> <em>n</em> indicates that the struct has the
packing semantics of Microsoftâs <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">pack(*n*)</span></code>.</p>
</p>
</dd>
<dt class="field-even">Example<span class="colon">:</span></dt>
<dd class="field-even"><p>Example C declaration:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Point</span><span class="w"> </span><span class="o">*</span><span class="nf">OnePoint</span><span class="p">();</span><span class="w"> </span><span class="cm">/* Returns a pointer to a Point */</span>
<span class="n">Point</span><span class="w"> </span><span class="o">*</span><span class="nf">PointArray</span><span class="p">();</span><span class="w"> </span><span class="cm">/* Returns a Point array */</span>
</pre></div>
</div>
<p>Example FFI definition:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-struct</span><span class="w"> </span><span class="nc">&lt;Point&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-unsigned-short&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-unsigned-short&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">pointer-type-name:</span><span class="w"> </span><span class="nc">&lt;Point*&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-struct</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">one-point</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Point*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;OnePoint&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">point-array</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Point*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;PointArray&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>
</pre></div>
</div>
<p>Example transactions:</p>
<div class="highlight-dylan-repl notranslate"><div class="highlight"><pre><span></span><span class="gp">?</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="nb">variable</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one-point</span><span class="p">();</span>
<span class="go">// Defined p.</span>

<span class="gp">?</span><span class="w"> </span><span class="nb">values</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="go">100</span>
<span class="go">50</span>

<span class="gp">?</span><span class="w"> </span><span class="k">define</span><span class="w"> </span><span class="nb">variable</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point-array</span><span class="p">();</span>
<span class="go">// Defined array.</span>

<span class="gp">?</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="nb">object-class</span><span class="p">;</span><span class="w"> </span><span class="c1">// implicit conversion to</span>
<span class="go">// the pointer type</span>
<span class="go">{&lt;Point&gt; pointer #xff5e00}</span>

<span class="gp">?</span><span class="w"> </span><span class="k">begin</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
<span class="go">20</span>

<span class="gp">?</span><span class="w"> </span><span class="nb">values</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">y</span><span class="p">)</span>
<span class="go">10</span>
<span class="go">20</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
<section id="describing-union-types">
<span id="index-111"></span><h3>Describing union types<a class="headerlink" href="#describing-union-types" title="Link to this heading">Â¶</a></h3>
<dl class="dylan macro" id="index-112">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-union">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-union</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-union" title="Link to this definition">Â¶</a></dt>
<dd><p>Describes C union types to the <em>c-ffi</em>.</p>
<dl class="field-list">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define C-union <cite>name</cite>
  [<cite>slot-spec</cite> ; ...] [;]
  [<cite>type-options</cite>] [;]
end [C-union] [<cite>name</cite>]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> â A Dylan variable name.</p></li>
<li><p><strong>slot-spec</strong></p></li>
<li><p><strong>type-options</strong> â A property list.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="index-113"></span><p>Describes C union types to the C-FFI. The syntax for the macro and
its use are similar to <a class="reference internal" href="#c-ffi:c-ffi:definec-struct"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">c-struct</span></code></a> except that bitfield
slots are not allowed. The designator created by the macro is a
subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-union]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;c-union&gt;</span></code></a>.</p>
<p>Each of the slots in a union is laid out in memory on top of one another
just as in Câs <code class="docutils literal notranslate"><span class="pre">union</span></code> construct.</p>
</p>
</dd>
<dt class="field-even">Example<span class="colon">:</span></dt>
<dd class="field-even"><p>Example C declaration:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">union</span><span class="w"> </span><span class="nc">Num</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">int_value</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">double_value</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Num</span><span class="w"> </span><span class="o">*</span><span class="nf">OneNum</span><span class="p">();</span><span class="w"> </span><span class="cm">/* Returns a pointer to a Num */</span>

<span class="n">Num</span><span class="w"> </span><span class="o">*</span><span class="nf">NumArray</span><span class="p">();</span><span class="w"> </span><span class="cm">/* Returns a Num array */</span>
</pre></div>
</div>
<p>Example FFI definition:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-union</span><span class="w"> </span><span class="nc">&lt;Num&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">int-value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">double-value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-double&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">pointer-type-name:</span><span class="w"> </span><span class="nc">&lt;Num*&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-union</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">one-num</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Num*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;OneNum&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">num-array</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Num*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;NumArray&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>
</pre></div>
</div>
<p>Example transactions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>? define variable n = one-num();
// Defined n.

? values(p.int-value, p.double-value);
154541
92832.e23 // or something

? define variable array = num-array();
// Defined array.

? array[5].object-class; // implicit conversion to
// the pointer type
{&lt;Num&gt; pointer #xff5e00}

? array[5].int-value := 0;
0

? array[5].double-value;
11232e-12 // or a different something
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="functions">
<span id="index-114"></span><h2>Functions<a class="headerlink" href="#functions" title="Link to this heading">Â¶</a></h2>
<p>This section describes the C FFI macros that allow C functions to be
made available to Dylan and Dylan functions available to C.</p>
<section id="function-types">
<span id="index-115"></span><h3>Function types<a class="headerlink" href="#function-types" title="Link to this heading">Â¶</a></h3>
<p>This section describes classes that designate C function types and how
to construct them.</p>
<dl class="dylan class" id="index-116">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-function-pointer]">
<span class="sig-name descname"><span class="pre">&lt;C-function-pointer&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-function-pointer]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>The superclass of all classes that designate a C function type. It
is a subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>. The Dylan variable bound by
<code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">c-callable</span></code> is of this type.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="describing-c-functions-to-dylan">
<span id="index-117"></span><h3>Describing C functions to Dylan<a class="headerlink" href="#describing-c-functions-to-dylan" title="Link to this heading">Â¶</a></h3>
<dl class="dylan macro" id="index-118">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-function">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-function</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-function" title="Link to this definition">Â¶</a></dt>
<dd><p>Describes a C function to the <em>c-ffi</em>.</p>
<dl class="field-list simple">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define C-function <cite>name</cite>
  [<cite>parameter-spec</cite>; ...]
  [<cite>result-spec</cite>;]
  [<cite>function-option</cite>, ...;]
end [C-function] [<cite>name</cite>]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> â A Dylan variable name.</p></li>
<li><p><strong>parameter-spec</strong></p></li>
<li><p><strong>result-spec</strong></p></li>
<li><p><strong>function-option</strong> â A property list.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Describes a C function to the C-FFI. In order for a C function to
be called correctly by Dylan, the same information about the
function must be given as is needed by C callers, typically
provided by <code class="docutils literal notranslate"><span class="pre">extern</span></code> declarations for the function in a C header
file: the functionâs name and the types of its parameters and
results.</p>
<span class="target" id="index-119"></span><p>The result of processing a <a class="reference internal" href="#c-ffi:c-ffi:definec-function"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-function</span></code></a> definition is a
Dylan function which is bound to name. This function takes Dylan
objects as arguments, converting them to their C representations
according to the types declared for the parameters of the C
function before calling the C function with them. If the C function
returns results, these results are converted to Dylan
representations according to the declared types of those results
before being returned to the Dylan caller of the function. By
default the function created is a raw method, not a generic
function. A generic function method can defined by using the
<em>generic-function-method:</em> option.</p>
<p>Either the <em>c-name:</em> function option must be supplied, or the
<em>indirect:</em> option must be supplied with a value other than <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>,
but not both.</p>
<p>A parameter-spec has the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">*</span><span class="n">adjectives</span><span class="o">*</span><span class="p">]</span> <span class="n">parameter</span> <span class="n">name</span> <span class="p">::</span> <span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="nb">type</span><span class="o">*</span> <span class="c1">#key *c-name*</span>
</pre></div>
</div>
<p>If no parameters are specified, the C function is taken to have no
arguments.</p>
<p>The adjectives can be either <em>output</em>, <em>input</em>, or both. The
calling discipline is specified by the <em>input</em> and <em>output</em>
adjectives.</p>
<p>By itself, <em>input</em> indicates that the argument is passed into the
function by value. This option is the default and is used primarily
to document the code. There is a parameter to the generated Dylan
function corresponding to each <em>input</em> parameter of the C function.</p>
<p>The <em>output</em> adjective specifies that the argument value to the C
function is used to identify a location into which an extra result
of the C function will be stored. There is no parameter in the
generated Dylan function corresponding to an <em>output</em> parameter of
the C function. The C-FFI generates a location for the extra return
value itself and passes it to the C function. When the C function
returns, the value in the location is accessed and returned as an
extra result from the Dylan function. The C-FFI allocates space for
the output parameterâs referenced type, passes a pointer to the
allocated space, and returns <a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> of that pointer. A
struct or union type may not be used as an output parameter.</p>
<p>Example of <em>output</em> parameter definition:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">mix-it-up</span>
<span class="w">  </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">out1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;some-struct*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">out2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;mix_it_up&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">mix-it-up</span><span class="p">;</span>
</pre></div>
</div>
<p>Example transaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>? mix-it-up();
1
{&lt;some-struct&gt; pointer #xfefe770}
42
</pre></div>
</div>
<span class="target" id="index-120"></span><p>If both <em>input</em> and <em>output</em> are supplied, they specify that the
argument value to the C function is used to identify a location
from which a value is accessed and into which an extra result value
is placed by the C function. There is a parameter to the generated
Dylan function corresponding to each <em>input</em> <em>output</em> parameter of
the C function that is specialized as the union of the export type
of the referenced type of the type given for the parameter in
<a class="reference internal" href="#c-ffi:c-ffi:definec-function"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">c-function</span></code></a>, and <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>. When the C function returns, the
value in the location is accessed and returned as an extra result
from the Dylan function. If an <em>input</em> <em>output</em> parameter is passed
as <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> from Dylan then a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> pointer is passed to the C
function, and the extra value returned by the Dylan function will
be <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>.</p>
<p>Example of <em>input</em> <em>output</em> parameter definition:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">mix-it-up</span>
<span class="w">  </span><span class="n">input</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">inout</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;mix_it_up&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">mix-it-up</span><span class="p">;</span>
</pre></div>
</div>
<p>Example transaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>? mix-it-up(7);
1
14
</pre></div>
</div>
<p>Note that neither <em>output</em> nor <em>input</em> <em>output</em> affects the
declared type of an argument: it must have the same type it has in
C and so, because it represents a location, must be a pointer type.</p>
<p>A result-spec has the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="p">[</span><span class="n">name</span> <span class="p">::</span> <span class="n">c</span><span class="o">-</span><span class="nb">type</span><span class="p">]</span>
<span class="n">error</span><span class="o">-</span><span class="n">result</span> <span class="p">[</span><span class="n">name</span> <span class="p">::</span> <span class="n">c</span><span class="o">-</span><span class="nb">type</span><span class="p">]</span>
</pre></div>
</div>
<p>If no <em>result</em> is specified, the Dylan function does not return a
value for the C result, and the C function is expected to have a
return type of <em>void</em>.</p>
<p><em>error-result</em> is used when it is necessary to call the <em>import-map</em>
function on the result and then discard it. This is often used when
mapping a return value to a Dylan error.</p>
<span class="target" id="index-121"></span><p>Each <em>function-option</em> is a keywordâvalue pair. The
<em>generic-function-method:</em> option may be either <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> or <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>,
indicating whether to add a method to the generic function name or
to bind a bare constant method directly to name. The default value
for <em>generic-function-method:</em> is <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>. The option <em>C-modifiers:</em>
can be used to specify platform dependent modifiers for the C
function being called. For example, on Windows, use <em>C-modifiers:</em>
<code class="docutils literal notranslate"><span class="pre">&quot;__stdcall&quot;</span></code> if the C function to be called is defined to be a
<code class="docutils literal notranslate"><span class="pre">__stdcall</span></code> function.</p>
<p>The <em>c-name:</em> option is used to specify the name of the C function
as it is defined in the object or shared library file. The <em>c-name</em>
must be a constant string.</p>
<span class="target" id="index-122"></span><p>The <em>indirect:</em> <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> option defines a function that accepts a C
function pointer as its first argument and calls the function given
with the signature described by the parameters and result given. In
this case the Dylan function defined accepts one more argument than
if <em>c-name</em> was given. The type specified for the first parameter
of the Dylan function is <a class="reference internal" href="#c-ffi:c-ffi:[c-function-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;c-function-pointer&gt;</span></code></a>. One of
<em>c-name</em> or <em>indirect:</em> <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> must be supplied, but not both.</p>
<p>Example C declarations:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Compute the length of a string */</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">strlen</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">string</span><span class="p">);</span>

<span class="cm">/* Set the given locations to values,</span>
<span class="cm">   returning an error code */</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">fill_locations</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">loc1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">loc2</span><span class="p">);</span>

<span class="cm">/* Read at most as far as indicated in max_then_read,</span>
<span class="cm">   updating it to contain how much was actually read */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">read_stuff</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">max_then_read</span><span class="p">);</span>
</pre></div>
</div>
<p>Example FFI definitions:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">strlen</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-char*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;strlen&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">fill-locations</span>
<span class="w">  </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">loc1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">loc2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">return-code</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c_name:</span><span class="w"> </span><span class="s">&quot;fill_locations&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">read-stuff</span>
<span class="w">  </span><span class="n">input</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;read_stuff&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>
</pre></div>
</div>
<p>Example transactions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>? strlen($my-c-string);
44
? fill-locations();
0
101 // extra output value
102 // extra output value
? read-stuff(100);
50 // extra output value
</pre></div>
</div>
<span class="target" id="index-123"></span><p>In effect, a <a class="reference internal" href="#c-ffi:c-ffi:definec-function"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-function</span></code></a> such as:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">foo</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-char*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>
</pre></div>
</div>
<p>expands into something like:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">function</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">c-string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">%as-c-representation</span><span class="p">(</span><span class="nc">&lt;C-char*&gt;</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">string</span><span class="p">);</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">c-count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">%as-c-representation</span><span class="p">(</span><span class="nc">&lt;C-int&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">c-result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">%call-c-function</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c-string</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">c-count</span><span class="p">);</span>
<span class="w">  </span><span class="n">%as-dylan-representation</span><span class="p">(</span><span class="nc">&lt;C-int&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">c-result</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<p>with the declared type.</p>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="describing-dylan-functions-for-use-by-c">
<span id="index-124"></span><h3>Describing Dylan functions for use by C<a class="headerlink" href="#describing-dylan-functions-for-use-by-c" title="Link to this heading">Â¶</a></h3>
<dl class="dylan macro" id="index-125">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-callable-wrapper">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-callable-wrapper</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-callable-wrapper" title="Link to this definition">Â¶</a></dt>
<dd><p>Makes a Dylan function callable from C by describing a C contract for
the function.</p>
<dl class="field-list">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define C-callable-wrapper [<cite>dylan-rep-name</cite>] of <cite>dylan-function</cite>
  [<cite>parameter-spec</cite> ; ...] [;]
  [<cite>result-spec</cite> ] [;]
  [<cite>function-options</cite> ][;]
end [C-callable-wrapper]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>dylan-rep-name</strong> â A Dylan variable name.</p></li>
<li><p><strong>dylan-function</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Function_Classes#function"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;function&gt;</span></code></a>.</p></li>
<li><p><strong>parameter-spec</strong></p></li>
<li><p><strong>result-spec</strong></p></li>
<li><p><strong>function-options</strong> â A property list.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Makes a Dylan function callable from C by describing a C contract
for the function. In order to generate a correct C-callable
function wrapper, the same information about the function must be
given as would be needed by C callers, typically provided by
<code class="docutils literal notranslate"><span class="pre">extern</span></code> declarations for the function in a C header file: the
types of its parameters and results.</p>
<span class="target" id="index-126"></span><p>The result of processing a <a class="reference internal" href="#c-ffi:c-ffi:definec-callable-wrapper"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-callable-wrapper</span></code></a> definition
is a function with a C entry point with the contract described.
This function takes C values as arguments, converting them to Dylan
representations according to the types declared for the parameters
of the C function before calling the Dylan function with them. If
the C function was described as returning results, the results of
the call to the Dylan function are converted to C representations
according to the declared types of those results before being
returned to the C caller of the function.</p>
<p>The <em>dylan-function</em> is a Dylan function that accepts the correct
number of parameters, and is called by the C callable wrapper.</p>
<p>The function-options are a property list. This list may contain a
string value for the c-name keyword. If a c-name is specified, that
name is made visible to C as the name of the generated <em>C-callable
wrapper</em> function. Given a compatible <code class="docutils literal notranslate"><span class="pre">extern</span></code> declaration, this
allows C code to call Dylan code simply by invoking a named
function. The <em>export:</em> option takes the values <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> or <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>
and indicates whether the c-name for the generated
<em>C-callable-wrapper</em> function is to be exported from the libraryâs
<em>.dll</em>. <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> means it is exported, <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> means it is not. The
default is #f. The <em>c-modifiers:</em> option is the same as in the
<em>c-function</em> macro, except that the modifiers apply to the C
function wrapper which is generated. See <a class="reference internal" href="#c-ffi:c-ffi:definec-function"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-function</span></code></a>.</p>
<p>If <em>dylan-rep-name</em> is specified, it is bound to an instance of a
function-pointer designator class identifying the generated
C-callable wrapper function. You can pass this pointer to C code
for use as, for example, a callback.</p>
<p>A parameter-spec has the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">*</span><span class="n">adjectives</span><span class="o">*</span> <span class="p">]</span> <span class="n">parameter</span> <span class="n">name</span> <span class="p">::</span> <span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="nb">type</span><span class="o">*</span> <span class="c1">#key *c-name*</span>
</pre></div>
</div>
<p>If no parameters are specified, the C function is taken to have no
arguments.</p>
<p>An adjective can be <em>input</em>, <em>output</em>, or both. The calling
discipline is specified by the <em>input</em> and <em>output</em> adjectives.</p>
<p>If a parameter is <em>output</em>, the corresponding parameter is not
passed to the Dylan function, but the Dylan function is expected to
return an extra value that is placed in the location pointed to by
the parameter. When the pointer is NULL, the extra value from the
Dylan function is ignored. The type designated for the parameter
must be a pointer type.</p>
<p>If a parameter is both <em>input</em> and <em>output</em>, the parameter must be
a pointer type, and the value accepted by the Dylan function is the
result. The functions pointer-value and pointer-value-setter
perform the primitive Dylan-to-C and C-to-Dylan conversions as
documented with the designator class of the pointerâs contents type
(see Table 1.1). The C-FFI signals an error if it cannot convert
the object you attempt to store in the pointer to a compatible
type on that pointer. The Dylan function is expected to return
an extra value which is placed into the location specified by the
pointer passed to the C function. If the pointer passed to the C
function is <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, then the value passed to the Dylan function
will be <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>, and the extra value returned will be ignored.</p>
<p>There is currently no way to define a C-callable function that
accepts a variable number of arguments.</p>
<p>A result-spec has the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="n">name</span> <span class="p">::</span> <span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="nb">type</span><span class="o">*</span>
</pre></div>
</div>
<p>If no <em>result</em> is specified, the C function defined does not return
a value. It is defined as what in C terminology is known as a
<em>void</em> function.</p>
</p>
</dd>
<dt class="field-even">Example<span class="colon">:</span></dt>
<dd class="field-even"><p>Example C declarations:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Compute the length of a string */</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">strlen</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">string</span><span class="p">);</span>

<span class="cm">/* Set the given locations to values, returning an</span>
<span class="cm">   error code */</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">fill_locations</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">loc1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">loc2</span><span class="p">);</span>

<span class="cm">/* Read at most as far as indicated in max_then_read,</span>
<span class="cm">   updating it to contain how much was actually read */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">read_stuff</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">max_then_read</span><span class="p">);</span>
</pre></div>
</div>
<p>Example FFI definitions:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">dylan-strlen</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-callable-wrapper</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">dylan-strlen</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-char*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;strlen&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">dylan-fill-locations</span><span class="w"> </span><span class="p">()</span>
<span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">return-code</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">,</span>
<span class="w">     </span><span class="n">val1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">,</span>
<span class="w">     </span><span class="n">val2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span>
<span class="w">  </span><span class="p">...</span>
<span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-callable-wrapper</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">dylan-fill-locations</span>
<span class="w">  </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">loc1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">loc2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">return-code</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;fill_locations&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">dylan-read-stuff</span><span class="w"> </span><span class="p">(</span><span class="nb">max</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;integer&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="n">read</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">&lt;integer</span><span class="p">)</span><span class="w"> </span><span class="p">...</span>
<span class="k">end</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-callable-wrapper</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">dylan-read-stuff</span>
<span class="w">  </span><span class="n">input</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">max-then-read</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;read_stuff&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>
</pre></div>
</div>
<p>Example C calls:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">loc1</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">loc2</span><span class="p">,</span><span class="w"> </span><span class="n">max_then_read</span><span class="p">;</span>
<span class="w">  </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="s">&quot;ABC&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">fill_locations</span><span class="p">(</span><span class="n">loc1</span><span class="p">,</span><span class="w"> </span><span class="n">loc2</span><span class="p">);</span>

<span class="w">  </span><span class="n">max_then_read</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>

<span class="w">  </span><span class="n">read_stuff</span><span class="p">(</span><span class="o">&amp;</span><span class="n">max_then_read</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="index-127">In effect, a <a class="reference internal" href="#c-ffi:c-ffi:definec-callable-wrapper"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-callable-wrapper</span></code></a> such as:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-callable-wrapper</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">foo</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-char*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>
</pre></div>
</div>
<p>expands into something like:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">%c-callable-function</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">c-string</span><span class="p">,</span><span class="w"> </span><span class="n">c-count</span><span class="p">)</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">dylan-string</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">%as-dylan-representation</span><span class="p">(</span><span class="nc">&lt;C-char*&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">c-string</span><span class="p">);</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">dylan-count</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">%as-dylan-representation</span><span class="p">(</span><span class="nc">&lt;C-int&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">c-count</span><span class="p">);</span>
<span class="w">  </span><span class="k">let</span><span class="w"> </span><span class="n">dylan-result</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">dylan-string</span><span class="p">,</span><span class="w"> </span><span class="n">dylan-count</span><span class="p">);</span>
<span class="w">  </span><span class="n">%as-c-representation</span><span class="p">(</span><span class="nc">&lt;C-int&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">dylan-result</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<p>where the <em>%</em> functions perform the primitive conversions between
Dylan and C representations, checking that their arguments are
compatible with the declared type.</p>
<p>Callback example:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">c-sort</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">strings</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-string*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-function-pointer&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">sorted-strings</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-string*&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;sort&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-callable-wrapper</span><span class="w"> </span><span class="n">callback-for-&lt;</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">\&lt;</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">string1</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-string&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">string2</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-string&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-int&gt;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-callable-wrapper</span><span class="p">;</span>

<span class="p">?</span><span class="w"> </span><span class="n">callback-for-&lt;</span>
<span class="p">{</span><span class="nb">function</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="mh">#xff6e00</span><span class="p">}</span>

<span class="p">?</span><span class="w"> </span><span class="n">c-sort</span><span class="p">(</span><span class="n">some-c-strings</span><span class="p">,</span><span class="w"> </span><span class="n">callback-for-&lt;</span><span class="p">);</span>
<span class="p">{</span><span class="nc">&lt;C-string&gt;</span><span class="w"> </span><span class="n">array</span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
<section id="objective-c">
<h3>Objective C<a class="headerlink" href="#objective-c" title="Link to this heading">Â¶</a></h3>
<p>A full-featured Objective C bridge is provided separately, however, parts
of that bridge are implemented within this library.</p>
<dl class="dylan macro">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:defineobjc-selector">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">objc-selector</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:defineobjc-selector" title="Link to this definition">Â¶</a></dt>
<dd><p>Describe Objective C selectors to the <em>c-ffi</em>.</p>
<dl class="field-list">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define objc-selector <cite>name</cite>
  [<cite>parameter-spec</cite>; ...]
  [<cite>result-spec</cite>;]
  [<cite>function-option</cite>, ...;]
end [C-function] [<cite>name</cite>]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> â A Dylan variable name.</p></li>
<li><p><strong>parameter-spec</strong></p></li>
<li><p><strong>result-spec</strong></p></li>
<li><p><strong>function-option</strong> â A property list.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Defining an Objective C selector is much the same as <a class="reference internal" href="#c-ffi:c-ffi:definec-function"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-function</span></code></a>,
except:</p>
<ul class="simple">
<li><p>There must be at least one parameter specification. The first parameter specifies
the target of the method, so it should be either an Objective C class or an
object instance.</p></li>
<li><p>Rather than specifying a <code class="docutils literal notranslate"><span class="pre">c-name:</span></code> for the function, a <code class="docutils literal notranslate"><span class="pre">selector</span></code> is specified
instead.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">c-modifiers</span></code> keyword can be used to select alternate versions of <code class="docutils literal notranslate"><span class="pre">objc_msgSend</span></code>
when calling into the Objective C run-time.</p></li>
<li><p>An additional keyword, <code class="docutils literal notranslate"><span class="pre">type-encoding:</span></code> must be supplied with a valid type encoding
for the selector. See the Objective C bridge documentation for more details.</p></li>
</ul>
</p>
</dd>
<dt class="field-even">Example<span class="colon">:</span></dt>
<dd class="field-even"><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">objc-selector</span><span class="w"> </span><span class="n">sel/alloc</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;objc/class&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="n">objc-instance</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;objc/instance-address&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">selector:</span><span class="w"> </span><span class="s">&quot;alloc&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="variables">
<span id="index-128"></span><h2>Variables<a class="headerlink" href="#variables" title="Link to this heading">Â¶</a></h2>
<p>This section covers describing and accessing C variables.</p>
<dl class="dylan macro" id="index-129">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-variable">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-variable</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-variable" title="Link to this definition">Â¶</a></dt>
<dd><p>Describes C variables to the <em>c-ffi</em>.</p>
<dl class="field-list">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define C-variable <cite>getter-name</cite> :: <cite>c-type</cite>
  #key <cite>setter</cite> <cite>c-name</cite> import: <cite>boolean</cite>
end [C-variable]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>getter-name</strong> â A Dylan variable name.</p></li>
<li><p><strong>c-type</strong> â A Dylan name.</p></li>
<li><p><strong>setter</strong> â <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> or a Dylan variable name.</p></li>
<li><p><strong>c-name</strong> â A string constant.</p></li>
<li><p><strong>import</strong> â <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> or <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="target" id="index-130"></span><p>Describes C variables to the C-FFI. It defines a getter and setter
function for accessing the variableâs value. The c-name keyword
argument is required and gives the C name of the variable to be
accessed. The <em>setter</em> keyword allows you to specify the name of
the setter function, or if a setter function is to be defined at
all. If <em>setter</em> is <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>, no setter function will be defined.</p>
<p>The <em>import:</em> option indicates if the C variable must be imported
from another <em>.dll</em> or not. <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> indicates it is in another
<em>.dll</em> and must be imported, <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> means that it is not to be
imported. Whether the variable has to be imported from another
<em>.dll</em> or not is determined by which Dylan project the C source
files are part of. If they are in the same project as the
<em>C-variable</em> definition then the value of âimport:â should be
<a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> as the definition and variable will be linked into the same
<em>.dll</em>. If the definition is in a different project from the C
source files then they will be in separate <em>.dll</em> s and <em>import:</em>
needs to be <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a>. The default value is <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>.</p>
<span class="target" id="index-131"></span><p>For integer, float, or pointer-typed C variables the representation
is clear and unambiguous. For C struct or union typed variables the
translation is not so simple. A C union or struct has no direct
representation in Dylan. You may only have a reference to the C
object in Dylan through a <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;c-pointer&gt;</span></code></a> object. For this
reason, <a class="reference internal" href="#c-ffi:c-ffi:definec-variable"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">c-variable</span></code></a> is not permitted for variables with C
aggregate types. Use <a class="reference internal" href="#c-ffi:c-ffi:definec-address"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-address</span></code></a> for those variables.</p>
</p>
</dd>
<dt class="field-even">Example<span class="colon">:</span></dt>
<dd class="field-even"><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>? define C-variable process-count :: &lt;C-int&gt;,
  c-name: &quot;process_count&quot; end;

? process-count();
57

? process-count() := 0;
0

? process-count();
0

? define C-variable machine-name-1 :: &lt;C-char*&gt;,
  c-name: &quot;MachineName&quot;;
end;

? machine-name-1();
#{&lt;C-char*&gt; #xaaabc00}
</pre></div>
</div>
<p>In C and other static languages what is known as a variable is a
named allocation of memory. To access a global C variable from
Dylan it is occasionally necessary to get a handle to the location
where that variable is kept. The <a class="reference internal" href="#c-ffi:c-ffi:definec-address"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-address</span></code></a> macro
can be used for this purpose.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan macro" id="index-132">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:definec-address">
<span class="sig-name descname"><span class="pre">define</span> <span class="pre">C-address</span></span> <em class="property"><span class="pre">Defining</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:definec-address" title="Link to this definition">Â¶</a></dt>
<dd><p>Defines a Dylan constant binding that is a <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> to
the location of a C global variable.</p>
<dl class="field-list simple">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">define C-address <cite>name</cite> :: <cite>pointer-designator-type</cite>
  #key <cite>c-name</cite> import: <cite>boolean</cite>
end [C-address] [<cite>name</cite>]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> â A Dylan variable name.</p></li>
<li><p><strong>pointer-designator-type</strong></p></li>
<li><p><strong>c-name</strong> â A string constant.</p></li>
<li><p><strong>import</strong> â <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> or <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Defines a Dylan constant binding, <em>name</em>, that is a
<a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> which points to the location of the C global
variable <em>c-name</em>.</p>
<p><em>Pointer-designator-type</em> must be the type of the constant to be
defined, and a subtype of <code class="docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code>.</p>
<p>The <em>import:</em> option indicates if the C address must be imported
from another <em>.dll</em> or not. <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> indicates it is in another
<em>.dll</em> and must be imported, <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> means that it is not to be
imported. Whether the variable has to be imported from another
<em>.dll</em> or not is determined by which Dylan project the C source
files are part of. If they are in the same project as the
<em>C-address</em> definition then the value of âimport:â should be <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>
as the definition and variable will be linked into the same <em>.dll</em>.
If the definition is in a different project from the C source files
then they will be in separate <em>.dll</em> s and <em>import:</em> needs to be
<a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a>. The default value is <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>.</p>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="allocating-and-deallocating-c-storage">
<span id="index-133"></span><h2>Allocating and deallocating C storage<a class="headerlink" href="#allocating-and-deallocating-c-storage" title="Link to this heading">Â¶</a></h2>
<p>C objects can be allocated by calling <a class="reference external" href="https://opendylan.org/books/drm/Constructing_and_Initializing_Instances#make"><code class="xref drm docutils literal notranslate"><span class="pre">make</span></code></a> on an associated wrapper
class or by allocating them on the stack using the macro
<a class="reference internal" href="#c-ffi:c-ffi:with-stack-structure"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">with-stack-structure</span></code></a>.</p>
<p>The C component of a <a class="reference external" href="https://opendylan.org/books/drm/Constructing_and_Initializing_Instances#make"><code class="xref drm docutils literal notranslate"><span class="pre">make</span></code></a> -allocated object is not deallocated by
default when the Dylan designator object is reclaimed by the garbage
collector, so we provide a manual means of freeing this storage with the
function <a class="reference internal" href="#c-ffi:c-ffi:destroy"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">destroy</span></code></a>.</p>
<dl class="dylan method" id="index-134">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:make(subclass([c-pointer]))">
<span class="sig-name descname"><span class="pre">make(subclass(&lt;C-pointer&gt;))</span></span> <em class="property"><span class="pre">Method</span></em><a class="headerlink" href="#c-ffi:c-ffi:make(subclass([c-pointer]))" title="Link to this definition">Â¶</a></dt>
<dd><p>Allocates a C object on the heap.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>make <em>subclass(&lt;c-pointer&gt;)</em> #key <em>allocator</em> <em>element-count</em> <em>extra-bytes</em> <em>address</em> =&gt; <em>C-pointer</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>subclass</strong> â A subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>allocator</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Function_Classes#function"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;function&gt;</span></code></a>.</p></li>
<li><p><strong>element-count</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
<li><p><strong>extra-bytes</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
<li><p><strong>address</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> or <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>c-pointer</strong> â An instance of type <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;c-pointer&gt;</span></code></a> pointing to the object.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><p>Allocates a C object on the heap, using whatever standard C
allocation function is in use on the target platform (typically
<code class="docutils literal notranslate"><span class="pre">malloc</span></code>) to allocate the storage. This method is applicable to
subclasses of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> and returns an instance of its
argument class.</p>
<p>If the <em>address</em> option is provided, no new storage is allocated, but
instead, a new pointer with the given machine word address is
returned.</p>
<p>The <em>allocator</em> argument should be a Dylan function that can serve
as an allocator. It must accept a single integer argument â the
number of bytes to be allocated â and return a Dylan
<a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a> that represents the address of the memory it
allocated.</p>
<p>The amount of storage allocated by default is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">size</span><span class="o">-</span><span class="n">of</span><span class="p">(</span><span class="o">*</span><span class="n">pointer</span><span class="o">-</span><span class="n">wrapper</span><span class="o">-</span><span class="n">class</span><span class="o">*.</span><span class="n">referenced</span><span class="o">-</span><span class="nb">type</span><span class="p">)</span>
</pre></div>
</div>
<p>If a positive integer is passed in the <em>extra-bytes</em> option, that
number of extra bytes is also allocated.</p>
<p>If a positive integer is passed in the <em>element-count</em> option, space
for <em>element-count</em> copies of the referenced type is allocated,
taking into account the <em>extra-bytes</em> option for each of them. The
<em>element-count</em> argument can be used for allocating arrays of sizes
that are not known statically. The keyword <code class="docutils literal notranslate"><span class="pre">element-count:</span></code> is used
for this option rather than <code class="docutils literal notranslate"><span class="pre">size:</span></code> in order to avoid conflict with
the <code class="docutils literal notranslate"><span class="pre">size:</span></code> collection keyword. The logical size of a collection
represented by a pointer wrapper and the number of array elements
that implement it may differ; a null-terminated string is an
example of such a case.</p>
<p>This <a class="reference external" href="https://opendylan.org/books/drm/Constructing_and_Initializing_Instances#make"><code class="xref drm docutils literal notranslate"><span class="pre">make</span></code></a> method calls <a class="reference external" href="https://opendylan.org/books/drm/Constructing_and_Initializing_Instances#initialize"><code class="xref drm docutils literal notranslate"><span class="pre">initialize</span></code></a> on the wrapper object it
generates before returning it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>? define variable *space-for-one-int* = make(&lt;C-int*&gt;);

? *space-for-one-int*[0];
97386437634 // Could have been anything unless the
  // default allocator guarantees to zero new memory.

? *space-for-one-int*[0] := 0;
0

? *space-for-one-int*[0];
0

? define variable *space-for-ten-ints*
    = make(&lt;C-int*&gt;, element-count: 10);

? define C-struct &lt;Z-properties&gt;
    slot type :: &lt;C-int&gt;;
    array slot properties :: &lt;C-int&gt;,
  end C-struct &lt;Z-properties&gt;;

? define variable *props*
    = make(&lt;Z-properties&gt;, extra-bytes: 10 * size-of(&lt;C-int&gt;));
</pre></div>
</div>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan generic-function" id="index-135">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:destroy">
<span class="sig-name descname"><span class="pre">destroy</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Generic</span> <span class="pre">function</span></em><a class="headerlink" href="#c-ffi:c-ffi:destroy" title="Link to this definition">Â¶</a></dt>
<dd><p>Frees the allocated heap memory at a specified address.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>destroy <em>C-pointer</em> #key <em>deallocator</em> =&gt; ()</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>c-pointer</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>deallocator</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Function_Classes#function"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;function&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Frees the allocated heap memory at the address encapsulated in
<em>C-pointer</em>.</p>
<p>The <em>deallocator</em> argument should be a Dylan function that can
serve as a deallocation facility. It must accept an address as a
<a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a> and free the storage allocated at that address.</p>
<p>You should only use <a class="reference internal" href="#c-ffi:c-ffi:destroy"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">destroy</span></code></a> on pointers allocated using
<a class="reference external" href="https://opendylan.org/books/drm/Constructing_and_Initializing_Instances#make"><code class="xref drm docutils literal notranslate"><span class="pre">make</span></code></a> where no address was given. If <em>allocator</em> was passed to
<a class="reference external" href="https://opendylan.org/books/drm/Constructing_and_Initializing_Instances#make"><code class="xref drm docutils literal notranslate"><span class="pre">make</span></code></a>, the matching deallocator should be passed to <a class="reference internal" href="#c-ffi:c-ffi:destroy"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">destroy</span></code></a>.</p>
<p>There is a default method for destroy on
<a class="reference internal" href="#c-ffi:c-ffi:[c-statically-typed-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></code></a>.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan macro" id="index-136">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:with-stack-structure">
<span class="sig-name descname"><span class="pre">with-stack-structure</span></span> <em class="property"><span class="pre">Statement</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:with-stack-structure" title="Link to this definition">Â¶</a></dt>
<dd><p>Allocates an object within the scope of the body of the code.</p>
<dl class="field-list">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">with-stack-structure (<cite>name</cite> :: <cite>wrapper-type</cite>
    #key <cite>element-count</cite>, <cite>extra-bytes</cite>)
  <cite>body</cite>
end [with-stack-structure]</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> â A Dylan variable name.</p></li>
<li><p><strong>wrapper-type</strong> â A Dylan name.</p></li>
<li><p><strong>element-count</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
<li><p><strong>extra-bytes</strong> (<em>#key</em>) â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Allocates an object <em>name</em> within the scope of a <em>body</em>. The
<em>element-count</em> and <em>extra-bytes</em> options behave as in <a class="reference external" href="https://opendylan.org/books/drm/Constructing_and_Initializing_Instances#make"><code class="xref drm docutils literal notranslate"><span class="pre">make</span></code></a>.
The memory that was allocated is freed after <em>body</em> exits.</p>
<p>This macro gives the object <em>dynamic extent</em>.</p>
</p>
</dd>
<dt class="field-even">Example<span class="colon">:</span></dt>
<dd class="field-even"><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span><span class="w"> </span><span class="n">C-struct</span><span class="w"> </span><span class="nc">&lt;PointStruct&gt;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">x-coord</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-unsigned-short&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="nb">slot</span><span class="w"> </span><span class="n">y-coord</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;C-unsigned-short&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">pointer-type-name:</span><span class="w"> </span><span class="nc">&lt;PointStruct*&gt;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-struct</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="nb">constant</span><span class="w"> </span><span class="nc">&lt;Point&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">&lt;PointStruct*&gt;</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="n">C-function</span><span class="w"> </span><span class="n">PlotPoint</span>
<span class="w">  </span><span class="n">parameter</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Point&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">c-name:</span><span class="w"> </span><span class="s">&quot;PlotPoint&quot;</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="n">C-function</span><span class="p">;</span>

<span class="k">define</span><span class="w"> </span><span class="nb">method</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">  </span><span class="n">with-stack-structure</span><span class="w"> </span><span class="p">(</span><span class="n">point</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nc">&lt;Point&gt;</span><span class="p">)</span>
<span class="w">    </span><span class="n">point</span><span class="p">.</span><span class="n">x-coord</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<span class="w">    </span><span class="n">point</span><span class="p">.</span><span class="n">y-coord</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<span class="w">    </span><span class="n">PlotPoint</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
<span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
<section id="utility-designator-classes">
<span id="index-137"></span><h2>Utility designator classes<a class="headerlink" href="#utility-designator-classes" title="Link to this heading">Â¶</a></h2>
<p>The following designator classes are defined for convenience purposes
using <a class="reference internal" href="#c-ffi:c-ffi:definec-mapped-subtype"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">define</span> <span class="pre">c-mapped-subtype</span></code></a>.</p>
<dl class="dylan class" id="index-138">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-boolean]">
<span class="sig-name descname"><span class="pre">&lt;C-boolean&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-boolean]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>A mapped subclass of <code class="docutils literal notranslate"><span class="pre">&lt;C-int&gt;</span></code> that provides an analogue to
Dylanâs <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a> class. The Dylan type for both import and
export is <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a>, and the C type is <code class="docutils literal notranslate"><span class="pre">int</span></code>. The C integer
<code class="docutils literal notranslate"><span class="pre">0</span></code> is mapped to <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> in Dylan, and all other values are mapped
to <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan class" id="index-139">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-string]">
<span class="sig-name descname"><span class="pre">&lt;C-string&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-string]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>A mapped subclass of <code class="docutils literal notranslate"><span class="pre">&lt;C-char*&gt;</span></code> and <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code></a>. On export the
Dylan types <code class="docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code>, or <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a> may be passed to
C. On import all values are mapped to <code class="docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code>. A
<a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a> may be passed to C directly and no copying takes
place. The value in C will be a pointer to the data of the
byte-string. The implementation of <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a> is such that,
unless there are <code class="docutils literal notranslate"><span class="pre">NULL</span></code> characters embedded in the string,
<code class="docutils literal notranslate"><span class="pre">strlen</span></code> in C and <code class="docutils literal notranslate"><span class="pre">size</span></code> in Dylan will return the same value.</p>
<p>A <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a> may only be safely passed to a C function if
its value is never stored and used after the call returns.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan class">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-character]">
<span class="sig-name descname"><span class="pre">&lt;C-character&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-character]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>The Dylan type for import and export is <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#character"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;character&gt;</span></code></a>. It is a
designator that allows instances of <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#character"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;character&gt;</span></code></a> to be passed to
and from C.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan macro" id="index-140">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:with-c-string">
<span class="sig-name descname"><span class="pre">with-c-string</span></span> <em class="property"><span class="pre">Statement</span> <span class="pre">Macro</span></em><a class="headerlink" href="#c-ffi:c-ffi:with-c-string" title="Link to this definition">Â¶</a></dt>
<dd><p>Passes a C pointer to the contents of a <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Macro Call<span class="colon">:</span></dt>
<dd class="field-odd"><p><pre class="literal-block">with-c-string (<cite>variable</cite> = <cite>string-valued-expression</cite>)
  <cite>body</cite>
end</pre>
</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>variable</strong> â A Dylan variable name.</p></li>
<li><p><strong>string-valued-expression</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Use this macro when you need to pass C a pointer to the contents of
a <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a>, but for some reason it cannot be passed
directly. Inside the <em>body</em>, <em>variable</em> is bound to a
<a class="reference internal" href="#c-ffi:c-ffi:[c-string]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code></a> object that refers to the contents of the
string returned by <em>string-valued-expression</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;c-string&gt;</span></code> object is only live during the period that
<em>body</em> is executing. If the program holds onto the pointer after that,
the data it refers to cannot be guaranteed to be correct, because the
garbage collector can no longer keep track of it.</p>
</div>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:clear-memory!">
<span class="sig-name descname"><span class="pre">clear-memory!</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:clear-memory!" title="Link to this definition">Â¶</a></dt>
<dd><p>Stores zeros in the specified bytes of memory.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>clear-memory! <em>pointer</em>, <em>size</em> =&gt; ()</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>pointer</strong> â An instance of type <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a> that
points to the memory location at which to start writing zeros.</p></li>
<li><p><strong>size</strong> â An instance of type <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>. The number of
bytes to clear.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>Stores zeros into <em>size</em> bytes of memory beginning at <em>pointer</em>.
The space is assumed to be a whole number of words and
word-aligned.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:copy-bytes!">
<span class="sig-name descname"><span class="pre">copy-bytes!</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:copy-bytes!" title="Link to this definition">Â¶</a></dt>
<dd><p>Copies an arbitrary number of bytes at an arbitrary alignment.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>copy-bytes! <em>destination-pointer</em>, <em>source-pointer</em>, <em>size</em> =&gt; ()</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>destination-pointer</strong> â An instance of type <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>source-pointer</strong> â An instance of type <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>size</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>Copies an arbitrary number of bytes at arbitrary alignment instead
of copying whole words.</p>
</dd>
<dt class="field-even">See also<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><a class="reference internal" href="#c-ffi:c-ffi:copy-into!"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">copy-into!</span></code></a>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:copy-into!">
<span class="sig-name descname"><span class="pre">copy-into!</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:copy-into!" title="Link to this definition">Â¶</a></dt>
<dd><p>Copies the specified number of words.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>copy-into! <em>destination-pointer</em>, <em>source-pointer</em>, <em>size</em>) =&gt; ()</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>destination-pointer</strong> â An instance of type <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>source-pointer</strong> â An instance of type <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>size</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Copies <em>size</em> bytes from <em>source-pointer</em> to <em>destination-pointer</em>.</p>
<p>Although the size is specified in bytes, it will be assumed to be a
multiple of the word size. The function may also assume that both
pointers are word-aligned and that the two storage areas do not
overlap.</p>
</p>
</dd>
<dt class="field-even">See also<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><a class="reference internal" href="#c-ffi:c-ffi:copy-bytes!"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">copy-bytes!</span></code></a>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:equal-memory?">
<span class="sig-name descname"><span class="pre">equal-memory?</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:equal-memory?" title="Link to this definition">Â¶</a></dt>
<dd><p>Returns <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> if the size of the two designated memory spaces have
the same contents.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>equal-memory? <em>ptr1</em>, <em>ptr2</em>, <em>size</em> =&gt; &lt;boolean&gt;</p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ptr1</strong> â An instance of type <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>ptr2</strong> â An instance of type <a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a>.</p></li>
<li><p><strong>size</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>Returns <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> if the <em>size</em> bytes of memory starting at pointer
<em>ptr1</em> have the same contents as the memory starting at <em>ptr2</em>,
else <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>. The space is assumed to be a whole number of words and
word-aligned.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan class" id="index-141">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:[c-dylan-object]">
<span class="sig-name descname"><span class="pre">&lt;C-Dylan-object&gt;</span></span> <em class="property"><span class="pre">Open</span> <span class="pre">Abstract</span> <span class="pre">Class</span></em><a class="headerlink" href="#c-ffi:c-ffi:[c-dylan-object]" title="Link to this definition">Â¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Superclasses<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#c-ffi:c-ffi:[c-void*]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-void*&gt;</span></code></a></p>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A mapped subclass of <a class="reference internal" href="#c-ffi:c-ffi:[c-void*]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-void*&gt;</span></code></a>. Objects of this type
correspond to specific Dylan objects. The Dylan type for import and
export is <code class="docutils literal notranslate"><span class="pre">&lt;C-Dylan-Object&gt;</span></code>. The C type is <code class="docutils literal notranslate"><span class="pre">void*</span></code>.</p>
<p>To pass a reference to an arbitrary Dylan object to C, the Dylan
object first must be registered using
<a class="reference internal" href="#c-ffi:c-ffi:register-c-dylan-object"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">register-C-Dylan-object</span></code></a>. Then a <code class="docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code>
<em>handle</em> to the object can be created using the function
<a class="reference internal" href="#c-ffi:c-ffi:export-c-dylan-object"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">export-C-Dylan-object</span></code></a>. The handle can then be passed
directly to any C transition point designated as
<a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a>. Any object received by Dylan from a
transition point designated as <code class="docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code> may be passed
to <a class="reference internal" href="#c-ffi:c-ffi:import-c-dylan-object"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">import-C-Dylan-object</span></code></a> to get the Dylan object for which
it was a handle.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:register-c-dylan-object">
<span class="sig-name descname"><span class="pre">register-C-Dylan-object</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:register-c-dylan-object" title="Link to this definition">Â¶</a></dt>
<dd><p>Allows objects to be passed to a C function as instances of
<a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>register-C-Dylan-object <em>object</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>Allows objects to be passed to a C function as instances of
<a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">register-C-Dylan-object</span></code> function arranges for the garbage
collector to leave the storage used by <em>object</em> unclaimed, and
assures that the handle passed to C is not accidentally corrupted
(from Câs point of view) by the memory manager.</p>
</p>
</dd>
<dt class="field-even">See also<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><a class="reference internal" href="#c-ffi:c-ffi:unregister-c-dylan-object"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">unregister-C-Dylan-object</span></code></a>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-142">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:unregister-c-dylan-object">
<span class="sig-name descname"><span class="pre">unregister-C-Dylan-object</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:unregister-c-dylan-object" title="Link to this definition">Â¶</a></dt>
<dd><p>Deallocates an object.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>unregister-C-Dylan-object <em>object</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Discussion<span class="colon">:</span></dt>
<dd class="field-odd"><p>Deallocates an object. When the handle is no longer needed from C,
you call <code class="docutils literal notranslate"><span class="pre">unregister-C-Dylan-object</span></code> to allow the object to be
normally reclaimed by the memory manager. Calls to
<a class="reference internal" href="#c-ffi:c-ffi:register-c-dylan-object"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">register-C-Dylan-object</span></code></a> and <code class="docutils literal notranslate"><span class="pre">unregister-C-Dylan-object</span></code>
on the same object nest or interleave without interference. That
is, if <a class="reference internal" href="#c-ffi:c-ffi:register-c-dylan-object"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">register-C-Dylan-object</span></code></a> is called exactly twice on
an object then <code class="docutils literal notranslate"><span class="pre">unregister-C-Dylan-object</span></code> must be called exactly
twice before the memory manager can reclaim the space for the
object as it normally would.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-143">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:export-c-dylan-object">
<span class="sig-name descname"><span class="pre">export-C-Dylan-object</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:export-c-dylan-object" title="Link to this definition">Â¶</a></dt>
<dd><p>Fetches the <a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a> handle for a Dylan object.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>export-C-Dylan-object <em>object</em> =&gt; <em>c-dylan-object</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>c-dylan-object</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Fetches the <a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a> handle for a Dylan object.</p>
</dd>
</dl>
</dd></dl>

<dl class="dylan function" id="index-144">
<dt class="sig sig-object dylan-api dylan" id="c-ffi:c-ffi:import-c-dylan-object">
<span class="sig-name descname"><span class="pre">import-C-Dylan-object</span></span> <em class="property"><span class="pre">Function</span></em><a class="headerlink" href="#c-ffi:c-ffi:import-c-dylan-object" title="Link to this definition">Â¶</a></dt>
<dd><p>Fetches the Dylan object for a <a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a> handle.</p>
<dl class="field-list simple">
<dt class="field-odd">Signature<span class="colon">:</span></dt>
<dd class="field-odd"><p>import-c-dylan-object <em>c-dylan-object</em> =&gt; <em>object</em></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> â An instance of <a class="reference external" href="https://opendylan.org/books/drm/Object_Classes#object"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Discussion<span class="colon">:</span></dt>
<dd class="field-even"><p>Fetches the Dylan object for a <a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a> handle.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../collections/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">The collections Library</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../lid.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">LID File Format</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2011-2026, Dylan Hackers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">The c-ffi Library</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#c-types-in-dylan">C types in Dylan</a></li>
<li><a class="reference internal" href="#c-functions-in-dylan">C functions in Dylan</a></li>
<li><a class="reference internal" href="#c-variables-in-dylan">C variables in Dylan</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notes-on-linking">Notes on Linking</a><ul>
<li><a class="reference internal" href="#linking-against-a-library">Linking against a Library</a></li>
<li><a class="reference internal" href="#linking-against-a-macos-framework">Linking against a macOS Framework</a></li>
<li><a class="reference internal" href="#using-pkg-config">Using pkg-config</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tracing-ffi-calls">Tracing FFI Calls</a></li>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#basic-options-in-c-ffi-macros">Basic options in C-FFI macros</a></li>
<li><a class="reference internal" href="#designator-classes">Designator classes</a><ul>
<li><a class="reference internal" href="#designator-type-properties">Designator type properties</a></li>
<li><a class="reference internal" href="#designator-class-basics">Designator class basics</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-value]"><code class="docutils literal notranslate"><span class="pre">&lt;C-value&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-void]"><code class="docutils literal notranslate"><span class="pre">&lt;C-void&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:size-of"><code class="docutils literal notranslate"><span class="pre">size-of</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:alignment-of"><code class="docutils literal notranslate"><span class="pre">alignment-of</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#fundamental-numeric-type-designator-classes">Fundamental numeric type designator classes</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-number]"><code class="docutils literal notranslate"><span class="pre">&lt;C-number&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-float]"><code class="docutils literal notranslate"><span class="pre">&lt;C-float&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-double]"><code class="docutils literal notranslate"><span class="pre">&lt;C-double&gt;</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#pointer-designator-classes-and-related-functions">Pointer designator classes and related functions</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-pointer]"><code class="docutils literal notranslate"><span class="pre">&lt;C-pointer&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:pointer-address"><code class="docutils literal notranslate"><span class="pre">pointer-address</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:pointer-cast"><code class="docutils literal notranslate"><span class="pre">pointer-cast</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:null-pointer"><code class="docutils literal notranslate"><span class="pre">null-pointer</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:null-pointer?"><code class="docutils literal notranslate"><span class="pre">null-pointer?</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-void*]"><code class="docutils literal notranslate"><span class="pre">&lt;C-void*&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-statically-typed-pointer]"><code class="docutils literal notranslate"><span class="pre">&lt;C-statically-typed-pointer&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-pointer-type"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-pointer-type</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:referenced-type"><code class="docutils literal notranslate"><span class="pre">referenced-type</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-type-cast"><code class="docutils literal notranslate"><span class="pre">c-type-cast</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:pointer-value"><code class="docutils literal notranslate"><span class="pre">pointer-value</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:pointer-value-setter"><code class="docutils literal notranslate"><span class="pre">pointer-value-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:pointer-value-address"><code class="docutils literal notranslate"><span class="pre">pointer-value-address</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:element([c-statically-typed-pointer])"><code class="docutils literal notranslate"><span class="pre">element(&lt;C-statically-typed-pointer&gt;)</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:element-setter([c-statically-typed-pointer])"><code class="docutils literal notranslate"><span class="pre">element-setter(&lt;C-statically-typed-pointer&gt;)</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:=([c-pointer])"><code class="docutils literal notranslate"><span class="pre">=(&lt;C-pointer&gt;)</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[([c-pointer])"><code class="docutils literal notranslate"><span class="pre">&lt;(&lt;C-pointer&gt;)</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-char-at"><code class="docutils literal notranslate"><span class="pre">C-char-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-char-at-setter"><code class="docutils literal notranslate"><span class="pre">C-char-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-signed-char-at"><code class="docutils literal notranslate"><span class="pre">C-signed-char-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-signed-char-at-setter"><code class="docutils literal notranslate"><span class="pre">C-signed-char-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-unsigned-char-at"><code class="docutils literal notranslate"><span class="pre">C-unsigned-char-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-unsigned-char-at-setter"><code class="docutils literal notranslate"><span class="pre">C-unsigned-char-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-unsigned-short-at"><code class="docutils literal notranslate"><span class="pre">C-unsigned-short-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-unsigned-short-at-setter"><code class="docutils literal notranslate"><span class="pre">C-unsigned-short-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-signed-short-at"><code class="docutils literal notranslate"><span class="pre">C-signed-short-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-signed-short-at-setter"><code class="docutils literal notranslate"><span class="pre">C-signed-short-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-short-at"><code class="docutils literal notranslate"><span class="pre">C-short-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-short-at-setter"><code class="docutils literal notranslate"><span class="pre">C-short-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-unsigned-long-at"><code class="docutils literal notranslate"><span class="pre">C-unsigned-long-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-unsigned-long-at-setter"><code class="docutils literal notranslate"><span class="pre">C-unsigned-long-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-signed-int-at"><code class="docutils literal notranslate"><span class="pre">C-signed-int-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-signed-int-at-setter"><code class="docutils literal notranslate"><span class="pre">C-signed-int-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-int-at"><code class="docutils literal notranslate"><span class="pre">C-int-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-int-at-setter"><code class="docutils literal notranslate"><span class="pre">C-int-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-signed-long-at"><code class="docutils literal notranslate"><span class="pre">C-signed-long-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-signed-long-at-setter"><code class="docutils literal notranslate"><span class="pre">C-signed-long-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-long-at"><code class="docutils literal notranslate"><span class="pre">C-long-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-long-at-setter"><code class="docutils literal notranslate"><span class="pre">C-long-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-unsigned-int-at"><code class="docutils literal notranslate"><span class="pre">C-unsigned-int-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-unsigned-int-at-setter"><code class="docutils literal notranslate"><span class="pre">C-unsigned-int-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-double-at"><code class="docutils literal notranslate"><span class="pre">C-double-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-double-at-setter"><code class="docutils literal notranslate"><span class="pre">C-double-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-float-at"><code class="docutils literal notranslate"><span class="pre">C-float-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-float-at-setter"><code class="docutils literal notranslate"><span class="pre">C-float-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-pointer-at"><code class="docutils literal notranslate"><span class="pre">C-pointer-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-pointer-at-setter"><code class="docutils literal notranslate"><span class="pre">C-pointer-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-size-t-at"><code class="docutils literal notranslate"><span class="pre">C-size-t-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-size-t-at-setter"><code class="docutils literal notranslate"><span class="pre">C-size-t-at-setter</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-ssize-t-at"><code class="docutils literal notranslate"><span class="pre">C-ssize-t-at</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:c-ssize-t-at-setter"><code class="docutils literal notranslate"><span class="pre">C-ssize-t-at-setter</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#structure-types">Structure types</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-struct]"><code class="docutils literal notranslate"><span class="pre">&lt;C-struct&gt;</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#union-types">Union types</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-union]"><code class="docutils literal notranslate"><span class="pre">&lt;C-union&gt;</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#notes-on-c-type-macros">Notes on C type macros</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defining-types">Defining types</a><ul>
<li><a class="reference internal" href="#defining-specialized-versions-of-designator-classes">Defining specialized versions of designator classes</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-subtype"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-subtype</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#defining-specialized-designator-classes">Defining specialized designator classes</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-mapped-subtype"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-mapped-subtype</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#describing-structure-types">Describing structure types</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-struct"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-struct</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#describing-union-types">Describing union types</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-union"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-union</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#functions">Functions</a><ul>
<li><a class="reference internal" href="#function-types">Function types</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-function-pointer]"><code class="docutils literal notranslate"><span class="pre">&lt;C-function-pointer&gt;</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#describing-c-functions-to-dylan">Describing C functions to Dylan</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-function"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-function</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#describing-dylan-functions-for-use-by-c">Describing Dylan functions for use by C</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-callable-wrapper"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-callable-wrapper</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#objective-c">Objective C</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:defineobjc-selector"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">objc-selector</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#variables">Variables</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-variable"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-variable</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:definec-address"><code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">C-address</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#allocating-and-deallocating-c-storage">Allocating and deallocating C storage</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:make(subclass([c-pointer]))"><code class="docutils literal notranslate"><span class="pre">make(subclass(&lt;C-pointer&gt;))</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:destroy"><code class="docutils literal notranslate"><span class="pre">destroy</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:with-stack-structure"><code class="docutils literal notranslate"><span class="pre">with-stack-structure</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#utility-designator-classes">Utility designator classes</a><ul>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-boolean]"><code class="docutils literal notranslate"><span class="pre">&lt;C-boolean&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-string]"><code class="docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-character]"><code class="docutils literal notranslate"><span class="pre">&lt;C-character&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:with-c-string"><code class="docutils literal notranslate"><span class="pre">with-c-string</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:clear-memory!"><code class="docutils literal notranslate"><span class="pre">clear-memory!</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:copy-bytes!"><code class="docutils literal notranslate"><span class="pre">copy-bytes!</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:copy-into!"><code class="docutils literal notranslate"><span class="pre">copy-into!</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:equal-memory?"><code class="docutils literal notranslate"><span class="pre">equal-memory?</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:[c-dylan-object]"><code class="docutils literal notranslate"><span class="pre">&lt;C-Dylan-object&gt;</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:register-c-dylan-object"><code class="docutils literal notranslate"><span class="pre">register-C-Dylan-object</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:unregister-c-dylan-object"><code class="docutils literal notranslate"><span class="pre">unregister-C-Dylan-object</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:export-c-dylan-object"><code class="docutils literal notranslate"><span class="pre">export-C-Dylan-object</span></code></a></li>
<li><a class="reference internal" href="#c-ffi:c-ffi:import-c-dylan-object"><code class="docutils literal notranslate"><span class="pre">import-C-Dylan-object</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=b916904f"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=35a8b989"></script>
    </body>
</html>