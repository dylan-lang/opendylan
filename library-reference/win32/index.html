
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Win32 API Libraries &mdash; Dylan Library Reference</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/opendylan.org/css/opendylan-docs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Copyright" href="../copyright.html" />
    <link rel="prev" title="The t-lists Library" href="../t-lists/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Dylan Library Reference
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Extensions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language-extensions/index.html">Dylan Language Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lid.html">LID File Format</a></li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../c-ffi/index.html">The c-ffi Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collections/index.html">The collections Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coloring-stream/index.html">The coloring-stream Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common-dylan/index.html">The common-dylan Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dood/index.html">The DOOD library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dylan/index.html">The dylan Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/index.html">The io Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">The network Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../progress-stream/index.html">The progress-stream Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql/index.html">The sql Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system/index.html">The system Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../t-lists/index.html">The t-lists Library</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Win32 API Libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#supported-win32-libraries">Supported Win32 libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#content-and-organization-of-the-win32-api-libraries">Content and organization of the Win32 API libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#notes-on-the-translations">Notes on the translations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#naming-and-mapping-conventions">Naming and mapping conventions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-naming-conventions">Simple naming conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mapping-the-null-value">Mapping the null value</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mapping-c-types-onto-dylan-classes">Mapping C types onto Dylan classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-methods-from-windows-alias-functions">Creating methods from Windows alias functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mapping-c-structure-fields-onto-dylan-slot-names">Mapping C structure fields onto Dylan slot names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handling-return-of-multiple-values">Handling return of multiple values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#defining-callback-functions">Defining callback functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#error-messages">Error messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-dylan-conditions-in-a-win32-application">Handling Dylan conditions in a Win32 application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dealing-with-the-c-function-winmain">Dealing with the C function WinMain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#combining-bit-mask-constants">Combining bit mask constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-minor-details">Other minor details</a></li>
<li class="toctree-l2"><a class="reference internal" href="#index-of-win32-names-excluded-from-the-dylan-libraries">Index of Win32 names excluded from the Dylan libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#characters">Characters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a">A</a></li>
<li class="toctree-l3"><a class="reference internal" href="#b">B</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c">C</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d">D</a></li>
<li class="toctree-l3"><a class="reference internal" href="#e">E</a></li>
<li class="toctree-l3"><a class="reference internal" href="#f">F</a></li>
<li class="toctree-l3"><a class="reference internal" href="#g">G</a></li>
<li class="toctree-l3"><a class="reference internal" href="#h">H</a></li>
<li class="toctree-l3"><a class="reference internal" href="#l">L</a></li>
<li class="toctree-l3"><a class="reference internal" href="#m">M</a></li>
<li class="toctree-l3"><a class="reference internal" href="#n">N</a></li>
<li class="toctree-l3"><a class="reference internal" href="#o">O</a></li>
<li class="toctree-l3"><a class="reference internal" href="#p">P</a></li>
<li class="toctree-l3"><a class="reference internal" href="#r">R</a></li>
<li class="toctree-l3"><a class="reference internal" href="#s">S</a></li>
<li class="toctree-l3"><a class="reference internal" href="#u">U</a></li>
<li class="toctree-l3"><a class="reference internal" href="#v">V</a></li>
<li class="toctree-l3"><a class="reference internal" href="#w">W</a></li>
<li class="toctree-l3"><a class="reference internal" href="#y">Y</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">Copyright</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dylan Library Reference</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">The Win32 API Libraries</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/win32/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="the-win32-api-libraries">
<span id="index-0"></span><h1>The Win32 API Libraries<a class="headerlink" href="#the-win32-api-libraries" title="Permalink to this headline">¶</a></h1>
<p id="index-1">This document describes Open Dylan’s set of Win32 API interface
libraries. These libraries provide a low-level Dylan interface to the
Win32 API in Microsoft Windows.</p>
<p>Each Dylan library is a simple translation of Win32 API header files
into a set of interface declarations from Open Dylan’s C-FFI
library. So you can write Windows applications in Dylan by using the
same functions and types as you would in C, albeit with slightly
modified names so that they conform to Dylan naming conventions and
requirements.</p>
<p>The Open Dylan Win32 API has been constructed from several Dylan
libraries. Win32 functionality is divided among these libraries,
matching the contents of Microsoft’s DLLs, allowing Dylan applications
to avoid references to DLLs they do not need to use.</p>
<p>With the exception of changes necessitated by Dylan naming conventions
and requirements, the names of C items have been preserved.
Hence this document does not provide
an exhaustive list of the items available in the libraries. Instead, it
explains the name mapping scheme we used in the conversion, and provides
a collection of tips for writing Dylan applications with the libraries.
Finally, there is a list of items not supported in our versions of these
libraries.</p>
<div class="section" id="supported-win32-libraries">
<span id="index-2"></span><h2>Supported Win32 libraries<a class="headerlink" href="#supported-win32-libraries" title="Permalink to this headline">¶</a></h2>
<p>Each Dylan library representing a portion of the Win32 API has a single
module of the same name as the library itself. For example, the library
Win32-Common has a module also called Win32-Common. An exception to this
rule is Win32-User, which also exports the module Win32-Default-Handler.</p>
<p>The libraries are:</p>
<p>Win32-Common</p>
<ul class="simple">
<li><p>Data types, constants (including error codes), and structure
accessors that are shared by the other modules.</p></li>
<li><p>Most of these come from the Win32 header files <em>WINDEF.H</em>, <em>WINNT.H</em>,
and <em>WINERROR.H</em>. (There is no DLL file supplied as standard with
Windows that corresponds with this library, because there are no C
functions in the header files to which it forms an interface.)</p></li>
<li><p>Win32-Kernel Non-GUI system services, as implemented in
<em>KERNEL32.DLL</em> and declared in <em>WINBASE.H</em> (files, pipes, semaphores,
atoms, time, and so on) and <em>WINNLS.H</em> (National Language Support).</p></li>
<li><p><em>Note:</em> This library does not provide thread support. Thread support
is being handled at a higher level by Dylan’s own Threads library.
See the <em>Core Features</em> manual for details.</p></li>
<li><p>Win32-GDI Graphics Device Interface, drawing graphics and text, and
printing. Corresponds to <em>WINGDI.H</em> and <em>GDI32.DLL</em>.</p></li>
<li><p>Win32-User Other windowing functions. Corresponds to <em>WINUSER.H</em> and
<em>USER32.DLL</em>. Also contains <a class="reference internal" href="#win32-user:win32-user:win32-last-handler"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">win32-last-handler</span></code></a> which can handle
conditions and display them to the application user a simply Win32
dialog. That function is exported from the module
Win32-Default-Handler.</p></li>
<li><p>Win32-Version Version management. Corresponds to <em>WINVER.H</em> and
<em>VERSION.DLL</em>.</p></li>
<li><p>Win32-Dialog Common dialog boxes, as implemented in <em>COMDLG32.DLL</em>
and declared in <em>COMMDLG.H</em>, <em>DLGS.H</em>, and <em>CDERR.H</em>.</p></li>
</ul>
<p>Win32-Controls</p>
<ul class="simple">
<li><p>“Common controls”, including list view, tree view, property sheets,
and so on (<em>COMMCTRL.H</em> and <em>COMCTL32.DLL</em>).</p></li>
</ul>
<p>Win32-Registry</p>
<ul class="simple">
<li><p>Registry (<em>WINREG.H</em> and <em>ADVAPI32.DLL</em>).</p></li>
</ul>
<p>Win32-Rich-Edit</p>
<ul class="simple">
<li><p>“Rich edit” controls (<em>RICHEDIT.H</em> and <em>RICHED32.DLL</em>).</p></li>
<li><p>Win32-DDE Dynamic Data Exchange (<em>DDE.H</em> and <em>DDEML.H</em>).</p></li>
<li><p>Win32-Shell API for querying and extending the Windows Shell.
Corresponds to <em>SHELLAPI.H</em> and <em>SHELL32.DLL</em>.</p></li>
<li><p>Winsock2 Corresponds to <em>WINSOCK2.H</em>, <em>QOS.H</em>, and <em>MSWSOCK.H</em>.</p></li>
</ul>
</div>
<div class="section" id="content-and-organization-of-the-win32-api-libraries">
<span id="index-3"></span><h2>Content and organization of the Win32 API libraries<a class="headerlink" href="#content-and-organization-of-the-win32-api-libraries" title="Permalink to this headline">¶</a></h2>
<p>The Open Dylan Win32 API libraries are modeled closely upon
Microsoft’s Win32 C libraries. Most names available in the Dylan
libraries are the same as those available in the C libraries, though of
course to conform to Dylan naming conventions and restrictions, many of
the C names have been translated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Look at the <em>library.dylan</em> file in each library to see what
each library provides. (Look in <em>comlib.dylan</em> for Win32-Common.) The
libraries generally include only features that apply to both Windows NT
and Windows 95/98.</p>
<p>If there is an additional area of Win32 you would like to see these
libraries support, please inform the Open Dylan support team.</p>
</div>
<div class="section" id="notes-on-the-translations">
<span id="index-4"></span><h3>Notes on the translations<a class="headerlink" href="#notes-on-the-translations" title="Permalink to this headline">¶</a></h3>
<p>The Win32-Common module re-exports some names from the C-FFI module that
its user may need to use directly, without needing to use (or know
about) the C-FFI module itself. These names are: <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:null-pointer"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">null-pointer</span></code></a>,
<a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:null-pointer?"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">null-pointer?</span></code></a>, <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:pointer-address"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">pointer-address</span></code></a>, <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">pointer-value</span></code></a>,
<a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">pointer-value</span></code></a>, <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:pointer-cast"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">pointer-cast</span></code></a>, <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:[c-string]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code></a>,
<code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;C-unicode-string&gt;</span></code>, <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:destroy"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">destroy</span></code></a>, and <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:with-stack-structure"><code class="xref dylan dylan-macro docutils literal notranslate"><span class="pre">with-stack-structure</span></code></a>.</p>
<p>Names that are documented as being obsolete and/or included in Win32
only for compatibility with Win16, are generally not defined in the
Dylan libraries. The names excluded are listed in <a class="reference internal" href="#index-of-win32-names-excluded-from-the-dylan-libraries">Index of Win32
names excluded from the Dylan libraries</a>.</p>
<p>The extended API macros, defined in the optional C header file
<em>WINDOWSX.H</em>, are not supported.</p>
</div>
</div>
<div class="section" id="naming-and-mapping-conventions">
<span id="index-5"></span><h2>Naming and mapping conventions<a class="headerlink" href="#naming-and-mapping-conventions" title="Permalink to this headline">¶</a></h2>
<p>A Dylan application using the Win32 API will generally use the same API
names as a C program would, with the following modifications for
consistency with Dylan conventions.</p>
<div class="section" id="simple-naming-conventions">
<span id="index-6"></span><h3>Simple naming conventions<a class="headerlink" href="#simple-naming-conventions" title="Permalink to this headline">¶</a></h3>
<p>Type names are enclosed in angle brackets. For example, <em>HANDLE</em> becomes
<code class="docutils literal notranslate"><span class="pre">&lt;HANDLE&gt;</span></code>.</p>
<p>Names of constants are prefixed by <em>$</em>. For example, <em>OPAQUE</em> becomes
<em>$OPAQUE</em>.</p>
<p>Underscores are replaced by hyphens. Thus, a constant called <em>NO_ERROR</em>
becomes <em>$NO-ERROR</em> and a class called <em>LIST_ENTRY</em> becomes
<code class="docutils literal notranslate"><span class="pre">&lt;LIST-ENTRY&gt;</span></code>.</p>
<p>Hyphens will <em>not</em> be inserted between capitalized words (for example,
<code class="docutils literal notranslate"><span class="pre">CreateWindow</span></code> does not become <code class="docutils literal notranslate"><span class="pre">Create-Window</span></code>) since that is a less
obvious mapping that is more likely to cause confusion when switching
between Dylan code and Windows documentation.</p>
</div>
<div class="section" id="mapping-the-null-value">
<span id="index-7"></span><h3>Mapping the null value<a class="headerlink" href="#mapping-the-null-value" title="Permalink to this headline">¶</a></h3>
<p>In place of <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, there are several constants providing null values
for frequently used types, such as <code class="docutils literal notranslate"><span class="pre">$NULL-HANDLE</span></code>, <code class="docutils literal notranslate"><span class="pre">NULL-RECT</span></code>, and
<code class="docutils literal notranslate"><span class="pre">$NULL-STRING</span></code>. Null values for other pointer types may be designated
by the expression <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:null-pointer"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">null-pointer(&lt;FOO&gt;)</span></code></a>. Use the function
<a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:null-pointer?"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">null-pointer?</span></code></a> to test whether a value is null. Do not use the
expression <code class="docutils literal notranslate"><span class="pre">if(ptr)...</span></code> as is often done in C, since a null pointer is
not the same as <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a>. There are also functions <code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">null-handle</span></code> and
<code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">null-handle?</span></code> for creating and testing handles, since conceptually they
are not necessarily pointers.</p>
</div>
<div class="section" id="mapping-c-types-onto-dylan-classes">
<span id="index-8"></span><h3>Mapping C types onto Dylan classes<a class="headerlink" href="#mapping-c-types-onto-dylan-classes" title="Permalink to this headline">¶</a></h3>
<p>The multitude of integer data types in C code (<code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">long</span></code>,
<code class="docutils literal notranslate"><span class="pre">unsigned</span></code>, <code class="docutils literal notranslate"><span class="pre">ULONG</span></code>, <code class="docutils literal notranslate"><span class="pre">DWORD</span></code>, <code class="docutils literal notranslate"><span class="pre">LRESULT</span></code>, and so on) are all
designated as <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> (or some appropriate subrange thereof) in
Dylan method argument types. However, a <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a> needs to be
used to represent values that do not fit in the signed 30-bit
representation of an integer.</p>
<p>Names such as <code class="docutils literal notranslate"><span class="pre">&lt;DWORD&gt;</span></code> should not be used in application code because
they refer to the FFI designation of the C value representation, not to
a Dylan data type.</p>
<p>The C types <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> and <code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code> are both mapped to <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a> in
Dylan. Use <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#true"><code class="xref drm docutils literal notranslate"><span class="pre">#t</span></code></a> and <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> instead of <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> and <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Beware that some functions, such as <em>TranslateAccelerator</em>,
though documented to return <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, actually return <code class="docutils literal notranslate"><span class="pre">int</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> ; in such a case, you will have to compare the result
to 0.</p>
<p>Similarly, watch out for cases where C code passes <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> as
an integer argument. To handle one common case, the Dylan implementation
of <em>MAKELPARAM</em> accepts either an <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> or <a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a> as the
first argument.</p>
</div>
<p>The C types <code class="docutils literal notranslate"><span class="pre">CHAR</span></code>, <code class="docutils literal notranslate"><span class="pre">WCHAR</span></code>, and <code class="docutils literal notranslate"><span class="pre">TCHAR</span></code> are all mapped to
<a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#character"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;character&gt;</span></code></a> in Dylan. However, <code class="docutils literal notranslate"><span class="pre">UCHAR</span></code> is mapped to <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>
since that is how it is actually used.</p>
<p>Most of the pointer types in the Windows API have several names; for
example: <em>PRECT</em>, <em>NPRECT</em>, and <em>LPRECT</em>. In 16-bit code, these
distinguished between “near” and “far” pointers, but in 32-bit code
there is no difference. Rather than carry the duplicate names over into
Dylan, it would be simpler to use only the basic <em>P…</em> prefix names.
However, the <em>LP…</em> names seem to be used much more often, and hence
may be more familiar, and the Microsoft documentation still tends to use
the <em>LP…</em> names in most places. So the Dylan interface defines both
the <em>&lt;P…&gt;</em> and <em>&lt;LP…&gt;</em> names even though they have identical values.
The <em>NP…</em> names are not defined in Dylan since they are not as
commonly used.</p>
<p>Values of type <code class="docutils literal notranslate"><span class="pre">char*</span></code> in C are represented as instances of class
<code class="docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code> in Dylan. This is a subclass of <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code></a>, so all of the
normal string operations can be used directly. C function parameters of
type <em>char*</em> will also accept an instance of <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a> ; a C
pointer is created to point to the characters of the Dylan data, so the
string does not need to be copied. (Dylan byte strings maintain a NUL
character at the end in order to allow them to be used directly by C.)</p>
<p>in the current implementation, that involves automatically copying the
string at run time, but the need for copying is intended to be removed
later.</p>
<p>The <em>TEXT</em> function can also be used to coerce a string literal to a
<code class="docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code>. This usage is consistent with the Win32 <em>TEXT</em> macro,
although the current purpose is different.</p>
<p>The Dylan declarations for C types will generally follow the <em>strict</em>
alternative versions of the C declarations. This means, for example,
that the various handle types such as <code class="docutils literal notranslate"><span class="pre">&lt;hmenu&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;hwnd&gt;</span></code> are
disjoint subclasses of <code class="docutils literal notranslate"><span class="pre">&lt;handle&gt;</span></code>, instead of all being equivalent.</p>
</div>
<div class="section" id="creating-methods-from-windows-alias-functions">
<span id="index-9"></span><h3>Creating methods from Windows alias functions<a class="headerlink" href="#creating-methods-from-windows-alias-functions" title="Permalink to this headline">¶</a></h3>
<p>Consider a Windows function called <em>Foo</em> which is an alias for either
<em>FooA</em> (an 8-bit character version) or <em>FooW</em> (a 16-bit character
version). In Dylan, only the name <em>Foo</em> will be defined, but it will be
a generic function with separate methods for arguments of types
<code class="docutils literal notranslate"><span class="pre">&lt;C-string&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;C-unicode-string&gt;</span></code>, <a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#byte-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;byte-string&gt;</span></code></a> or
<a class="reference external" href="https://opendylan.org/books/drm/Collection_Classes#unicode-string"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;unicode-string&gt;</span></code></a>. (Only the 8-bit versions will be supported in the
initial implementation, both because the compiler is not ready to handle
Unicode and because it will not work on Windows 95.)</p>
</div>
<div class="section" id="mapping-c-structure-fields-onto-dylan-slot-names">
<span id="index-10"></span><h3>Mapping C structure fields onto Dylan slot names<a class="headerlink" href="#mapping-c-structure-fields-onto-dylan-slot-names" title="Permalink to this headline">¶</a></h3>
<p>Because slot names are not in a separate name space in Dylan, the names
of C structure fields will have the suffix <em>-value</em> added to form the
name of the Dylan accessor function. For example, the C statement:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">pt</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</pre></div>
</div>
<p>becomes in Dylan:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">pt</span><span class="p">.</span><span class="n">x-value</span> <span class="o">:=</span> <span class="n">x</span><span class="p">;</span>
</pre></div>
</div>
<p>There is not any attempt to append <em>?</em> to the names of predicate
functions since it is not obvious exactly which functions that should
apply to. The Dylan convention of <em>*…*</em> for global variables is not
relevant since there are no global variables involved.</p>
</div>
<div class="section" id="handling-return-of-multiple-values">
<span id="index-11"></span><h3>Handling return of multiple values<a class="headerlink" href="#handling-return-of-multiple-values" title="Permalink to this headline">¶</a></h3>
<p>In cases where the C library function takes a pointer argument as a
place to store a pointer, integer, or boolean value, the corresponding
Dylan function uses multiple return values to return such output
parameters following the original function return value. For example,
where C code does:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">BOOL</span> <span class="n">ok</span><span class="p">;</span>
<span class="n">DWORD</span> <span class="n">NumberRead</span><span class="p">;</span>

<span class="n">ok</span> <span class="o">=</span> <span class="n">ReadConsoleInput</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="o">&amp;</span> <span class="n">NumberRead</span><span class="p">);</span>
</pre></div>
</div>
<p>in Dylan it would be:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="p">(</span> <span class="n">ok</span> <span class="p">::</span> <span class="nc">&lt;boolean&gt;</span><span class="p">,</span> <span class="n">NumberRead</span> <span class="p">::</span> <span class="nc">&lt;integer&gt;</span> <span class="p">)</span> <span class="o">=</span>
  <span class="n">ReadConsoleInput</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
</pre></div>
</div>
<p>Similarly, this function returns multiple values instead of a structure:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span> <span class="o">=</span> <span class="n">GetLargestConsoleWindowSize</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="defining-callback-functions">
<span id="index-12"></span><h2>Defining callback functions<a class="headerlink" href="#defining-callback-functions" title="Permalink to this headline">¶</a></h2>
<p>The Win32-common library provides a <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">callback</span></code> macro to make it
easy to define callback functions without the application programmer
needing to use the FFI <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">c-callable-wrapper</span></code> macro directly. It is
used like this:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="n">callback</span> <span class="n">WndProc</span> <span class="p">::</span> <span class="nc">&lt;WNDPROC&gt;</span> <span class="o">=</span> <span class="n">my-window-function</span><span class="p">;</span>
</pre></div>
</div>
<p>This says that <code class="docutils literal notranslate"><span class="pre">WndProc</span></code> is being defined as a C function pointer of
type <code class="docutils literal notranslate"><span class="pre">&lt;WNDPROC&gt;</span></code>, which when called from C causes the Dylan function
<code class="docutils literal notranslate"><span class="pre">my-window-function</span></code> to be run. The Dylan function will be defined
normally using <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">method</span></code> or <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">function</span></code>, and it is the
responsibility of the programmer to ensure that its argument signature
is consistent with what <code class="docutils literal notranslate"><span class="pre">&lt;WNDPROC&gt;</span></code> requires. For example:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">my-window-function</span><span class="p">(</span>
  <span class="n">hWnd</span> <span class="p">::</span> <span class="nc">&lt;HWND&gt;</span><span class="p">,</span> <span class="c1">// window handle</span>
  <span class="n">message</span> <span class="p">::</span> <span class="nc">&lt;integer&gt;</span><span class="p">,</span> <span class="c1">// type of message</span>
  <span class="n">uParam</span><span class="p">,</span> <span class="c1">// additional information</span>
  <span class="n">lParam</span><span class="p">)</span> <span class="c1">// additional information</span>
<span class="p">=&gt;</span> <span class="n">return</span> <span class="p">::</span> <span class="nc">&lt;integer&gt;</span><span class="p">;</span>
  <span class="p">...</span>
</pre></div>
</div>
<p>Note that the <em>uParam</em> and <em>lParam</em> arguments might receive values of
either type <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> or <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>, so it may be best not to
specialize them. Often these values are not used directly anyway, but
are passed to other functions (such as <em>LOWORD</em> and <em>HIWORD</em>) which
have methods for handling either representation.</p>
<p>The other types of function supported by <code class="docutils literal notranslate"><span class="pre">define</span> <span class="pre">callback</span></code> are dialog
functions (<code class="docutils literal notranslate"><span class="pre">&lt;DLGPROC&gt;</span></code>) and dialog hooks (<em>&lt;LP…HOOKPROC&gt;</em>), both of
which have the same argument types as a window function, but return a
<a class="reference external" href="https://opendylan.org/books/drm/Simple_Object_Classes#boolean"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;boolean&gt;</span></code></a>. (The dialog hook functions are actually declared in
<em>COMMDLG.H</em> as returning a <em>UINT</em>, but the value is always supposed to
be <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, so the Dylan callback interface has been
implemented using <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> instead.)</p>
</div>
<div class="section" id="error-messages">
<span id="index-13"></span><h2>Error messages<a class="headerlink" href="#error-messages" title="Permalink to this headline">¶</a></h2>
<p>The Win32-Kernel library provides the following utility functions.</p>
<span class="target" id="index-14"></span><dl class="function">
<dt class="dylan-api" id="win32-kernel:win32-kernel:win32-error-message">
<code class="sig-name descname">win32-error-message</code> <em class="property">Function</em><a class="headerlink" href="#win32-kernel:win32-kernel:win32-error-message" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list">
<dt class="field-odd">Signature</dt>
<dd class="field-odd"><p>win32-error-message <em>error-code</em> =&gt; <em>message</em></p>
</dd>
<dt class="field-even">Discussion</dt>
<dd class="field-even"><p><p>The <em>error-code</em> is an instance of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> or <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a> (type
unioned).</p>
<span class="target" id="index-15"></span><p>The <em>error-code</em> argument is either a Windows a Windows error code
(such as returned by <code class="docutils literal notranslate"><span class="pre">GetLastError</span></code>) or an <code class="docutils literal notranslate"><span class="pre">SCODE</span></code> (also known
as an <code class="docutils literal notranslate"><span class="pre">HRESULT</span></code>) value (such as returned by most OLE/COM
functions).</p>
<p>The function returns a text message (in a string) corresponding to
the error code, <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> if the code is not recognized. The returned
string might have more than one line but does not have a newline at
the end.</p>
</p>
</dd>
<dt class="field-odd">Example</dt>
<dd class="field-odd"><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">win32-error-message</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="s">&quot;Access is denied.&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt class="dylan-api" id="win32-kernel:win32-kernel:report-win32-error">
<code class="sig-name descname">report-win32-error</code> <em class="property">Function</em><a class="headerlink" href="#win32-kernel:win32-kernel:report-win32-error" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature</dt>
<dd class="field-odd"><p>report-win32-error <em>name</em> #key <em>error</em></p>
</dd>
<dt class="field-even">Discussion</dt>
<dd class="field-even"><p>Signals a Dylan error if the Win 32 error code specified is not
<code class="docutils literal notranslate"><span class="pre">NO_ERROR</span></code>. If no code is specified, the value returned by the
Win32 API <code class="docutils literal notranslate"><span class="pre">GetLastError</span></code> is used. The error that is signaled
includes both the error code and the error message, as computed by
the function <a class="reference internal" href="#win32-kernel:win32-kernel:win32-error-message"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">win32-error-message</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt class="dylan-api" id="win32-kernel:win32-kernel:check-win32-result">
<code class="sig-name descname">check-win32-result</code> <em class="property">Function</em><a class="headerlink" href="#win32-kernel:win32-kernel:check-win32-result" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list">
<dt class="field-odd">Signature</dt>
<dd class="field-odd"><p>check-win32-result <em>name</em> <em>result</em></p>
</dd>
<dt class="field-even">Discussion</dt>
<dd class="field-even"><p>Many Windows functions return <a class="reference external" href="https://opendylan.org/books/drm/Other_Built-In_Objects_Defined#false"><code class="xref drm docutils literal notranslate"><span class="pre">#f</span></code></a> or <code class="docutils literal notranslate"><span class="pre">NULL</span></code> to mean failure.
The function <code class="docutils literal notranslate"><span class="pre">check-win32-result</span></code> checks the result to see if it
indicates failure, and if so it calls <a class="reference internal" href="#win32-kernel:win32-kernel:report-win32-error"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">report-win32-error</span></code></a>.</p>
</dd>
<dt class="field-odd">Example</dt>
<dd class="field-odd"><div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">check-win32-result</span><span class="p">(</span><span class="s">&quot;SetWindowText&quot;</span><span class="p">,</span> <span class="n">SetWindowText</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt class="dylan-api" id="win32-kernel:win32-kernel:ensure-no-win32-error">
<code class="sig-name descname">ensure-no-win32-error</code> <em class="property">Function</em><a class="headerlink" href="#win32-kernel:win32-kernel:ensure-no-win32-error" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Signature</dt>
<dd class="field-odd"><p>ensure-no-win32-error <em>name</em></p>
</dd>
<dt class="field-even">Discussion</dt>
<dd class="field-even"><p>Ensures that the Win32 API <code class="docutils literal notranslate"><span class="pre">GetLastError</span></code> does not indicate that
an error occurred. If an occurs, it is signaled using
<a class="reference internal" href="#win32-kernel:win32-kernel:report-win32-error"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">report-win32-error</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="handling-dylan-conditions-in-a-win32-application">
<h2>Handling Dylan conditions in a Win32 application<a class="headerlink" href="#handling-dylan-conditions-in-a-win32-application" title="Permalink to this headline">¶</a></h2>
<p>The Win32-User library exports from its Win32-Default-Handler module a
handler utility function called <a class="reference internal" href="#win32-user:win32-user:win32-last-handler"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">win32-last-handler</span></code></a>, defined on
objects of class <a class="reference external" href="https://opendylan.org/books/drm/Condition_Classes#serious-condition"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;serious-condition&gt;</span></code></a>.</p>
<dl class="function">
<dt class="dylan-api" id="win32-user:win32-user:win32-last-handler">
<code class="sig-name descname">win32-last-handler</code> <em class="property">Function</em><a class="headerlink" href="#win32-user:win32-user:win32-last-handler" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Discussion</dt>
<dd class="field-odd"><p><p>Displays a rudimentary Win32 dialog to allow the user to decide
what to do with the Dylan condition that has been signalled.</p>
<p>It is a handler utility function that can be by bound dynamically
around a computation via <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">handler</span></code> or installed globally via
<code class="docutils literal notranslate"><span class="pre">last-handler-definer</span></code>. It is automatically installed as the last
handler simply by using the Win32-User library.</p>
<p>The function has the following call syntax:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">win32-last-handler</span> <span class="p">(</span><span class="n">serious-condition</span><span class="p">,</span> <span class="n">next-handler</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>serious-condition</em> argument is an object of class serious
condition. The <em>next-handler</em> argument is a function. The
<em>win32-last-handler</em> function returns no values.</p>
<p>The following form defines a dynamic handler around some body:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="nb">handler</span> <span class="nc">&lt;serious-condition&gt;</span> <span class="o">=</span> <span class="n">win32-last-handler</span><span class="p">;</span>
</pre></div>
</div>
<p>while the following form installs a globally visible last-handler:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="n">last-handler</span> <span class="nc">&lt;serious-condition&gt;</span> <span class="o">=</span> <span class="n">win32-last-handler</span><span class="p">;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">seealso</dt>
<dd class="field-odd"><p><em>last-handler-definer</em> and <em>default-last-handler</em>, exported
from the Functional Dylan-Extensions library and module, in the
<em>Core Features</em> reference manual.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="dealing-with-the-c-function-winmain">
<span id="index-16"></span><h2>Dealing with the C function WinMain<a class="headerlink" href="#dealing-with-the-c-function-winmain" title="Permalink to this headline">¶</a></h2>
<p>In C, the programmer has to supply a <em>WinMain</em> function as the main
program for a GUI application, but in Dylan there is no main program as
such. The beginning of execution is indicated simply by a top-level
function call expression; this needs to be at the bottom of the last
file listed in the project file. The Win32-Kernel and Win32-User
libraries export functions to obtain the values which would have been
the arguments to <em>WinMain</em>:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">application-instance-handle</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="nc">&lt;HINSTANCE&gt;</span>
<span class="n">application-command-line</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="nc">&lt;string&gt;</span>
<span class="c1">// arguments without program name</span>
<span class="n">application-show-window</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="nc">&lt;integer&gt;</span> <span class="c1">// one of $SW-...</span>
</pre></div>
</div>
<p>There is no accessor provided for the <em>WinMain</em> previous instance
parameter because on Win32, that parameter is always null, even for
Win32s as well as NT and Windows 95.</p>
<p>The program can be terminated, with an exit code, by calling either the
Win32 <code class="docutils literal notranslate"><span class="pre">ExitProcess</span></code> function or the <code class="docutils literal notranslate"><span class="pre">exit-application</span></code> function in
Open Dylan’s System library. The latter method is preferred if the
application might actually be run as part of another process.</p>
<p>The start of an application program might look something like this:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">my-main</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">hInstance</span> <span class="p">::</span> <span class="nc">&lt;HINSTANCE&gt;</span> <span class="o">=</span> <span class="n">application-instance-handle</span><span class="p">();</span>
  <span class="k">let</span> <span class="n">wc</span> <span class="p">::</span> <span class="nc">&lt;PWNDCLASS&gt;</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;PWNDCLASS&gt;</span><span class="p">);</span>
  <span class="n">wc</span><span class="p">.</span><span class="n">style-value</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">wc</span><span class="p">.</span><span class="n">lpfnWndProc-value</span> <span class="o">:=</span> <span class="n">MainWndProc</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="n">RegisterClass</span><span class="p">(</span><span class="n">wc</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">hWnd</span> <span class="o">=</span> <span class="n">CreateWindow</span><span class="p">(</span> <span class="p">...</span> <span class="p">);</span>
  <span class="n">ShowWindow</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">application-show-window</span><span class="p">());</span>
  <span class="n">UpdateWindow</span><span class="p">(</span><span class="n">hWnd</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">msg</span> <span class="p">::</span> <span class="nc">&lt;PMSG&gt;</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;PMSG&gt;</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span> <span class="n">GetMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="no">$NULL-HWND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">TranslateMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">DispatchMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="n">ExitProcess</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">wParam-value</span><span class="p">);</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">my-main</span><span class="p">;</span>

<span class="n">my-main</span><span class="p">();</span> <span class="c1">// this is what initiates execution.</span>
</pre></div>
</div>
<p>For a complete example program, see</p>
<blockquote>
<div><p>Examples\Win32\windows-ffi-example\example.dylan</p>
</div></blockquote>
<p>in the Open Dylan installation directory.</p>
</div>
<div class="section" id="combining-bit-mask-constants">
<span id="index-17"></span><h2>Combining bit mask constants<a class="headerlink" href="#combining-bit-mask-constants" title="Permalink to this headline">¶</a></h2>
<p>Where C code would use the <em>|</em> operator to combine bit mask constants,
Dylan code usually uses the <em>logior</em> function. However, a few such
constants have values of type <a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a> when they will not fit in
a small integer, and <em>logior</em> only works on instances of <a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a>.
Because of this, the <em>win32-common</em> library exports a <em>%logior</em> function
which is used like <em>logior</em> except that it accepts values of either type
<a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> or <code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code> and returns a <code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code> result.
It can be used in most places that accept a bit mask (C types <em>DWORD</em>,
<em>ULONG</em>, <em>LPARAM</em>, and so on), but must be used if any of the
arguments are a <code class="docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code>. The contexts where this is likely to
occur are:</p>
<ul class="simple">
<li><p>Window style parameter of <em>CreateWindow ($WS-…)</em></p></li>
<li><p>Flags value for <em>CreateFile</em> or <em>CreateNamedPipe</em> <em>($FILE-FLAG-…)</em></p></li>
<li><p><em>$LOCALE-NOUSEROVERRIDE</em> for <em>LCTYPE</em> parameters for <em>GetLocaleInfoA</em>,
<em>GetLocaleInfo</em>, and possibly others, or <em>dwFlags</em> parameter of
<em>GetTimeFormat</em>, <em>GetNumberFormat</em>, <em>GetCurrencyFormat</em>, or
<em>GetDateFormat</em>.</p></li>
<li><p>Mask and effects values in <em>CHARFORMAT</em> structure for “rich edit”
controls <em>($CFM-…</em> and <em>$CFE-…)</em></p></li>
<li><p>Mask value in <em>PARAFORMAT</em> structure for “rich edit” controls
<em>($PFM-…)</em></p></li>
</ul>
</div>
<div class="section" id="other-minor-details">
<span id="index-18"></span><h2>Other minor details<a class="headerlink" href="#other-minor-details" title="Permalink to this headline">¶</a></h2>
<p>The types <code class="docutils literal notranslate"><span class="pre">&lt;FARPROC&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;PROC&gt;</span></code> are defined as equivalent to
<code class="docutils literal notranslate"><span class="pre">&lt;C-function-pointer&gt;</span></code>, so any C function wrapper object can be passed
to a routine taking a <code class="docutils literal notranslate"><span class="pre">&lt;FARPROC&gt;</span></code> without needing to do any type
conversion like that needed in C.</p>
<p>Type casts between handles and integers (<a class="reference external" href="https://opendylan.org/books/drm/Number_Classes#integer"><code class="xref drm docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code></a> or
<a class="reference internal" href="../common-dylan/machine-words.html#common-dylan:machine-words:[machine-word]"><code class="xref dylan dylan-class docutils literal notranslate"><span class="pre">&lt;machine-word&gt;</span></code></a>) can be done by using <code class="docutils literal notranslate"><span class="pre">as</span></code>. For example:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">window-class</span><span class="p">.</span><span class="n">hbrBackground-value</span> <span class="o">:=</span>
  <span class="nb">as</span><span class="p">(</span><span class="nc">&lt;HBRUSH&gt;</span><span class="p">,</span> <span class="no">$COLOR-WINDOW</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that pointers and handles must be compared using <em>=</em>, not <em>==</em>,
in order to compare the C address instead of the Dylan wrapper objects.</p>
<p>For type casts from one pointer type to another, use the function
<a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:pointer-cast"><code class="xref dylan dylan-func docutils literal notranslate"><span class="pre">pointer-cast</span></code></a> instead of <code class="docutils literal notranslate"><span class="pre">as</span></code>. Think of <code class="docutils literal notranslate"><span class="pre">as</span></code> as converting
the data structure pointed to, while <code class="docutils literal notranslate"><span class="pre">pointer-cast</span></code> operates on just
the pointer itself.</p>
<p>The Dylan function <a class="reference internal" href="../c-ffi/index.html#c-ffi:c-ffi:pointer-value"><code class="xref dylan dylan-gf docutils literal notranslate"><span class="pre">pointer-value</span></code></a> can be used to convert between a
Dylan integer and a <em>LARGE-INTEGER</em> or <em>ULARGE-INTEGER</em>. For example:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">li</span> <span class="p">::</span> <span class="nb">make</span><span class="p">(</span> <span class="nc">&lt;PLARGE-INTEGER&gt;</span> <span class="p">);</span> <span class="n">pointer-value</span><span class="p">(</span><span class="n">li</span><span class="p">)</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>allocates a <em>LARGE-INTEGER</em> and sets its value to 0, without needing to
be concerned with the individual fields of the internal representation.
Alternatively, you can use an initialization keyword:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">li</span> <span class="p">::</span> <span class="nb">make</span><span class="p">(</span> <span class="nc">&lt;PLARGE-INTEGER&gt;</span><span class="p">,</span> <span class="k">value:</span> <span class="mi">0</span> <span class="p">);</span>
</pre></div>
</div>
<p>The C macros <em>MAKEPOINT</em>, <em>MAKEPOINTS</em>, and <em>LONG2POINT</em> do not easily
translate to Dylan. Instead, use the Dylan function <em>lparam-to-xy</em> to
split a parameter into two signed numbers. For example:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span> <span class="o">=</span> <span class="n">LPARAM-TO-XY</span><span class="p">(</span><span class="n">lParam</span><span class="p">);</span>
</pre></div>
</div>
<p>In Dylan, <code class="docutils literal notranslate"><span class="pre">&lt;RECTL&gt;</span></code> is an alias of <code class="docutils literal notranslate"><span class="pre">&lt;RECT&gt;</span></code> instead of being a distinct
type. (In Win32, they are structurally equivalent but were separate
types for the sake of source code compatibility with Win16; there is no
need to maintain that artificial distinction in Dylan.)</p>
<p>Windows resource files (<em>.rc</em> files) can be included by using the LID
file field <em>RC-Files:</em>.</p>
</div>
<div class="section" id="index-of-win32-names-excluded-from-the-dylan-libraries">
<span id="index-19"></span><h2>Index of Win32 names excluded from the Dylan libraries<a class="headerlink" href="#index-of-win32-names-excluded-from-the-dylan-libraries" title="Permalink to this headline">¶</a></h2>
<p>The names listed in the index below are excluded from the Open Dylan
Win32 API libraries because they are obsolete.</p>
<p>Functions for old-style metafiles (<em>CreateMetaFile</em>, <em>CloseMetaFile</em>,
and so on) are described in the Win32 API as being obsolete, but they
are being supported because they are needed for OLE applications to
exchange data with 16-bit applications.</p>
<p>Functions <em>wsprintf</em> and <em>wvsprintf</em> are not supported because the Dylan
function <em>format-to-string</em> serves the same purpose. Also, the FFI
doesn’t currently support C functions with a variable number of
arguments.</p>
<p>The extended API macros defined in optional C header file <em>windowsx.h</em>
will not be supported by the Dylan interface.</p>
<p>The 64-bit utility macros <em>Int32x32To64</em>, <em>Int64ShllMod32</em>,
<em>Int64ShraMod32</em>, <em>Int64ShrlMod32</em>, and <em>UInt32x32To64</em> are not
planned to be supported since there is no clear need for them and the
functionality can be obtained by using Dylan extended integers. However,
an interface to function <em>MulDiv</em> is provided, since it is an ordinary C
function that is commonly used.</p>
<div class="section" id="characters">
<span id="index-20"></span><h3>Characters<a class="headerlink" href="#characters" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>_hread, _hwrite, _lclose, _lcreat, _llseek, _lopen, _lread,
_lwrite</p>
</div></blockquote>
</div>
<div class="section" id="a">
<h3>A<a class="headerlink" href="#a" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>AccessResource, AllocDSToCSAlias, AllocResource, AllocSelector,
AnsiLowerBuff, AnsiNext, AnsiPrev, AnsiToOem, AnsiToOemBuff,
AnsiUpper, AnsiUpperBuff</p>
</div></blockquote>
</div>
<div class="section" id="b">
<h3>B<a class="headerlink" href="#b" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>BN_DBLCLK, BN_DISABLE, BN_DOUBLECLICKED, BN_HILITE, BN_PAINT,
BN_PUSHED, BN_UNPUSHED, BS_USERBUTTON</p>
</div></blockquote>
</div>
<div class="section" id="c">
<h3>C<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>CPL_INQUIRE, ChangeSelector, CloseComm, CloseSound, CopyLZFile,
CountVoiceNotes</p>
</div></blockquote>
</div>
<div class="section" id="d">
<h3>D<a class="headerlink" href="#d" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>DOS3Call, DefHookProc, DefineHandleTable, DeviceMode,
DlgDirSelect, DlgDirSelectComboBox</p>
</div></blockquote>
</div>
<div class="section" id="e">
<h3>E<a class="headerlink" href="#e" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>EnumFonts, ERR_…, ExtDeviceMode</p>
</div></blockquote>
</div>
<div class="section" id="f">
<h3>F<a class="headerlink" href="#f" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FixBrushOrgEx, FlushComm, FreeModule, FreeProcInstance,
FreeSelector</p>
</div></blockquote>
</div>
<div class="section" id="g">
<h3>G<a class="headerlink" href="#g" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>GCW_HBRBACKGROUND, GCW_HCURSOR, GCW_HICON, GWW_HINSTANCE,
GWW_HWNDPARENT, GWW_ID, GWW_USERDATA, GetAspectRatioFilter,
GetAtomHandle, GetBitmapBits, GetBitmapDimension, GetBrushOrg,
GetCharWidth, GetCodeHandle, GetCodeInfo, GetCommError, GetCurrentPDB,
GetCurrentPosition, GetEnvironment, GetFreeSpace,
GetFreeSystemResources, GetInstanceData, GetKBCodePage,
GetMetaFile, GetMetaFileBits, GetPrivateProfileInt
GetPrivateProfileSection, GetPrivateProfileSectionNames,
GetPrivateProfileString, GetPrivateProfileStruct, GetProfileInt,
GetProfileSection, GetProfileString, GetStringTypeA,
GetStringTypeW, GetTempDrive, GetTextExtent, GetTextExtentEx,
GetTextExtentPoint, GetThresholdEvent, GetThresholdStatus,
GetViewportExt, GetViewportOrg, GetWindowExt, GetWindowOrg,
GlobalCompact, GlobalDosAlloc, GlobalDosFree, GlobalFix,
GlobalLRUNewest, GlobalLRUOldest, GlobalNotify, GlobalPageLock,
GlobalPageUnlock, GlobalUnWire, GlobalUnfix, GlobalUnwire,
GlobalWire</p>
</div></blockquote>
</div>
<div class="section" id="h">
<h3>H<a class="headerlink" href="#h" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>HFILE, HFILE_ERROR</p>
</div></blockquote>
</div>
<div class="section" id="l">
<h3>L<a class="headerlink" href="#l" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>LZDone, LZStart, LimitEmsPages, LocalCompact, LocalInit,
LocalNotify, LocalShrink, LockSegment</p>
</div></blockquote>
</div>
<div class="section" id="m">
<h3>M<a class="headerlink" href="#m" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>MAKEPOINT, MakeProcInstance, MoveTo</p>
</div></blockquote>
</div>
<div class="section" id="n">
<h3>N<a class="headerlink" href="#n" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>NetBIOSCall</p>
</div></blockquote>
</div>
<div class="section" id="o">
<h3>O<a class="headerlink" href="#o" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>OemToAnsi, OemToAnsiBuff, OffsetViewportOrg, OffsetWindowOrg,
OpenComm, OpenFile, OpenSound</p>
</div></blockquote>
</div>
<div class="section" id="p">
<h3>P<a class="headerlink" href="#p" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>PM_NOYIELD, ProfClear, ProfFinish, ProfFlush, ProfInsChk,
ProfSampRate, ProfSetup, ProfStart, ProfStop</p>
</div></blockquote>
</div>
<div class="section" id="r">
<h3>R<a class="headerlink" href="#r" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>READ, READ_WRITE, ReadComm, RegCreateKey, RegEnumKey, RegOpenKey,
RegQueryValue, RegSetValue</p>
</div></blockquote>
</div>
<div class="section" id="s">
<h3>S<a class="headerlink" href="#s" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>SYSTEM_FIXED_FONT, ScaleViewportExt, ScaleWindowExt,
SetBitmapDimension, SetCommEventMask, SetEnvironment,
SetMetaFileBits, SetResourceHandler, SetScrollPos,
SetScrollRange, SetSoundNoise, SetSwapAreaSize,
SetViewportExt, SetViewportOrg, SetVoiceAccent, SetVoiceEnvelope,
SetVoiceNote, SetVoiceQueueSize, SetVoiceSound,
SetVoiceThreshold, SetWindowExt, SetWindowOrg, SetWindowsHook,
StartSound, StopSound, SwitchStackBack, SwitchStackTo,
SyncAllVoices</p>
</div></blockquote>
</div>
<div class="section" id="u">
<h3>U<a class="headerlink" href="#u" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>UngetCommChar, UnhookWindowsHook, UnlockSegment</p>
</div></blockquote>
</div>
<div class="section" id="v">
<h3>V<a class="headerlink" href="#v" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>ValidateCodeSegments, ValidateFreeSpaces</p>
</div></blockquote>
</div>
<div class="section" id="w">
<h3>W<a class="headerlink" href="#w" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>WM_CTLCOLOR, WNetAddConnection, WNetCancelConnection, WRITE,
WaitSoundState, WriteComm, WritePrivateProfileSection,
WritePrivateProfileString, WritePrivateProfileStruct,
WriteProfileSection, WriteProfileString</p>
</div></blockquote>
</div>
<div class="section" id="y">
<h3>Y<a class="headerlink" href="#y" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Yield</p>
</div></blockquote>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../t-lists/index.html" class="btn btn-neutral float-left" title="The t-lists Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../copyright.html" class="btn btn-neutral float-right" title="Copyright" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../copyright.html">Copyright</a> 2011-2023, Dylan Hackers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>