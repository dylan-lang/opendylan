
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding Callbacks to the Application &mdash; Building Applications With DUIM</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/opendylan.org/css/opendylan-docs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="Using Command Tables" href="commands.html" />
    <link rel="prev" title="Adding Menus To The Application" href="menus.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Building Applications With DUIM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Designing A Simple DUIM Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="improve.html">Improving The Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="menus.html">Adding Menus To The Application</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Adding Callbacks to the Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#defining-the-underlying-data-structures-for-tasks">Defining the underlying data structures for tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specifying-a-callback-in-the-definition-of-each-gadget">Specifying a callback in the definition of each gadget</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-the-callbacks">Defining the callbacks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#handling-files-in-the-task-list-manager">Handling files in the task list manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-open-file-method">The open-file method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-save-file-method">The save-file method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-save-as-file-method">The save-as-file method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-load-task-list-function">The load-task-list function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-save-task-list-function">The save-task-list function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-and-removing-tasks-from-the-task-list">Adding and removing tasks from the task list</a></li>
<li class="toctree-l3"><a class="reference internal" href="#duim-support-for-adding-and-removing-tasks">DUIM support for adding and removing tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-duim-support-for-adding-and-removing-tasks">Non-DUIM support for adding and removing tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-the-user-interface">Updating the user interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initializing-a-new-instance-of-task-frame">Initializing a new instance of &lt;task-frame&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#determining-and-setting-the-selected-task">Determining and setting the selected task</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-and-disabling-buttons-in-the-interface">Enabling and disabling buttons in the interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Refreshing the list of tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-an-information-dialog">Creating an information dialog</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exiting-the-task-list-manager">Exiting the task list manager</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#enhancing-the-task-list-manager">Enhancing the task list manager</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Using Command Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="tour.html">A Tour of the DUIM Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="source.html">Source Code For The Task List Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="copyright.html">Copyright</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Building Applications With DUIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Adding Callbacks to the Application</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/callbacks.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="adding-callbacks-to-the-application">
<span id="index-0"></span><h1>Adding Callbacks to the Application<a class="headerlink" href="#adding-callbacks-to-the-application" title="Permalink to this headline">¶</a></h1>
<p>At this point, the task list manager still does very little. If you try
running the code (as described in <a class="reference external" href="improve.html#starting-the-application">Starting the
application</a>), and interacting with any of the
elements in the GUI (clicking on a button, choosing a menu command, and
so on), then only the “not yet implemented” message is displayed. This
section shows you how to remedy this situation, by adding callback
functions to the task list manager.</p>
<p>Getting the application to respond to mouse events such as clicking on a
button or choosing a menu command consists of two things:</p>
<p>For each gadget in the GUI, you need to specify which callbacks to use.
There are several different types of callback, depending on the type of
event for which you want to define behavior.</p>
<p>You need to define the callback functions themselves. These are the
functions that are invoked when a particular callback type is
detected, and are the functions you use to define the correct behavior
for your application.</p>
<p>In addition, you need to set up the basic data structures that allow you
to work with tasks in your application.</p>
<p>At this point, you may be wondering exactly what a callback is, and why
they are used to respond to application events, rather than event
handlers. If you have developed GUI applications using other development
environments, you may be more used to writing event handlers that work
for a whole class of objects, and discriminating on which instance of a
class to work on at any one time by means of case statements.</p>
<p>Writing event handlers in this way can be cumbersome. It turns out to be
much simpler to define a function that works only for a particular
instance of a class, and then refer to this function when defining the
class instance. This function is what is referred to as a callback. This
makes the source code for your application much clearer and easier to
write, and the only price you pay is that you have to specify a callback
for each gadget when you define the gadget itself.</p>
<p>In fact, DUIM provides a complete protocol for defining and handling
events of all descriptions. However, you only need to use this protocol
if you are creating new classes of gadgets, for which you need to define
the event behavior, or new classes of events (for example, support for
different input devices or notification of low resources). If you are
just using gadgets, then you only ever need to use callbacks.</p>
<div class="section" id="defining-the-underlying-data-structures-for-tasks">
<span id="index-1"></span><h2>Defining the underlying data structures for tasks<a class="headerlink" href="#defining-the-underlying-data-structures-for-tasks" title="Permalink to this headline">¶</a></h2>
<p>Before defining any real callbacks, it is time to consider how you can
represent task lists, and the information contained in them. This is
essential, not just for handling tasks within the application, but for
saving task lists to disk, and loading them back into the application.</p>
<p>Add the code described in this section to <code class="docutils literal notranslate"><span class="pre">task-list.dylan</span></code>.</p>
<p>There are two basic kinds of object that you need to model: task lists
and tasks. A task list is a collection of one or more tasks. The best
way to represent these is by defining a <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> class and a
<code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> class.</p>
<p>The definition of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>, below, contains three slots:</p>
<p><code class="docutils literal notranslate"><span class="pre">task-list-tasks</span></code></p>
<blockquote>
<div><p>This slot specifies a sequence of tasks that are contained in the
task list. Each object in the sequence will be an instance of
<code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code>. The default for new task lists is an empty stretchy
vector. An init-keyword has been specified so that this slot can be
set when an instance of the class is initialized.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">task-list-filename</span></code></p>
<blockquote>
<div><p>This slot specifies the file on disk to which the task list has been
saved, if it has been saved at all. The default for new task lists is
<code class="docutils literal notranslate"><span class="pre">#f</span></code>, since the task list has not yet been saved to disk. An
init-keyword has been specified so that this slot can be set when an
instance of the class is initialized.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">task-list-modified?</span></code></p>
<blockquote>
<div><p>The purpose for this slot is less obvious. It is useful to flag
whether or not a task list has been modified so that, for instance,
the <em>Save</em> command in the application can be disabled if the task
list is unmodified. There is no init-keyword defined for this class,
because you only ever want to use the supplied default value for new
instances of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>.</p>
</div></blockquote>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">class</span> <span class="nc">&lt;task-list&gt;</span> <span class="p">(</span><span class="nc">&lt;object&gt;</span><span class="p">)</span>
  <span class="nb">constant</span> <span class="nb">slot</span> <span class="n">task-list-tasks</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;stretchy-vector&gt;</span><span class="p">),</span>
    <span class="k">init-keyword:</span> <span class="k">tasks:</span><span class="p">;</span>
  <span class="nb">slot</span> <span class="n">task-list-filename</span> <span class="p">::</span> <span class="nb">false-or</span><span class="p">(</span><span class="nc">&lt;string&gt;</span><span class="p">)</span> <span class="o">=</span> <span class="l">#f</span><span class="p">,</span>
    <span class="k">init-keyword:</span> <span class="k">filename:</span><span class="p">;</span>
  <span class="nb">slot</span> <span class="n">task-list-modified?</span> <span class="p">::</span> <span class="nc">&lt;boolean&gt;</span> <span class="o">=</span> <span class="l">#f</span><span class="p">;</span>
<span class="k">end</span> <span class="nb">class</span> <span class="nc">&lt;task-list&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>Next, consider the information that needs to be encoded in each
individual task. There are two pieces of information that need to be
recorded:</p>
<ul class="simple">
<li><p>The text of the task, which should be a string.</p></li>
<li><p>The priority, which should be one of high, medium, or low.</p></li>
</ul>
<p>Priorities can be recorded using a constant, as shown below:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">constant</span> <span class="nc">&lt;priority&gt;</span> <span class="o">=</span> <span class="nb">one-of</span><span class="p">(</span><span class="ss">#&quot;low&quot;</span><span class="p">,</span> <span class="ss">#&quot;medium&quot;</span><span class="p">,</span> <span class="ss">#&quot;high&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Notice that it is most straightforward to encode each priority as a
symbol. Later on, you will see how you can use <code class="docutils literal notranslate"><span class="pre">as</span></code> to convert each
symbol to a format that can be saved to disk and read back into the
application as a symbol.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> class can then be defined as having two slots: one for the
task text itself, and another for the priority. Both have init-keywords
so that they can be specified when a new instance is created, and both
init-keywords are required; they must be specified whenever a task is
created.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">class</span> <span class="nc">&lt;task&gt;</span> <span class="p">(</span><span class="nc">&lt;object&gt;</span><span class="p">)</span>
  <span class="nb">slot</span> <span class="n">task-name</span> <span class="p">::</span> <span class="nc">&lt;string&gt;</span><span class="p">,</span>
    <span class="k">required-init-keyword:</span> <span class="k">name:</span><span class="p">;</span>
  <span class="nb">slot</span> <span class="n">task-priority</span> <span class="p">::</span> <span class="nc">&lt;priority&gt;</span><span class="p">,</span>
    <span class="k">required-init-keyword:</span> <span class="k">priority:</span><span class="p">;</span>
<span class="k">end</span> <span class="nb">class</span> <span class="nc">&lt;task&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>These three definitions are all that is needed to be able to represent
tasks and task lists within the task list application.</p>
<p>In order to handle tasks effectively in the GUI of the task list
manager, some changes are necessary to the definition of the <code class="docutils literal notranslate"><span class="pre">task-list</span></code>
pane in the definition of <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code>. These changes are needed to
ensure that information about tasks is passed to the <code class="docutils literal notranslate"><span class="pre">task-list</span></code> pane
correctly. Make these changes to the existing definition in the file
<code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
<p>In <a class="reference external" href="menus.html#gluing-the-new-design-together">Gluing the final design together</a>, the
definition of <code class="docutils literal notranslate"><span class="pre">task-list</span></code> was given as:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="c1">// definition of list</span>
<span class="n">pane</span> <span class="n">task-list</span> <span class="p">(</span><span class="n">frame</span><span class="p">)</span>
  <span class="nb">make</span> <span class="p">(</span><span class="nc">&lt;list-box&gt;</span><span class="p">,</span> <span class="k">items:</span> <span class="p">#(),</span> <span class="k">lines:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="k">activate-callback:</span> <span class="n">not-yet-implemented</span><span class="p">);</span>
</pre></div>
</div>
<p>First, you need to ensure that the items passed to <code class="docutils literal notranslate"><span class="pre">task-list</span></code> are the
tasks in the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> associated with the frame. Recall that a
<code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> slot was specified in the definition of <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code>
; this slot is used to hold the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> that is
associated with the <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code>. The sequence of tasks contained in
the associated <code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> can then be found using the
<code class="docutils literal notranslate"><span class="pre">frame-task-list.task-list-tasks</span></code> accessor. To display these tasks in
the <code class="docutils literal notranslate"><span class="pre">task-list</span></code> pane, the <code class="docutils literal notranslate"><span class="pre">items:</span></code> init-keyword needs to be set to the
value of this accessor:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">items</span><span class="o">:</span> <span class="s">frame.frame-task-list.task-list-tasks,</span>
</pre></div>
</div>
<p>Next, you need to ensure that the label for each task in the <code class="docutils literal notranslate"><span class="pre">task-list</span></code>
pane is the text of the task itself. As described above, the text of any
task is stored in its <code class="docutils literal notranslate"><span class="pre">task-name</span></code> slot. In order to display this text as
the label for every item in the list box, you need to specify the
<code class="docutils literal notranslate"><span class="pre">task-name</span></code> slot as the <code class="docutils literal notranslate"><span class="pre">gadget-label-key</span></code> of the list box. A label key
is a function that is used to calculate the label of each item in a
gadget, and it can be specified using the <code class="docutils literal notranslate"><span class="pre">label-key:</span></code> init-keyword:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">label-key</span><span class="o">:</span> <span class="s">task-name,</span>
</pre></div>
</div>
<p>This gives the following new definition for the <code class="docutils literal notranslate"><span class="pre">task-list</span></code> pane:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="c1">// definition of list</span>
<span class="n">pane</span> <span class="n">task-list</span> <span class="p">(</span><span class="n">frame</span><span class="p">)</span>
  <span class="nb">make</span> <span class="p">(</span><span class="nc">&lt;list-box&gt;</span><span class="p">,</span>
        <span class="k">items:</span> <span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span><span class="p">.</span><span class="n">task-list-tasks</span><span class="p">,</span>
        <span class="k">label-key:</span> <span class="n">task-name</span><span class="p">,</span>
        <span class="k">lines:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="k">activate-callback:</span> <span class="n">not-yet-implemented</span><span class="p">);</span>
</pre></div>
</div>
<p>There is one final change that still needs to be made to this pane
definition. This is described in <a class="reference internal" href="#updating-the-user-interface">Updating the user interface</a>.</p>
</div>
<div class="section" id="specifying-a-callback-in-the-definition-of-each-gadget">
<span id="index-2"></span><h2>Specifying a callback in the definition of each gadget<a class="headerlink" href="#specifying-a-callback-in-the-definition-of-each-gadget" title="Permalink to this headline">¶</a></h2>
<p>As you have already seen when using the <code class="docutils literal notranslate"><span class="pre">not-yet-implemented</span></code> callback,
providing a callback for a gadget is just a matter of specifying another
keyword-value pair in the definition of the gadget. There are two ways
that you can specify the callback function to use.</p>
<p>If you wish, you can define the callback function inline, making the
definition itself the value part of the keyword-value pair.</p>
<p>This can be useful for a simple callback function that you only need to
invoke from a single callback type in a single pane. However, if several
panes, or several types of callback, need to invoke the same callback
function, you need to define the function explicitly in each gadget that
uses it.</p>
<p>Alternatively, you can define a callback function explicitly in your
application code, and then refer to it by name in the keyword-value
pair.</p>
<p>This method is best for portability and reusability of your code, since
the same callback function can be referred to by name in as many gadgets
as you need to use it in, without having to redefine the callback
function in each gadget. It can also lead to more readable source code.
This technique is the one used throughout this example application.</p>
<p>As already mentioned, there are a number of different kinds of callback
available, depending on the behavior that you want to specify, and the
gadget for which you are defining a callback. When defining different
callbacks for a gadget, you need to use a different init-keyword for
each callback.</p>
<p>As you have already seen, by far the most common callback is the
activate callback. This type of callback is invoked when you activate
any instance of <code class="docutils literal notranslate"><span class="pre">&lt;action-gadget&gt;</span></code>. For buttons, the activate callback
is invoked when you click on the button. For menu commands, the activate
callback is invoked when you choose the command from the menu. The
activate callback is the callback that is used most in the task list
manager. You can specify an activate callback for any gadget using the
<code class="docutils literal notranslate"><span class="pre">activate-callback:</span></code> init-keyword. In addition, you have seen the
value-changed callback, which is invoked when the gadget-value has been
changed. You can specify this callback using the
<code class="docutils literal notranslate"><span class="pre">value-changed-callback:</span></code> init-keyword.</p>
<p>You have already defined a callback for all the gadgets in the GUI. All
you need to do now is replace the reference to <code class="docutils literal notranslate"><span class="pre">not-yet-implemented</span></code>
with the real function name that should get called when each gadget is
activated. Thus, to specify an activate callback for the <em>Add task</em>
button in the tool bar, redefine the button as follows in the definition
of the <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code> class:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">pane</span> <span class="n">add-button</span> <span class="p">(</span><span class="n">frame</span><span class="p">)</span>
  <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;push-button&gt;</span><span class="p">,</span> <span class="k">label:</span> <span class="s">&quot;Add task&quot;</span><span class="p">,</span>
       <span class="k">activate-callback:</span> <span class="n">frame-add-task</span><span class="p">);</span>
</pre></div>
</div>
<p>You can use exactly the same callback in the new definition of
<code class="docutils literal notranslate"><span class="pre">add-menu-button</span></code> :</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">pane</span> <span class="n">add-menu-button</span> <span class="p">(</span><span class="n">frame</span><span class="p">)</span>
  <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;menu-button&gt;</span><span class="p">,</span> <span class="k">label:</span> <span class="s">&quot;Add...&quot;</span><span class="p">,</span>
       <span class="k">activate-callback:</span> <span class="n">frame-add-task</span><span class="p">,</span>
       <span class="k">accelerator:</span> <span class="n">make-keyboard-gesture</span>
                      <span class="p">(</span><span class="ss">#&quot;a&quot;</span><span class="p">,</span> <span class="ss">#&quot;control&quot;</span><span class="p">,</span> <span class="ss">#&quot;shift&quot;</span><span class="p">),</span>
       <span class="k">documentation:</span> <span class="s">&quot;Add a new task.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Notice how both of these gadgets specify the same activate callback.
This is because the <em>Add</em> command in the menu should perform exactly the
same action as the <em>Add task</em> button in the tool bar.</p>
<p>At this point, redefine the callback for each gadget listed in the table
below, making sure that you supply the same callback to those gadgets
that perform the same functions.</p>
<p>The callback functions used in the Task List Manager</p>
<p>Gadget</p>
<p>Callback</p>
<p>open-menu-button</p>
<p>open-file</p>
<p>save-menu-button</p>
<p>save-file</p>
<p>save-as-menu-button</p>
<p>save-as-file</p>
<p>exit-menu-button</p>
<p>exit-task</p>
<p>add-menu-button</p>
<p>frame-add-task</p>
<p>remove-menu-button</p>
<p>frame-remove-task</p>
<p>about-menu-button</p>
<p>about-task</p>
<p>add-button</p>
<p>frame-add-task</p>
<p>remove-button</p>
<p>frame-remove-task</p>
<p>open-button</p>
<p>open-file</p>
<p>save-button</p>
<p>save-file</p>
<p>The following sections show you how to define the callbacks themselves.
You will need to define other functions and methods, as well as the
callback functions listed above. These other functions and methods are
called by some of the callbacks themselves.</p>
</div>
<div class="section" id="defining-the-callbacks">
<span id="index-3"></span><h2>Defining the callbacks<a class="headerlink" href="#defining-the-callbacks" title="Permalink to this headline">¶</a></h2>
<p>This section shows you how to define the callbacks that are necessary in
the task list manager, as well as any other associated functions and
methods.</p>
<ul class="simple">
<li><p>First, you will look at methods and functions that enable file
handling in the task list manager; that is, functions and methods
that let you save and load files into the application.</p></li>
<li><p>Next, you will look at methods and functions for adding and removing
tasks from the task list.</p></li>
<li><p>Last, you will define a few additional methods that are necessary to
update the GUI elegantly, when other operations are performed.</p></li>
</ul>
<p>All the code discussed in this chapter is structured so that callbacks
which affect the GUI do not also perform other tasks that are not
related to the GUI. This helps to keep the design of the application
clean, so that you can follow the code more easily, and is recommended
for all GUI design. Separating GUI code and non-GUI code also lets you
produce code that is more easily reusable, either in other parts of a
developing application, or in completely different applications.</p>
<div class="section" id="handling-files-in-the-task-list-manager">
<span id="index-4"></span><h3>Handling files in the task list manager<a class="headerlink" href="#handling-files-in-the-task-list-manager" title="Permalink to this headline">¶</a></h3>
<p>To begin with, you will define the functions and methods that let you
save files to disk and load them back into the task list manager. Once
you have added these to your code, you will be able to save and reload
your task lists into the application; this type of functionality is
essential in even the most trivial application.</p>
<p id="index-5">There are three methods and two functions necessary for handling files.
The methods handle GUI-specific operations involved in loading and
saving files. The functions deal with the basic task of saving data
structures to disk, and loading them from disk. Add the definitions of
the methods to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>, and the definitions of the functions to
<code class="docutils literal notranslate"><span class="pre">task-list.dylan</span></code>.</p>
<p>Each method is invoked as a callback in the definition of the
<code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code> class:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">open-file</span></code> This method prompts the user to choose a filename, and
then loads that file into the task list manager by calling the
function <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code>. It is used as the activate callback for
both <code class="docutils literal notranslate"><span class="pre">open-button</span></code> (on the application tool bar) and
<code class="docutils literal notranslate"><span class="pre">open-menu-button</span></code> (in the <em>File</em> menu of the application).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save-file</span></code> This method saves the task list currently loaded into the
application to disk. It is used as the activate callback for both
<code class="docutils literal notranslate"><span class="pre">save-button</span></code> (on the application tool bar) and <code class="docutils literal notranslate"><span class="pre">save-menu-button</span></code>
(in the <em>File</em> menu of the application).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save-as-file</span></code> This method saves the task list currently loaded into
the application to disk, and prompts the user to supply a name. It is
used as the activate callback for <code class="docutils literal notranslate"><span class="pre">save-as-menu-button</span></code> (in the
<em>File</em> menu of the application).</p></li>
</ul>
<p>The following functions are called by the methods described above:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">save-task-list</span></code> This function saves an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> to
a named file. It is called by <code class="docutils literal notranslate"><span class="pre">save-as-file</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load-task-list</span></code> This function takes the contents of a file on disk
and converts it into an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>. It is called by
<code class="docutils literal notranslate"><span class="pre">open-as-file</span></code>.</p></li>
</ul>
<p>The following sections present and explain the code for each of these
methods and functions in turn.</p>
</div>
<div class="section" id="the-open-file-method">
<span id="index-6"></span><h3>The open-file method<a class="headerlink" href="#the-open-file-method" title="Permalink to this headline">¶</a></h3>
<p>The code for open-file is shown below. Add this code to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">open-file</span>
    <span class="p">(</span><span class="n">gadget</span> <span class="p">::</span> <span class="nc">&lt;gadget&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">sheet-frame</span><span class="p">(</span><span class="n">gadget</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">frame-task-list</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">filename</span>
    <span class="o">=</span> <span class="n">choose-file</span><span class="p">(</span><span class="k">frame:</span> <span class="n">frame</span><span class="p">,</span>
                  <span class="k">default:</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-filename</span><span class="p">,</span>
                  <span class="k">direction:</span> <span class="ss">#&quot;input&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">load-task-list</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">task-list</span><span class="p">)</span>
      <span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span> <span class="o">:=</span> <span class="n">task-list</span><span class="p">;</span>
      <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">notify-user</span><span class="p">(</span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;Failed to open file %s&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
                  <span class="k">owner:</span> <span class="n">frame</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">open-file</span><span class="p">;</span>
</pre></div>
</div>
<p>The method takes a gadget as an argument and returns no values. The
argument is the gadget that is used to invoke it, which in the case of
the task list manager means either <code class="docutils literal notranslate"><span class="pre">open-menu-button</span></code> (in the <em>File</em>
menu of the application) or <code class="docutils literal notranslate"><span class="pre">open-button</span></code> (on the tool bar). The
<code class="docutils literal notranslate"><span class="pre">open-file</span></code> method then sets three local variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frame</span></code> This contains the frame of which the gadget argument is a
part. This is a simple way of identifying the main application frame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task-list</span></code> This contains the value of the <code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> slot for
frame. This identifies the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> that is being
used to hold the task list information currently loaded into the task
list manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filename</span></code> This is the name of the file that is to be loaded into the
task list manager, and the user is always prompted to supply it.</p></li>
</ul>
<p>The method <code class="docutils literal notranslate"><span class="pre">choose-file</span></code> (a method provided by DUIM) is used to prompt
for a file to load. The portion of code that performs this task is
repeated here:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">choose-file</span><span class="p">(</span><span class="k">frame:</span> <span class="n">frame</span><span class="p">,</span>
            <span class="k">default:</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-filename</span><span class="p">,</span>
            <span class="k">direction:</span> <span class="ss">#&quot;input&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This method displays a standard file dialog box so that the user can
select a file on any disk connected to the host computer. For
<code class="docutils literal notranslate"><span class="pre">open-file</span></code>, you need to supply three arguments to <code class="docutils literal notranslate"><span class="pre">choose-file</span></code> : the
frame that owns the dialog, a default value to supply to the user, and
the direction of the interaction.</p>
<p>You need to supply a frame so that the system knows how to treat the
frame correctly, with respect to the dialog box. Thus, while the dialog
is displayed, the frame that owns it cannot be minimized, resized, or
interacted with in any way; this is standard behavior for modal dialog
boxes.</p>
<p>In this case, supplying a default value is useful in that it lets us
supply the filename for the currently loaded task list as a default
value. It determines this by examining the <code class="docutils literal notranslate"><span class="pre">task-list-filename</span></code> slot of
<code class="docutils literal notranslate"><span class="pre">task-list</span></code> (which, remember, is defined as a local variable and
represents the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> in use). If this slot has a
value, then it is offered as a default. (Note that if the currently
loaded task list has never been saved to disk, then this slot is <code class="docutils literal notranslate"><span class="pre">#f</span></code>,
and so no default is offered.)</p>
<p>The direction of interaction should also be specified when calling
<code class="docutils literal notranslate"><span class="pre">choose-file</span></code>, since the same generic function can be used to prompt
for a filename using a standard Open File dialog or a standard Save File
dialog. In this case, the direction is <code class="docutils literal notranslate"><span class="pre">#&quot;input&quot;</span></code>, which indicates that
data is being read in (that is, Open File is used).</p>
<p>The rest of the <code class="docutils literal notranslate"><span class="pre">open-file</span></code> method deals with loading in the task list
information safely. It consists of two nested <code class="docutils literal notranslate"><span class="pre">if</span></code> statements as shown
below.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">load-task-list</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">task-list</span><span class="p">)</span>
    <span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span> <span class="o">:=</span> <span class="n">task-list</span><span class="p">;</span>
    <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">notify-user</span><span class="p">(</span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;Failed to open file %s&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
                <span class="k">owner:</span> <span class="n">frame</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The clause</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
  <span class="p">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>is necessary to handle the case where the user cancels the Open file
dialog: on cancelling the dialog, the <code class="docutils literal notranslate"><span class="pre">open-file</span></code> method should return
silently with no side effects.</p>
<p>If a filename is supplied, then it is read from disk and converted into
a format that is readable by the application, in the line that reads</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">load-task-list</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code> is described in <a class="reference internal" href="#the-load-task-list-function">The load-task-list
function</a>.</p>
<p>The clause</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">task-list</span><span class="p">)</span>
  <span class="p">...</span>
<span class="k">else</span>
  <span class="p">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>is necessary to handle the case where the filename specified does not
contain data that can be interpreted by <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code>. If
<code class="docutils literal notranslate"><span class="pre">task-list</span></code> cannot be assigned, then the <code class="docutils literal notranslate"><span class="pre">else</span></code> code is run. This calls
the function <code class="docutils literal notranslate"><span class="pre">notify-user</span></code>, which is a simple way to display a short
message to the user in a message box.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">task-list</span></code> can be assigned (that is, the contents of the specified
file have been successfully read by <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code> ), then two lines
of code are run. The line</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span> <span class="o">:=</span> <span class="n">task-list</span><span class="p">;</span>
</pre></div>
</div>
<p>assigns the <code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> slot of frame to the value of <code class="docutils literal notranslate"><span class="pre">task-list</span></code>.</p>
<p>The line</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</pre></div>
</div>
<p>calls a method that refreshes the list of tasks displayed in the task
list manager, so that the contents of the newly loaded file are
correctly displayed on the screen. The method <code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> is
described in <a class="reference internal" href="#updating-the-user-interface">Updating the user interface</a>.</p>
</div>
<div class="section" id="the-save-file-method">
<span id="index-7"></span><h3>The save-file method<a class="headerlink" href="#the-save-file-method" title="Permalink to this headline">¶</a></h3>
<p>The code for <code class="docutils literal notranslate"><span class="pre">save-file</span></code> is as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">save-file</span>
    <span class="p">(</span><span class="n">gadget</span> <span class="p">::</span> <span class="nc">&lt;gadget&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">sheet-frame</span><span class="p">(</span><span class="n">gadget</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">frame-task-list</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="n">save-as-file</span><span class="p">(</span><span class="n">gadget</span><span class="p">,</span> <span class="k">filename:</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-filename</span><span class="p">)</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">save-file</span><span class="p">;</span>
</pre></div>
</div>
<p>Add this code to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
<p>This method is very simple, in that it just calls the method
<code class="docutils literal notranslate"><span class="pre">save-as-file</span></code>, passing it a filename as an argument. The
<code class="docutils literal notranslate"><span class="pre">save-as-file</span></code> method then does the real work of updating the GUI and
calling the relevant code to save information to disk.</p>
<p>Just like the <code class="docutils literal notranslate"><span class="pre">open-file</span></code> method, <code class="docutils literal notranslate"><span class="pre">save-file</span></code> takes the gadget used to
invoke it as an argument and returns no values. In the case of the task
list manager the gadget is either <code class="docutils literal notranslate"><span class="pre">open-menu-button</span></code> (in the <em>File</em> menu
of the application) or <code class="docutils literal notranslate"><span class="pre">open-button</span></code> (on the tool bar). The <code class="docutils literal notranslate"><span class="pre">save-file</span></code>
method sets the following two local variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frame</span></code> The frame of which the gadget argument is a part, so that the
main application frame can be identified.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task-list</span></code> This contains the value of the <code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> slot for
<code class="docutils literal notranslate"><span class="pre">frame</span></code>. This identifies the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> that needs to
be saved to disk.</p></li>
</ul>
<p>Note that similar local variables are used in the definition of
<code class="docutils literal notranslate"><span class="pre">open-file</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">save-file</span></code> method then calls <code class="docutils literal notranslate"><span class="pre">save-as-file</span></code>, passing it the
following two arguments:</p>
<ul class="simple">
<li><p>The gadget that invoked <code class="docutils literal notranslate"><span class="pre">save-file</span></code>.</p></li>
<li><p>The filename associated with the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> that needs
to be saved to disk.</p></li>
</ul>
<p>Notice that the second of these arguments may be <code class="docutils literal notranslate"><span class="pre">#f</span></code>, if the task list
has not previously been saved to disk.</p>
</div>
<div class="section" id="the-save-as-file-method">
<span id="index-8"></span><h3>The save-as-file method<a class="headerlink" href="#the-save-as-file-method" title="Permalink to this headline">¶</a></h3>
<p>The code for <code class="docutils literal notranslate"><span class="pre">save-as-file</span></code> is as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">save-as-file</span>
    <span class="p">(</span><span class="n">gadget</span> <span class="p">::</span> <span class="nc">&lt;gadget&gt;</span><span class="p">,</span> <span class="k">#key</span> <span class="n">filename</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">sheet-frame</span><span class="p">(</span><span class="n">gadget</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">frame-task-list</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">filename</span>
    <span class="o">=</span> <span class="n">filename</span>
      <span class="o">|</span> <span class="n">choose-file</span><span class="p">(</span><span class="k">frame:</span> <span class="n">frame</span><span class="p">,</span>
                     <span class="k">default:</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-filename</span><span class="p">,</span>
                     <span class="k">direction:</span> <span class="ss">#&quot;output&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">save-task-list</span><span class="p">(</span><span class="n">task-list</span><span class="p">,</span> <span class="k">filename:</span> <span class="n">filename</span><span class="p">))</span>
      <span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span> <span class="o">:=</span> <span class="n">task-list</span><span class="p">;</span>
      <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="n">notify-user</span><span class="p">(</span><span class="n">format-to-string</span>
                    <span class="p">(</span><span class="s">&quot;Failed to save file %s&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
                  <span class="k">owner:</span> <span class="n">frame</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">save-as-file</span><span class="p">;</span>
</pre></div>
</div>
<p>Add this code to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
<p>Like <code class="docutils literal notranslate"><span class="pre">open-file</span></code> and <code class="docutils literal notranslate"><span class="pre">save-file</span></code>, this method takes a gadget as an
argument and returns no values. This argument is the gadget which is
used to invoke it. In addition, an optional keyword argument, a
filename, can be passed.</p>
<p>This method is a little unusual; as well as being the activate callback
for the <code class="docutils literal notranslate"><span class="pre">save-as-menu-button</span></code> (the command <em>File &gt; Save As</em> ), it is
also called by the <code class="docutils literal notranslate"><span class="pre">save-file</span></code> method.</p>
<ul class="simple">
<li><p>When directly invoked as an activate callback, the <code class="docutils literal notranslate"><span class="pre">filename</span></code>
argument is not passed to <code class="docutils literal notranslate"><span class="pre">save-as-file</span></code>. Instead, the user is
prompted to supply it. In addition, the <code class="docutils literal notranslate"><span class="pre">gadget</span></code> is
<code class="docutils literal notranslate"><span class="pre">save-as-menu-button</span></code>.</p></li>
<li><p>When invoked by <code class="docutils literal notranslate"><span class="pre">save-file</span></code>, a <code class="docutils literal notranslate"><span class="pre">filename</span></code> may be passed, if the
associated task list has been saved before. In addition, the gadget
is either <code class="docutils literal notranslate"><span class="pre">save-button</span></code> or <code class="docutils literal notranslate"><span class="pre">save-menu-button</span></code>.</p></li>
</ul>
<p>As with <code class="docutils literal notranslate"><span class="pre">open-file</span></code>, <code class="docutils literal notranslate"><span class="pre">save-as-file</span></code> sets three local variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frame</span></code> This is the frame containing the gadget passed as an
argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task-list</span></code> This contains the value of the <code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> slot for
<code class="docutils literal notranslate"><span class="pre">frame</span></code>, and identifies the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> to be saved.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filename</span></code> The filename to which the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> is
saved.</p></li>
</ul>
<p>Unless <code class="docutils literal notranslate"><span class="pre">filename</span></code> is passed as an optional argument, the user is
prompted to supply a filename in which the task list information is to
be saved. As with <code class="docutils literal notranslate"><span class="pre">open-file</span></code>, the <code class="docutils literal notranslate"><span class="pre">choose-file</span></code> method is used to do
this. In fact, the call to <code class="docutils literal notranslate"><span class="pre">choose-file</span></code> here is identical to the call
to <code class="docutils literal notranslate"><span class="pre">choose-file</span></code> in <code class="docutils literal notranslate"><span class="pre">open-file</span></code>, with the exception of the direction
argument, which is set to <code class="docutils literal notranslate"><span class="pre">#&quot;output&quot;</span></code>.</p>
<p>The rest of the <code class="docutils literal notranslate"><span class="pre">save-as-file</span></code> method deals with saving the task list
information safely. It is similar to the equivalent code in <code class="docutils literal notranslate"><span class="pre">open-file</span></code>,
and consists of two nested <code class="docutils literal notranslate"><span class="pre">if</span></code> statements as shown below.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">save-task-list</span><span class="p">(</span><span class="n">task-list</span><span class="p">,</span> <span class="k">filename:</span> <span class="n">filename</span><span class="p">))</span>
    <span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span> <span class="o">:=</span> <span class="n">task-list</span><span class="p">;</span>
    <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">notify-user</span><span class="p">(</span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;Failed to save file %s&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
                <span class="k">owner:</span> <span class="n">frame</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>As with <code class="docutils literal notranslate"><span class="pre">open-file</span></code>, the clause</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
  <span class="p">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>is necessary in case the user cancels the Save file dialog: on
cancelling the dialog, <code class="docutils literal notranslate"><span class="pre">save-as-file</span></code> should fail silently with no side
effects.</p>
<p>The second <code class="docutils literal notranslate"><span class="pre">if</span></code> statement is more interesting. The body of the <code class="docutils literal notranslate"><span class="pre">if</span></code>
statement is like the body of the equivalent <code class="docutils literal notranslate"><span class="pre">if</span></code> statement in
<code class="docutils literal notranslate"><span class="pre">open-file</span></code> :</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span> <span class="o">:=</span> <span class="n">task-list</span><span class="p">;</span>
<span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</pre></div>
</div>
<p>This sets the <code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> slot of <code class="docutils literal notranslate"><span class="pre">frame</span></code> and then calls
<code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> to ensure that the correct information is shown on
the screen.</p>
<p>Similarly, the body of the <code class="docutils literal notranslate"><span class="pre">else</span></code> clause warns that the task list could
not be saved, when the <code class="docutils literal notranslate"><span class="pre">if</span></code> condition does not return true:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">notify-user</span><span class="p">(</span><span class="n">format-to-string</span><span class="p">(</span><span class="s">&quot;Failed to save file %s&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
            <span class="k">owner:</span> <span class="n">frame</span><span class="p">)</span>
</pre></div>
</div>
<p>The interesting part of this <code class="docutils literal notranslate"><span class="pre">if</span></code> statement is the <code class="docutils literal notranslate"><span class="pre">if</span></code> condition
itself:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">save-task-list</span><span class="p">(</span><span class="n">task-list</span><span class="p">,</span> <span class="k">filename:</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>As well as providing a test for whether the task list frame should be
updated, it actually performs the save operation, by calling the
function <code class="docutils literal notranslate"><span class="pre">save-task-list</span></code> with the required arguments.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">save-task-list</span></code> is described in <a class="reference internal" href="#the-save-task-list-function">The save-task-list
function</a> and the method <code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> is described in
<a class="reference internal" href="#updating-the-user-interface">Updating the user interface</a>.</p>
</div>
<div class="section" id="the-load-task-list-function">
<span id="index-9"></span><h3>The load-task-list function<a class="headerlink" href="#the-load-task-list-function" title="Permalink to this headline">¶</a></h3>
<p>The code for <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code> is shown below. Because this function does
not use any DUIM code, it is described only briefly.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">function</span> <span class="n">load-task-list</span>
    <span class="p">(</span><span class="n">filename</span> <span class="p">::</span> <span class="nc">&lt;string&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">task-list</span> <span class="p">::</span> <span class="nb">false-or</span><span class="p">(</span><span class="nc">&lt;task-list&gt;</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">tasks</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;stretchy-vector&gt;</span><span class="p">);</span>
  <span class="nb">block</span> <span class="p">(</span><span class="n">return</span><span class="p">)</span>
    <span class="n">with-open-file</span> <span class="p">(</span><span class="n">stream</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="k">direction:</span> <span class="ss">#&quot;input&quot;</span><span class="p">)</span>
      <span class="k">while</span> <span class="p">(</span><span class="l">#t</span><span class="p">)</span>
        <span class="k">let</span> <span class="n">name</span> <span class="o">=</span> <span class="n">read-line</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="k">on-end-of-stream:</span> <span class="l">#f</span><span class="p">);</span>
        <span class="k">unless</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="n">return</span><span class="p">()</span> <span class="k">end</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">priority</span> <span class="o">=</span> <span class="n">read-line</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="k">on-end-of-stream:</span> <span class="l">#f</span><span class="p">);</span>
        <span class="k">unless</span> <span class="p">(</span><span class="n">priority</span><span class="p">)</span>
          <span class="nb">error</span><span class="p">(</span><span class="s">&quot;Unexpectedly missing priority!&quot;</span><span class="p">)</span>
        <span class="k">end</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">task</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;task&gt;</span><span class="p">,</span> <span class="k">name:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="k">priority:</span> <span class="nb">as</span><span class="p">(</span><span class="nc">&lt;symbol&gt;</span><span class="p">,</span> <span class="n">priority</span><span class="p">));</span>
        <span class="nb">add!</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;task-list&gt;</span><span class="p">,</span> <span class="k">tasks:</span> <span class="n">tasks</span><span class="p">,</span> <span class="k">filename:</span> <span class="n">filename</span><span class="p">)</span>
<span class="k">end</span> <span class="nb">function</span> <span class="n">load-task-list</span><span class="p">;</span>
</pre></div>
</div>
<p>Add this code to <code class="docutils literal notranslate"><span class="pre">task-list.dylan</span></code>.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code> reads a file from disk and attempts to
convert its contents into an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>, which itself
contains any number of instances of <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code>. It takes one argument,
the filename, and returns one value, the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>.</p>
<p>This function uses a generic function and a macro from the Streams
library to read information from the file. For full information about
this library, please refer to the <em>I/O and Networks Library Reference</em>.</p>
<p>The file format used by the task list manager is very simple, with each
element of a task occupying a single line in the file. Suppose
<code class="docutils literal notranslate"><span class="pre">load-task-list</span></code> is called on a file containing the following
information:</p>
<p>Wash the dog</p>
<p>medium</p>
<p>Video Men Behaving Badly</p>
<p>high</p>
<p>This would create an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> whose <code class="docutils literal notranslate"><span class="pre">task-list-tasks</span></code>
slot was a sequence of two instances of <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code>.</p>
<ul class="simple">
<li><p>The first <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> would have a <code class="docutils literal notranslate"><span class="pre">task-name</span></code> of <em>“Wash the dog”</em> and a
<code class="docutils literal notranslate"><span class="pre">task-priority</span></code> of <code class="docutils literal notranslate"><span class="pre">#&quot;medium&quot;</span></code>.</p></li>
<li><p>The second <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> would have a <code class="docutils literal notranslate"><span class="pre">task-name</span></code> of <em>“Video Men Behaving
Badly”</em> and a <code class="docutils literal notranslate"><span class="pre">task-priority</span></code> of <code class="docutils literal notranslate"><span class="pre">#&quot;high&quot;</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">task-list-filename</span></code> slot of the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> is the filename
itself. Note that the <code class="docutils literal notranslate"><span class="pre">task-list-modified?</span></code> slot of the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> is
set to <code class="docutils literal notranslate"><span class="pre">#f</span></code>, reflecting the fact that the task list is loaded, but
unchanged. This does not have to be done explicitly by <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code>,
since <code class="docutils literal notranslate"><span class="pre">#f</span></code> is the default value of this slot, as you can see from its
definition in <a class="reference internal" href="#defining-the-underlying-data-structures-for-tasks">Defining the underlying data structures for tasks</a>.</p>
<p>The file is opened for reading using the <code class="docutils literal notranslate"><span class="pre">with-open-file</span></code> macro. It is
then read a line at a time, setting the local variables <code class="docutils literal notranslate"><span class="pre">name</span></code> and
<code class="docutils literal notranslate"><span class="pre">priority</span></code> with each alternate line. After successfully setting both
<code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">priority</span></code>, an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> is created, and added to
the stretchy vector tasks using <code class="docutils literal notranslate"><span class="pre">add!</span></code>. When the end of the file is
reached, <code class="docutils literal notranslate"><span class="pre">#f</span></code> is returned and an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> is created
from <code class="docutils literal notranslate"><span class="pre">tasks</span></code> and returned by the function.</p>
<p>Note how the <code class="docutils literal notranslate"><span class="pre">as</span></code> method is used to convert a string value such as
<code class="docutils literal notranslate"><span class="pre">&quot;medium&quot;</span></code> into a symbol such as <code class="docutils literal notranslate"><span class="pre">#&quot;medium&quot;</span></code>. This is a useful
technique to use when you wish to save and load symbol information in an
application.</p>
</div>
<div class="section" id="the-save-task-list-function">
<span id="index-10"></span><h3>The save-task-list function<a class="headerlink" href="#the-save-task-list-function" title="Permalink to this headline">¶</a></h3>
<p>The code for <code class="docutils literal notranslate"><span class="pre">save-task-list</span></code> is shown below. Because this function does
not use any DUIM code, it is described only briefly.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">function</span> <span class="n">save-task-list</span>
    <span class="p">(</span><span class="n">task-list</span> <span class="p">::</span> <span class="nc">&lt;task-list&gt;</span><span class="p">,</span> <span class="k">#key</span> <span class="n">filename</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">(</span><span class="n">saved?</span> <span class="p">::</span> <span class="nc">&lt;boolean&gt;</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">|</span> <span class="n">task-list-filename</span><span class="p">(</span><span class="n">task-list</span><span class="p">);</span>
  <span class="n">with-open-file</span> <span class="p">(</span><span class="n">stream</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="k">direction:</span> <span class="ss">#&quot;output&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">task</span> <span class="k">in</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-tasks</span><span class="p">)</span>
      <span class="n">format</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\\</span><span class="s">n%s</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span>
             <span class="n">task</span><span class="p">.</span><span class="n">task-name</span><span class="p">,</span> <span class="nb">as</span><span class="p">(</span><span class="nc">&lt;string&gt;</span><span class="p">,</span> <span class="n">task</span><span class="p">.</span><span class="n">task-priority</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-modified?</span> <span class="o">:=</span> <span class="l">#f</span><span class="p">;</span>
  <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-filename</span> <span class="o">:=</span> <span class="n">filename</span><span class="p">;</span>
  <span class="l">#t</span>
<span class="k">end</span> <span class="nb">function</span> <span class="n">save-task-list</span><span class="p">;</span>
</pre></div>
</div>
<p>Add this code to <code class="docutils literal notranslate"><span class="pre">task-list.dylan</span></code>.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">save-task-list</span></code> takes an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> as an
argument, and optionally a <code class="docutils literal notranslate"><span class="pre">filename</span></code>. It then attempts to save the
instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> to the file specified by <code class="docutils literal notranslate"><span class="pre">filename</span></code>. It
returns a boolean value that indicates whether the file was successfully
saved or not. If filename is not passed as an argument to
<code class="docutils literal notranslate"><span class="pre">save-task-list</span></code> (in the case where the user has chosen <em>File &gt; Save</em> or
clicked the <em>Save</em> button when working with a task list file that has
previously been saved), then the <code class="docutils literal notranslate"><span class="pre">task-list-filename</span></code> slot of the
<code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> is used instead.</p>
<p>Like <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code>, this function uses the Streams library to save
information to a file. For full information about this library, please
refer to the <em>I/O and Networks Library Reference</em>. It also uses the
<code class="docutils literal notranslate"><span class="pre">format</span></code> function from the Format library, which is described in the
same reference.</p>
<p>The file is opened for saving using the <code class="docutils literal notranslate"><span class="pre">with-open-file</span></code> macro (just
like <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code>, but in the opposite direction), A <code class="docutils literal notranslate"><span class="pre">for</span></code> loop is
used to save each element in each task to the file. The <code class="docutils literal notranslate"><span class="pre">format</span></code>
function then writes each element to the file, separated by a newline
character. Note how the <code class="docutils literal notranslate"><span class="pre">as</span></code> method is used to convert the
<code class="docutils literal notranslate"><span class="pre">task-priority</span></code> symbol to a string when saving each priority value: this
is the reverse situation to <code class="docutils literal notranslate"><span class="pre">load-task-list</span></code>, where a method for <code class="docutils literal notranslate"><span class="pre">as</span></code>
was used to convert the string to a symbol.</p>
<p>Once every element in the file has been saved, the <code class="docutils literal notranslate"><span class="pre">task-list-modified</span></code>
slot of the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> is reset to <code class="docutils literal notranslate"><span class="pre">#f</span></code>, and the
<code class="docutils literal notranslate"><span class="pre">task-list-filename</span></code> slot of the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> is set to the filename
used by <code class="docutils literal notranslate"><span class="pre">save-task-list</span></code>. This last step is necessary to allow for the
case where the user has chosen the <em>File &gt; Save As</em> command to save the
file under a different name.</p>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">save-task-list</span></code> returns <code class="docutils literal notranslate"><span class="pre">#t</span></code> to indicate that the file has
been successfully saved.</p>
</div>
<div class="section" id="adding-and-removing-tasks-from-the-task-list">
<span id="index-11"></span><h3>Adding and removing tasks from the task list<a class="headerlink" href="#adding-and-removing-tasks-from-the-task-list" title="Permalink to this headline">¶</a></h3>
<p>This section describes the functions and methods necessary for adding to
the task list and removing tasks from the task list. A total of two
methods and two functions are necessary.</p>
<p><code class="docutils literal notranslate"><span class="pre">frame-add-task</span></code></p>
<blockquote>
<div><p>This prompts the user for the details of a new task and adds it to
the list.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">frame-remove-task</span></code></p>
<blockquote>
<div><p>This removes the currently selected task from the list, prompting the
user before removing it completely.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">add-task</span></code></p>
<blockquote>
<div><p>This adds an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> to an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">remove-task</span></code></p>
<blockquote>
<div><p>This removes an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> from an instance of
<code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>.</p>
</div></blockquote>
<p>As with the file handling code, DUIM code and non-DUIM code has been
separated. The methods beginning with <code class="docutils literal notranslate"><span class="pre">frame-</span></code> deal with the GUI-related
issues of adding and removing tasks, and the functions deal with the
underlying data structures.</p>
<p>Add the definitions of the methods to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>, and the
definitions of the functions to <code class="docutils literal notranslate"><span class="pre">task-list.dylan</span></code>.</p>
</div>
<div class="section" id="duim-support-for-adding-and-removing-tasks">
<span id="index-12"></span><h3>DUIM support for adding and removing tasks<a class="headerlink" href="#duim-support-for-adding-and-removing-tasks" title="Permalink to this headline">¶</a></h3>
<p>This section describes the methods necessary to provide support in the
task list manager GUI for adding and removing tasks.</p>
<p id="index-13">Add the code described in this section to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
<p>The code for <code class="docutils literal notranslate"><span class="pre">frame-add-task</span></code> is as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">frame-add-task</span> <span class="p">(</span><span class="n">gadget</span> <span class="p">::</span> <span class="nc">&lt;gadget&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">sheet-frame</span><span class="p">(</span><span class="n">gadget</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">frame-task-list</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="k">let</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span> <span class="o">=</span> <span class="n">prompt-for-task</span><span class="p">(</span><span class="k">owner:</span> <span class="n">frame</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">&amp;</span> <span class="n">priority</span><span class="p">)</span>
    <span class="k">let</span> <span class="n">new-task</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;task&gt;</span><span class="p">,</span> <span class="k">name:</span> <span class="n">name</span><span class="p">,</span> <span class="k">priority:</span> <span class="n">priority</span><span class="p">);</span>
    <span class="n">add-task</span><span class="p">(</span><span class="n">task-list</span><span class="p">,</span> <span class="n">new-task</span><span class="p">);</span>
    <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
    <span class="n">frame-selected-task</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">:=</span> <span class="n">new-task</span>
  <span class="k">end</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">frame-add-task</span><span class="p">;</span>
</pre></div>
</div>
<p>The method takes a gadget as an argument and returns no values. The
argument is the gadget which is used to invoke it, which in the case of
the task list manager means either <code class="docutils literal notranslate"><span class="pre">add-menu-button</span></code> (in the <em>Task</em> menu
of the application) or <code class="docutils literal notranslate"><span class="pre">add-button</span></code> (on the tool bar). The
<code class="docutils literal notranslate"><span class="pre">frame-add-task</span></code> method then sets a number of local variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frame</span></code> The frame containing the gadget passed as an argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task-list</span></code> The value of the <code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> slot for <code class="docutils literal notranslate"><span class="pre">frame</span></code>.
This identifies the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> to which a task is to
be added.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> The text of the task to be added.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priority</span></code> The priority of the task to be added.</p></li>
</ul>
<p>As with other DUIM methods you have seen, <code class="docutils literal notranslate"><span class="pre">frame</span></code> and <code class="docutils literal notranslate"><span class="pre">task-list</span></code> are
specified using known slot values about the gadget supplied to
<code class="docutils literal notranslate"><span class="pre">frame-add-task</span></code>, and the frame that contains the gadget. The <code class="docutils literal notranslate"><span class="pre">name</span></code>
and <code class="docutils literal notranslate"><span class="pre">priority</span></code> values are specified by calling the <code class="docutils literal notranslate"><span class="pre">prompt-for-task</span></code>
method defined in <a class="reference external" href="improve.html#creating-a-dialog-for-adding-new-items">Creating a dialog for adding new
items</a>. This method displays a dialog into which
the user types the text for the new task and chooses the priority, both
of which values are returned from <code class="docutils literal notranslate"><span class="pre">prompt-for-task</span></code>.</p>
<p>Once all the local variables have been specified, the main body of code
for the method, repeated below, is executed.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">&amp;</span> <span class="n">priority</span><span class="p">)</span>
  <span class="k">let</span> <span class="n">new-task</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="nc">&lt;task&gt;</span><span class="p">,</span> <span class="k">name:</span> <span class="n">name</span><span class="p">,</span> <span class="k">priority:</span> <span class="n">priority</span><span class="p">);</span>
  <span class="n">add-task</span><span class="p">(</span><span class="n">task-list</span><span class="p">,</span> <span class="n">new-task</span><span class="p">);</span>
  <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="n">frame-selected-task</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">:=</span> <span class="n">new-task</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This consists of four expressions around which is wrapped an <code class="docutils literal notranslate"><span class="pre">if</span></code>
statement.</p>
<ol class="arabic simple">
<li><p>The first expression creates a new task from the values of the <code class="docutils literal notranslate"><span class="pre">name</span></code>
and <code class="docutils literal notranslate"><span class="pre">priority</span></code> local variables.</p></li>
<li><p>The second expression adds the new task to task list, by calling the
<code class="docutils literal notranslate"><span class="pre">add-task</span></code> function.</p></li>
<li><p>The third expression refreshes the display of the task list in the
task list manager, so that the new task is displayed on the screen
once it has been added.</p></li>
<li><p>The fourth expression ensures that the new task is selected in the
task list manager. The frame-selected–task method is described in
<a class="reference internal" href="#updating-the-user-interface">Updating the user interface</a>.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">if</span></code> statement ensures that all the information needed to construct
the new task is specified before the new task is created.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">add-task</span></code> function is described in <a class="reference internal" href="#non-duim-support-for-adding-and-removing-tasks">Non-DUIM support for adding
and removing tasks</a>.</p>
<p>The code for <code class="docutils literal notranslate"><span class="pre">frame-remove-task</span></code> is as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">frame-remove-task</span> <span class="p">(</span><span class="n">gadget</span> <span class="p">::</span> <span class="nc">&lt;gadget&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">sheet-frame</span><span class="p">(</span><span class="n">gadget</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">task</span> <span class="o">=</span> <span class="n">frame-selected-task</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">frame-task-list</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">notify-user</span><span class="p">(</span><span class="n">format-to-string</span>
                   <span class="p">(</span><span class="s">&quot;Really remove task %s&quot;</span><span class="p">,</span> <span class="n">task</span><span class="p">.</span><span class="n">task-name</span><span class="p">),</span>
      <span class="k">owner:</span> <span class="n">frame</span><span class="p">,</span> <span class="k">style:</span> <span class="ss">#&quot;question&quot;</span><span class="p">))</span>
    <span class="n">frame-selected-task</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">:=</span> <span class="l">#f</span><span class="p">;</span>
    <span class="n">remove-task</span><span class="p">(</span><span class="n">task-list</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
    <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">frame-remove-task</span><span class="p">;</span>
</pre></div>
</div>
<p>As with <code class="docutils literal notranslate"><span class="pre">frame-add-task</span></code>, this method takes the gadget that is used to
invoke it as an argument and returns no values. In the case of the task
list manager, the gadget is either <code class="docutils literal notranslate"><span class="pre">remove-menu-button</span></code> (in the <em>Task</em>
menu of the application) or <code class="docutils literal notranslate"><span class="pre">remove-button</span></code> (on the tool bar). The
<code class="docutils literal notranslate"><span class="pre">frame-remove-task</span></code> method then sets a number of local variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frame</span></code> The frame containing the gadget passed as an argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code> The task that is to be removed. The task to be removed is the
one selected in the list of tasks on screen. The method
<code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code> is called to determine which task this is.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task-list</span></code> The value of the <code class="docutils literal notranslate"><span class="pre">frame-task-list</span></code> slot for <code class="docutils literal notranslate"><span class="pre">frame</span></code>.
This identifies the instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> from which a task is to
be removed.</p></li>
</ul>
<p>The method <code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code> is described in <a class="reference internal" href="#updating-the-user-interface">Updating the user
interface</a>.</p>
<p>Once these local variables have been set, the rest of the code goes
about removing the task. The code consists of three expressions around
which is wrapped an <code class="docutils literal notranslate"><span class="pre">if</span></code> statement, as shown below.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">notify-user</span><span class="p">(</span><span class="n">format-to-string</span>
                  <span class="p">(</span><span class="s">&quot;Really remove task %s&quot;</span><span class="p">,</span> <span class="n">task</span><span class="p">.</span><span class="n">task-name</span><span class="p">),</span>
    <span class="k">owner:</span> <span class="n">frame</span><span class="p">,</span> <span class="k">style:</span> <span class="ss">#&quot;question&quot;</span><span class="p">))</span>
  <span class="n">frame-selected-task</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">:=</span> <span class="l">#f</span><span class="p">;</span>
  <span class="n">remove-task</span><span class="p">(</span><span class="n">task-list</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
  <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Notice here that the method <code class="docutils literal notranslate"><span class="pre">notify-user</span></code> is used as the condition in
the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement: if the call to <code class="docutils literal notranslate"><span class="pre">notify-user</span></code> returns <code class="docutils literal notranslate"><span class="pre">#t</span></code>, then the
subsequent expressions are executed. This use of <code class="docutils literal notranslate"><span class="pre">notify-user</span></code>
illustrates how you can use the method to generate a yes-no question for
the user to answer, by using the <code class="docutils literal notranslate"><span class="pre">style:</span></code> init-keyword. You might like
to compare the user of <code class="docutils literal notranslate"><span class="pre">notify-user</span></code> in this method with its use in
<code class="docutils literal notranslate"><span class="pre">open-file</span></code> or <code class="docutils literal notranslate"><span class="pre">save-as-file</span></code> ; essentially, the only difference is in
the use of the <code class="docutils literal notranslate"><span class="pre">style:</span></code> init-keyword.</p>
<p>If the call to <code class="docutils literal notranslate"><span class="pre">notify-user</span></code> returns <code class="docutils literal notranslate"><span class="pre">#t</span></code>, then three expressions are
executed:</p>
<ol class="arabic simple">
<li><p>The first calls the setter for <code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code>, to ensure that no
items in the task list are selected.</p></li>
<li><p>The second calls the function <code class="docutils literal notranslate"><span class="pre">remove-task</span></code>, which removes task from
<code class="docutils literal notranslate"><span class="pre">task-list</span></code>.</p></li>
<li><p>Then, <code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> is called to ensure that the task that has
been removed is no longer displayed in the list of tasks on the
screen.</p></li>
</ol>
<p>The methods defined for <code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code> are described in
<a class="reference internal" href="#updating-the-user-interface">Updating the user interface</a>. The function <code class="docutils literal notranslate"><span class="pre">remove-task</span></code> is
described in <a class="reference internal" href="#non-duim-support-for-adding-and-removing-tasks">Non-DUIM support for adding and removing tasks</a>. The
<code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> method is described in <a class="reference internal" href="#updating-the-user-interface">Updating the user
interface</a>.</p>
</div>
<div class="section" id="non-duim-support-for-adding-and-removing-tasks">
<span id="index-14"></span><h3>Non-DUIM support for adding and removing tasks<a class="headerlink" href="#non-duim-support-for-adding-and-removing-tasks" title="Permalink to this headline">¶</a></h3>
<p>This section describes the functions necessary for adding an instance of
<code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> to a <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>, and removing a <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> from a
<code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>. These functions are called by the callback functions
<code class="docutils literal notranslate"><span class="pre">frame-add-task</span></code> and <code class="docutils literal notranslate"><span class="pre">frame-remove-task</span></code>, respectively. Because these
functions do not use any DUIM code, they are described only briefly.</p>
<p>Add the code described in this section to <code class="docutils literal notranslate"><span class="pre">task-list.dylan</span></code>.</p>
<p>The code for <code class="docutils literal notranslate"><span class="pre">add-task</span></code> is as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">function</span> <span class="n">add-task</span>
    <span class="p">(</span><span class="n">task-list</span> <span class="p">::</span> <span class="nc">&lt;task-list&gt;</span><span class="p">,</span> <span class="n">task</span> <span class="p">::</span> <span class="nc">&lt;task&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="nb">add!</span><span class="p">(</span><span class="n">task-list</span><span class="p">.</span><span class="n">task-list-tasks</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
  <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-modified?</span> <span class="o">:=</span> <span class="l">#t</span>
<span class="k">end</span> <span class="nb">function</span> <span class="n">add-task</span><span class="p">;</span>
</pre></div>
</div>
<p>This function takes two arguments, a <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> and the <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> that
is to be added to it, and returns no values. The <code class="docutils literal notranslate"><span class="pre">add-task</span></code> function
first adds the <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> to the end of the sequence bound to the
<code class="docutils literal notranslate"><span class="pre">task-list-tasks</span></code> slot of the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>, and then sets the
<code class="docutils literal notranslate"><span class="pre">task-list-modified?</span></code> slot of the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">#t</span></code>, to indicate
that a change in the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> has occurred.</p>
<p>The code for <code class="docutils literal notranslate"><span class="pre">remove-task</span></code> is as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">function</span> <span class="n">remove-task</span>
    <span class="p">(</span><span class="n">task-list</span> <span class="p">::</span> <span class="nc">&lt;task-list&gt;</span><span class="p">,</span> <span class="n">task</span> <span class="p">::</span> <span class="nc">&lt;task&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="nb">remove!</span><span class="p">(</span><span class="n">task-list</span><span class="p">.</span><span class="n">task-list-tasks</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
  <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-modified?</span> <span class="o">:=</span> <span class="l">#t</span>
<span class="k">end</span> <span class="nb">function</span> <span class="n">remove-task</span><span class="p">;</span>
</pre></div>
</div>
<p>This function is analogous to <code class="docutils literal notranslate"><span class="pre">add-task</span></code>. It takes the same arguments,
and returns no values. The function first removes the <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> from the
<code class="docutils literal notranslate"><span class="pre">task-list-tasks</span></code> slot of the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code>, and then sets the
<code class="docutils literal notranslate"><span class="pre">task-list-modified?</span></code> slot of the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">#t</span></code>, to indicate
that a change in the <code class="docutils literal notranslate"><span class="pre">&lt;task-list&gt;</span></code> has occurred.</p>
</div>
<div class="section" id="updating-the-user-interface">
<span id="index-15"></span><h3>Updating the user interface<a class="headerlink" href="#updating-the-user-interface" title="Permalink to this headline">¶</a></h3>
<p>This section describes a number of miscellaneous methods that are
required for smooth operation of the task list manager. Each of the
methods defined here ensures that the task list manager displays the
correct information and gives the user access to appropriate commands in
any given situation. Here is a list of the methods defined in this
section, together with a brief description of each one:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">initialize</span></code> An <code class="docutils literal notranslate"><span class="pre">initialize</span></code> method is provided for <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code>
that ensures information is displayed correctly when the task list
manager is first displayed. This method is described in
<a class="reference internal" href="#initializing-a-new-instance-of-task-frame">Initializing a new instance of &lt;task-frame&gt;</a>.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code></p>
<blockquote>
<div><p>This method returns the task that is currently selected in the task
list manager. This method is described in <a class="reference internal" href="#determining-and-setting-the-selected-task">Determining and
setting the selected task</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">frame-selected-task-setter</span></code></p>
<blockquote>
<div><p>This is a setter method for frame-selected-task, and is used to
select or deselect item in the task list manager. This method is
described in <a class="reference internal" href="#determining-and-setting-the-selected-task">Determining and setting the selected task</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code></p>
<blockquote>
<div><p>Two methods are defined that deal with updating the GUI whenever a
change is made to the task selection state. This method is described
in <a class="reference internal" href="#enabling-and-disabling-buttons-in-the-interface">Enabling and disabling buttons in the interface</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code></p>
<blockquote>
<div><p>This method can be called to refresh the task frame at any time. This
method is described in <a class="reference external" href="callbacks.html#refreshing-the-list-of-tasks">Refreshing the list of tasks</a>.</p>
</div></blockquote>
<p>Each of these methods should be added to the file <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
</div>
<div class="section" id="initializing-a-new-instance-of-task-frame">
<h3>Initializing a new instance of &lt;task-frame&gt;<a class="headerlink" href="#initializing-a-new-instance-of-task-frame" title="Permalink to this headline">¶</a></h3>
<p>The code below provides an <code class="docutils literal notranslate"><span class="pre">initialize</span></code> method for the class
<code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code>. This simply ensures that the display in a
<code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code> is refreshed as soon as it is created, and calls any
subsequent methods that may be defined for it (although, in the case of
the task list manager, there are none). While not strictly necessary,
this <code class="docutils literal notranslate"><span class="pre">initialize</span></code> method illustrates general good practice when defining
your own classes of frame. If the application was associated with files
of a particular type on disk, then the <code class="docutils literal notranslate"><span class="pre">initialize</span></code> method would be
necessary to ensure that tasks were displayed correctly after starting
the task list manager by double-clicking on a file of tasks.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="nb">initialize</span>
    <span class="p">(</span><span class="n">frame</span> <span class="p">::</span> <span class="nc">&lt;task-frame&gt;</span><span class="p">,</span> <span class="k">#key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="nb">next-method</span><span class="p">();</span>
  <span class="n">refresh-task-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
<span class="k">end</span> <span class="nb">method</span> <span class="nb">initialize</span><span class="p">;</span>
</pre></div>
</div>
<p>Add the code for this method to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
</div>
<div class="section" id="determining-and-setting-the-selected-task">
<h3>Determining and setting the selected task<a class="headerlink" href="#determining-and-setting-the-selected-task" title="Permalink to this headline">¶</a></h3>
<p>Two methods are used to determine which task is selected in the task
list manager, and to set a specific task in the task list manager:
<code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code> and <code class="docutils literal notranslate"><span class="pre">frame-selected-task-setter</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code> method returns the task that is currently
selected in the task list manager, or <code class="docutils literal notranslate"><span class="pre">#f</span></code> if no task is selected. This
method is used by <code class="docutils literal notranslate"><span class="pre">frame-remove-task</span></code> to determine which task should be
deleted from the task list. It is also used by
<code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> to determine whether or not a task is
selected.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">frame-selected-task</span>
    <span class="p">(</span><span class="n">frame</span> <span class="p">::</span> <span class="nc">&lt;task-frame&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">task</span> <span class="p">::</span> <span class="nb">false-or</span><span class="p">(</span><span class="nc">&lt;task&gt;</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">list-box</span> <span class="o">=</span> <span class="n">task-list</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="n">gadget-value</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">frame-selected-task</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code> method works by determining the <code class="docutils literal notranslate"><span class="pre">gadget-value</span></code>
of the list box that displays the tasks in the task list manager. The
<code class="docutils literal notranslate"><span class="pre">gadget-value</span></code> of a collection such as a list box is the selected item.
Notice how you can access the value of a pane in a frame instance in
exactly the same way that you can access the value of a slot in a class
instance; the definition of the pane creates an accessor that is just
like a slot accessor. Recall that the name of the list box in the
definition of the <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code> class is <code class="docutils literal notranslate"><span class="pre">task-list</span></code>.</p>
<p>A setter method is also defined for <code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code>, as shown
below:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">frame-selected-task-setter</span>
    <span class="p">(</span><span class="n">task</span> <span class="p">::</span> <span class="nb">false-or</span><span class="p">(</span><span class="nc">&lt;task&gt;</span><span class="p">),</span> <span class="n">frame</span> <span class="p">::</span> <span class="nc">&lt;task-frame&gt;</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">(</span><span class="n">task</span> <span class="p">::</span> <span class="nb">false-or</span><span class="p">(</span><span class="nc">&lt;task&gt;</span><span class="p">))</span>
  <span class="k">let</span> <span class="n">list-box</span> <span class="o">=</span> <span class="n">task-list</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="n">gadget-value</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span> <span class="o">:=</span> <span class="n">task</span><span class="p">;</span>
  <span class="n">note-task-selection-change</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="n">task</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">frame-selected-task-setter</span><span class="p">;</span>
</pre></div>
</div>
<p>This method takes two arguments: the <code class="docutils literal notranslate"><span class="pre">task</span></code> to select in the task list
manager, and the <code class="docutils literal notranslate"><span class="pre">frame</span></code> to which the task belongs. It returns the task.
The method determines the list box used to display tasks in <code class="docutils literal notranslate"><span class="pre">frame</span></code>,
and then sets the <code class="docutils literal notranslate"><span class="pre">gadget-value</span></code> of that list box to <code class="docutils literal notranslate"><span class="pre">task</span></code>. Finally,
it calls <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code>, described below, to update other
parts of the user interface appropriately, such as buttons on the tool
bar.</p>
<p>As with most setter methods, <code class="docutils literal notranslate"><span class="pre">frame-selected-task-setter</span></code> is not called
directly. Instead, it is called implicitly by setting a value using
<code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code>. For example,</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">frame-selected-task</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">:=</span> <span class="l">#f</span><span class="p">;</span>
</pre></div>
</div>
<p>ensures that no tasks are selected in <code class="docutils literal notranslate"><span class="pre">frame</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">frame-selected-task-setter</span></code> method is called by two other methods:
<code class="docutils literal notranslate"><span class="pre">frame-add-task</span></code> (to ensure that the task added is subsequently
selected) and <code class="docutils literal notranslate"><span class="pre">frame-remove-task</span></code> (to ensure that no tasks are selected
once a task has been removed from the list). These methods are described
in <a class="reference internal" href="#duim-support-for-adding-and-removing-tasks">DUIM support for adding and removing tasks</a>.</p>
<p>Add the code for these methods to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
</div>
<div class="section" id="enabling-and-disabling-buttons-in-the-interface">
<h3>Enabling and disabling buttons in the interface<a class="headerlink" href="#enabling-and-disabling-buttons-in-the-interface" title="Permalink to this headline">¶</a></h3>
<p>The two methods for <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> make a number of
changes to the GUI of the task list manager, to ensure that the correct
information is displayed to the user. In particular, they perform any
changes necessary after an item in the task list has been selected or
deselected. They ensure that the correct priority is displayed in the
radio box, depending on whether there is a task currently selected, and
they also enable or disable the <em>Remove task</em> button and its equivalent
command in the <em>Task</em> menu, depending on whether there is a task
selected or not (if there is no task selected, then the button and menu
command should both be disabled).</p>
<p>There are two methods defined, one on an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code>,
and one on an instance of <code class="docutils literal notranslate"><span class="pre">&lt;gadget&gt;</span></code>. The Task List 1 project requires
both of these methods. For the Task List 2 project, however, the first
method requires a slightly different definition, and the second method
is not required at all.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> method defined on <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code>
is called by <code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code>, described on <a class="reference external" href="callbacks.html#refreshing-the-list-of-tasks">Refreshing the
list of tasks</a>. The
refresh-task-frame method is called whenever the list of tasks needs
to be refreshed for whatever reason. This happens most commonly after
adding or removing a task from the list, or loading in a new task list
from a file on disk. The method <code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> takes an instance
of <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code> as an argument and returns no values. For the
Task List 1 project, the <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> method is
defined:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">note-task-selection-change</span>
    <span class="p">(</span><span class="n">frame</span> <span class="p">::</span> <span class="nc">&lt;task-frame&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">task</span> <span class="o">=</span> <span class="n">frame-selected-task</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="n">frame</span><span class="p">.</span><span class="n">priority-box</span><span class="p">.</span><span class="n">gadget-value</span> <span class="o">:=</span> <span class="n">task</span><span class="p">.</span><span class="n">task-priority</span><span class="p">;</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">selection?</span> <span class="o">=</span> <span class="p">(</span><span class="n">task</span> <span class="o">~=</span> <span class="l">#f</span><span class="p">);</span>
  <span class="n">frame</span><span class="p">.</span><span class="n">remove-button</span><span class="p">.</span><span class="n">gadget-enabled?</span> <span class="o">:=</span> <span class="n">selection?</span><span class="p">;</span>
  <span class="n">frame</span><span class="p">.</span><span class="n">remove-menu-button</span><span class="p">.</span><span class="n">gadget-enabled?</span> <span class="o">:=</span> <span class="n">selection?</span><span class="p">;</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">note-task-selection-change</span><span class="p">;</span>
</pre></div>
</div>
<p>For the Task List 2 project the <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> method is
defined:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">note-task-selection-change</span>
    <span class="p">(</span><span class="n">frame</span> <span class="p">::</span> <span class="nc">&lt;task-frame&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">task</span> <span class="o">=</span> <span class="n">frame-selected-task</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="n">frame</span><span class="p">.</span><span class="n">priority-box</span><span class="p">.</span><span class="n">gadget-value</span> <span class="o">:=</span> <span class="n">task</span><span class="p">.</span><span class="n">task-priority</span><span class="p">;</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="n">command-enabled?</span><span class="p">(</span><span class="n">frame-remove-task</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span> <span class="o">:=</span> <span class="n">task</span> <span class="o">~=</span> <span class="l">#f</span><span class="p">;</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">note-task-selection-change</span><span class="p">;</span>
</pre></div>
</div>
<p>The method takes an instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code> as an argument, and
returns no values. It works by calling <code class="docutils literal notranslate"><span class="pre">frame-selected-task</span></code> to
determine which, if any, task is currently selected, and sets that to a
local variable, <code class="docutils literal notranslate"><span class="pre">task</span></code>.</p>
<p>The expression</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">)</span>
  <span class="n">frame</span><span class="p">.</span><span class="n">priority-box</span><span class="p">.</span><span class="n">gadget-value</span> <span class="o">:=</span> <span class="n">task</span><span class="p">.</span><span class="n">task-priority</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<p>sets the gadget value of the <code class="docutils literal notranslate"><span class="pre">priority-box</span></code> pane in the task list
manager to the value of the <code class="docutils literal notranslate"><span class="pre">task-priority</span></code> slot of the selected task,
if a task is selected. This ensures that if a task is selected, its
priority is displayed correctly beneath the list of tasks. Note that
<code class="docutils literal notranslate"><span class="pre">priority-box</span></code> may take the same set of values as the <code class="docutils literal notranslate"><span class="pre">task-priority</span></code>
slot, namely <code class="docutils literal notranslate"><span class="pre">#&quot;low&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">#&quot;medium&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">#&quot;high&quot;</span></code>, so it is
straightforward to make this kind of assignment.</p>
<p>The rest of the method deals with enabling or disabling gadgets that let
the user remove a task from the task list. If there is no task selected,
then <code class="docutils literal notranslate"><span class="pre">remove-button</span></code> and <code class="docutils literal notranslate"><span class="pre">remove-menu-button</span></code> need to be disabled. If
there is a task selected, then they need to be enabled. This behavior is
achieved by converting the value of the variable <code class="docutils literal notranslate"><span class="pre">task</span></code>, which can take
a value of <code class="docutils literal notranslate"><span class="pre">false-or(&lt;task&gt;)</span></code>, into a boolean value, called
<code class="docutils literal notranslate"><span class="pre">selection?</span></code>. This is done in the expression</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">selection?</span> <span class="o">=</span> <span class="p">(</span><span class="n">task</span> <span class="o">~=</span> <span class="l">#f</span><span class="p">);</span>
</pre></div>
</div>
<p>This sets <code class="docutils literal notranslate"><span class="pre">selection?</span></code> to the result of performing an inequality
comparison on <code class="docutils literal notranslate"><span class="pre">task</span></code> and <code class="docutils literal notranslate"><span class="pre">#f</span></code>. Thus, if <code class="docutils literal notranslate"><span class="pre">task</span></code> is <code class="docutils literal notranslate"><span class="pre">#f</span></code> (there is no
task selected), then <code class="docutils literal notranslate"><span class="pre">selection?</span></code> is <code class="docutils literal notranslate"><span class="pre">#f</span></code>, but if <code class="docutils literal notranslate"><span class="pre">task</span></code> is an instance
of <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;</span></code> (there is a task selected), then <code class="docutils literal notranslate"><span class="pre">selection?</span></code> is <code class="docutils literal notranslate"><span class="pre">#t</span></code>.</p>
<p>The two calls to <code class="docutils literal notranslate"><span class="pre">gadget-enabled?</span></code> then set the <code class="docutils literal notranslate"><span class="pre">gadget-enabled</span></code> slot of
the appropriate gadgets to the value of <code class="docutils literal notranslate"><span class="pre">selection?</span></code>, enabling or
disabling each gadget as appropriate.</p>
<p>The second method for <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> is defined for an
instance of <code class="docutils literal notranslate"><span class="pre">&lt;gadget&gt;</span></code>, as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">note-task-selection-change</span>
    <span class="p">(</span><span class="n">gadget</span> <span class="p">::</span> <span class="nc">&lt;gadget&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">gadget</span><span class="p">.</span><span class="n">sheet-frame</span><span class="p">;</span>
  <span class="n">note-task-selection-change</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">note-task-selection-change</span><span class="p">;</span>
</pre></div>
</div>
<p>This takes a gadget as an argument. It simply finds the frame that the
gadget belongs to, and calls the other method for
<code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> on that frame.</p>
<p>The second method for <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> needs to be used as
the value-changed callback of the <code class="docutils literal notranslate"><span class="pre">task-list</span></code> pane in the definition of
<code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code> ; a value-changed callback is invoked whenever the
<code class="docutils literal notranslate"><span class="pre">gadget-value</span></code> of a gadget changes. Because the <code class="docutils literal notranslate"><span class="pre">gadget-value</span></code> of a list
box is the currently selected item, whenever a different item is
selected in the list box, <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code> is called.</p>
<p>In order to achieve this, a small change is needed to the definition of
the task-list pane in <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>. In this definition for the Task
List 1 project, change the line that reads:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">activate-callback</span><span class="o">:</span> <span class="s">not-yet-implemented);</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">value-changed-callback</span><span class="o">:</span> <span class="s">note-task-selection-change);</span>
</pre></div>
</div>
<p>and for the Task List 2 project change the line to</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="na">value-changed-callback</span><span class="o">:</span> <span class="s">method (gadget)</span>
<span class="s">  note-task-selection-change(frame) end);</span>
</pre></div>
</div>
<p>to give a final definition for this pane as follows:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="c1">// definition of list</span>
<span class="n">pane</span> <span class="n">task-list</span> <span class="p">(</span><span class="n">frame</span><span class="p">)</span>
  <span class="nb">make</span> <span class="p">(</span><span class="nc">&lt;list-box&gt;</span><span class="p">,</span>
        <span class="k">items:</span> <span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span><span class="p">.</span><span class="n">task-list-tasks</span><span class="p">,</span>
        <span class="k">label-key:</span> <span class="n">task-name</span><span class="p">,</span>
        <span class="k">lines:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="k">value-changed-callback:</span> <span class="n">note-task-selection-change</span><span class="p">);</span>
</pre></div>
</div>
<p>Add the code for these methods to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
</div>
<div class="section" id="id1">
<h3>Refreshing the list of tasks<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> method is called whenever the list of tasks
needs to be refreshed for whatever reason. This happens most commonly
after adding or removing a task from the list, or loading in a new task
list from a file on disk. The method <code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> takes an
instance of <code class="docutils literal notranslate"><span class="pre">&lt;task-frame&gt;</span></code> as an argument and returns no values. For the
Task List 1 project the definition is:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">refresh-task-frame</span>
    <span class="p">(</span><span class="n">frame</span> <span class="p">::</span> <span class="nc">&lt;task-frame&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">list-box</span> <span class="o">=</span> <span class="n">frame</span><span class="p">.</span><span class="n">task-list</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">modified?</span> <span class="o">=</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-modified?</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">tasks</span> <span class="o">=</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-tasks</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gadget-items</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span> <span class="o">==</span> <span class="n">tasks</span><span class="p">)</span>
    <span class="n">update-gadget</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">gadget-items</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span> <span class="o">:=</span> <span class="n">tasks</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="n">gadget-enabled?</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">save-button</span><span class="p">)</span> <span class="o">:=</span> <span class="n">modified?</span><span class="p">;</span>
  <span class="n">gadget-enabled?</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">save-menu-button</span><span class="p">)</span> <span class="o">:=</span> <span class="n">modified?</span><span class="p">;</span>
  <span class="n">note-task-selection-change</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">refresh-task-frame</span><span class="p">;</span>
</pre></div>
</div>
<p>However, the Task List 2 project requires a call to <code class="docutils literal notranslate"><span class="pre">command-enabled?</span></code>,
so the definition is:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">refresh-task-frame</span>
    <span class="p">(</span><span class="n">frame</span> <span class="p">::</span> <span class="nc">&lt;task-frame&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">list-box</span> <span class="o">=</span> <span class="n">frame</span><span class="p">.</span><span class="n">task-list</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">frame</span><span class="p">.</span><span class="n">frame-task-list</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">modified?</span> <span class="o">=</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-modified?</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">tasks</span> <span class="o">=</span> <span class="n">task-list</span><span class="p">.</span><span class="n">task-list-tasks</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gadget-items</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span> <span class="o">==</span> <span class="n">tasks</span><span class="p">)</span>
    <span class="n">update-gadget</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">gadget-items</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span> <span class="o">:=</span> <span class="n">tasks</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="n">command-enabled?</span><span class="p">(</span><span class="n">save-file</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span> <span class="o">:=</span> <span class="n">modified?</span><span class="p">;</span>
  <span class="n">note-task-selection-change</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">refresh-task-frame</span><span class="p">;</span>
</pre></div>
</div>
<p>To begin, <code class="docutils literal notranslate"><span class="pre">refresh-task-frame</span></code> sets a number of local variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">list-box</span></code> The list box used to display the list of tasks in task
list manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task-list</span></code> The task list currently loaded in the task list manager.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modified?</span></code> The value of the <code class="docutils literal notranslate"><span class="pre">task-list-modified?</span></code> slot of
<code class="docutils literal notranslate"><span class="pre">task-list</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tasks</span></code> The sequence of tasks stored in <code class="docutils literal notranslate"><span class="pre">task-list</span></code>.</p></li>
</ul>
<p>Next, the following code is executed:</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">gadget-items</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span> <span class="o">==</span> <span class="n">tasks</span><span class="p">)</span>
  <span class="n">update-gadget</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span>
<span class="k">else</span>
  <span class="n">gadget-items</span><span class="p">(</span><span class="n">list-box</span><span class="p">)</span> <span class="o">:=</span> <span class="n">tasks</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<p>This code ensures that if the items in the list box are the same as the
sequence of tasks in the task list, then the display in the list box is
updated to ensure all the items are displayed correctly. If the items in
the list box are not the same as the sequence of tasks, then the items
in the list box are updated to reflect the current task list. The items
in the list box could be different if a task had been added or removed
from the list, or if a completely new set of tasks had been loaded into
the task list manager.</p>
<p>Lastly, the following three lines</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="n">gadget-enabled?</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">save-button</span><span class="p">)</span> <span class="o">:=</span> <span class="n">modified?</span><span class="p">;</span>
<span class="n">gadget-enabled?</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">save-menu-button</span><span class="p">)</span> <span class="o">:=</span> <span class="n">modified?</span><span class="p">;</span>
<span class="n">note-task-selection-change</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
</pre></div>
</div>
<p>ensure that the <em>Save</em> button and <em>File &gt; Save</em> menu command are enabled
if the task list has been modified, and then any changes that need to be
made to the GUI as a result of changing the selected item are performed,
by calling <code class="docutils literal notranslate"><span class="pre">note-task-selection-change</span></code>.</p>
<p>Add the code for this method to <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
</div>
<div class="section" id="creating-an-information-dialog">
<span id="index-16"></span><h3>Creating an information dialog<a class="headerlink" href="#creating-an-information-dialog" title="Permalink to this headline">¶</a></h3>
<p>The following function displays a simple dialog box that provides
information about the application. This dialog is displayed when you
choose the <em>Help &gt; About</em> menu command.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">function</span> <span class="n">about-task</span> <span class="p">(</span><span class="n">gadget</span> <span class="p">::</span> <span class="nc">&lt;gadget&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="n">notify-user</span><span class="p">(</span><span class="s">&quot;Task List Manager&quot;</span><span class="p">,</span> <span class="k">owner:</span> <span class="n">sheet-frame</span><span class="p">(</span><span class="n">gadget</span><span class="p">))</span>
<span class="k">end</span> <span class="nb">function</span> <span class="n">about-task</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="exiting-the-task-list-manager">
<span id="index-17"></span><h3>Exiting the task list manager<a class="headerlink" href="#exiting-the-task-list-manager" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">exit-task</span></code> method allows you to exit the task list manager. It is
invoked by choosing <em>File &gt; Exit</em>. The definition of this method is
quite simple.</p>
<div class="highlight-dylan notranslate"><div class="highlight"><pre><span></span><span class="k">define</span> <span class="nb">method</span> <span class="n">exit-task</span> <span class="p">(</span><span class="n">gadget</span> <span class="p">::</span> <span class="nc">&lt;gadget&gt;</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">()</span>
  <span class="k">let</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">sheet-frame</span><span class="p">(</span><span class="n">gadget</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">task-list</span> <span class="o">=</span> <span class="n">frame-task-list</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
  <span class="n">save-file</span> <span class="p">(</span><span class="n">gadget</span><span class="p">);</span>
  <span class="n">exit-frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="k">end</span> <span class="nb">method</span> <span class="n">exit-task</span><span class="p">;</span>
</pre></div>
</div>
<p>Add this method to the file <code class="docutils literal notranslate"><span class="pre">frame.dylan</span></code>.</p>
<p>The method takes the gadget used to invoke it and returns no values. In
this case, <code class="docutils literal notranslate"><span class="pre">exit-task</span></code> is only ever invoked by the <code class="docutils literal notranslate"><span class="pre">exit-menu-button</span></code>
gadget.</p>
<p>As with many other callbacks in this example, <code class="docutils literal notranslate"><span class="pre">exit-task</span></code> sets a number
of local variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frame</span></code> The frame that the gadget argument belongs to.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task-list</span></code> The task list associated with <code class="docutils literal notranslate"><span class="pre">frame</span></code>.</p></li>
</ul>
<p>The method begins by calling the <code class="docutils literal notranslate"><span class="pre">save-file</span></code> method (defined in <a class="reference internal" href="#the-save-file-method">The
save-file method</a>) to save the current task list to disk. This ensures
that the user does not lose any work. Next, the <code class="docutils literal notranslate"><span class="pre">exit-frame</span></code> generic
function is invoked to exit the task list manager window.</p>
</div>
</div>
<div class="section" id="enhancing-the-task-list-manager">
<span id="index-18"></span><h2>Enhancing the task list manager<a class="headerlink" href="#enhancing-the-task-list-manager" title="Permalink to this headline">¶</a></h2>
<p>This concludes the tutorial on building application with DUIM. At this
point, you can build and run a functional task list manager, but it is a
very basic application. <a class="reference internal" href="commands.html"><span class="doc">Using Command Tables</span></a> introduces command tables as a way of
defining hierarchies of menu commands. To do this, it re-implements the
menu hierarchy you defined in <a class="reference internal" href="menus.html"><span class="doc">Adding Menus To The Application</span></a>, but does not add any new
functionality to the application.</p>
<p>There are many ways that the task list manager could be extended, and
you might like to try experimenting with the code. To begin with, very
little error checking has been written into the application, and you
might like to add some in order to make the task list manager more
robust. For example, it is currently possible to exit the task list
manager and lose any changes in an unsaved list of tasks.</p>
<p>In addition to error checking, there is a wide range of new
functionality you might like to add. A few ideas are listed below:</p>
<ul class="simple">
<li><p>Re-implement the list box and radio box in the main window of the
task list manager as a table control, so that the priority of each
task is displayed next to the text for the task.</p></li>
<li><p>Implement the facility to define categories, so that tasks could be
assigned categories such as “Home” and “Business”. Categories could
be listed in the table control alongside priorities.</p></li>
<li><p>Allow sorting the list of tasks according to a key. Tasks could then
be sorted by priority or category.</p></li>
<li><p>Implement the ability to mark tasks as complete.</p></li>
<li><p>Allow users to add text memos to any task.</p></li>
</ul>
<p>This is only a very limited list of ideas. After learning about command
tables in <a class="reference internal" href="commands.html"><span class="doc">Using Command Tables</span></a>, read through <a class="reference internal" href="tour.html"><span class="doc">A Tour of the DUIM Libraries</span></a> to learn more about
the features that DUIM provides. Then, using the <em>DUIM Reference Manual</em>
as your reference source, get coding!</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="menus.html" class="btn btn-neutral float-left" title="Adding Menus To The Application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="commands.html" class="btn btn-neutral float-right" title="Using Command Tables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="copyright.html">Copyright</a> 2011-2023, Dylan Hackers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>